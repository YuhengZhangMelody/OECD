var iP=Object.defineProperty;var nP=(l,o,u)=>o in l?iP(l,o,{enumerable:!0,configurable:!0,writable:!0,value:u}):l[o]=u;var ei=(l,o,u)=>(nP(l,typeof o!="symbol"?o+"":o,u),u);(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))m(_);new MutationObserver(_=>{for(const v of _)if(v.type==="childList")for(const M of v.addedNodes)M.tagName==="LINK"&&M.rel==="modulepreload"&&m(M)}).observe(document,{childList:!0,subtree:!0});function u(_){const v={};return _.integrity&&(v.integrity=_.integrity),_.referrerPolicy&&(v.referrerPolicy=_.referrerPolicy),_.crossOrigin==="use-credentials"?v.credentials="include":_.crossOrigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function m(_){if(_.ep)return;_.ep=!0;const v=u(_);fetch(_.href,v)}})();/**
* @vue/shared v3.4.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function L0(l,o){const u=new Set(l.split(","));return m=>u.has(m)}const or={},Zu=[],js=()=>{},rP=()=>!1,P_=l=>l.charCodeAt(0)===111&&l.charCodeAt(1)===110&&(l.charCodeAt(2)>122||l.charCodeAt(2)<97),k0=l=>l.startsWith("onUpdate:"),Vr=Object.assign,R0=(l,o)=>{const u=l.indexOf(o);u>-1&&l.splice(u,1)},sP=Object.prototype.hasOwnProperty,En=(l,o)=>sP.call(l,o),nn=Array.isArray,Xu=l=>D_(l)==="[object Map]",MM=l=>D_(l)==="[object Set]",cn=l=>typeof l=="function",zr=l=>typeof l=="string",Uc=l=>typeof l=="symbol",_r=l=>l!==null&&typeof l=="object",SM=l=>(_r(l)||cn(l))&&cn(l.then)&&cn(l.catch),EM=Object.prototype.toString,D_=l=>EM.call(l),oP=l=>D_(l).slice(8,-1),AM=l=>D_(l)==="[object Object]",z0=l=>zr(l)&&l!=="NaN"&&l[0]!=="-"&&""+parseInt(l,10)===l,vf=L0(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),L_=l=>{const o=Object.create(null);return u=>o[u]||(o[u]=l(u))},aP=/-(\w)/g,Go=L_(l=>l.replace(aP,(o,u)=>u?u.toUpperCase():"")),lP=/\B([A-Z])/g,ih=L_(l=>l.replace(lP,"-$1").toLowerCase()),k_=L_(l=>l.charAt(0).toUpperCase()+l.slice(1)),zy=L_(l=>l?`on${k_(l)}`:""),Bc=(l,o)=>!Object.is(l,o),Oy=(l,o)=>{for(let u=0;u<l.length;u++)l[u](o)},IM=(l,o,u,m=!1)=>{Object.defineProperty(l,o,{configurable:!0,enumerable:!1,writable:m,value:u})},cP=l=>{const o=parseFloat(l);return isNaN(o)?l:o};let Tw;const CM=()=>Tw||(Tw=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function O0(l){if(nn(l)){const o={};for(let u=0;u<l.length;u++){const m=l[u],_=zr(m)?fP(m):O0(m);if(_)for(const v in _)o[v]=_[v]}return o}else if(zr(l)||_r(l))return l}const uP=/;(?![^(]*\))/g,hP=/:([^]+)/,dP=/\/\*[^]*?\*\//g;function fP(l){const o={};return l.replace(dP,"").split(uP).forEach(u=>{if(u){const m=u.split(hP);m.length>1&&(o[m[0].trim()]=m[1].trim())}}),o}function F0(l){let o="";if(zr(l))o=l;else if(nn(l))for(let u=0;u<l.length;u++){const m=F0(l[u]);m&&(o+=m+" ")}else if(_r(l))for(const u in l)l[u]&&(o+=u+" ");return o.trim()}const pP="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",mP=L0(pP);function PM(l){return!!l||l===""}const _P=l=>zr(l)?l:l==null?"":nn(l)||_r(l)&&(l.toString===EM||!cn(l.toString))?JSON.stringify(l,DM,2):String(l),DM=(l,o)=>o&&o.__v_isRef?DM(l,o.value):Xu(o)?{[`Map(${o.size})`]:[...o.entries()].reduce((u,[m,_],v)=>(u[Fy(m,v)+" =>"]=_,u),{})}:MM(o)?{[`Set(${o.size})`]:[...o.values()].map(u=>Fy(u))}:Uc(o)?Fy(o):_r(o)&&!nn(o)&&!AM(o)?String(o):o,Fy=(l,o="")=>{var u;return Uc(l)?`Symbol(${(u=l.description)!=null?u:o})`:l};/**
* @vue/reactivity v3.4.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let oo;class gP{constructor(o=!1){this.detached=o,this._active=!0,this.effects=[],this.cleanups=[],this.parent=oo,!o&&oo&&(this.index=(oo.scopes||(oo.scopes=[])).push(this)-1)}get active(){return this._active}run(o){if(this._active){const u=oo;try{return oo=this,o()}finally{oo=u}}}on(){oo=this}off(){oo=this.parent}stop(o){if(this._active){let u,m;for(u=0,m=this.effects.length;u<m;u++)this.effects[u].stop();for(u=0,m=this.cleanups.length;u<m;u++)this.cleanups[u]();if(this.scopes)for(u=0,m=this.scopes.length;u<m;u++)this.scopes[u].stop(!0);if(!this.detached&&this.parent&&!o){const _=this.parent.scopes.pop();_&&_!==this&&(this.parent.scopes[this.index]=_,_.index=this.index)}this.parent=void 0,this._active=!1}}}function yP(l,o=oo){o&&o.active&&o.effects.push(l)}function xP(){return oo}let Rc;class B0{constructor(o,u,m,_){this.fn=o,this.trigger=u,this.scheduler=m,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,yP(this,_)}get dirty(){if(this._dirtyLevel===2||this._dirtyLevel===3){this._dirtyLevel=1,Sl();for(let o=0;o<this._depsLength;o++){const u=this.deps[o];if(u.computed&&(vP(u.computed),this._dirtyLevel>=4))break}this._dirtyLevel===1&&(this._dirtyLevel=0),El()}return this._dirtyLevel>=4}set dirty(o){this._dirtyLevel=o?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let o=xl,u=Rc;try{return xl=!0,Rc=this,this._runnings++,Mw(this),this.fn()}finally{Sw(this),this._runnings--,Rc=u,xl=o}}stop(){this.active&&(Mw(this),Sw(this),this.onStop&&this.onStop(),this.active=!1)}}function vP(l){return l.value}function Mw(l){l._trackId++,l._depsLength=0}function Sw(l){if(l.deps.length>l._depsLength){for(let o=l._depsLength;o<l.deps.length;o++)LM(l.deps[o],l);l.deps.length=l._depsLength}}function LM(l,o){const u=l.get(o);u!==void 0&&o._trackId!==u&&(l.delete(o),l.size===0&&l.cleanup())}let xl=!0,r0=0;const kM=[];function Sl(){kM.push(xl),xl=!1}function El(){const l=kM.pop();xl=l===void 0?!0:l}function N0(){r0++}function V0(){for(r0--;!r0&&s0.length;)s0.shift()()}function RM(l,o,u){if(o.get(l)!==l._trackId){o.set(l,l._trackId);const m=l.deps[l._depsLength];m!==o?(m&&LM(m,l),l.deps[l._depsLength++]=o):l._depsLength++}}const s0=[];function zM(l,o,u){N0();for(const m of l.keys()){let _;m._dirtyLevel<o&&(_??(_=l.get(m)===m._trackId))&&(m._shouldSchedule||(m._shouldSchedule=m._dirtyLevel===0),m._dirtyLevel=o),m._shouldSchedule&&(_??(_=l.get(m)===m._trackId))&&(m.trigger(),(!m._runnings||m.allowRecurse)&&m._dirtyLevel!==2&&(m._shouldSchedule=!1,m.scheduler&&s0.push(m.scheduler)))}V0()}const OM=(l,o)=>{const u=new Map;return u.cleanup=l,u.computed=o,u},o0=new WeakMap,zc=Symbol(""),a0=Symbol("");function xs(l,o,u){if(xl&&Rc){let m=o0.get(l);m||o0.set(l,m=new Map);let _=m.get(u);_||m.set(u,_=OM(()=>m.delete(u))),RM(Rc,_)}}function Ta(l,o,u,m,_,v){const M=o0.get(l);if(!M)return;let A=[];if(o==="clear")A=[...M.values()];else if(u==="length"&&nn(l)){const r=Number(m);M.forEach((k,N)=>{(N==="length"||!Uc(N)&&N>=r)&&A.push(k)})}else switch(u!==void 0&&A.push(M.get(u)),o){case"add":nn(l)?z0(u)&&A.push(M.get("length")):(A.push(M.get(zc)),Xu(l)&&A.push(M.get(a0)));break;case"delete":nn(l)||(A.push(M.get(zc)),Xu(l)&&A.push(M.get(a0)));break;case"set":Xu(l)&&A.push(M.get(zc));break}N0();for(const r of A)r&&zM(r,4);V0()}const bP=L0("__proto__,__v_isRef,__isVue"),FM=new Set(Object.getOwnPropertyNames(Symbol).filter(l=>l!=="arguments"&&l!=="caller").map(l=>Symbol[l]).filter(Uc)),Ew=wP();function wP(){const l={};return["includes","indexOf","lastIndexOf"].forEach(o=>{l[o]=function(...u){const m=Hn(this);for(let v=0,M=this.length;v<M;v++)xs(m,"get",v+"");const _=m[o](...u);return _===-1||_===!1?m[o](...u.map(Hn)):_}}),["push","pop","shift","unshift","splice"].forEach(o=>{l[o]=function(...u){Sl(),N0();const m=Hn(this)[o].apply(this,u);return V0(),El(),m}}),l}function TP(l){Uc(l)||(l=String(l));const o=Hn(this);return xs(o,"has",l),o.hasOwnProperty(l)}class BM{constructor(o=!1,u=!1){this._isReadonly=o,this._isShallow=u}get(o,u,m){const _=this._isReadonly,v=this._isShallow;if(u==="__v_isReactive")return!_;if(u==="__v_isReadonly")return _;if(u==="__v_isShallow")return v;if(u==="__v_raw")return m===(_?v?OP:jM:v?UM:VM).get(o)||Object.getPrototypeOf(o)===Object.getPrototypeOf(m)?o:void 0;const M=nn(o);if(!_){if(M&&En(Ew,u))return Reflect.get(Ew,u,m);if(u==="hasOwnProperty")return TP}const A=Reflect.get(o,u,m);return(Uc(u)?FM.has(u):bP(u))||(_||xs(o,"get",u),v)?A:zs(A)?M&&z0(u)?A:A.value:_r(A)?_?GM(A):G0(A):A}}class NM extends BM{constructor(o=!1){super(!1,o)}set(o,u,m,_){let v=o[u];if(!this._isShallow){const r=y_(v);if(!l0(m)&&!y_(m)&&(v=Hn(v),m=Hn(m)),!nn(o)&&zs(v)&&!zs(m))return r?!1:(v.value=m,!0)}const M=nn(o)&&z0(u)?Number(u)<o.length:En(o,u),A=Reflect.set(o,u,m,_);return o===Hn(_)&&(M?Bc(m,v)&&Ta(o,"set",u,m):Ta(o,"add",u,m)),A}deleteProperty(o,u){const m=En(o,u);o[u];const _=Reflect.deleteProperty(o,u);return _&&m&&Ta(o,"delete",u,void 0),_}has(o,u){const m=Reflect.has(o,u);return(!Uc(u)||!FM.has(u))&&xs(o,"has",u),m}ownKeys(o){return xs(o,"iterate",nn(o)?"length":zc),Reflect.ownKeys(o)}}class MP extends BM{constructor(o=!1){super(!0,o)}set(o,u){return!0}deleteProperty(o,u){return!0}}const SP=new NM,EP=new MP,AP=new NM(!0);const U0=l=>l,R_=l=>Reflect.getPrototypeOf(l);function Bm(l,o,u=!1,m=!1){l=l.__v_raw;const _=Hn(l),v=Hn(o);u||(Bc(o,v)&&xs(_,"get",o),xs(_,"get",v));const{has:M}=R_(_),A=m?U0:u?H0:W0;if(M.call(_,o))return A(l.get(o));if(M.call(_,v))return A(l.get(v));l!==_&&l.get(o)}function Nm(l,o=!1){const u=this.__v_raw,m=Hn(u),_=Hn(l);return o||(Bc(l,_)&&xs(m,"has",l),xs(m,"has",_)),l===_?u.has(l):u.has(l)||u.has(_)}function Vm(l,o=!1){return l=l.__v_raw,!o&&xs(Hn(l),"iterate",zc),Reflect.get(l,"size",l)}function Aw(l){l=Hn(l);const o=Hn(this);return R_(o).has.call(o,l)||(o.add(l),Ta(o,"add",l,l)),this}function Iw(l,o){o=Hn(o);const u=Hn(this),{has:m,get:_}=R_(u);let v=m.call(u,l);v||(l=Hn(l),v=m.call(u,l));const M=_.call(u,l);return u.set(l,o),v?Bc(o,M)&&Ta(u,"set",l,o):Ta(u,"add",l,o),this}function Cw(l){const o=Hn(this),{has:u,get:m}=R_(o);let _=u.call(o,l);_||(l=Hn(l),_=u.call(o,l)),m&&m.call(o,l);const v=o.delete(l);return _&&Ta(o,"delete",l,void 0),v}function Pw(){const l=Hn(this),o=l.size!==0,u=l.clear();return o&&Ta(l,"clear",void 0,void 0),u}function Um(l,o){return function(m,_){const v=this,M=v.__v_raw,A=Hn(M),r=o?U0:l?H0:W0;return!l&&xs(A,"iterate",zc),M.forEach((k,N)=>m.call(_,r(k),r(N),v))}}function jm(l,o,u){return function(...m){const _=this.__v_raw,v=Hn(_),M=Xu(v),A=l==="entries"||l===Symbol.iterator&&M,r=l==="keys"&&M,k=_[l](...m),N=u?U0:o?H0:W0;return!o&&xs(v,"iterate",r?a0:zc),{next(){const{value:G,done:K}=k.next();return K?{value:G,done:K}:{value:A?[N(G[0]),N(G[1])]:N(G),done:K}},[Symbol.iterator](){return this}}}}function hl(l){return function(...o){return l==="delete"?!1:l==="clear"?void 0:this}}function IP(){const l={get(v){return Bm(this,v)},get size(){return Vm(this)},has:Nm,add:Aw,set:Iw,delete:Cw,clear:Pw,forEach:Um(!1,!1)},o={get(v){return Bm(this,v,!1,!0)},get size(){return Vm(this)},has:Nm,add:Aw,set:Iw,delete:Cw,clear:Pw,forEach:Um(!1,!0)},u={get(v){return Bm(this,v,!0)},get size(){return Vm(this,!0)},has(v){return Nm.call(this,v,!0)},add:hl("add"),set:hl("set"),delete:hl("delete"),clear:hl("clear"),forEach:Um(!0,!1)},m={get(v){return Bm(this,v,!0,!0)},get size(){return Vm(this,!0)},has(v){return Nm.call(this,v,!0)},add:hl("add"),set:hl("set"),delete:hl("delete"),clear:hl("clear"),forEach:Um(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(v=>{l[v]=jm(v,!1,!1),u[v]=jm(v,!0,!1),o[v]=jm(v,!1,!0),m[v]=jm(v,!0,!0)}),[l,u,o,m]}const[CP,PP,DP,LP]=IP();function j0(l,o){const u=o?l?LP:DP:l?PP:CP;return(m,_,v)=>_==="__v_isReactive"?!l:_==="__v_isReadonly"?l:_==="__v_raw"?m:Reflect.get(En(u,_)&&_ in m?u:m,_,v)}const kP={get:j0(!1,!1)},RP={get:j0(!1,!0)},zP={get:j0(!0,!1)};const VM=new WeakMap,UM=new WeakMap,jM=new WeakMap,OP=new WeakMap;function FP(l){switch(l){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function BP(l){return l.__v_skip||!Object.isExtensible(l)?0:FP(oP(l))}function G0(l){return y_(l)?l:$0(l,!1,SP,kP,VM)}function NP(l){return $0(l,!1,AP,RP,UM)}function GM(l){return $0(l,!0,EP,zP,jM)}function $0(l,o,u,m,_){if(!_r(l)||l.__v_raw&&!(o&&l.__v_isReactive))return l;const v=_.get(l);if(v)return v;const M=BP(l);if(M===0)return l;const A=new Proxy(l,M===2?m:u);return _.set(l,A),A}function bf(l){return y_(l)?bf(l.__v_raw):!!(l&&l.__v_isReactive)}function y_(l){return!!(l&&l.__v_isReadonly)}function l0(l){return!!(l&&l.__v_isShallow)}function $M(l){return l?!!l.__v_raw:!1}function Hn(l){const o=l&&l.__v_raw;return o?Hn(o):l}function VP(l){return Object.isExtensible(l)&&IM(l,"__v_skip",!0),l}const W0=l=>_r(l)?G0(l):l,H0=l=>_r(l)?GM(l):l;class WM{constructor(o,u,m,_){this.getter=o,this._setter=u,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new B0(()=>o(this._value),()=>By(this,this.effect._dirtyLevel===2?2:3)),this.effect.computed=this,this.effect.active=this._cacheable=!_,this.__v_isReadonly=m}get value(){const o=Hn(this);return(!o._cacheable||o.effect.dirty)&&Bc(o._value,o._value=o.effect.run())&&By(o,4),jP(o),o.effect._dirtyLevel>=2&&By(o,2),o._value}set value(o){this._setter(o)}get _dirty(){return this.effect.dirty}set _dirty(o){this.effect.dirty=o}}function UP(l,o,u=!1){let m,_;const v=cn(l);return v?(m=l,_=js):(m=l.get,_=l.set),new WM(m,_,v||!_,u)}function jP(l){var o;xl&&Rc&&(l=Hn(l),RM(Rc,(o=l.dep)!=null?o:l.dep=OM(()=>l.dep=void 0,l instanceof WM?l:void 0)))}function By(l,o=4,u){l=Hn(l);const m=l.dep;m&&zM(m,o)}function zs(l){return!!(l&&l.__v_isRef===!0)}function GP(l){return zs(l)?l.value:l}const $P={get:(l,o,u)=>GP(Reflect.get(l,o,u)),set:(l,o,u,m)=>{const _=l[o];return zs(_)&&!zs(u)?(_.value=u,!0):Reflect.set(l,o,u,m)}};function HM(l){return bf(l)?l:new Proxy(l,$P)}/**
* @vue/runtime-core v3.4.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function vl(l,o,u,m){try{return m?l(...m):l()}catch(_){z_(_,o,u)}}function uo(l,o,u,m){if(cn(l)){const _=vl(l,o,u,m);return _&&SM(_)&&_.catch(v=>{z_(v,o,u)}),_}if(nn(l)){const _=[];for(let v=0;v<l.length;v++)_.push(uo(l[v],o,u,m));return _}}function z_(l,o,u,m=!0){const _=o?o.vnode:null;if(o){let v=o.parent;const M=o.proxy,A=`https://vuejs.org/error-reference/#runtime-${u}`;for(;v;){const k=v.ec;if(k){for(let N=0;N<k.length;N++)if(k[N](l,M,A)===!1)return}v=v.parent}const r=o.appContext.config.errorHandler;if(r){Sl(),vl(r,null,10,[l,M,A]),El();return}}WP(l,u,_,m)}function WP(l,o,u,m=!0){console.error(l)}let Pf=!1,c0=!1;const Kr=[];let Uo=0;const Yu=[];let dl=null,Lc=0;const qM=Promise.resolve();let q0=null;function HP(l){const o=q0||qM;return l?o.then(this?l.bind(this):l):o}function qP(l){let o=Uo+1,u=Kr.length;for(;o<u;){const m=o+u>>>1,_=Kr[m],v=Df(_);v<l||v===l&&_.pre?o=m+1:u=m}return o}function Z0(l){(!Kr.length||!Kr.includes(l,Pf&&l.allowRecurse?Uo+1:Uo))&&(l.id==null?Kr.push(l):Kr.splice(qP(l.id),0,l),ZM())}function ZM(){!Pf&&!c0&&(c0=!0,q0=qM.then(YM))}function ZP(l){const o=Kr.indexOf(l);o>Uo&&Kr.splice(o,1)}function XP(l){nn(l)?Yu.push(...l):(!dl||!dl.includes(l,l.allowRecurse?Lc+1:Lc))&&Yu.push(l),ZM()}function Dw(l,o,u=Pf?Uo+1:0){for(;u<Kr.length;u++){const m=Kr[u];if(m&&m.pre){if(l&&m.id!==l.uid)continue;Kr.splice(u,1),u--,m()}}}function XM(l){if(Yu.length){const o=[...new Set(Yu)].sort((u,m)=>Df(u)-Df(m));if(Yu.length=0,dl){dl.push(...o);return}for(dl=o,Lc=0;Lc<dl.length;Lc++)dl[Lc]();dl=null,Lc=0}}const Df=l=>l.id==null?1/0:l.id,YP=(l,o)=>{const u=Df(l)-Df(o);if(u===0){if(l.pre&&!o.pre)return-1;if(o.pre&&!l.pre)return 1}return u};function YM(l){c0=!1,Pf=!0,Kr.sort(YP);try{for(Uo=0;Uo<Kr.length;Uo++){const o=Kr[Uo];o&&o.active!==!1&&vl(o,null,14)}}finally{Uo=0,Kr.length=0,XM(),Pf=!1,q0=null,(Kr.length||Yu.length)&&YM()}}function KP(l,o,...u){if(l.isUnmounted)return;const m=l.vnode.props||or;let _=u;const v=o.startsWith("update:"),M=v&&o.slice(7);if(M&&M in m){const N=`${M==="modelValue"?"model":M}Modifiers`,{number:G,trim:K}=m[N]||or;K&&(_=u.map(ie=>zr(ie)?ie.trim():ie)),G&&(_=u.map(cP))}let A,r=m[A=zy(o)]||m[A=zy(Go(o))];!r&&v&&(r=m[A=zy(ih(o))]),r&&uo(r,l,6,_);const k=m[A+"Once"];if(k){if(!l.emitted)l.emitted={};else if(l.emitted[A])return;l.emitted[A]=!0,uo(k,l,6,_)}}function KM(l,o,u=!1){const m=o.emitsCache,_=m.get(l);if(_!==void 0)return _;const v=l.emits;let M={},A=!1;if(!cn(l)){const r=k=>{const N=KM(k,o,!0);N&&(A=!0,Vr(M,N))};!u&&o.mixins.length&&o.mixins.forEach(r),l.extends&&r(l.extends),l.mixins&&l.mixins.forEach(r)}return!v&&!A?(_r(l)&&m.set(l,null),null):(nn(v)?v.forEach(r=>M[r]=null):Vr(M,v),_r(l)&&m.set(l,M),M)}function O_(l,o){return!l||!P_(o)?!1:(o=o.slice(2).replace(/Once$/,""),En(l,o[0].toLowerCase()+o.slice(1))||En(l,ih(o))||En(l,o))}let ao=null,JM=null;function x_(l){const o=ao;return ao=l,JM=l&&l.type.__scopeId||null,o}function JP(l,o=ao,u){if(!o||l._n)return l;const m=(..._)=>{m._d&&jw(-1);const v=x_(o);let M;try{M=l(..._)}finally{x_(v),m._d&&jw(1)}return M};return m._n=!0,m._c=!0,m._d=!0,m}function Ny(l){const{type:o,vnode:u,proxy:m,withProxy:_,propsOptions:[v],slots:M,attrs:A,emit:r,render:k,renderCache:N,props:G,data:K,setupState:ie,ctx:pe,inheritAttrs:ge}=l,Te=x_(l);let Re,$e;try{if(u.shapeFlag&4){const ut=_||m,ot=ut;Re=Vo(k.call(ot,ut,N,G,ie,K,pe)),$e=A}else{const ut=o;Re=Vo(ut.length>1?ut(G,{attrs:A,slots:M,emit:r}):ut(G,null)),$e=o.props?A:QP(A)}}catch(ut){Mf.length=0,z_(ut,l,1),Re=bl(Lf)}let tt=Re;if($e&&ge!==!1){const ut=Object.keys($e),{shapeFlag:ot}=tt;ut.length&&ot&7&&(v&&ut.some(k0)&&($e=eD($e,v)),tt=Ju(tt,$e,!1,!0))}return u.dirs&&(tt=Ju(tt,null,!1,!0),tt.dirs=tt.dirs?tt.dirs.concat(u.dirs):u.dirs),u.transition&&(tt.transition=u.transition),Re=tt,x_(Te),Re}const QP=l=>{let o;for(const u in l)(u==="class"||u==="style"||P_(u))&&((o||(o={}))[u]=l[u]);return o},eD=(l,o)=>{const u={};for(const m in l)(!k0(m)||!(m.slice(9)in o))&&(u[m]=l[m]);return u};function tD(l,o,u){const{props:m,children:_,component:v}=l,{props:M,children:A,patchFlag:r}=o,k=v.emitsOptions;if(o.dirs||o.transition)return!0;if(u&&r>=0){if(r&1024)return!0;if(r&16)return m?Lw(m,M,k):!!M;if(r&8){const N=o.dynamicProps;for(let G=0;G<N.length;G++){const K=N[G];if(M[K]!==m[K]&&!O_(k,K))return!0}}}else return(_||A)&&(!A||!A.$stable)?!0:m===M?!1:m?M?Lw(m,M,k):!0:!!M;return!1}function Lw(l,o,u){const m=Object.keys(o);if(m.length!==Object.keys(l).length)return!0;for(let _=0;_<m.length;_++){const v=m[_];if(o[v]!==l[v]&&!O_(u,v))return!0}return!1}function iD({vnode:l,parent:o},u){for(;o;){const m=o.subTree;if(m.suspense&&m.suspense.activeBranch===l&&(m.el=l.el),m===l)(l=o.vnode).el=u,o=o.parent;else break}}const QM="components";function nD(l,o){return sD(QM,l,!0,o)||l}const rD=Symbol.for("v-ndc");function sD(l,o,u=!0,m=!1){const _=ao||Jr;if(_){const v=_.type;if(l===QM){const A=tL(v,!1);if(A&&(A===o||A===Go(o)||A===k_(Go(o))))return v}const M=kw(_[l]||v[l],o)||kw(_.appContext[l],o);return!M&&m?v:M}}function kw(l,o){return l&&(l[o]||l[Go(o)]||l[k_(Go(o))])}const oD=l=>l.__isSuspense;function aD(l,o){o&&o.pendingBranch?nn(l)?o.effects.push(...l):o.effects.push(l):XP(l)}const lD=Symbol.for("v-scx"),cD=()=>o_(lD),Gm={};function Vy(l,o,u){return eS(l,o,u)}function eS(l,o,{immediate:u,deep:m,flush:_,once:v,onTrack:M,onTrigger:A}=or){if(o&&v){const at=o;o=(...dt)=>{at(...dt),ot()}}const r=Jr,k=at=>m===!0?at:qu(at,m===!1?1:void 0);let N,G=!1,K=!1;if(zs(l)?(N=()=>l.value,G=l0(l)):bf(l)?(N=()=>k(l),G=!0):nn(l)?(K=!0,G=l.some(at=>bf(at)||l0(at)),N=()=>l.map(at=>{if(zs(at))return at.value;if(bf(at))return k(at);if(cn(at))return vl(at,r,2)})):cn(l)?o?N=()=>vl(l,r,2):N=()=>(ie&&ie(),uo(l,r,3,[pe])):N=js,o&&m){const at=N;N=()=>qu(at())}let ie,pe=at=>{ie=tt.onStop=()=>{vl(at,r,4),ie=tt.onStop=void 0}},ge;if(N_)if(pe=js,o?u&&uo(o,r,3,[N(),K?[]:void 0,pe]):N(),_==="sync"){const at=cD();ge=at.__watcherHandles||(at.__watcherHandles=[])}else return js;let Te=K?new Array(l.length).fill(Gm):Gm;const Re=()=>{if(!(!tt.active||!tt.dirty))if(o){const at=tt.run();(m||G||(K?at.some((dt,xe)=>Bc(dt,Te[xe])):Bc(at,Te)))&&(ie&&ie(),uo(o,r,3,[at,Te===Gm?void 0:K&&Te[0]===Gm?[]:Te,pe]),Te=at)}else tt.run()};Re.allowRecurse=!!o;let $e;_==="sync"?$e=Re:_==="post"?$e=()=>gs(Re,r&&r.suspense):(Re.pre=!0,r&&(Re.id=r.uid),$e=()=>Z0(Re));const tt=new B0(N,js,$e),ut=xP(),ot=()=>{tt.stop(),ut&&R0(ut.effects,tt)};return o?u?Re():Te=tt.run():_==="post"?gs(tt.run.bind(tt),r&&r.suspense):tt.run(),ge&&ge.push(ot),ot}function uD(l,o,u){const m=this.proxy,_=zr(l)?l.includes(".")?tS(m,l):()=>m[l]:l.bind(m,m);let v;cn(o)?v=o:(v=o.handler,u=o);const M=jf(this),A=eS(_,v.bind(m),u);return M(),A}function tS(l,o){const u=o.split(".");return()=>{let m=l;for(let _=0;_<u.length&&m;_++)m=m[u[_]];return m}}function qu(l,o=1/0,u){if(o<=0||!_r(l)||l.__v_skip||(u=u||new Set,u.has(l)))return l;if(u.add(l),o--,zs(l))qu(l.value,o,u);else if(nn(l))for(let m=0;m<l.length;m++)qu(l[m],o,u);else if(MM(l)||Xu(l))l.forEach(m=>{qu(m,o,u)});else if(AM(l))for(const m in l)qu(l[m],o,u);return l}function Mc(l,o,u,m){const _=l.dirs,v=o&&o.dirs;for(let M=0;M<_.length;M++){const A=_[M];v&&(A.oldValue=v[M].value);let r=A.dir[m];r&&(Sl(),uo(r,u,8,[l.el,A,l,o]),El())}}const s_=l=>!!l.type.__asyncLoader,iS=l=>l.type.__isKeepAlive;function hD(l,o){nS(l,"a",o)}function dD(l,o){nS(l,"da",o)}function nS(l,o,u=Jr){const m=l.__wdc||(l.__wdc=()=>{let _=u;for(;_;){if(_.isDeactivated)return;_=_.parent}return l()});if(F_(o,m,u),u){let _=u.parent;for(;_&&_.parent;)iS(_.parent.vnode)&&fD(m,o,u,_),_=_.parent}}function fD(l,o,u,m){const _=F_(o,l,m,!0);rS(()=>{R0(m[o],_)},u)}function F_(l,o,u=Jr,m=!1){if(u){const _=u[l]||(u[l]=[]),v=o.__weh||(o.__weh=(...M)=>{if(u.isUnmounted)return;Sl();const A=jf(u),r=uo(o,u,l,M);return A(),El(),r});return m?_.unshift(v):_.push(v),v}}const Ma=l=>(o,u=Jr)=>(!N_||l==="sp")&&F_(l,(...m)=>o(...m),u),pD=Ma("bm"),mD=Ma("m"),_D=Ma("bu"),gD=Ma("u"),yD=Ma("bum"),rS=Ma("um"),xD=Ma("sp"),vD=Ma("rtg"),bD=Ma("rtc");function wD(l,o=Jr){F_("ec",l,o)}const u0=l=>l?bS(l)?J0(l)||l.proxy:u0(l.parent):null,wf=Vr(Object.create(null),{$:l=>l,$el:l=>l.vnode.el,$data:l=>l.data,$props:l=>l.props,$attrs:l=>l.attrs,$slots:l=>l.slots,$refs:l=>l.refs,$parent:l=>u0(l.parent),$root:l=>u0(l.root),$emit:l=>l.emit,$options:l=>X0(l),$forceUpdate:l=>l.f||(l.f=()=>{l.effect.dirty=!0,Z0(l.update)}),$nextTick:l=>l.n||(l.n=HP.bind(l.proxy)),$watch:l=>uD.bind(l)}),Uy=(l,o)=>l!==or&&!l.__isScriptSetup&&En(l,o),TD={get({_:l},o){if(o==="__v_skip")return!0;const{ctx:u,setupState:m,data:_,props:v,accessCache:M,type:A,appContext:r}=l;let k;if(o[0]!=="$"){const ie=M[o];if(ie!==void 0)switch(ie){case 1:return m[o];case 2:return _[o];case 4:return u[o];case 3:return v[o]}else{if(Uy(m,o))return M[o]=1,m[o];if(_!==or&&En(_,o))return M[o]=2,_[o];if((k=l.propsOptions[0])&&En(k,o))return M[o]=3,v[o];if(u!==or&&En(u,o))return M[o]=4,u[o];h0&&(M[o]=0)}}const N=wf[o];let G,K;if(N)return o==="$attrs"&&xs(l.attrs,"get",""),N(l);if((G=A.__cssModules)&&(G=G[o]))return G;if(u!==or&&En(u,o))return M[o]=4,u[o];if(K=r.config.globalProperties,En(K,o))return K[o]},set({_:l},o,u){const{data:m,setupState:_,ctx:v}=l;return Uy(_,o)?(_[o]=u,!0):m!==or&&En(m,o)?(m[o]=u,!0):En(l.props,o)||o[0]==="$"&&o.slice(1)in l?!1:(v[o]=u,!0)},has({_:{data:l,setupState:o,accessCache:u,ctx:m,appContext:_,propsOptions:v}},M){let A;return!!u[M]||l!==or&&En(l,M)||Uy(o,M)||(A=v[0])&&En(A,M)||En(m,M)||En(wf,M)||En(_.config.globalProperties,M)},defineProperty(l,o,u){return u.get!=null?l._.accessCache[o]=0:En(u,"value")&&this.set(l,o,u.value,null),Reflect.defineProperty(l,o,u)}};function Rw(l){return nn(l)?l.reduce((o,u)=>(o[u]=null,o),{}):l}let h0=!0;function MD(l){const o=X0(l),u=l.proxy,m=l.ctx;h0=!1,o.beforeCreate&&zw(o.beforeCreate,l,"bc");const{data:_,computed:v,methods:M,watch:A,provide:r,inject:k,created:N,beforeMount:G,mounted:K,beforeUpdate:ie,updated:pe,activated:ge,deactivated:Te,beforeDestroy:Re,beforeUnmount:$e,destroyed:tt,unmounted:ut,render:ot,renderTracked:at,renderTriggered:dt,errorCaptured:xe,serverPrefetch:le,expose:Je,inheritAttrs:Mt,components:Qe,directives:Zt,filters:xi}=o;if(k&&SD(k,m,null),M)for(const yt in M){const wt=M[yt];cn(wt)&&(m[yt]=wt.bind(u))}if(_){const yt=_.call(u,u);_r(yt)&&(l.data=G0(yt))}if(h0=!0,v)for(const yt in v){const wt=v[yt],Qt=cn(wt)?wt.bind(u,u):cn(wt.get)?wt.get.bind(u,u):js,bn=!cn(wt)&&cn(wt.set)?wt.set.bind(u):js,Ji=nL({get:Qt,set:bn});Object.defineProperty(m,yt,{enumerable:!0,configurable:!0,get:()=>Ji.value,set:Nt=>Ji.value=Nt})}if(A)for(const yt in A)sS(A[yt],m,u,yt);if(r){const yt=cn(r)?r.call(u):r;Reflect.ownKeys(yt).forEach(wt=>{DD(wt,yt[wt])})}N&&zw(N,l,"c");function si(yt,wt){nn(wt)?wt.forEach(Qt=>yt(Qt.bind(u))):wt&&yt(wt.bind(u))}if(si(pD,G),si(mD,K),si(_D,ie),si(gD,pe),si(hD,ge),si(dD,Te),si(wD,xe),si(bD,at),si(vD,dt),si(yD,$e),si(rS,ut),si(xD,le),nn(Je))if(Je.length){const yt=l.exposed||(l.exposed={});Je.forEach(wt=>{Object.defineProperty(yt,wt,{get:()=>u[wt],set:Qt=>u[wt]=Qt})})}else l.exposed||(l.exposed={});ot&&l.render===js&&(l.render=ot),Mt!=null&&(l.inheritAttrs=Mt),Qe&&(l.components=Qe),Zt&&(l.directives=Zt)}function SD(l,o,u=js){nn(l)&&(l=d0(l));for(const m in l){const _=l[m];let v;_r(_)?"default"in _?v=o_(_.from||m,_.default,!0):v=o_(_.from||m):v=o_(_),zs(v)?Object.defineProperty(o,m,{enumerable:!0,configurable:!0,get:()=>v.value,set:M=>v.value=M}):o[m]=v}}function zw(l,o,u){uo(nn(l)?l.map(m=>m.bind(o.proxy)):l.bind(o.proxy),o,u)}function sS(l,o,u,m){const _=m.includes(".")?tS(u,m):()=>u[m];if(zr(l)){const v=o[l];cn(v)&&Vy(_,v)}else if(cn(l))Vy(_,l.bind(u));else if(_r(l))if(nn(l))l.forEach(v=>sS(v,o,u,m));else{const v=cn(l.handler)?l.handler.bind(u):o[l.handler];cn(v)&&Vy(_,v,l)}}function X0(l){const o=l.type,{mixins:u,extends:m}=o,{mixins:_,optionsCache:v,config:{optionMergeStrategies:M}}=l.appContext,A=v.get(o);let r;return A?r=A:!_.length&&!u&&!m?r=o:(r={},_.length&&_.forEach(k=>v_(r,k,M,!0)),v_(r,o,M)),_r(o)&&v.set(o,r),r}function v_(l,o,u,m=!1){const{mixins:_,extends:v}=o;v&&v_(l,v,u,!0),_&&_.forEach(M=>v_(l,M,u,!0));for(const M in o)if(!(m&&M==="expose")){const A=ED[M]||u&&u[M];l[M]=A?A(l[M],o[M]):o[M]}return l}const ED={data:Ow,props:Fw,emits:Fw,methods:ff,computed:ff,beforeCreate:os,created:os,beforeMount:os,mounted:os,beforeUpdate:os,updated:os,beforeDestroy:os,beforeUnmount:os,destroyed:os,unmounted:os,activated:os,deactivated:os,errorCaptured:os,serverPrefetch:os,components:ff,directives:ff,watch:ID,provide:Ow,inject:AD};function Ow(l,o){return o?l?function(){return Vr(cn(l)?l.call(this,this):l,cn(o)?o.call(this,this):o)}:o:l}function AD(l,o){return ff(d0(l),d0(o))}function d0(l){if(nn(l)){const o={};for(let u=0;u<l.length;u++)o[l[u]]=l[u];return o}return l}function os(l,o){return l?[...new Set([].concat(l,o))]:o}function ff(l,o){return l?Vr(Object.create(null),l,o):o}function Fw(l,o){return l?nn(l)&&nn(o)?[...new Set([...l,...o])]:Vr(Object.create(null),Rw(l),Rw(o??{})):o}function ID(l,o){if(!l)return o;if(!o)return l;const u=Vr(Object.create(null),l);for(const m in o)u[m]=os(l[m],o[m]);return u}function oS(){return{app:null,config:{isNativeTag:rP,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let CD=0;function PD(l,o){return function(m,_=null){cn(m)||(m=Vr({},m)),_!=null&&!_r(_)&&(_=null);const v=oS(),M=new WeakSet;let A=!1;const r=v.app={_uid:CD++,_component:m,_props:_,_container:null,_context:v,_instance:null,version:rL,get config(){return v.config},set config(k){},use(k,...N){return M.has(k)||(k&&cn(k.install)?(M.add(k),k.install(r,...N)):cn(k)&&(M.add(k),k(r,...N))),r},mixin(k){return v.mixins.includes(k)||v.mixins.push(k),r},component(k,N){return N?(v.components[k]=N,r):v.components[k]},directive(k,N){return N?(v.directives[k]=N,r):v.directives[k]},mount(k,N,G){if(!A){const K=bl(m,_);return K.appContext=v,G===!0?G="svg":G===!1&&(G=void 0),N&&o?o(K,k):l(K,k,G),A=!0,r._container=k,k.__vue_app__=r,J0(K.component)||K.component.proxy}},unmount(){A&&(l(null,r._container),delete r._container.__vue_app__)},provide(k,N){return v.provides[k]=N,r},runWithContext(k){const N=Tf;Tf=r;try{return k()}finally{Tf=N}}};return r}}let Tf=null;function DD(l,o){if(Jr){let u=Jr.provides;const m=Jr.parent&&Jr.parent.provides;m===u&&(u=Jr.provides=Object.create(m)),u[l]=o}}function o_(l,o,u=!1){const m=Jr||ao;if(m||Tf){const _=m?m.parent==null?m.vnode.appContext&&m.vnode.appContext.provides:m.parent.provides:Tf._context.provides;if(_&&l in _)return _[l];if(arguments.length>1)return u&&cn(o)?o.call(m&&m.proxy):o}}const aS={},lS=()=>Object.create(aS),cS=l=>Object.getPrototypeOf(l)===aS;function LD(l,o,u,m=!1){const _={},v=lS();l.propsDefaults=Object.create(null),uS(l,o,_,v);for(const M in l.propsOptions[0])M in _||(_[M]=void 0);u?l.props=m?_:NP(_):l.type.props?l.props=_:l.props=v,l.attrs=v}function kD(l,o,u,m){const{props:_,attrs:v,vnode:{patchFlag:M}}=l,A=Hn(_),[r]=l.propsOptions;let k=!1;if((m||M>0)&&!(M&16)){if(M&8){const N=l.vnode.dynamicProps;for(let G=0;G<N.length;G++){let K=N[G];if(O_(l.emitsOptions,K))continue;const ie=o[K];if(r)if(En(v,K))ie!==v[K]&&(v[K]=ie,k=!0);else{const pe=Go(K);_[pe]=f0(r,A,pe,ie,l,!1)}else ie!==v[K]&&(v[K]=ie,k=!0)}}}else{uS(l,o,_,v)&&(k=!0);let N;for(const G in A)(!o||!En(o,G)&&((N=ih(G))===G||!En(o,N)))&&(r?u&&(u[G]!==void 0||u[N]!==void 0)&&(_[G]=f0(r,A,G,void 0,l,!0)):delete _[G]);if(v!==A)for(const G in v)(!o||!En(o,G))&&(delete v[G],k=!0)}k&&Ta(l.attrs,"set","")}function uS(l,o,u,m){const[_,v]=l.propsOptions;let M=!1,A;if(o)for(let r in o){if(vf(r))continue;const k=o[r];let N;_&&En(_,N=Go(r))?!v||!v.includes(N)?u[N]=k:(A||(A={}))[N]=k:O_(l.emitsOptions,r)||(!(r in m)||k!==m[r])&&(m[r]=k,M=!0)}if(v){const r=Hn(u),k=A||or;for(let N=0;N<v.length;N++){const G=v[N];u[G]=f0(_,r,G,k[G],l,!En(k,G))}}return M}function f0(l,o,u,m,_,v){const M=l[u];if(M!=null){const A=En(M,"default");if(A&&m===void 0){const r=M.default;if(M.type!==Function&&!M.skipFactory&&cn(r)){const{propsDefaults:k}=_;if(u in k)m=k[u];else{const N=jf(_);m=k[u]=r.call(null,o),N()}}else m=r}M[0]&&(v&&!A?m=!1:M[1]&&(m===""||m===ih(u))&&(m=!0))}return m}function hS(l,o,u=!1){const m=o.propsCache,_=m.get(l);if(_)return _;const v=l.props,M={},A=[];let r=!1;if(!cn(l)){const N=G=>{r=!0;const[K,ie]=hS(G,o,!0);Vr(M,K),ie&&A.push(...ie)};!u&&o.mixins.length&&o.mixins.forEach(N),l.extends&&N(l.extends),l.mixins&&l.mixins.forEach(N)}if(!v&&!r)return _r(l)&&m.set(l,Zu),Zu;if(nn(v))for(let N=0;N<v.length;N++){const G=Go(v[N]);Bw(G)&&(M[G]=or)}else if(v)for(const N in v){const G=Go(N);if(Bw(G)){const K=v[N],ie=M[G]=nn(K)||cn(K)?{type:K}:Vr({},K);if(ie){const pe=Uw(Boolean,ie.type),ge=Uw(String,ie.type);ie[0]=pe>-1,ie[1]=ge<0||pe<ge,(pe>-1||En(ie,"default"))&&A.push(G)}}}const k=[M,A];return _r(l)&&m.set(l,k),k}function Bw(l){return l[0]!=="$"&&!vf(l)}function Nw(l){return l===null?"null":typeof l=="function"?l.name||"":typeof l=="object"&&l.constructor&&l.constructor.name||""}function Vw(l,o){return Nw(l)===Nw(o)}function Uw(l,o){return nn(o)?o.findIndex(u=>Vw(u,l)):cn(o)&&Vw(o,l)?0:-1}const dS=l=>l[0]==="_"||l==="$stable",Y0=l=>nn(l)?l.map(Vo):[Vo(l)],RD=(l,o,u)=>{if(o._n)return o;const m=JP((..._)=>Y0(o(..._)),u);return m._c=!1,m},fS=(l,o,u)=>{const m=l._ctx;for(const _ in l){if(dS(_))continue;const v=l[_];if(cn(v))o[_]=RD(_,v,m);else if(v!=null){const M=Y0(v);o[_]=()=>M}}},pS=(l,o)=>{const u=Y0(o);l.slots.default=()=>u},zD=(l,o)=>{const u=l.slots=lS();if(l.vnode.shapeFlag&32){const m=o._;m?(Vr(u,o),IM(u,"_",m,!0)):fS(o,u)}else o&&pS(l,o)},OD=(l,o,u)=>{const{vnode:m,slots:_}=l;let v=!0,M=or;if(m.shapeFlag&32){const A=o._;A?u&&A===1?v=!1:(Vr(_,o),!u&&A===1&&delete _._):(v=!o.$stable,fS(o,_)),M=o}else o&&(pS(l,o),M={default:1});if(v)for(const A in _)!dS(A)&&M[A]==null&&delete _[A]};function p0(l,o,u,m,_=!1){if(nn(l)){l.forEach((K,ie)=>p0(K,o&&(nn(o)?o[ie]:o),u,m,_));return}if(s_(m)&&!_)return;const v=m.shapeFlag&4?J0(m.component)||m.component.proxy:m.el,M=_?null:v,{i:A,r}=l,k=o&&o.r,N=A.refs===or?A.refs={}:A.refs,G=A.setupState;if(k!=null&&k!==r&&(zr(k)?(N[k]=null,En(G,k)&&(G[k]=null)):zs(k)&&(k.value=null)),cn(r))vl(r,A,12,[M,N]);else{const K=zr(r),ie=zs(r);if(K||ie){const pe=()=>{if(l.f){const ge=K?En(G,r)?G[r]:N[r]:r.value;_?nn(ge)&&R0(ge,v):nn(ge)?ge.includes(v)||ge.push(v):K?(N[r]=[v],En(G,r)&&(G[r]=N[r])):(r.value=[v],l.k&&(N[l.k]=r.value))}else K?(N[r]=M,En(G,r)&&(G[r]=M)):ie&&(r.value=M,l.k&&(N[l.k]=M))};M?(pe.id=-1,gs(pe,u)):pe()}}}const gs=aD;function FD(l){return BD(l)}function BD(l,o){const u=CM();u.__VUE__=!0;const{insert:m,remove:_,patchProp:v,createElement:M,createText:A,createComment:r,setText:k,setElementText:N,parentNode:G,nextSibling:K,setScopeId:ie=js,insertStaticContent:pe}=l,ge=(ye,we,Ge,nt=null,ft=null,Ct=null,Gt=void 0,mt=null,zt=!!we.dynamicChildren)=>{if(ye===we)return;ye&&!af(ye,we)&&(nt=Ln(ye),Nt(ye,ft,Ct,!0),ye=null),we.patchFlag===-2&&(zt=!1,we.dynamicChildren=null);const{type:ct,ref:kt,shapeFlag:li}=we;switch(ct){case B_:Te(ye,we,Ge,nt);break;case Lf:Re(ye,we,Ge,nt);break;case Gy:ye==null&&$e(we,Ge,nt,Gt);break;case _a:Qe(ye,we,Ge,nt,ft,Ct,Gt,mt,zt);break;default:li&1?ot(ye,we,Ge,nt,ft,Ct,Gt,mt,zt):li&6?Zt(ye,we,Ge,nt,ft,Ct,Gt,mt,zt):(li&64||li&128)&&ct.process(ye,we,Ge,nt,ft,Ct,Gt,mt,zt,Ei)}kt!=null&&ft&&p0(kt,ye&&ye.ref,Ct,we||ye,!we)},Te=(ye,we,Ge,nt)=>{if(ye==null)m(we.el=A(we.children),Ge,nt);else{const ft=we.el=ye.el;we.children!==ye.children&&k(ft,we.children)}},Re=(ye,we,Ge,nt)=>{ye==null?m(we.el=r(we.children||""),Ge,nt):we.el=ye.el},$e=(ye,we,Ge,nt)=>{[ye.el,ye.anchor]=pe(ye.children,we,Ge,nt,ye.el,ye.anchor)},tt=({el:ye,anchor:we},Ge,nt)=>{let ft;for(;ye&&ye!==we;)ft=K(ye),m(ye,Ge,nt),ye=ft;m(we,Ge,nt)},ut=({el:ye,anchor:we})=>{let Ge;for(;ye&&ye!==we;)Ge=K(ye),_(ye),ye=Ge;_(we)},ot=(ye,we,Ge,nt,ft,Ct,Gt,mt,zt)=>{we.type==="svg"?Gt="svg":we.type==="math"&&(Gt="mathml"),ye==null?at(we,Ge,nt,ft,Ct,Gt,mt,zt):le(ye,we,ft,Ct,Gt,mt,zt)},at=(ye,we,Ge,nt,ft,Ct,Gt,mt)=>{let zt,ct;const{props:kt,shapeFlag:li,transition:$t,dirs:Ce}=ye;if(zt=ye.el=M(ye.type,Ct,kt&&kt.is,kt),li&8?N(zt,ye.children):li&16&&xe(ye.children,zt,null,nt,ft,jy(ye,Ct),Gt,mt),Ce&&Mc(ye,null,nt,"created"),dt(zt,ye,ye.scopeId,Gt,nt),kt){for(const ne in kt)ne!=="value"&&!vf(ne)&&v(zt,ne,null,kt[ne],Ct,ye.children,nt,ft,en);"value"in kt&&v(zt,"value",null,kt.value,Ct),(ct=kt.onVnodeBeforeMount)&&Fo(ct,nt,ye)}Ce&&Mc(ye,null,nt,"beforeMount");const Z=ND(ft,$t);Z&&$t.beforeEnter(zt),m(zt,we,Ge),((ct=kt&&kt.onVnodeMounted)||Z||Ce)&&gs(()=>{ct&&Fo(ct,nt,ye),Z&&$t.enter(zt),Ce&&Mc(ye,null,nt,"mounted")},ft)},dt=(ye,we,Ge,nt,ft)=>{if(Ge&&ie(ye,Ge),nt)for(let Ct=0;Ct<nt.length;Ct++)ie(ye,nt[Ct]);if(ft){let Ct=ft.subTree;if(we===Ct){const Gt=ft.vnode;dt(ye,Gt,Gt.scopeId,Gt.slotScopeIds,ft.parent)}}},xe=(ye,we,Ge,nt,ft,Ct,Gt,mt,zt=0)=>{for(let ct=zt;ct<ye.length;ct++){const kt=ye[ct]=mt?fl(ye[ct]):Vo(ye[ct]);ge(null,kt,we,Ge,nt,ft,Ct,Gt,mt)}},le=(ye,we,Ge,nt,ft,Ct,Gt)=>{const mt=we.el=ye.el;let{patchFlag:zt,dynamicChildren:ct,dirs:kt}=we;zt|=ye.patchFlag&16;const li=ye.props||or,$t=we.props||or;let Ce;if(Ge&&Sc(Ge,!1),(Ce=$t.onVnodeBeforeUpdate)&&Fo(Ce,Ge,we,ye),kt&&Mc(we,ye,Ge,"beforeUpdate"),Ge&&Sc(Ge,!0),ct?Je(ye.dynamicChildren,ct,mt,Ge,nt,jy(we,ft),Ct):Gt||wt(ye,we,mt,null,Ge,nt,jy(we,ft),Ct,!1),zt>0){if(zt&16)Mt(mt,we,li,$t,Ge,nt,ft);else if(zt&2&&li.class!==$t.class&&v(mt,"class",null,$t.class,ft),zt&4&&v(mt,"style",li.style,$t.style,ft),zt&8){const Z=we.dynamicProps;for(let ne=0;ne<Z.length;ne++){const he=Z[ne],Le=li[he],Ve=$t[he];(Ve!==Le||he==="value")&&v(mt,he,Le,Ve,ft,ye.children,Ge,nt,en)}}zt&1&&ye.children!==we.children&&N(mt,we.children)}else!Gt&&ct==null&&Mt(mt,we,li,$t,Ge,nt,ft);((Ce=$t.onVnodeUpdated)||kt)&&gs(()=>{Ce&&Fo(Ce,Ge,we,ye),kt&&Mc(we,ye,Ge,"updated")},nt)},Je=(ye,we,Ge,nt,ft,Ct,Gt)=>{for(let mt=0;mt<we.length;mt++){const zt=ye[mt],ct=we[mt],kt=zt.el&&(zt.type===_a||!af(zt,ct)||zt.shapeFlag&70)?G(zt.el):Ge;ge(zt,ct,kt,null,nt,ft,Ct,Gt,!0)}},Mt=(ye,we,Ge,nt,ft,Ct,Gt)=>{if(Ge!==nt){if(Ge!==or)for(const mt in Ge)!vf(mt)&&!(mt in nt)&&v(ye,mt,Ge[mt],null,Gt,we.children,ft,Ct,en);for(const mt in nt){if(vf(mt))continue;const zt=nt[mt],ct=Ge[mt];zt!==ct&&mt!=="value"&&v(ye,mt,ct,zt,Gt,we.children,ft,Ct,en)}"value"in nt&&v(ye,"value",Ge.value,nt.value,Gt)}},Qe=(ye,we,Ge,nt,ft,Ct,Gt,mt,zt)=>{const ct=we.el=ye?ye.el:A(""),kt=we.anchor=ye?ye.anchor:A("");let{patchFlag:li,dynamicChildren:$t,slotScopeIds:Ce}=we;Ce&&(mt=mt?mt.concat(Ce):Ce),ye==null?(m(ct,Ge,nt),m(kt,Ge,nt),xe(we.children||[],Ge,kt,ft,Ct,Gt,mt,zt)):li>0&&li&64&&$t&&ye.dynamicChildren?(Je(ye.dynamicChildren,$t,Ge,ft,Ct,Gt,mt),(we.key!=null||ft&&we===ft.subTree)&&mS(ye,we,!0)):wt(ye,we,Ge,kt,ft,Ct,Gt,mt,zt)},Zt=(ye,we,Ge,nt,ft,Ct,Gt,mt,zt)=>{we.slotScopeIds=mt,ye==null?we.shapeFlag&512?ft.ctx.activate(we,Ge,nt,Gt,zt):xi(we,Ge,nt,ft,Ct,Gt,zt):qe(ye,we,zt)},xi=(ye,we,Ge,nt,ft,Ct,Gt)=>{const mt=ye.component=YD(ye,nt,ft);if(iS(ye)&&(mt.ctx.renderer=Ei),KD(mt),mt.asyncDep){if(ft&&ft.registerDep(mt,si),!ye.el){const zt=mt.subTree=bl(Lf);Re(null,zt,we,Ge)}}else si(mt,ye,we,Ge,ft,Ct,Gt)},qe=(ye,we,Ge)=>{const nt=we.component=ye.component;if(tD(ye,we,Ge))if(nt.asyncDep&&!nt.asyncResolved){yt(nt,we,Ge);return}else nt.next=we,ZP(nt.update),nt.effect.dirty=!0,nt.update();else we.el=ye.el,nt.vnode=we},si=(ye,we,Ge,nt,ft,Ct,Gt)=>{const mt=()=>{if(ye.isMounted){let{next:kt,bu:li,u:$t,parent:Ce,vnode:Z}=ye;{const Xe=_S(ye);if(Xe){kt&&(kt.el=Z.el,yt(ye,kt,Gt)),Xe.asyncDep.then(()=>{ye.isUnmounted||mt()});return}}let ne=kt,he;Sc(ye,!1),kt?(kt.el=Z.el,yt(ye,kt,Gt)):kt=Z,li&&Oy(li),(he=kt.props&&kt.props.onVnodeBeforeUpdate)&&Fo(he,Ce,kt,Z),Sc(ye,!0);const Le=Ny(ye),Ve=ye.subTree;ye.subTree=Le,ge(Ve,Le,G(Ve.el),Ln(Ve),ye,ft,Ct),kt.el=Le.el,ne===null&&iD(ye,Le.el),$t&&gs($t,ft),(he=kt.props&&kt.props.onVnodeUpdated)&&gs(()=>Fo(he,Ce,kt,Z),ft)}else{let kt;const{el:li,props:$t}=we,{bm:Ce,m:Z,parent:ne}=ye,he=s_(we);if(Sc(ye,!1),Ce&&Oy(Ce),!he&&(kt=$t&&$t.onVnodeBeforeMount)&&Fo(kt,ne,we),Sc(ye,!0),li&&hn){const Le=()=>{ye.subTree=Ny(ye),hn(li,ye.subTree,ye,ft,null)};he?we.type.__asyncLoader().then(()=>!ye.isUnmounted&&Le()):Le()}else{const Le=ye.subTree=Ny(ye);ge(null,Le,Ge,nt,ye,ft,Ct),we.el=Le.el}if(Z&&gs(Z,ft),!he&&(kt=$t&&$t.onVnodeMounted)){const Le=we;gs(()=>Fo(kt,ne,Le),ft)}(we.shapeFlag&256||ne&&s_(ne.vnode)&&ne.vnode.shapeFlag&256)&&ye.a&&gs(ye.a,ft),ye.isMounted=!0,we=Ge=nt=null}},zt=ye.effect=new B0(mt,js,()=>Z0(ct),ye.scope),ct=ye.update=()=>{zt.dirty&&zt.run()};ct.id=ye.uid,Sc(ye,!0),ct()},yt=(ye,we,Ge)=>{we.component=ye;const nt=ye.vnode.props;ye.vnode=we,ye.next=null,kD(ye,we.props,nt,Ge),OD(ye,we.children,Ge),Sl(),Dw(ye),El()},wt=(ye,we,Ge,nt,ft,Ct,Gt,mt,zt=!1)=>{const ct=ye&&ye.children,kt=ye?ye.shapeFlag:0,li=we.children,{patchFlag:$t,shapeFlag:Ce}=we;if($t>0){if($t&128){bn(ct,li,Ge,nt,ft,Ct,Gt,mt,zt);return}else if($t&256){Qt(ct,li,Ge,nt,ft,Ct,Gt,mt,zt);return}}Ce&8?(kt&16&&en(ct,ft,Ct),li!==ct&&N(Ge,li)):kt&16?Ce&16?bn(ct,li,Ge,nt,ft,Ct,Gt,mt,zt):en(ct,ft,Ct,!0):(kt&8&&N(Ge,""),Ce&16&&xe(li,Ge,nt,ft,Ct,Gt,mt,zt))},Qt=(ye,we,Ge,nt,ft,Ct,Gt,mt,zt)=>{ye=ye||Zu,we=we||Zu;const ct=ye.length,kt=we.length,li=Math.min(ct,kt);let $t;for($t=0;$t<li;$t++){const Ce=we[$t]=zt?fl(we[$t]):Vo(we[$t]);ge(ye[$t],Ce,Ge,null,ft,Ct,Gt,mt,zt)}ct>kt?en(ye,ft,Ct,!0,!1,li):xe(we,Ge,nt,ft,Ct,Gt,mt,zt,li)},bn=(ye,we,Ge,nt,ft,Ct,Gt,mt,zt)=>{let ct=0;const kt=we.length;let li=ye.length-1,$t=kt-1;for(;ct<=li&&ct<=$t;){const Ce=ye[ct],Z=we[ct]=zt?fl(we[ct]):Vo(we[ct]);if(af(Ce,Z))ge(Ce,Z,Ge,null,ft,Ct,Gt,mt,zt);else break;ct++}for(;ct<=li&&ct<=$t;){const Ce=ye[li],Z=we[$t]=zt?fl(we[$t]):Vo(we[$t]);if(af(Ce,Z))ge(Ce,Z,Ge,null,ft,Ct,Gt,mt,zt);else break;li--,$t--}if(ct>li){if(ct<=$t){const Ce=$t+1,Z=Ce<kt?we[Ce].el:nt;for(;ct<=$t;)ge(null,we[ct]=zt?fl(we[ct]):Vo(we[ct]),Ge,Z,ft,Ct,Gt,mt,zt),ct++}}else if(ct>$t)for(;ct<=li;)Nt(ye[ct],ft,Ct,!0),ct++;else{const Ce=ct,Z=ct,ne=new Map;for(ct=Z;ct<=$t;ct++){const Tt=we[ct]=zt?fl(we[ct]):Vo(we[ct]);Tt.key!=null&&ne.set(Tt.key,ct)}let he,Le=0;const Ve=$t-Z+1;let Xe=!1,Ot=0;const Be=new Array(Ve);for(ct=0;ct<Ve;ct++)Be[ct]=0;for(ct=Ce;ct<=li;ct++){const Tt=ye[ct];if(Le>=Ve){Nt(Tt,ft,Ct,!0);continue}let Ft;if(Tt.key!=null)Ft=ne.get(Tt.key);else for(he=Z;he<=$t;he++)if(Be[he-Z]===0&&af(Tt,we[he])){Ft=he;break}Ft===void 0?Nt(Tt,ft,Ct,!0):(Be[Ft-Z]=ct+1,Ft>=Ot?Ot=Ft:Xe=!0,ge(Tt,we[Ft],Ge,null,ft,Ct,Gt,mt,zt),Le++)}const Vt=Xe?VD(Be):Zu;for(he=Vt.length-1,ct=Ve-1;ct>=0;ct--){const Tt=Z+ct,Ft=we[Tt],wi=Tt+1<kt?we[Tt+1].el:nt;Be[ct]===0?ge(null,Ft,Ge,wi,ft,Ct,Gt,mt,zt):Xe&&(he<0||ct!==Vt[he]?Ji(Ft,Ge,wi,2):he--)}}},Ji=(ye,we,Ge,nt,ft=null)=>{const{el:Ct,type:Gt,transition:mt,children:zt,shapeFlag:ct}=ye;if(ct&6){Ji(ye.component.subTree,we,Ge,nt);return}if(ct&128){ye.suspense.move(we,Ge,nt);return}if(ct&64){Gt.move(ye,we,Ge,Ei);return}if(Gt===_a){m(Ct,we,Ge);for(let li=0;li<zt.length;li++)Ji(zt[li],we,Ge,nt);m(ye.anchor,we,Ge);return}if(Gt===Gy){tt(ye,we,Ge);return}if(nt!==2&&ct&1&&mt)if(nt===0)mt.beforeEnter(Ct),m(Ct,we,Ge),gs(()=>mt.enter(Ct),ft);else{const{leave:li,delayLeave:$t,afterLeave:Ce}=mt,Z=()=>m(Ct,we,Ge),ne=()=>{li(Ct,()=>{Z(),Ce&&Ce()})};$t?$t(Ct,Z,ne):ne()}else m(Ct,we,Ge)},Nt=(ye,we,Ge,nt=!1,ft=!1)=>{const{type:Ct,props:Gt,ref:mt,children:zt,dynamicChildren:ct,shapeFlag:kt,patchFlag:li,dirs:$t}=ye;if(mt!=null&&p0(mt,null,Ge,ye,!0),kt&256){we.ctx.deactivate(ye);return}const Ce=kt&1&&$t,Z=!s_(ye);let ne;if(Z&&(ne=Gt&&Gt.onVnodeBeforeUnmount)&&Fo(ne,we,ye),kt&6)un(ye.component,Ge,nt);else{if(kt&128){ye.suspense.unmount(Ge,nt);return}Ce&&Mc(ye,null,we,"beforeUnmount"),kt&64?ye.type.remove(ye,we,Ge,ft,Ei,nt):ct&&(Ct!==_a||li>0&&li&64)?en(ct,we,Ge,!1,!0):(Ct===_a&&li&384||!ft&&kt&16)&&en(zt,we,Ge),nt&&Qi(ye)}(Z&&(ne=Gt&&Gt.onVnodeUnmounted)||Ce)&&gs(()=>{ne&&Fo(ne,we,ye),Ce&&Mc(ye,null,we,"unmounted")},Ge)},Qi=ye=>{const{type:we,el:Ge,anchor:nt,transition:ft}=ye;if(we===_a){xn(Ge,nt);return}if(we===Gy){ut(ye);return}const Ct=()=>{_(Ge),ft&&!ft.persisted&&ft.afterLeave&&ft.afterLeave()};if(ye.shapeFlag&1&&ft&&!ft.persisted){const{leave:Gt,delayLeave:mt}=ft,zt=()=>Gt(Ge,Ct);mt?mt(ye.el,Ct,zt):zt()}else Ct()},xn=(ye,we)=>{let Ge;for(;ye!==we;)Ge=K(ye),_(ye),ye=Ge;_(we)},un=(ye,we,Ge)=>{const{bum:nt,scope:ft,update:Ct,subTree:Gt,um:mt}=ye;nt&&Oy(nt),ft.stop(),Ct&&(Ct.active=!1,Nt(Gt,ye,we,Ge)),mt&&gs(mt,we),gs(()=>{ye.isUnmounted=!0},we),we&&we.pendingBranch&&!we.isUnmounted&&ye.asyncDep&&!ye.asyncResolved&&ye.suspenseId===we.pendingId&&(we.deps--,we.deps===0&&we.resolve())},en=(ye,we,Ge,nt=!1,ft=!1,Ct=0)=>{for(let Gt=Ct;Gt<ye.length;Gt++)Nt(ye[Gt],we,Ge,nt,ft)},Ln=ye=>ye.shapeFlag&6?Ln(ye.component.subTree):ye.shapeFlag&128?ye.suspense.next():K(ye.anchor||ye.el);let In=!1;const hi=(ye,we,Ge)=>{ye==null?we._vnode&&Nt(we._vnode,null,null,!0):ge(we._vnode||null,ye,we,null,null,null,Ge),In||(In=!0,Dw(),XM(),In=!1),we._vnode=ye},Ei={p:ge,um:Nt,m:Ji,r:Qi,mt:xi,mc:xe,pc:wt,pbc:Je,n:Ln,o:l};let on,hn;return{render:hi,hydrate:on,createApp:PD(hi,on)}}function jy({type:l,props:o},u){return u==="svg"&&l==="foreignObject"||u==="mathml"&&l==="annotation-xml"&&o&&o.encoding&&o.encoding.includes("html")?void 0:u}function Sc({effect:l,update:o},u){l.allowRecurse=o.allowRecurse=u}function ND(l,o){return(!l||l&&!l.pendingBranch)&&o&&!o.persisted}function mS(l,o,u=!1){const m=l.children,_=o.children;if(nn(m)&&nn(_))for(let v=0;v<m.length;v++){const M=m[v];let A=_[v];A.shapeFlag&1&&!A.dynamicChildren&&((A.patchFlag<=0||A.patchFlag===32)&&(A=_[v]=fl(_[v]),A.el=M.el),u||mS(M,A)),A.type===B_&&(A.el=M.el)}}function VD(l){const o=l.slice(),u=[0];let m,_,v,M,A;const r=l.length;for(m=0;m<r;m++){const k=l[m];if(k!==0){if(_=u[u.length-1],l[_]<k){o[m]=_,u.push(m);continue}for(v=0,M=u.length-1;v<M;)A=v+M>>1,l[u[A]]<k?v=A+1:M=A;k<l[u[v]]&&(v>0&&(o[m]=u[v-1]),u[v]=m)}}for(v=u.length,M=u[v-1];v-- >0;)u[v]=M,M=o[M];return u}function _S(l){const o=l.subTree.component;if(o)return o.asyncDep&&!o.asyncResolved?o:_S(o)}const UD=l=>l.__isTeleport,_a=Symbol.for("v-fgt"),B_=Symbol.for("v-txt"),Lf=Symbol.for("v-cmt"),Gy=Symbol.for("v-stc"),Mf=[];let lo=null;function gS(l=!1){Mf.push(lo=l?null:[])}function jD(){Mf.pop(),lo=Mf[Mf.length-1]||null}let kf=1;function jw(l){kf+=l}function GD(l){return l.dynamicChildren=kf>0?lo||Zu:null,jD(),kf>0&&lo&&lo.push(l),l}function yS(l,o,u,m,_,v){return GD(xa(l,o,u,m,_,v,!0))}function $D(l){return l?l.__v_isVNode===!0:!1}function af(l,o){return l.type===o.type&&l.key===o.key}const xS=({key:l})=>l??null,a_=({ref:l,ref_key:o,ref_for:u})=>(typeof l=="number"&&(l=""+l),l!=null?zr(l)||zs(l)||cn(l)?{i:ao,r:l,k:o,f:!!u}:l:null);function xa(l,o=null,u=null,m=0,_=null,v=l===_a?0:1,M=!1,A=!1){const r={__v_isVNode:!0,__v_skip:!0,type:l,props:o,key:o&&xS(o),ref:o&&a_(o),scopeId:JM,slotScopeIds:null,children:u,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:v,patchFlag:m,dynamicProps:_,dynamicChildren:null,appContext:null,ctx:ao};return A?(K0(r,u),v&128&&l.normalize(r)):u&&(r.shapeFlag|=zr(u)?8:16),kf>0&&!M&&lo&&(r.patchFlag>0||v&6)&&r.patchFlag!==32&&lo.push(r),r}const bl=WD;function WD(l,o=null,u=null,m=0,_=null,v=!1){if((!l||l===rD)&&(l=Lf),$D(l)){const A=Ju(l,o,!0);return u&&K0(A,u),kf>0&&!v&&lo&&(A.shapeFlag&6?lo[lo.indexOf(l)]=A:lo.push(A)),A.patchFlag|=-2,A}if(iL(l)&&(l=l.__vccOpts),o){o=HD(o);let{class:A,style:r}=o;A&&!zr(A)&&(o.class=F0(A)),_r(r)&&($M(r)&&!nn(r)&&(r=Vr({},r)),o.style=O0(r))}const M=zr(l)?1:oD(l)?128:UD(l)?64:_r(l)?4:cn(l)?2:0;return xa(l,o,u,m,_,M,v,!0)}function HD(l){return l?$M(l)||cS(l)?Vr({},l):l:null}function Ju(l,o,u=!1,m=!1){const{props:_,ref:v,patchFlag:M,children:A,transition:r}=l,k=o?qD(_||{},o):_,N={__v_isVNode:!0,__v_skip:!0,type:l.type,props:k,key:k&&xS(k),ref:o&&o.ref?u&&v?nn(v)?v.concat(a_(o)):[v,a_(o)]:a_(o):v,scopeId:l.scopeId,slotScopeIds:l.slotScopeIds,children:A,target:l.target,targetAnchor:l.targetAnchor,staticCount:l.staticCount,shapeFlag:l.shapeFlag,patchFlag:o&&l.type!==_a?M===-1?16:M|16:M,dynamicProps:l.dynamicProps,dynamicChildren:l.dynamicChildren,appContext:l.appContext,dirs:l.dirs,transition:r,component:l.component,suspense:l.suspense,ssContent:l.ssContent&&Ju(l.ssContent),ssFallback:l.ssFallback&&Ju(l.ssFallback),el:l.el,anchor:l.anchor,ctx:l.ctx,ce:l.ce};return r&&m&&(N.transition=r.clone(N)),N}function vS(l=" ",o=0){return bl(B_,null,l,o)}function Vo(l){return l==null||typeof l=="boolean"?bl(Lf):nn(l)?bl(_a,null,l.slice()):typeof l=="object"?fl(l):bl(B_,null,String(l))}function fl(l){return l.el===null&&l.patchFlag!==-1||l.memo?l:Ju(l)}function K0(l,o){let u=0;const{shapeFlag:m}=l;if(o==null)o=null;else if(nn(o))u=16;else if(typeof o=="object")if(m&65){const _=o.default;_&&(_._c&&(_._d=!1),K0(l,_()),_._c&&(_._d=!0));return}else{u=32;const _=o._;!_&&!cS(o)?o._ctx=ao:_===3&&ao&&(ao.slots._===1?o._=1:(o._=2,l.patchFlag|=1024))}else cn(o)?(o={default:o,_ctx:ao},u=32):(o=String(o),m&64?(u=16,o=[vS(o)]):u=8);l.children=o,l.shapeFlag|=u}function qD(...l){const o={};for(let u=0;u<l.length;u++){const m=l[u];for(const _ in m)if(_==="class")o.class!==m.class&&(o.class=F0([o.class,m.class]));else if(_==="style")o.style=O0([o.style,m.style]);else if(P_(_)){const v=o[_],M=m[_];M&&v!==M&&!(nn(v)&&v.includes(M))&&(o[_]=v?[].concat(v,M):M)}else _!==""&&(o[_]=m[_])}return o}function Fo(l,o,u,m=null){uo(l,o,7,[u,m])}const ZD=oS();let XD=0;function YD(l,o,u){const m=l.type,_=(o?o.appContext:l.appContext)||ZD,v={uid:XD++,vnode:l,type:m,parent:o,appContext:_,root:null,next:null,subTree:null,effect:null,update:null,scope:new gP(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:o?o.provides:Object.create(_.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:hS(m,_),emitsOptions:KM(m,_),emit:null,emitted:null,propsDefaults:or,inheritAttrs:m.inheritAttrs,ctx:or,data:or,props:or,attrs:or,slots:or,refs:or,setupState:or,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:u,suspenseId:u?u.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return v.ctx={_:v},v.root=o?o.root:v,v.emit=KP.bind(null,v),l.ce&&l.ce(v),v}let Jr=null,b_,m0;{const l=CM(),o=(u,m)=>{let _;return(_=l[u])||(_=l[u]=[]),_.push(m),v=>{_.length>1?_.forEach(M=>M(v)):_[0](v)}};b_=o("__VUE_INSTANCE_SETTERS__",u=>Jr=u),m0=o("__VUE_SSR_SETTERS__",u=>N_=u)}const jf=l=>{const o=Jr;return b_(l),l.scope.on(),()=>{l.scope.off(),b_(o)}},Gw=()=>{Jr&&Jr.scope.off(),b_(null)};function bS(l){return l.vnode.shapeFlag&4}let N_=!1;function KD(l,o=!1){o&&m0(o);const{props:u,children:m}=l.vnode,_=bS(l);LD(l,u,_,o),zD(l,m);const v=_?JD(l,o):void 0;return o&&m0(!1),v}function JD(l,o){const u=l.type;l.accessCache=Object.create(null),l.proxy=new Proxy(l.ctx,TD);const{setup:m}=u;if(m){const _=l.setupContext=m.length>1?eL(l):null,v=jf(l);Sl();const M=vl(m,l,0,[l.props,_]);if(El(),v(),SM(M)){if(M.then(Gw,Gw),o)return M.then(A=>{$w(l,A,o)}).catch(A=>{z_(A,l,0)});l.asyncDep=M}else $w(l,M,o)}else wS(l,o)}function $w(l,o,u){cn(o)?l.type.__ssrInlineRender?l.ssrRender=o:l.render=o:_r(o)&&(l.setupState=HM(o)),wS(l,u)}let Ww;function wS(l,o,u){const m=l.type;if(!l.render){if(!o&&Ww&&!m.render){const _=m.template||X0(l).template;if(_){const{isCustomElement:v,compilerOptions:M}=l.appContext.config,{delimiters:A,compilerOptions:r}=m,k=Vr(Vr({isCustomElement:v,delimiters:A},M),r);m.render=Ww(_,k)}}l.render=m.render||js}{const _=jf(l);Sl();try{MD(l)}finally{El(),_()}}}const QD={get(l,o){return xs(l,"get",""),l[o]}};function eL(l){const o=u=>{l.exposed=u||{}};return{attrs:new Proxy(l.attrs,QD),slots:l.slots,emit:l.emit,expose:o}}function J0(l){if(l.exposed)return l.exposeProxy||(l.exposeProxy=new Proxy(HM(VP(l.exposed)),{get(o,u){if(u in o)return o[u];if(u in wf)return wf[u](l)},has(o,u){return u in o||u in wf}}))}function tL(l,o=!0){return cn(l)?l.displayName||l.name:l.name||o&&l.__name}function iL(l){return cn(l)&&"__vccOpts"in l}const nL=(l,o)=>UP(l,o,N_),rL="3.4.27";/**
* @vue/runtime-dom v3.4.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const sL="http://www.w3.org/2000/svg",oL="http://www.w3.org/1998/Math/MathML",pl=typeof document<"u"?document:null,Hw=pl&&pl.createElement("template"),aL={insert:(l,o,u)=>{o.insertBefore(l,u||null)},remove:l=>{const o=l.parentNode;o&&o.removeChild(l)},createElement:(l,o,u,m)=>{const _=o==="svg"?pl.createElementNS(sL,l):o==="mathml"?pl.createElementNS(oL,l):pl.createElement(l,u?{is:u}:void 0);return l==="select"&&m&&m.multiple!=null&&_.setAttribute("multiple",m.multiple),_},createText:l=>pl.createTextNode(l),createComment:l=>pl.createComment(l),setText:(l,o)=>{l.nodeValue=o},setElementText:(l,o)=>{l.textContent=o},parentNode:l=>l.parentNode,nextSibling:l=>l.nextSibling,querySelector:l=>pl.querySelector(l),setScopeId(l,o){l.setAttribute(o,"")},insertStaticContent(l,o,u,m,_,v){const M=u?u.previousSibling:o.lastChild;if(_&&(_===v||_.nextSibling))for(;o.insertBefore(_.cloneNode(!0),u),!(_===v||!(_=_.nextSibling)););else{Hw.innerHTML=m==="svg"?`<svg>${l}</svg>`:m==="mathml"?`<math>${l}</math>`:l;const A=Hw.content;if(m==="svg"||m==="mathml"){const r=A.firstChild;for(;r.firstChild;)A.appendChild(r.firstChild);A.removeChild(r)}o.insertBefore(A,u)}return[M?M.nextSibling:o.firstChild,u?u.previousSibling:o.lastChild]}},lL=Symbol("_vtc");function cL(l,o,u){const m=l[lL];m&&(o=(o?[o,...m]:[...m]).join(" ")),o==null?l.removeAttribute("class"):u?l.setAttribute("class",o):l.className=o}const qw=Symbol("_vod"),uL=Symbol("_vsh"),hL=Symbol(""),dL=/(^|;)\s*display\s*:/;function fL(l,o,u){const m=l.style,_=zr(u);let v=!1;if(u&&!_){if(o)if(zr(o))for(const M of o.split(";")){const A=M.slice(0,M.indexOf(":")).trim();u[A]==null&&l_(m,A,"")}else for(const M in o)u[M]==null&&l_(m,M,"");for(const M in u)M==="display"&&(v=!0),l_(m,M,u[M])}else if(_){if(o!==u){const M=m[hL];M&&(u+=";"+M),m.cssText=u,v=dL.test(u)}}else o&&l.removeAttribute("style");qw in l&&(l[qw]=v?m.display:"",l[uL]&&(m.display="none"))}const Zw=/\s*!important$/;function l_(l,o,u){if(nn(u))u.forEach(m=>l_(l,o,m));else if(u==null&&(u=""),o.startsWith("--"))l.setProperty(o,u);else{const m=pL(l,o);Zw.test(u)?l.setProperty(ih(m),u.replace(Zw,""),"important"):l[m]=u}}const Xw=["Webkit","Moz","ms"],$y={};function pL(l,o){const u=$y[o];if(u)return u;let m=Go(o);if(m!=="filter"&&m in l)return $y[o]=m;m=k_(m);for(let _=0;_<Xw.length;_++){const v=Xw[_]+m;if(v in l)return $y[o]=v}return o}const Yw="http://www.w3.org/1999/xlink";function mL(l,o,u,m,_){if(m&&o.startsWith("xlink:"))u==null?l.removeAttributeNS(Yw,o.slice(6,o.length)):l.setAttributeNS(Yw,o,u);else{const v=mP(o);u==null||v&&!PM(u)?l.removeAttribute(o):l.setAttribute(o,v?"":u)}}function _L(l,o,u,m,_,v,M){if(o==="innerHTML"||o==="textContent"){m&&M(m,_,v),l[o]=u??"";return}const A=l.tagName;if(o==="value"&&A!=="PROGRESS"&&!A.includes("-")){const k=A==="OPTION"?l.getAttribute("value")||"":l.value,N=u??"";(k!==N||!("_value"in l))&&(l.value=N),u==null&&l.removeAttribute(o),l._value=u;return}let r=!1;if(u===""||u==null){const k=typeof l[o];k==="boolean"?u=PM(u):u==null&&k==="string"?(u="",r=!0):k==="number"&&(u=0,r=!0)}try{l[o]=u}catch{}r&&l.removeAttribute(o)}function gL(l,o,u,m){l.addEventListener(o,u,m)}function yL(l,o,u,m){l.removeEventListener(o,u,m)}const Kw=Symbol("_vei");function xL(l,o,u,m,_=null){const v=l[Kw]||(l[Kw]={}),M=v[o];if(m&&M)M.value=m;else{const[A,r]=vL(o);if(m){const k=v[o]=TL(m,_);gL(l,A,k,r)}else M&&(yL(l,A,M,r),v[o]=void 0)}}const Jw=/(?:Once|Passive|Capture)$/;function vL(l){let o;if(Jw.test(l)){o={};let m;for(;m=l.match(Jw);)l=l.slice(0,l.length-m[0].length),o[m[0].toLowerCase()]=!0}return[l[2]===":"?l.slice(3):ih(l.slice(2)),o]}let Wy=0;const bL=Promise.resolve(),wL=()=>Wy||(bL.then(()=>Wy=0),Wy=Date.now());function TL(l,o){const u=m=>{if(!m._vts)m._vts=Date.now();else if(m._vts<=u.attached)return;uo(ML(m,u.value),o,5,[m])};return u.value=l,u.attached=wL(),u}function ML(l,o){if(nn(o)){const u=l.stopImmediatePropagation;return l.stopImmediatePropagation=()=>{u.call(l),l._stopped=!0},o.map(m=>_=>!_._stopped&&m&&m(_))}else return o}const Qw=l=>l.charCodeAt(0)===111&&l.charCodeAt(1)===110&&l.charCodeAt(2)>96&&l.charCodeAt(2)<123,SL=(l,o,u,m,_,v,M,A,r)=>{const k=_==="svg";o==="class"?cL(l,m,k):o==="style"?fL(l,u,m):P_(o)?k0(o)||xL(l,o,u,m,M):(o[0]==="."?(o=o.slice(1),!0):o[0]==="^"?(o=o.slice(1),!1):EL(l,o,m,k))?_L(l,o,m,v,M,A,r):(o==="true-value"?l._trueValue=m:o==="false-value"&&(l._falseValue=m),mL(l,o,m,k))};function EL(l,o,u,m){if(m)return!!(o==="innerHTML"||o==="textContent"||o in l&&Qw(o)&&cn(u));if(o==="spellcheck"||o==="draggable"||o==="translate"||o==="form"||o==="list"&&l.tagName==="INPUT"||o==="type"&&l.tagName==="TEXTAREA")return!1;if(o==="width"||o==="height"){const _=l.tagName;if(_==="IMG"||_==="VIDEO"||_==="CANVAS"||_==="SOURCE")return!1}return Qw(o)&&zr(u)?!1:o in l}const AL=Vr({patchProp:SL},aL);let eT;function IL(){return eT||(eT=FD(AL))}const CL=(...l)=>{const o=IL().createApp(...l),{mount:u}=o;return o.mount=m=>{const _=DL(m);if(!_)return;const v=o._component;!cn(v)&&!v.render&&!v.template&&(v.template=_.innerHTML),_.innerHTML="";const M=u(_,!1,PL(_));return _ instanceof Element&&(_.removeAttribute("v-cloak"),_.setAttribute("data-v-app","")),M},o};function PL(l){if(l instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&l instanceof MathMLElement)return"mathml"}function DL(l){return zr(l)?document.querySelector(l):l}var TS=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function MS(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var SS={exports:{}};(function(l,o){var u={};(function(m,_){l.exports=_()})(TS,function(){var m,_,v;function M(r,k){if(!m)m=k;else if(!_)_=k;else{var N="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+m+")(sharedChunk); ("+_+")(sharedChunk); self.onerror = null;",G={};m(G),v=k(G),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(v.workerUrl=window.URL.createObjectURL(new Blob([N],{type:"text/javascript"})))}}M(["exports"],function(r){var k="3.3.0";let N;const G={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(N==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{N=u.API_URL_REGEX!=null?new RegExp(u.API_URL_REGEX):t}catch{N=t}}return N},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!G.API_URL)return null;try{const t=new URL(G.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"};function K(t){return G.API_URL_REGEX.test(t)}function ie(t){return t.indexOf("mapbox:")===0}function pe(t){return G.API_CDN_URL_REGEX.test(t)}function ge(t){return G.API_SPRITE_REGEX.test(t)}function Te(t){return G.API_STYLE_REGEX.test(t)&&!ge(t)}const Re={create:"create",load:"load",fullLoad:"fullLoad"};function $e(t){const e=t.name.split("?")[0];return pe(e)&&e.includes("mapbox-gl.js")?"javascript":pe(e)&&e.includes("mapbox-gl.css")?"css":function(i){return G.API_FONTS_REGEX.test(i)}(e)?"fontRange":ge(e)?"sprite":Te(e)?"style":function(i){return G.API_TILEJSON_REGEX.test(i)}(e)?"tilejson":"other"}function tt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ut=ot;function ot(t,e,i,s){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=s}ot.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,s=0;s<8;s++){var c=this.sampleCurveX(i)-t;if(Math.abs(c)<e)return i;var h=this.sampleCurveDerivativeX(i);if(Math.abs(h)<1e-6)break;i-=c/h}var p=0,y=1;for(i=t,s=0;s<20&&(c=this.sampleCurveX(i),!(Math.abs(c-t)<e));s++)t>c?p=i:y=i,i=.5*(y-p)+p;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var at=tt(ut),dt=xe;function xe(t,e){this.x=t,this.y=e}xe.prototype={clone:function(){return new xe(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),s=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=s,this},_rotateAround:function(t,e){var i=Math.cos(t),s=Math.sin(t),c=e.y+s*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-s*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},xe.convert=function(t){return t instanceof xe?t:Array.isArray(t)?new xe(t[0],t[1]):t};var le=tt(dt);const Je=Math.PI/180,Mt=180/Math.PI;function Qe(t){return t*Je}function Zt(t){return t*Mt}const xi=[[0,0],[1,0],[1,1],[0,1]];function qe(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function si(t,e,i,s){const c=new at(t,e,i,s);return function(h){return c.solve(h)}}const yt=si(.25,.1,.25,1);function wt(t,e,i){return Math.min(i,Math.max(e,t))}function Qt(t,e,i){return(i=wt((i-t)/(e-t),0,1))*i*(3-2*i)}function bn(t,e,i){const s=i-e,c=((t-e)%s+s)%s+e;return c===e?i:c}function Ji(t,e,i){if(!t.length)return i(null,[]);let s=t.length;const c=new Array(t.length);let h=null;t.forEach((p,y)=>{e(p,(b,w)=>{b&&(h=b),c[y]=w,--s==0&&i(h,c)})})}function Nt(t,...e){for(const i of e)for(const s in i)t[s]=i[s];return t}let Qi=1;function xn(){return Qi++}function un(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function en(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Ln(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function In(t,e){t.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function hi(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Ei(t,e,i){const s={};for(const c in t)s[c]=e.call(i||this,t[c],c,t);return s}function on(t,e,i){const s={};for(const c in t)e.call(i||this,t[c],c,t)&&(s[c]=t[c]);return s}function hn(t){return Array.isArray(t)?t.map(hn):typeof t=="object"&&t?Ei(t,hn):t}const ye={};function we(t){ye[t]||(typeof console<"u"&&console.warn(t),ye[t]=!0)}function Ge(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function nt(t){let e=0;for(let i,s,c=0,h=t.length,p=h-1;c<h;p=c++)i=t[c],s=t[p],e+=(s.x-i.x)*(i.y+s.y);return e}function ft([t,e,i]){const s=Qe(e+90),c=Qe(i);return{x:t*Math.cos(s)*Math.sin(c),y:t*Math.sin(s)*Math.sin(c),z:t*Math.cos(c),azimuthal:e,polar:i}}function Ct(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Gt(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,s,c,h)=>{const p=c||h;return e[s]=!p||p.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let mt,zt,ct,kt,li,$t,Ce=null;function Z(t){try{const e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function ne(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function he(t,e,i,s){for(;e<i;){const c=e+i>>1;t[c]<s?e=c+1:i=c}return e}function Le(t,e,i,s){for(;e<i;){const c=e+i>>1;t[c]<=s?e=c+1:i=c}return e}function Ve(){return mt==null&&(mt=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),mt}const Xe={now:()=>kt!==void 0?kt:performance.now(),setNow(t){kt=t},restoreNow(){kt=void 0},frame(t){const e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:i,height:s}=t;li||(li=document.createElement("canvas"));const c=li.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(i>li.width||s>li.height)&&(li.width=i,li.height=s),c.clearRect(-e,-e,i+2*e,s+2*e),c.drawImage(t,0,0,i,s),c.getImageData(-e,-e,i+2*e,s+2*e)},resolveURL:t=>(zt||(zt=document.createElement("a")),zt.href=t,zt.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(ct==null&&(ct=window.matchMedia("(prefers-reduced-motion: reduce)")),ct.matches)},hasCanvasFingerprintNoise(){if($t!==void 0)return $t;if(!Ve())return $t=!1,!1;const t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0});let i=0;for(let c=0;c<t.width;++c)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(c,0,1,1);const s=e.getImageData(0,0,t.width,t.height);i=0;for(let c=0;c<s.data.length;++c)if(c%4!=3&&i++!==s.data[c])return $t=!0,!0;return $t=!1,!1}},Ot="mapbox-tiles";let Be=500,Vt=50,Tt,Ft;function wi(){try{return caches}catch{}}function dn(){const t=wi();t&&!Tt&&(Tt=t.open(Ot))}function Cn(t){const e=t.indexOf("?");if(e<0)return t;const i=["language","worldview"],s=new URLSearchParams,c=new URLSearchParams(t.slice(e));for(const h of i){const p=c.get(h);p&&s.set(h,p)}return`${t.slice(0,e)}?${s.toString()}`}function fn(t,e){const i=t.indexOf("?");if(i<0)return`${t}?${new URLSearchParams(e).toString()}`;const s=new URLSearchParams(t.slice(i));for(const c in e)s.set(c,e[c]);return`${t.slice(0,i)}?${s.toString()}`}let tn=1/0;const Zi={supported:!1,testSupport:function(t){!ur&&wn&&(Sn?Dr(t):an=t)}};let an,wn,ur=!1,Sn=!1;const Or=typeof self<"u"?self:{};function Dr(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,wn),t.isContextLost())return;Zi.supported=!0}catch{}t.deleteTexture(e),ur=!0}Or.document&&(wn=Or.document.createElement("img"),wn.onload=function(){an&&Dr(an),an=null,Sn=!0},wn.onerror=function(){ur=!0,an=null},wn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ur={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Ur);class tr extends Error{constructor(e,i,s){i===401&&K(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Yn=Ct()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,je=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(Yn())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(s,c){const h=new AbortController,p=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:Yn(),referrerPolicy:s.referrerPolicy,signal:h.signal});let y=!1,b=!1;const w=(S=p.url).indexOf("sku=")>0&&K(S);var S;s.type==="json"&&p.headers.set("Accept","application/json");const I=(R,O,F)=>{if(b)return;if(R&&R.message!=="SecurityError"&&we(R.toString()),O&&F)return P(O);const U=Date.now();fetch(p).then($=>{if($.ok){const J=w?$.clone():null;return P($,J,U)}return c(new tr($.statusText,$.status,s.url))}).catch($=>{$.name!=="AbortError"&&c(new Error(`${$.message} ${s.url}`))})},P=(R,O,F)=>{(s.type==="arrayBuffer"?R.arrayBuffer():s.type==="json"?R.json():R.text()).then(U=>{b||(O&&F&&function($,J,te){if(dn(),!Tt)return;const ee=Gt(J.headers.get("Cache-Control")||"");if(ee["no-store"])return;const ce={status:J.status,statusText:J.statusText,headers:new Headers};J.headers.forEach((ve,Se)=>ce.headers.set(Se,ve)),ee["max-age"]&&ce.headers.set("Expires",new Date(te+1e3*ee["max-age"]).toUTCString());const ae=ce.headers.get("Expires");if(!ae||new Date(ae).getTime()-te<42e4)return;let fe=Cn($.url);if(J.status===206){const ve=$.headers.get("Range");if(!ve)return;ce.status=200,fe=fn(fe,{range:ve})}(function(ve,Se){if(Ft===void 0)try{new Response(new ReadableStream),Ft=!0}catch{Ft=!1}Ft?Se(ve.body):ve.blob().then(Se)})(J,ve=>{const Se=new Response(ve,ce);dn(),Tt&&Tt.then(De=>De.put(fe,Se)).catch(De=>we(De.message))})}(p,O,F),y=!0,c(null,U,R.headers.get("Cache-Control"),R.headers.get("Expires")))}).catch(U=>{b||c(new Error(U.message))})};return w?function(R,O){if(dn(),!Tt)return O(null);Tt.then(F=>{let U=Cn(R.url);const $=R.headers.get("Range");$&&(U=fn(U,{range:$})),F.match(U).then(J=>{const te=function(ee){if(!ee)return!1;const ce=new Date(ee.headers.get("Expires")||0),ae=Gt(ee.headers.get("Cache-Control")||"");return ce>Date.now()&&!ae["no-cache"]}(J);F.delete(U),te&&F.put(U,J.clone()),O(null,J,te)}).catch(O)}).catch(O)}(p,I):I(null,null),{cancel:()=>{b=!0,y||h.abort()}}}(t,e);if(Ct()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(s,c){const h=new XMLHttpRequest;h.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const p in s.headers)h.setRequestHeader(p,s.headers[p]);return s.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=s.credentials==="include",h.onerror=()=>{c(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let p=h.response;if(s.type==="json")try{p=JSON.parse(h.response)}catch(y){return c(y)}c(null,p,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else c(new tr(h.statusText,h.status,s.url))},h.send(s.body),{cancel:()=>h.abort()}}(t,e)},We=function(t,e){return je(Nt(t,{type:"arrayBuffer"}),e)};function lt(t){const e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}const bt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let _t,At;_t=[],At=0;const It=function(t,e){if(Zi.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),At>=G.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return _t.push(h),h}At++;let i=!1;const s=()=>{if(!i)for(i=!0,At--;_t.length&&At<G.MAX_PARALLEL_IMAGE_REQUESTS;){const h=_t.shift(),{requestParameters:p,callback:y,cancelled:b}=h;b||(h.cancel=It(p,y).cancel)}},c=We(t,(h,p,y,b)=>{s(),h?e(h):p&&(self.createImageBitmap?function(w,S){const I=new Blob([new Uint8Array(w)],{type:"image/png"});createImageBitmap(I).then(P=>{S(null,P)}).catch(P=>{S(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(w,S)=>e(w,S,y,b)):function(w,S){const I=new Image;I.onload=()=>{S(null,I),URL.revokeObjectURL(I.src),I.onload=null,requestAnimationFrame(()=>{I.src=bt})},I.onerror=()=>S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new Blob([new Uint8Array(w)],{type:"image/png"});I.src=w.byteLength?URL.createObjectURL(P):bt}(p,(w,S)=>e(w,S,y,b)))});return{cancel:()=>{c.cancel(),s()}}},xt="01",Dt="NO_ACCESS_TOKEN",St=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ci(t){const e=t.match(St);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function ki(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const Kt="mapbox.eventData";function pn(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class kn{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=pn(G.ACCESS_TOKEN);let s="";return s=i&&i.u?btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(c,h)=>String.fromCharCode(+("0x"+h)))):G.ACCESS_TOKEN||"",e?`${Kt}.${e}:${s}`:`${Kt}:${s}`}fetchEventData(){const e=Z("localStorage"),i=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const c=localStorage.getItem(i);c&&(this.eventData=JSON.parse(c));const h=localStorage.getItem(s);h&&(this.anonId=h)}catch{we("Unable to read from LocalStorage")}}saveEventData(){const e=Z("localStorage"),i=this.getStorageKey(),s=this.getStorageKey("uuid"),c=this.anonId;if(e&&c)try{localStorage.setItem(s,c),Object.keys(this.eventData).length>=1&&localStorage.setItem(i,JSON.stringify(this.eventData))}catch{we("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,s,c){if(!G.EVENTS_URL)return;const h=ci(G.EVENTS_URL);h.params.push(`access_token=${c||G.ACCESS_TOKEN||""}`);const p={event:this.type,created:new Date(e).toISOString()},y=i?Nt(p,i):p,b={url:ki(h),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=function(w,S){return je(Nt(w,{method:"POST"}),S)}(b,w=>{this.pendingRequest=null,s(w),this.saveEventData(),this.processRequests(c)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const vn=new class extends kn{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){G.EVENTS_URL&&G.ACCESS_TOKEN&&Array.isArray(t)&&t.some(i=>ie(i)||K(i))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=pn(G.ACCESS_TOKEN),i=e?e.u:G.ACCESS_TOKEN;let s=i!==this.eventData.tokenU;Ln(this.anonId)||(this.anonId=un(),s=!0);const c=this.queue.shift();if(this.eventData.lastSuccess){const h=new Date(this.eventData.lastSuccess),p=new Date(c),y=(c-this.eventData.lastSuccess)/864e5;s=s||y>=1||y<-1||h.getDate()!==p.getDate()}else s=!0;s?this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:k,skuId:xt,"enabled.telemetry":!1,userId:this.anonId},h=>{h||(this.eventData.lastSuccess=c,this.eventData.tokenU=i)},t):this.processRequests()}},ir=vn.postTurnstileEvent.bind(vn),Tr=new class extends kn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,s){this.skuToken=e,this.errorCb=s,G.EVENTS_URL&&(i||G.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(Dt)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Ln(this.anonId)||(this.anonId=un()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:k,skuId:xt,skuToken:this.skuToken,userId:this.anonId},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},Hi=Tr.postMapLoadEvent.bind(Tr),ts=new class extends kn{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){G.EVENTS_URL&&(t||G.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:i}=this.queue.shift(),s=function(c){const h=performance.getEntriesByType("resource"),p=performance.getEntriesByType("mark"),y=function(R){const O={};if(R){for(const F in R)if(F!=="other")for(const U of R[F]){const $=`${F}ResolveRangeMin`,J=`${F}ResolveRangeMax`,te=`${F}RequestCount`,ee=`${F}RequestCachedCount`;O[$]=Math.min(O[$]||1/0,U.startTime),O[J]=Math.max(O[J]||-1/0,U.responseEnd);const ce=ae=>{O[ae]===void 0&&(O[ae]=0),++O[ae]};U.transferSize!==void 0&&U.transferSize===0&&ce(ee),ce(te)}}return O}(function(R,O){const F={};if(R)for(const U of R){const $=O(U);F[$]===void 0&&(F[$]=[]),F[$].push(U)}return F}(h,$e)),b=window.devicePixelRatio,w=navigator.connection||navigator.mozConnection||navigator.webkitConnection,S=w?w.effectiveType:void 0,I={counters:[],metadata:[],attributes:[]},P=(R,O,F)=>{F!=null&&R.push({name:O,value:F.toString()})};for(const R in y)P(I.counters,R,y[R]);if(c.interactionRange[0]!==1/0&&c.interactionRange[1]!==-1/0&&(P(I.counters,"interactionRangeMin",c.interactionRange[0]),P(I.counters,"interactionRangeMax",c.interactionRange[1])),p)for(const R of Object.keys(Re)){const O=Re[R],F=p.find(U=>U.name===O);F&&P(I.counters,O,F.startTime)}return P(I.counters,"visibilityHidden",c.visibilityHidden),P(I.attributes,"style",function(R){if(R)for(const O of R){const F=O.name.split("?")[0];if(Te(F)){const U=F.split("/").slice(-2);if(U.length===2)return`mapbox://styles/${U[0]}/${U[1]}`}}}(h)),P(I.attributes,"terrainEnabled",c.terrainEnabled?"true":"false"),P(I.attributes,"fogEnabled",c.fogEnabled?"true":"false"),P(I.attributes,"projection",c.projection),P(I.attributes,"zoom",c.zoom),P(I.metadata,"devicePixelRatio",b),P(I.metadata,"connectionEffectiveType",S),P(I.metadata,"navigatorUserAgent",navigator.userAgent),P(I.metadata,"screenWidth",window.screen.width),P(I.metadata,"screenHeight",window.screen.height),P(I.metadata,"windowWidth",window.innerWidth),P(I.metadata,"windowHeight",window.innerHeight),P(I.metadata,"mapWidth",c.width/b),P(I.metadata,"mapHeight",c.height/b),P(I.metadata,"webglRenderer",c.renderer),P(I.metadata,"webglVendor",c.vendor),P(I.metadata,"sdkVersion",k),P(I.metadata,"sdkIdentifier","mapbox-gl-js"),I}(i);for(const c of s.metadata);for(const c of s.counters);for(const c of s.attributes);this.postEvent(e,s,()=>{},t)}},vs=ts.postPerformanceEvent.bind(ts),Mr=new class extends kn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,s){if(!G.API_URL||!G.SESSION_PATH)return;const c=ci(G.API_URL+G.SESSION_PATH);c.params.push(`sku=${e||""}`),c.params.push(`access_token=${s||G.ACCESS_TOKEN||""}`);const h={url:ki(c),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(p,y){return je(Nt(p,{method:"GET"}),y)}(h,p=>{this.pendingRequest=null,i(p),this.saveEventData(),this.processRequests(s)})}getSessionAPI(t,e,i,s){this.skuToken=e,this.errorCb=s,G.SESSION_PATH&&G.API_URL&&(i||G.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(Dt)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},Il=Mr.getSessionAPI.bind(Mr),fo=new Set;function Ea(t,e,i){i[t]&&i[t].indexOf(e)!==-1||(i[t]=i[t]||[],i[t].push(e))}function nh(t,e,i){if(i&&i[t]){const s=i[t].indexOf(e);s!==-1&&i[t].splice(s,1)}}class $o{constructor(e,i={}){Nt(this,i),this.type=e}}class rh extends $o{constructor(e,i={}){super("error",Nt({error:e},i))}}class Aa{on(e,i){return this._listeners=this._listeners||{},Ea(e,i,this._listeners),this}off(e,i){return nh(e,i,this._listeners),nh(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Ea(e,i,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,i){typeof e=="string"&&(e=new $o(e,i||{}));const s=e.type;if(this.listens(s)){e.target=this;const c=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const y of c)y.call(this,e);const h=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const y of h)nh(s,y,this._oneTimeListeners),y.call(this,e);const p=this._eventedParent;p&&(Nt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof rh&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}r.y=void 0;var Hf={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Gc(t){return(t=Math.round(t))<0?0:t>255?255:t}function sh(t){return Gc(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function $c(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function oh(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{r.y={}.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in Hf)return Hf[i].slice();if(i[0]==="#")return i.length===4?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:i.length===7&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var s=i.indexOf("("),c=i.indexOf(")");if(s!==-1&&c+1===i.length){var h=i.substr(0,s),p=i.substr(s+1,c-(s+1)).split(","),y=1;switch(h){case"rgba":if(p.length!==4)return null;y=$c(p.pop());case"rgb":return p.length!==3?null:[sh(p[0]),sh(p[1]),sh(p[2]),y];case"hsla":if(p.length!==4)return null;y=$c(p.pop());case"hsl":if(p.length!==3)return null;var b=(parseFloat(p[0])%360+360)%360/360,w=$c(p[1]),S=$c(p[2]),I=S<=.5?S*(w+1):S+w-S*w,P=2*S-I;return[Gc(255*oh(P,I,b+1/3)),Gc(255*oh(P,I,b)),Gc(255*oh(P,I,b-1/3)),y];default:return null}}return null}}catch{}class jr{constructor(e,i,s,c=1){this.r=e,this.g=i,this.b=s,this.a=c}static parse(e){if(!e)return;if(e instanceof jr)return e;if(typeof e!="string")return;const i=r.y(e);return i?new jr(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,s,c]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(s)},${c})`}toArray(){const{r:e,g:i,b:s,a:c}=this;return c===0?[0,0,0,0]:[255*e/c,255*i/c,255*s/c,c]}toArray01(){const{r:e,g:i,b:s,a:c}=this;return c===0?[0,0,0,0]:[e/c,i/c,s/c,c]}toArray01Scaled(e){const{r:i,g:s,b:c,a:h}=this;return h===0?[0,0,0]:[i/h*e,s/h*e,c/h*e]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:s,a:c}=this;return[e,i,s,c]}toArray01Linear(){const{r:e,g:i,b:s,a:c}=this;return c===0?[0,0,0,0]:[Math.pow(e/c,2.2),Math.pow(i/c,2.2),Math.pow(s/c,2.2),c]}}jr.black=new jr(0,0,0,1),jr.white=new jr(1,1,1,1),jr.transparent=new jr(0,0,0,0),jr.red=new jr(1,0,0,1),jr.blue=new jr(0,0,1,1);var Kn=jr;function Ri(t,e,i){return t*(1-i)+e*i}function qf(t,e,i){return t.map((s,c)=>Ri(s,e[c],i))}var Wc=Object.freeze({__proto__:null,array:qf,color:function(t,e,i){return new Kn(Ri(t.r,e.r,i),Ri(t.g,e.g,i),Ri(t.b,e.b,i),Ri(t.a,e.a,i))},number:Ri});function ah(t,...e){for(const i of e)for(const s in i)t[s]=i[s];return t}class W_ extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var Os=W_;class lh{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[s,c]of i)this.bindings[s]=c}concat(e){return new lh(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var H_=lh;const Ia={kind:"null"},Rt={kind:"number"},Xi={kind:"string"},Yi={kind:"boolean"},as={kind:"color"},Ca={kind:"object"},Ni={kind:"value"},Hc={kind:"collator"},Pa={kind:"formatted"},Cl={kind:"resolvedImage"};function Gr(t,e){return{kind:"array",itemType:t,N:e}}function Zn(t){if(t.kind==="array"){const e=Zn(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const ni=[Ia,Rt,Xi,Yi,as,Pa,Ca,Gr(Ni),Cl];function Wo(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Wo(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const i of ni)if(!Wo(i,e))return null}}return`Expected ${Zn(t)} but found ${Zn(e)} instead.`}function di(t,e){return e.some(i=>i.kind===t.kind)}function po(t,e){return e.some(i=>i==="null"?t===null:i==="array"?Array.isArray(t):i==="object"?t&&!Array.isArray(t)&&typeof t=="object":i===typeof t)}class Ai{constructor(e,i,s){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Da{constructor(e,i,s,c,h){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=s,this.fontStack=c,this.textColor=h}}class Sr{constructor(e){this.sections=e}static fromString(e){return new Sr([new Da(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof Sr?e:Sr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.namePrimary]);continue}e.push(i.text);const s={};i.fontStack&&(s["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(s["font-scale"]=i.scale),i.textColor&&(s["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(s)}return e}}class ri{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,i){return e?new ri({namePrimary:e,nameSecondary:i,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Zf(t,e,i,s){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[t,e,i,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[t,e,i,s]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ho(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Kn||t instanceof Ai||t instanceof Sr||t instanceof ri)return!0;if(Array.isArray(t)){for(const e of t)if(!Ho(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!Ho(t[e]))return!1;return!0}return!1}function nr(t){if(t===null)return Ia;if(typeof t=="string")return Xi;if(typeof t=="boolean")return Yi;if(typeof t=="number")return Rt;if(t instanceof Kn)return as;if(t instanceof Ai)return Hc;if(t instanceof Sr)return Pa;if(t instanceof ri)return Cl;if(Array.isArray(t)){const e=t.length;let i;for(const s of t){const c=nr(s);if(i){if(i===c)continue;i=Ni;break}i=c}return Gr(i||Ni,e)}return Ca}function ls(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Kn||t instanceof Sr||t instanceof ri?t.toString():JSON.stringify(t)}class mo{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ho(e[1]))return i.error("invalid value");const s=e[1];let c=nr(s);const h=i.expectedType;return c.kind!=="array"||c.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(c=h),new mo(c,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Kn?["rgba"].concat(this.value.toArray()):this.value instanceof Sr?this.value.serialize():this.value}}var Gs=mo,rr=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const ch={string:Xi,number:Rt,boolean:Yi,object:Ca};class uh{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let s,c=1;const h=e[0];if(h==="array"){let y,b;if(e.length>2){const w=e[1];if(typeof w!="string"||!(w in ch)||w==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);y=ch[w],c++}else y=Ni;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);b=e[2],c++}s=Gr(y,b)}else s=ch[h];const p=[];for(;c<e.length;c++){const y=i.parse(e[c],c,Ni);if(!y)return null;p.push(y)}return new uh(s,p)}evaluate(e){for(let i=0;i<this.args.length;i++){const s=this.args[i].evaluate(e);if(!Wo(this.type,nr(s)))return s;if(i===this.args.length-1)throw new rr(`Expected value to be of type ${Zn(this.type)}, but found ${Zn(nr(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const s=e.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){i.push(s.kind);const c=e.N;(typeof c=="number"||this.args.length>1)&&i.push(c)}}return i.concat(this.args.map(s=>s.serialize()))}}var $s=uh;class La{constructor(e){this.type=Pa,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return i.error("First argument must be an image or text section.");const c=[];let h=!1;for(let p=1;p<=e.length-1;++p){const y=e[p];if(h&&typeof y=="object"&&!Array.isArray(y)){h=!1;let b=null;if(y["font-scale"]&&(b=i.parse(y["font-scale"],1,Rt),!b))return null;let w=null;if(y["text-font"]&&(w=i.parse(y["text-font"],1,Gr(Xi)),!w))return null;let S=null;if(y["text-color"]&&(S=i.parse(y["text-color"],1,as),!S))return null;const I=c[c.length-1];I.scale=b,I.font=w,I.textColor=S}else{const b=i.parse(e[p],1,Ni);if(!b)return null;const w=b.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,c.push({content:b,scale:null,font:null,textColor:null})}}return new La(c)}evaluate(e){return new Sr(this.sections.map(i=>{const s=i.content.evaluate(e);return nr(s)===Cl?new Da("",s,null,null,null):new Da(ls(s),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const s={};i.scale&&(s["font-scale"]=i.scale.serialize()),i.font&&(s["text-font"]=i.font.serialize()),i.textColor&&(s["text-color"]=i.textColor.serialize()),e.push(s)}return e}}class qo{constructor(e,i){this.type=Cl,this.inputPrimary=e,this.inputSecondary=i}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");const s=i.parse(e[1],1,Xi);if(!s)return i.error("No image name provided.");if(e.length===2)return new qo(s);const c=i.parse(e[2],1,Xi);return c?new qo(s,c):i.error("Secondary image variant is not a string.")}evaluate(e){const i=ri.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(i.namePrimary)>-1,i.nameSecondary&&i.available&&e.availableImages&&(i.available=e.availableImages.indexOf(i.nameSecondary)>-1)),i}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function ka(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}const bs={"to-boolean":Yi,"to-color":as,"to-number":Rt,"to-string":Xi};class qc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[0],c=[];let h=Ia;if(s==="to-array"){if(!Array.isArray(e[1]))return null;const p=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);h=Gr(i.expectedType.itemType,p)}else{if(!(p>0&&Ho(e[1][0])))return null;h=Gr(nr(e[1][0]),p)}for(let y=0;y<p;y++){const b=e[1][y];let w;if(ka(b)==="array")w=i.parse(b,void 0,h.itemType);else{const S=ka(b);if(S!==h.itemType.kind)return i.error(`Expected ${h.itemType.kind} but found ${S}.`);w=i.registry.literal.parse(["literal",b===void 0?null:b],i)}if(!w)return null;c.push(w)}}else{if((s==="to-boolean"||s==="to-string")&&e.length!==2)return i.error("Expected one argument.");h=bs[s];for(let p=1;p<e.length;p++){const y=i.parse(e[p],p,Ni);if(!y)return null;c.push(y)}}return new qc(h,c)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,s;for(const c of this.args){if(i=c.evaluate(e),s=null,i instanceof Kn)return i;if(typeof i=="string"){const h=e.parseColor(i);if(h)return h}else if(Array.isArray(i)&&(s=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Zf(i[0],i[1],i[2],i[3]),!s))return new Kn(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new rr(s||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const s of this.args){if(i=s.evaluate(e),i===null)return 0;const c=Number(i);if(!isNaN(c))return c}throw new rr(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Sr.fromString(ls(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?ri.fromString(ls(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):ls(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new La([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new qo(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Ws=qc;const Pl=["Unknown","Point","LineString","Polygon"];var Xf=class{constructor(t,e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=e}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Pl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-t[0])+this.featureDistanceData.bearing[1]*(s*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Kn.parse(t)),e}getConfig(t){return this.options?this.options.get(t):null}};class Zo{constructor(e,i,s,c,h){this.name=e,this.type=i,this._evaluate=s,this.args=c,this._overloadIndex=h}evaluate(e){if(!this._evaluate){const i=Zo.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const s=e[0],c=Zo.definitions[s];if(!c)return i.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(c)?c[0]:c.type,p=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,y=[];let b=null,w=-1;for(const[S,I]of p){if(Array.isArray(S)&&S.length!==e.length-1)continue;y.push(S),w++,b=new ip(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const P=[];let R=!1;for(let O=1;O<e.length;O++){const F=e[O],U=Array.isArray(S)?S[O-1]:S.type,$=b.parse(F,1+P.length,U);if(!$){R=!0;break}P.push($)}if(!R)if(Array.isArray(S)&&S.length!==P.length)b.error(`Expected ${S.length} arguments, but found ${P.length} instead.`);else{for(let O=0;O<P.length;O++){const F=Array.isArray(S)?S[O]:S.type,U=P[O];b.concat(O+1).checkSubtype(F,U.type)}if(b.errors.length===0)return new Zo(s,h,I,P,w)}}if(y.length===1)i.errors.push(...b.errors);else{const S=(y.length?y:p.map(([P])=>P)).map(Yf).join(" | "),I=[];for(let P=1;P<e.length;P++){const R=i.parse(e[P],1+I.length);if(!R)return null;I.push(Zn(R.type))}i.error(`Expected arguments of type ${S}, but found (${I.join(", ")}) instead.`)}return null}static register(e,i){Zo.definitions=i;for(const s in i)e[s]=Zo}}function Yf(t){return Array.isArray(t)?`(${t.map(Zn).join(", ")})`:`(${Zn(t.type)}...)`}var Oi=Zo;class Dl{constructor(e,i,s){this.type=Hc,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return i.error("Collator options argument must be an object.");const c=i.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,Yi);if(!c)return null;const h=i.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,Yi);if(!h)return null;let p=null;return s.locale&&(p=i.parse(s.locale,1,Xi),!p)?null:new Dl(c,h,p)}evaluate(e){return new Ai(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var hh={exports:{}};hh.exports=function(){function t(s,c,h,p,y){for(;p>h;){if(p-h>600){var b=p-h+1,w=c-h+1,S=Math.log(b),I=.5*Math.exp(2*S/3),P=.5*Math.sqrt(S*I*(b-I)/b)*(w-b/2<0?-1:1);t(s,c,Math.max(h,Math.floor(c-w*I/b+P)),Math.min(p,Math.floor(c+(b-w)*I/b+P)),y)}var R=s[c],O=h,F=p;for(e(s,h,c),y(s[p],R)>0&&e(s,h,p);O<F;){for(e(s,O,F),O++,F--;y(s[O],R)<0;)O++;for(;y(s[F],R)>0;)F--}y(s[h],R)===0?e(s,h,F):e(s,++F,p),F<=c&&(h=F+1),c<=F&&(p=F-1)}}function e(s,c,h){var p=s[c];s[c]=s[h],s[h]=p}function i(s,c){return s<c?-1:s>c?1:0}return function(s,c,h,p,y){t(s,c,h||0,p||s.length-1,y||i)}}();var q_=tt(hh.exports);function Z_(t){let e=0;for(let i,s,c=0,h=t.length,p=h-1;c<h;p=c++)i=t[c],s=t[p],e+=(s.x-i.x)*(i.y+s.y);return e}function _o(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function go(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Zc(t,e,i){const s=t[0]-e[0],c=t[1]-e[1],h=t[0]-i[0],p=t[1]-i[1];return s*p-h*c==0&&s*h<=0&&c*p<=0}function Ra(t,e,i=!1){let s=!1;for(let y=0,b=e.length;y<b;y++){const w=e[y];for(let S=0,I=w.length,P=I-1;S<I;P=S++){const R=w[P],O=w[S];if(Zc(t,R,O))return i;(h=R)[1]>(c=t)[1]!=(p=O)[1]>c[1]&&c[0]<(p[0]-h[0])*(c[1]-h[1])/(p[1]-h[1])+h[0]&&(s=!s)}}var c,h,p;return s}function dh(t,e,i,s){const c=s[0]-i[0],h=s[1]-i[1],p=(t[0]-i[0])*h-c*(t[1]-i[1]),y=(e[0]-i[0])*h-c*(e[1]-i[1]);return p>0&&y<0||p<0&&y>0}function Hs(t,e,i,s){return(c=[s[0]-i[0],s[1]-i[1]])[0]*(h=[e[0]-t[0],e[1]-t[1]])[1]-c[1]*h[0]!=0&&!(!dh(t,e,i,s)||!dh(i,s,t,e));var c,h}const yo=8192;function Ll(t,e){const i=(180+t[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(i*c*yo),Math.round(s*c*yo)]}function fh(t,e){for(let i=0;i<e.length;i++)if(Ra(t,e[i]))return!0;return!1}function ph(t,e,i){for(const s of i)for(let c=0,h=s.length,p=h-1;c<h;p=c++)if(Hs(t,e,s[p],s[c]))return!0;return!1}function cs(t,e){for(let i=0;i<t.length;++i)if(!Ra(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(ph(t[i],t[i+1],e))return!1;return!0}function Kf(t,e){for(let i=0;i<e.length;i++)if(cs(t,e[i]))return!0;return!1}function mh(t,e,i){const s=[];for(let c=0;c<t.length;c++){const h=[];for(let p=0;p<t[c].length;p++){const y=Ll(t[c][p],i);_o(e,y),h.push(y)}s.push(h)}return s}function _h(t,e,i){const s=[];for(let c=0;c<t.length;c++){const h=mh(t[c],e,i);s.push(h)}return s}function gh(t,e,i,s){if(t[0]<i[0]||t[0]>i[2]){const c=.5*s;let h=t[0]-i[0]>c?-s:i[0]-t[0]>c?s:0;h===0&&(h=t[0]-i[2]>c?-s:i[2]-t[0]>c?s:0),t[0]+=h}_o(e,t)}function yh(t,e,i,s){const c=Math.pow(2,s.z)*yo,h=[s.x*yo,s.y*yo],p=[];if(!t)return p;for(const y of t)for(const b of y){const w=[b.x+h[0],b.y+h[1]];gh(w,e,i,c),p.push(w)}return p}function xh(t,e,i,s){const c=Math.pow(2,s.z)*yo,h=[s.x*yo,s.y*yo],p=[];if(!t)return p;for(const b of t){const w=[];for(const S of b){const I=[S.x+h[0],S.y+h[1]];_o(e,I),w.push(I)}p.push(w)}if(e[2]-e[0]<=c/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const b of p)for(const w of b)gh(w,e,i,c)}var y;return p}class za{constructor(e,i){this.type=Yi,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ho(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let c=0;c<s.features.length;++c){const h=s.features[c].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new za(s,s.features[c].geometry)}else if(s.type==="Feature"){const c=s.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new za(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new za(s,s)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,s){const c=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(!p)return!1;if(s.type==="Polygon"){const y=mh(s.coordinates,h,p),b=yh(i.geometry(),c,h,p);if(!go(c,h))return!1;for(const w of b)if(!Ra(w,y))return!1}if(s.type==="MultiPolygon"){const y=_h(s.coordinates,h,p),b=yh(i.geometry(),c,h,p);if(!go(c,h))return!1;for(const w of b)if(!fh(w,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,s){const c=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(!p)return!1;if(s.type==="Polygon"){const y=mh(s.coordinates,h,p),b=xh(i.geometry(),c,h,p);if(!go(c,h))return!1;for(const w of b)if(!cs(w,y))return!1}if(s.type==="MultiPolygon"){const y=_h(s.coordinates,h,p),b=xh(i.geometry(),c,h,p);if(!go(c,h))return!1;for(const w of b)if(!Kf(w,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Xc=za,kl={exports:{}};kl.exports=function(){var t={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},e=1/298.257223563,i=e*(2-e),s=Math.PI/180,c=function(w,S){if(w===void 0)throw new Error("No latitude given.");if(S&&!t[S])throw new Error("Unknown unit "+S+". Use one of: "+Object.keys(t).join(", "));var I=6378.137*s*(S?t[S]:1),P=Math.cos(w*s),R=1/(1-i*(1-P*P)),O=Math.sqrt(R);this.kx=I*O*P,this.ky=I*O*R*(1-i)},h={units:{configurable:!0}};function p(w,S){return w[0]===S[0]&&w[1]===S[1]}function y(w,S,I){var P=b(S[0]-w[0]);return[w[0]+P*I,w[1]+(S[1]-w[1])*I]}function b(w){for(;w<-180;)w+=360;for(;w>180;)w-=360;return w}return c.fromTile=function(w,S,I){var P=Math.PI*(1-2*(w+.5)/Math.pow(2,S)),R=Math.atan(.5*(Math.exp(P)-Math.exp(-P)))/s;return new c(R,I)},h.units.get=function(){return t},c.prototype.distance=function(w,S){var I=b(w[0]-S[0])*this.kx,P=(w[1]-S[1])*this.ky;return Math.sqrt(I*I+P*P)},c.prototype.bearing=function(w,S){var I=b(S[0]-w[0])*this.kx;return Math.atan2(I,(S[1]-w[1])*this.ky)/s},c.prototype.destination=function(w,S,I){var P=I*s;return this.offset(w,Math.sin(P)*S,Math.cos(P)*S)},c.prototype.offset=function(w,S,I){return[w[0]+S/this.kx,w[1]+I/this.ky]},c.prototype.lineDistance=function(w){for(var S=0,I=0;I<w.length-1;I++)S+=this.distance(w[I],w[I+1]);return S},c.prototype.area=function(w){for(var S=0,I=0;I<w.length;I++)for(var P=w[I],R=0,O=P.length,F=O-1;R<O;F=R++)S+=b(P[R][0]-P[F][0])*(P[R][1]+P[F][1])*(I?-1:1);return Math.abs(S)/2*this.kx*this.ky},c.prototype.along=function(w,S){var I=0;if(S<=0)return w[0];for(var P=0;P<w.length-1;P++){var R=w[P],O=w[P+1],F=this.distance(R,O);if((I+=F)>S)return y(R,O,(S-(I-F))/F)}return w[w.length-1]},c.prototype.pointToSegmentDistance=function(w,S,I){var P=S[0],R=S[1],O=b(I[0]-P)*this.kx,F=(I[1]-R)*this.ky,U=0;return O===0&&F===0||((U=(b(w[0]-P)*this.kx*O+(w[1]-R)*this.ky*F)/(O*O+F*F))>1?(P=I[0],R=I[1]):U>0&&(P+=O/this.kx*U,R+=F/this.ky*U)),O=b(w[0]-P)*this.kx,F=(w[1]-R)*this.ky,Math.sqrt(O*O+F*F)},c.prototype.pointOnLine=function(w,S){for(var I,P,R,O,F=1/0,U=0;U<w.length-1;U++){var $=w[U][0],J=w[U][1],te=b(w[U+1][0]-$)*this.kx,ee=(w[U+1][1]-J)*this.ky,ce=0;te===0&&ee===0||((ce=(b(S[0]-$)*this.kx*te+(S[1]-J)*this.ky*ee)/(te*te+ee*ee))>1?($=w[U+1][0],J=w[U+1][1]):ce>0&&($+=te/this.kx*ce,J+=ee/this.ky*ce));var ae=(te=b(S[0]-$)*this.kx)*te+(ee=(S[1]-J)*this.ky)*ee;ae<F&&(F=ae,I=$,P=J,R=U,O=ce)}return{point:[I,P],index:R,t:Math.max(0,Math.min(1,O))}},c.prototype.lineSlice=function(w,S,I){var P=this.pointOnLine(I,w),R=this.pointOnLine(I,S);if(P.index>R.index||P.index===R.index&&P.t>R.t){var O=P;P=R,R=O}var F=[P.point],U=P.index+1,$=R.index;!p(I[U],F[0])&&U<=$&&F.push(I[U]);for(var J=U+1;J<=$;J++)F.push(I[J]);return p(I[$],R.point)||F.push(R.point),F},c.prototype.lineSliceAlong=function(w,S,I){for(var P=0,R=[],O=0;O<I.length-1;O++){var F=I[O],U=I[O+1],$=this.distance(F,U);if((P+=$)>w&&R.length===0&&R.push(y(F,U,(w-(P-$))/$)),P>=S)return R.push(y(F,U,(S-(P-$))/$)),R;P>w&&R.push(U)}return R},c.prototype.bufferPoint=function(w,S){var I=S/this.ky,P=S/this.kx;return[w[0]-P,w[1]-I,w[0]+P,w[1]+I]},c.prototype.bufferBBox=function(w,S){var I=S/this.ky,P=S/this.kx;return[w[0]-P,w[1]-I,w[2]+P,w[3]+I]},c.prototype.insideBBox=function(w,S){return b(w[0]-S[0])>=0&&b(w[0]-S[2])<=0&&w[1]>=S[1]&&w[1]<=S[3]},Object.defineProperties(c,h),c}();var xo=tt(kl.exports),vh={exports:{}};vh.exports=function(){var t=function(i,s){if(i===void 0&&(i=[]),s===void 0&&(s=e),this.data=i,this.length=this.data.length,this.compare=s,this.length>0)for(var c=(this.length>>1)-1;c>=0;c--)this._down(c)};function e(i,s){return i<s?-1:i>s?1:0}return t.prototype.push=function(i){this.data.push(i),this.length++,this._up(this.length-1)},t.prototype.pop=function(){if(this.length!==0){var i=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),i}},t.prototype.peek=function(){return this.data[0]},t.prototype._up=function(i){for(var s=this.data,c=this.compare,h=s[i];i>0;){var p=i-1>>1,y=s[p];if(c(h,y)>=0)break;s[i]=y,i=p}s[i]=h},t.prototype._down=function(i){for(var s=this.data,c=this.compare,h=this.length>>1,p=s[i];i<h;){var y=1+(i<<1),b=s[y],w=y+1;if(w<this.length&&c(s[w],b)<0&&(y=w,b=s[w]),c(b,p)>=0)break;s[i]=b,i=y}s[i]=p},t}();var us=tt(vh.exports),Pt=8192;function Yc(t,e){return e.dist-t.dist}const bh=100,Rl=50;function wh(t){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function vo(t){return t[1]-t[0]+1}function ws(t,e){const i=t[1]>=t[0]&&t[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function Th(t,e){if(t[0]>t[1])return[null,null];const i=vo(t);if(e){if(i===2)return[t,null];const s=Math.floor(i/2);return[[t[0],t[0]+s],[t[0]+s,t[1]]]}{if(i===1)return[t,null];const s=Math.floor(i/2)-1;return[[t[0],t[0]+s],[t[0]+s+1,t[1]]]}}function Xo(t,e){const i=[1/0,1/0,-1/0,-1/0];if(!ws(e,t.length))return i;for(let s=e[0];s<=e[1];++s)_o(i,t[s]);return i}function Kc(t){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<t.length;++i)for(let s=0;s<t[i].length;++s)_o(e,t[i][s]);return e}function Yo(t,e,i){if(wh(t)||wh(e))return NaN;let s=0,c=0;return t[2]<e[0]&&(s=e[0]-t[2]),t[0]>e[2]&&(s=t[0]-e[2]),t[1]>e[3]&&(c=t[1]-e[3]),t[3]<e[1]&&(c=e[1]-t[3]),i.distance([0,0],[s,c])}function Mh(t){return 360*t-180}function X_(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Oa(t,e){const i=Math.pow(2,e.z),s=(t.y/Pt+e.y)/i;return[Mh((t.x/Pt+e.x)/i),X_(s)]}function Y_(t,e){const i=[];for(let s=0;s<t.length;++s)i.push(Oa(t[s],e));return i}function Jf(t,e,i){const s=i.pointOnLine(e,t).point;return i.distance(t,s)}function Qf(t,e,i,s,c){const h=i.slice(s[0],s[1]+1);let p=1/0;for(let y=e[0];y<=e[1];++y)if((p=Math.min(p,Jf(t[y],h,c)))===0)return 0;return p}function Sh(t,e,i,s,c){const h=Math.min(c.pointToSegmentDistance(t,i,s),c.pointToSegmentDistance(e,i,s)),p=Math.min(c.pointToSegmentDistance(i,t,e),c.pointToSegmentDistance(s,t,e));return Math.min(h,p)}function K_(t,e,i,s,c){if(!ws(e,t.length)||!ws(s,i.length))return NaN;let h=1/0;for(let p=e[0];p<e[1];++p)for(let y=s[0];y<s[1];++y){if(Hs(t[p],t[p+1],i[y],i[y+1]))return 0;h=Math.min(h,Sh(t[p],t[p+1],i[y],i[y+1],c))}return h}function J_(t,e,i,s,c){if(!ws(e,t.length)||!ws(s,i.length))return NaN;let h=1/0;for(let p=e[0];p<=e[1];++p)for(let y=s[0];y<=s[1];++y)if((h=Math.min(h,c.distance(t[p],i[y])))===0)return h;return h}function Q_(t,e,i){if(Ra(t,e,!0))return 0;let s=1/0;for(const c of e){const h=c.length;if(h<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(c[0]!==c[h-1]&&(s=Math.min(s,i.pointToSegmentDistance(t,c[h-1],c[0])))===0||(s=Math.min(s,Jf(t,c,i)))===0)return s}return s}function ep(t,e,i,s){if(!ws(e,t.length))return NaN;for(let h=e[0];h<=e[1];++h)if(Ra(t[h],i,!0))return 0;let c=1/0;for(let h=e[0];h<e[1];++h)for(const p of i)for(let y=0,b=p.length,w=b-1;y<b;w=y++){if(Hs(t[h],t[h+1],p[w],p[y]))return 0;c=Math.min(c,Sh(t[h],t[h+1],p[w],p[y],s))}return c}function zl(t,e){for(const i of t)for(let s=0;s<=i.length-1;++s)if(Ra(i[s],e,!0))return!0;return!1}function eg(t,e,i,s=1/0){const c=Kc(t),h=Kc(e);if(s!==1/0&&Yo(c,h,i)>=s)return s;if(go(c,h)){if(zl(t,e))return 0}else if(zl(e,t))return 0;let p=s;for(const y of t)for(let b=0,w=y.length,S=w-1;b<w;S=b++)for(const I of e)for(let P=0,R=I.length,O=R-1;P<R;O=P++){if(Hs(y[S],y[b],I[O],I[P]))return 0;p=Math.min(p,Sh(y[S],y[b],I[O],I[P],i))}return p}function Jc(t,e,i,s,c,h,p){if(h===null||p===null)return;const y=Yo(Xo(s,h),Xo(c,p),i);y<e&&t.push({dist:y,range1:h,range2:p})}function Eh(t,e,i,s,c=1/0){let h=Math.min(s.distance(t[0],i[0][0]),c);if(h===0)return h;const p=new us([{dist:0,range1:[0,t.length-1],range2:[0,0]}],Yc),y=e?Rl:bh,b=Kc(i);for(;p.length;){const w=p.pop();if(w.dist>=h)continue;const S=w.range1;if(vo(S)<=y){if(!ws(S,t.length))return NaN;if(e){const I=ep(t,S,i,s);if((h=Math.min(h,I))===0)return h}else for(let I=S[0];I<=S[1];++I){const P=Q_(t[I],i,s);if((h=Math.min(h,P))===0)return h}}else{const I=Th(S,e);if(I[0]!==null){const P=Yo(Xo(t,I[0]),b,s);P<h&&p.push({dist:P,range1:I[0],range2:[0,0]})}if(I[1]!==null){const P=Yo(Xo(t,I[1]),b,s);P<h&&p.push({dist:P,range1:I[1],range2:[0,0]})}}}return h}function tp(t,e,i,s,c,h=1/0){let p=Math.min(h,c.distance(t[0],i[0]));if(p===0)return p;const y=new us([{dist:0,range1:[0,t.length-1],range2:[0,i.length-1]}],Yc),b=e?Rl:bh,w=s?Rl:bh;for(;y.length;){const S=y.pop();if(S.dist>=p)continue;const I=S.range1,P=S.range2;if(vo(I)<=b&&vo(P)<=w){if(!ws(I,t.length)||!ws(P,i.length))return NaN;if(e&&s?p=Math.min(p,K_(t,I,i,P,c)):e||s?e&&!s?p=Math.min(p,Qf(i,P,t,I,c)):!e&&s&&(p=Math.min(p,Qf(t,I,i,P,c))):p=Math.min(p,J_(t,I,i,P,c)),p===0)return p}else{const R=Th(I,e),O=Th(P,s);Jc(y,p,c,t,i,R[0],O[0]),Jc(y,p,c,t,i,R[0],O[1]),Jc(y,p,c,t,i,R[1],O[0]),Jc(y,p,c,t,i,R[1],O[1])}}return p}function Ah(t,e,i,s,c=1/0){let h=c;const p=Xo(t,[0,t.length-1]);for(const y of i)if(!(h!==1/0&&Yo(p,Xo(y,[0,y.length-1]),s)>=h)&&(h=Math.min(h,tp(t,e,y,!0,s,h)),h===0))return h;return h}function Qc(t,e,i,s,c=1/0){let h=c;const p=Xo(t,[0,t.length-1]);for(const y of i){if(h!==1/0&&Yo(p,Kc(y),s)>=h)continue;const b=Eh(t,e,y,s,h);if(isNaN(b))return b;if((h=Math.min(h,b))===0)return h}return h}function Ih(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class Ko{constructor(e,i){this.type=Rt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Ho(e[1])){const s=e[1];if(s.type==="FeatureCollection"){for(let c=0;c<s.features.length;++c)if(Ih(s.features[c].geometry.type))return new Ko(s,s.features[c].geometry)}else if(s.type==="Feature"){if(Ih(s.geometry.type))return new Ko(s,s.geometry)}else if(Ih(s.type))return new Ko(s,s)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),s=e.canonicalID();if(i!=null&&s!=null){if(e.geometryType()==="Point")return function(c,h,p){const y=[];for(const w of c)for(const S of w)y.push(Oa(S,h));const b=new xo(y[0][1],"meters");return p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString"?tp(y,!1,p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",b):p.type==="MultiLineString"?Ah(y,!1,p.coordinates,b):p.type==="Polygon"||p.type==="MultiPolygon"?Qc(y,!1,p.type==="Polygon"?[p.coordinates]:p.coordinates,b):null}(i,s,this.geometries);if(e.geometryType()==="LineString")return function(c,h,p){const y=[];for(const w of c){const S=[];for(const I of w)S.push(Oa(I,h));y.push(S)}const b=new xo(y[0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Ah(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",y,b);if(p.type==="MultiLineString"){let w=1/0;for(let S=0;S<p.coordinates.length;S++){const I=Ah(p.coordinates[S],!0,y,b,w);if(isNaN(I))return I;if((w=Math.min(w,I))===0)return w}return w}if(p.type==="Polygon"||p.type==="MultiPolygon"){let w=1/0;for(let S=0;S<y.length;S++){const I=Qc(y[S],!0,p.type==="Polygon"?[p.coordinates]:p.coordinates,b,w);if(isNaN(I))return I;if((w=Math.min(w,I))===0)return w}return w}return null}(i,s,this.geometries);if(e.geometryType()==="Polygon")return function(c,h,p){const y=[];for(const w of function(S,I){const P=S.length;if(P<=1)return[S];const R=[];let O,F;for(let U=0;U<P;U++){const $=Z_(S[U]);$!==0&&(S[U].area=Math.abs($),F===void 0&&(F=$<0),F===$<0?(O&&R.push(O),O=[S[U]]):O.push(S[U]))}return O&&R.push(O),R}(c)){const S=[];for(let I=0;I<w.length;++I)S.push(Y_(w[I],h));y.push(S)}const b=new xo(y[0][0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Qc(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",y,b);if(p.type==="MultiLineString"){let w=1/0;for(let S=0;S<p.coordinates.length;S++){const I=Qc(p.coordinates[S],!0,y,b,w);if(isNaN(I))return I;if((w=Math.min(w,I))===0)return w}return w}return p.type==="Polygon"||p.type==="MultiPolygon"?function(w,S,I){let P=1/0;for(const R of w)for(const O of S){const F=eg(R,O,I,P);if(isNaN(F))return F;if((P=Math.min(P,F))===0)return P}return P}(p.type==="Polygon"?[p.coordinates]:p.coordinates,y,b):null}(i,s,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var eu=Ko;function Ol(t,e){switch(t){case"string":return ls(e);case"number":return+e;case"boolean":return!!e;case"color":return Kn.parse(e);case"formatted":return Sr.fromString(ls(e));case"resolvedImage":return ri.fromString(ls(e))}return e}function Ch(t,e,i,s){return s!==void 0&&(t=s*Math.round(t/s)),e!==void 0&&t<e&&(t=e),i!==void 0&&t>i&&(t=i),t}class Fl{constructor(e,i,s){this.type=e,this.key=i,this.scope=s}static parse(e,i){let s=i.expectedType;if(s==null&&(s=Ni),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const c=i.parse(e[1],1);if(!(c instanceof Gs))return i.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const h=i.parse(e[2],2);return h instanceof Gs?new Fl(s,ls(c.value),ls(h.value)):i.error("Scope of 'config' expression must be a string literal.")}return new Fl(s,ls(c.value))}evaluate(e){const i=[this.key,this.scope,e.scope].filter(Boolean).join(""),s=e.getConfig(i);if(!s)return null;const{type:c,value:h,values:p,minValue:y,maxValue:b,stepValue:w}=s,S=s.default.evaluate(e);let I=S;if(h){const P=e.scope;e.scope=(P||"").split("").slice(1).join(""),I=h.evaluate(e),e.scope=P}return c&&(I=Ol(c,I)),I===void 0||y===void 0&&b===void 0&&w===void 0||(typeof I=="number"?I=Ch(I,y,b,w):Array.isArray(I)&&(I=I.map(P=>typeof P=="number"?Ch(P,y,b,w):P))),h!==void 0&&I!==void 0&&p&&!p.includes(I)&&(I=S,c&&(I=Ol(c,I))),(c&&c!==this.type||I!==void 0&&nr(I)!==this.type)&&(I=Ol(this.type.kind,I)),I}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}var Fa=Fl;function Ba(t){if(t instanceof Oi&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Xc||t instanceof eu)return!1;let e=!0;return t.eachChild(i=>{e&&!Ba(i)&&(e=!1)}),e}function Bl(t){if(t instanceof Oi&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(i=>{e&&!Bl(i)&&(e=!1)}),e}function Nl(t){if(t instanceof Fa)return!1;let e=!0;return t.eachChild(i=>{e&&!Nl(i)&&(e=!1)}),e}function Er(t,e){if(t instanceof Oi&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(s=>{i&&!Er(s,e)&&(i=!1)}),i}class bo{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const s=e[1];return i.scope.has(s)?new bo(s,i.scope.get(s)):i.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Fr=bo;class Ph{constructor(e,i=[],s,c=new H_,h=[],p,y){this.registry=e,this.path=i,this.key=i.map(b=>`[${b}]`).join(""),this.scope=c,this.errors=h,this.expectedType=s,this._scope=p,this.options=y}parse(e,i,s,c,h={}){return i||s?this.concat(i,s,c)._parse(e,h):this._parse(e,h)}_parse(e,i){function s(c,h,p){return p==="assert"?new $s(h,[c]):p==="coerce"?new Ws(h,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(c){let h=c.parse(e,this);if(!h)return null;if(this.expectedType){const p=this.expectedType,y=h.type;if(p.kind!=="string"&&p.kind!=="number"&&p.kind!=="boolean"&&p.kind!=="object"&&p.kind!=="array"||y.kind!=="value")if(p.kind!=="color"&&p.kind!=="formatted"&&p.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string"){if(this.checkSubtype(p,y))return null}else h=s(h,p,i.typeAnnotation||"coerce");else h=s(h,p,i.typeAnnotation||"assert")}if(!(h instanceof Gs)&&h.type.kind!=="resolvedImage"&&Dh(h)){const p=new Xf(this._scope,this.options);try{h=new Gs(h.type,h.evaluate(p))}catch(y){return this.error(y.message),null}}return h}return Ws.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,s){const c=typeof e=="number"?this.path.concat(e):this.path,h=s?this.scope.concat(s):this.scope;return new Ph(this.registry,c,i||null,h,this.errors,this._scope,this.options)}error(e,...i){const s=`${this.key}${i.map(c=>`[${c}]`).join("")}`;this.errors.push(new Os(s,e))}checkSubtype(e,i){const s=Wo(e,i);return s&&this.error(s),s}}var ip=Ph;function Dh(t){if(t instanceof Fr)return Dh(t.boundExpression);if(t instanceof Oi&&t.name==="error"||t instanceof Dl||t instanceof Xc||t instanceof eu||t instanceof Fa)return!1;const e=t instanceof Ws||t instanceof $s;let i=!0;return t.eachChild(s=>{i=e?i&&Dh(s):i&&s instanceof Gs}),!!i&&Ba(t)&&Er(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Jo(t,e){const i=t.length-1;let s,c,h=0,p=i,y=0;for(;h<=p;)if(y=Math.floor((h+p)/2),s=t[y],c=t[y+1],s<=e){if(y===i||e<c)return y;h=y+1}else{if(!(s>e))throw new rr("Input is not a number.");p=y-1}return 0}class tu{constructor(e,i,s){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[c,h]of s)this.labels.push(c),this.outputs.push(h)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const s=i.parse(e[1],1,Rt);if(!s)return null;const c=[];let h=null;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);for(let p=1;p<e.length;p+=2){const y=p===1?-1/0:e[p],b=e[p+1],w=p,S=p+1;if(typeof y!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(c.length&&c[c.length-1][0]>=y)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const I=i.parse(b,S,h);if(!I)return null;h=h||I.type,c.push([y,I])}return new tu(h,s,c)}evaluate(e){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return s[0].evaluate(e);const h=i.length;return c>=i[h-1]?s[h-1].evaluate(e):s[Jo(i,c)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var Vl=tu;const np=.95047,wo=1.08883,rp=4/29,Na=6/29,Lh=3*Na*Na,sp=Na*Na*Na,tg=Math.PI/180,Ts=180/Math.PI;function iu(t){return t>sp?Math.pow(t,1/3):t/Lh+rp}function nu(t){return t>Na?t*t*t:Lh*(t-rp)}function ru(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function su(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function kh(t){const e=su(t.r),i=su(t.g),s=su(t.b),c=iu((.4124564*e+.3575761*i+.1804375*s)/np),h=iu((.2126729*e+.7151522*i+.072175*s)/1);return{l:116*h-16,a:500*(c-h),b:200*(h-iu((.0193339*e+.119192*i+.9503041*s)/wo)),alpha:t.a}}function Rh(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,s=isNaN(t.b)?e:e-t.b/200;return e=1*nu(e),i=np*nu(i),s=wo*nu(s),new Kn(ru(3.2404542*i-1.5371385*e-.4985314*s),ru(-.969266*i+1.8760108*e+.041556*s),ru(.0556434*i-.2040259*e+1.0572252*s),t.alpha)}function op(t,e,i){const s=e-t;return t+i*(s>180||s<-180?s-360*Math.round(s/360):s)}const Va={forward:kh,reverse:Rh,interpolate:function(t,e,i){return{l:Ri(t.l,e.l,i),a:Ri(t.a,e.a,i),b:Ri(t.b,e.b,i),alpha:Ri(t.alpha,e.alpha,i)}}},Ua={forward:function(t){const{l:e,a:i,b:s}=kh(t),c=Math.atan2(s,i)*Ts;return{h:c<0?c+360:c,c:Math.sqrt(i*i+s*s),l:e,alpha:t.a}},reverse:function(t){const e=t.h*tg,i=t.c;return Rh({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:op(t.h,e.h,i),c:Ri(t.c,e.c,i),l:Ri(t.l,e.l,i),alpha:Ri(t.alpha,e.alpha,i)}}};var zh=Object.freeze({__proto__:null,hcl:Ua,lab:Va});class Ul{constructor(e,i,s,c,h){this.type=e,this.operator=i,this.interpolation=s,this.input=c,this.labels=[],this.outputs=[];for(const[p,y]of h)this.labels.push(p),this.outputs.push(y)}static interpolationFactor(e,i,s,c){let h=0;if(e.name==="exponential")h=ja(i,e.base,s,c);else if(e.name==="linear")h=ja(i,1,s,c);else if(e.name==="cubic-bezier"){const p=e.controlPoints;h=new at(p[0],p[1],p[2],p[3]).solve(ja(i,1,s,c))}return h}static parse(e,i){let[s,c,h,...p]=e;if(!Array.isArray(c)||c.length===0)return i.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const w=c[1];if(typeof w!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:w}}else{if(c[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const w=c.slice(1);if(w.length!==4||w.some(S=>typeof S!="number"||S<0||S>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(h=i.parse(h,2,Rt),!h)return null;const y=[];let b=null;s==="interpolate-hcl"||s==="interpolate-lab"?b=as:i.expectedType&&i.expectedType.kind!=="value"&&(b=i.expectedType);for(let w=0;w<p.length;w+=2){const S=p[w],I=p[w+1],P=w+3,R=w+4;if(typeof S!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(y.length&&y[y.length-1][0]>=S)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const O=i.parse(I,R,b);if(!O)return null;b=b||O.type,y.push([S,O])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new Ul(b,s,c,h,y):i.error(`Type ${Zn(b)} is not interpolatable.`)}evaluate(e){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return s[0].evaluate(e);const h=i.length;if(c>=i[h-1])return s[h-1].evaluate(e);const p=Jo(i,c),y=Ul.interpolationFactor(this.interpolation,c,i[p],i[p+1]),b=s[p].evaluate(e),w=s[p+1].evaluate(e);return this.operator==="interpolate"?Wc[this.type.kind.toLowerCase()](b,w,y):this.operator==="interpolate-hcl"?Ua.reverse(Ua.interpolate(Ua.forward(b),Ua.forward(w),y)):Va.reverse(Va.interpolate(Va.forward(b),Va.forward(w),y))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)i.push(this.labels[s],this.outputs[s].serialize());return i}}function ja(t,e,i,s){const c=s-i,h=t-i;return c===0?0:e===1?h/c:(Math.pow(e,h)-1)/(Math.pow(e,c)-1)}var is=Ul;class Ga{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let s=null;const c=i.expectedType;c&&c.kind!=="value"&&(s=c);const h=[];for(const y of e.slice(1)){const b=i.parse(y,1+h.length,s,void 0,{typeAnnotation:"omit"});if(!b)return null;s=s||b.type,h.push(b)}const p=c&&h.some(y=>Wo(c,y.type));return new Ga(p?Ni:s,h)}evaluate(e){let i,s=null,c=0;for(const h of this.args){if(c++,s=h.evaluate(e),s&&s instanceof ri&&!s.available&&(i||(i=s),s=null,c===this.args.length))return i;if(s!==null)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Oh=Ga;class ou{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let h=1;h<e.length-1;h+=2){const p=e[h];if(typeof p!="string")return i.error(`Expected string, but found ${typeof p} instead.`,h);if(/[^a-zA-Z0-9_]/.test(p))return i.error("Variable names must contain only alphanumeric characters or '_'.",h);const y=i.parse(e[h+1],h+1);if(!y)return null;s.push([p,y])}const c=i.parse(e[e.length-1],e.length-1,i.expectedType,s);return c?new ou(s,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,s]of this.bindings)e.push(i,s.serialize());return e.push(this.result.serialize()),e}}var Fh=ou;class To{constructor(e,i,s){this.type=e,this.index=i,this.input=s}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Rt),c=i.parse(e[2],2,Gr(i.expectedType||Ni));return s&&c?new To(c.type.itemType,s,c):null}evaluate(e){const i=this.index.evaluate(e),s=this.input.evaluate(e);if(i<0)throw new rr(`Array index out of bounds: ${i} < 0.`);if(i>=s.length)throw new rr(`Array index out of bounds: ${i} > ${s.length-1}.`);if(i!==Math.floor(i))throw new rr(`Array index must be an integer, but found ${i} instead.`);return s[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Vi=To;class Bh{constructor(e,i){this.type=Yi,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Ni),c=i.parse(e[2],2,Ni);return s&&c?di(s.type,[Yi,Xi,Rt,Ia,Ni])?new Bh(s,c):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Zn(s.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(s==null)return!1;if(!po(i,["boolean","string","number","null"]))throw new rr(`Expected first argument to be of type boolean, string, number or null, but found ${Zn(nr(i))} instead.`);if(!po(s,["string","array"]))throw new rr(`Expected second argument to be of type array or string, but found ${Zn(nr(s))} instead.`);return s.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var ig=Bh;class au{constructor(e,i,s){this.type=Rt,this.needle=e,this.haystack=i,this.fromIndex=s}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Ni),c=i.parse(e[2],2,Ni);if(!s||!c)return null;if(!di(s.type,[Yi,Xi,Rt,Ia,Ni]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Zn(s.type)} instead`);if(e.length===4){const h=i.parse(e[3],3,Rt);return h?new au(s,c,h):null}return new au(s,c)}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!po(i,["boolean","string","number","null"]))throw new rr(`Expected first argument to be of type boolean, string, number or null, but found ${Zn(nr(i))} instead.`);if(!po(s,["string","array"]))throw new rr(`Expected second argument to be of type array or string, but found ${Zn(nr(s))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return s.indexOf(i,c)}return s.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var ap=au;class Nh{constructor(e,i,s,c,h,p){this.inputType=e,this.type=i,this.input=s,this.cases=c,this.outputs=h,this.otherwise=p}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let s,c;i.expectedType&&i.expectedType.kind!=="value"&&(c=i.expectedType);const h={},p=[];for(let w=2;w<e.length-1;w+=2){let S=e[w];const I=e[w+1];Array.isArray(S)||(S=[S]);const P=i.concat(w);if(S.length===0)return P.error("Expected at least one branch label.");for(const O of S){if(typeof O!="number"&&typeof O!="string")return P.error("Branch labels must be numbers or strings.");if(typeof O=="number"&&Math.abs(O)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof O=="number"&&Math.floor(O)!==O)return P.error("Numeric branch labels must be integer values.");if(s){if(P.checkSubtype(s,nr(O)))return null}else s=nr(O);if(h[String(O)]!==void 0)return P.error("Branch labels must be unique.");h[String(O)]=p.length}const R=i.parse(I,w,c);if(!R)return null;c=c||R.type,p.push(R)}const y=i.parse(e[1],1,Ni);if(!y)return null;const b=i.parse(e[e.length-1],e.length-1,c);return b?y.type.kind!=="value"&&i.concat(1).checkSubtype(s,y.type)?null:new Nh(s,c,y,h,p,b):null}evaluate(e){const i=this.input.evaluate(e);return(nr(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),s=[],c={};for(const p of i){const y=c[this.cases[p]];y===void 0?(c[this.cases[p]]=s.length,s.push([this.cases[p],[p]])):s[y][1].push(p)}const h=p=>this.inputType.kind==="number"?Number(p):p;for(const[p,y]of s)e.push(y.length===1?h(y[0]):y.map(h)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}var lp=Nh;class lu{constructor(e,i,s){this.type=e,this.branches=i,this.otherwise=s}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let s;i.expectedType&&i.expectedType.kind!=="value"&&(s=i.expectedType);const c=[];for(let p=1;p<e.length-1;p+=2){const y=i.parse(e[p],p,Yi);if(!y)return null;const b=i.parse(e[p+1],p+1,s);if(!b)return null;c.push([y,b]),s=s||b.type}const h=i.parse(e[e.length-1],e.length-1,s);return h?new lu(s,c,h):null}evaluate(e){for(const[i,s]of this.branches)if(i.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,s]of this.branches)e(i),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var cp=lu;class jl{constructor(e,i,s,c){this.type=e,this.input=i,this.beginIndex=s,this.endIndex=c}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Ni),c=i.parse(e[2],2,Rt);if(!s||!c)return null;if(!di(s.type,[Gr(Ni),Xi,Ni]))return i.error(`Expected first argument to be of type array or string, but found ${Zn(s.type)} instead`);if(e.length===4){const h=i.parse(e[3],3,Rt);return h?new jl(s.type,s,c,h):null}return new jl(s.type,s,c)}evaluate(e){const i=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!po(i,["string","array"]))throw new rr(`Expected first argument to be of type array or string, but found ${Zn(nr(i))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return i.slice(s,c)}return i.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var $a=jl;function Vh(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Uh(t,e,i,s){return s.compare(e,i)===0}function Wa(t,e,i){const s=t!=="=="&&t!=="!=";return class ES{constructor(h,p,y){this.type=Yi,this.lhs=h,this.rhs=p,this.collator=y,this.hasUntypedArgument=h.type.kind==="value"||p.type.kind==="value"}static parse(h,p){if(h.length!==3&&h.length!==4)return p.error("Expected two or three arguments.");const y=h[0];let b=p.parse(h[1],1,Ni);if(!b)return null;if(!Vh(y,b.type))return p.concat(1).error(`"${y}" comparisons are not supported for type '${Zn(b.type)}'.`);let w=p.parse(h[2],2,Ni);if(!w)return null;if(!Vh(y,w.type))return p.concat(2).error(`"${y}" comparisons are not supported for type '${Zn(w.type)}'.`);if(b.type.kind!==w.type.kind&&b.type.kind!=="value"&&w.type.kind!=="value")return p.error(`Cannot compare types '${Zn(b.type)}' and '${Zn(w.type)}'.`);s&&(b.type.kind==="value"&&w.type.kind!=="value"?b=new $s(w.type,[b]):b.type.kind!=="value"&&w.type.kind==="value"&&(w=new $s(b.type,[w])));let S=null;if(h.length===4){if(b.type.kind!=="string"&&w.type.kind!=="string"&&b.type.kind!=="value"&&w.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(S=p.parse(h[3],3,Hc),!S)return null}return new ES(b,w,S)}evaluate(h){const p=this.lhs.evaluate(h),y=this.rhs.evaluate(h);if(s&&this.hasUntypedArgument){const b=nr(p),w=nr(y);if(b.kind!==w.kind||b.kind!=="string"&&b.kind!=="number")throw new rr(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${b.kind}, ${w.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const b=nr(p),w=nr(y);if(b.kind!=="string"||w.kind!=="string")return e(h,p,y)}return this.collator?i(h,p,y,this.collator.evaluate(h)):e(h,p,y)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){const h=[t];return this.eachChild(p=>{h.push(p.serialize())}),h}}}const jh=Wa("==",function(t,e,i){return e===i},Uh),Gh=Wa("!=",function(t,e,i){return e!==i},function(t,e,i,s){return!Uh(0,e,i,s)}),ng=Wa("<",function(t,e,i){return e<i},function(t,e,i,s){return s.compare(e,i)<0}),rg=Wa(">",function(t,e,i){return e>i},function(t,e,i,s){return s.compare(e,i)>0}),up=Wa("<=",function(t,e,i){return e<=i},function(t,e,i,s){return s.compare(e,i)<=0}),sg=Wa(">=",function(t,e,i){return e>=i},function(t,e,i,s){return s.compare(e,i)>=0});class $h{constructor(e,i,s,c,h,p){this.type=Xi,this.number=e,this.locale=i,this.currency=s,this.unit=c,this.minFractionDigits=h,this.maxFractionDigits=p}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const s=i.parse(e[1],1,Rt);if(!s)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return i.error("NumberFormat options argument must be an object.");let h=null;if(c.locale&&(h=i.parse(c.locale,1,Xi),!h))return null;let p=null;if(c.currency&&(p=i.parse(c.currency,1,Xi),!p))return null;let y=null;if(c.unit&&(y=i.parse(c.unit,1,Xi),!y))return null;let b=null;if(c["min-fraction-digits"]&&(b=i.parse(c["min-fraction-digits"],1,Rt),!b))return null;let w=null;return c["max-fraction-digits"]&&(w=i.parse(c["max-fraction-digits"],1,Rt),!w)?null:new $h(s,h,p,y,b,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Wh{constructor(e){this.type=Rt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=i.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Zn(s.type)} instead.`):new Wh(s):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new rr(`Expected value to be of type string or array, but found ${Zn(nr(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function hp(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Hh={"==":jh,"!=":Gh,">":rg,"<":ng,">=":sg,"<=":up,array:$s,at:Vi,boolean:$s,case:cp,coalesce:Oh,collator:Dl,format:La,image:qo,in:ig,"index-of":ap,interpolate:is,"interpolate-hcl":is,"interpolate-lab":is,length:Wh,let:Fh,literal:Gs,match:lp,number:$s,"number-format":$h,object:$s,slice:$a,step:Vl,string:$s,"to-boolean":Ws,"to-color":Ws,"to-number":Ws,"to-string":Ws,var:Fr,within:Xc,distance:eu,config:Fa};function qh(t,[e,i,s,c]){e=e.evaluate(t),i=i.evaluate(t),s=s.evaluate(t);const h=c?c.evaluate(t):1,p=Zf(e,i,s,h);if(p)throw new rr(p);return new Kn(e/255*h,i/255*h,s/255*h,h)}function dp(t,[e,i,s,c]){e=e.evaluate(t),i=i.evaluate(t),s=s.evaluate(t);const h=c?c.evaluate(t):1,p=function(w,S,I,P){return typeof w=="number"&&w>=0&&w<=360?typeof S=="number"&&S>=0&&S<=100&&typeof I=="number"&&I>=0&&I<=100?P===void 0||typeof P=="number"&&P>=0&&P<=1?null:`Invalid hsla value [${[w,S,I,P].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof P=="number"?[w,S,I,P]:[w,S,I]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof P=="number"?[w,S,I,P]:[w,S,I]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,s,h);if(p)throw new rr(p);const y=`hsla(${e}, ${i}%, ${s}%, ${h})`,b=Kn.parse(y);if(!b)throw new rr(`Failed to parse HSLA color: ${y}`);return b}function Zh(t,e){return t in e}function Xh(t,e){const i=e[t];return i===void 0?null:i}function Qo(t){return{type:t}}Oi.register(Hh,{error:[{kind:"error"},[Xi],(t,[e])=>{throw new rr(e.evaluate(t))}],typeof:[Xi,[Ni],(t,[e])=>Zn(nr(e.evaluate(t)))],"to-rgba":[Gr(Rt,4),[as],(t,[e])=>e.evaluate(t).toArray()],rgb:[as,[Rt,Rt,Rt],qh],rgba:[as,[Rt,Rt,Rt,Rt],qh],hsl:[as,[Rt,Rt,Rt],dp],hsla:[as,[Rt,Rt,Rt,Rt],dp],has:{type:Yi,overloads:[[[Xi],(t,[e])=>Zh(e.evaluate(t),t.properties())],[[Xi,Ca],(t,[e,i])=>Zh(e.evaluate(t),i.evaluate(t))]]},get:{type:Ni,overloads:[[[Xi],(t,[e])=>Xh(e.evaluate(t),t.properties())],[[Xi,Ca],(t,[e,i])=>Xh(e.evaluate(t),i.evaluate(t))]]},"feature-state":[Ni,[Xi],(t,[e])=>Xh(e.evaluate(t),t.featureState||{})],properties:[Ca,[],t=>t.properties()],"geometry-type":[Xi,[],t=>t.geometryType()],id:[Ni,[],t=>t.id()],zoom:[Rt,[],t=>t.globals.zoom],pitch:[Rt,[],t=>t.globals.pitch||0],"distance-from-center":[Rt,[],t=>t.distanceFromCenter()],"measure-light":[Rt,[Xi],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[Rt,[],t=>t.globals.heatmapDensity||0],"line-progress":[Rt,[],t=>t.globals.lineProgress||0],"raster-value":[Rt,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[Rt,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[Rt,[],t=>t.globals.skyRadialProgress||0],accumulated:[Ni,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[Rt,Qo(Rt),(t,e)=>{let i=0;for(const s of e)i+=s.evaluate(t);return i}],"*":[Rt,Qo(Rt),(t,e)=>{let i=1;for(const s of e)i*=s.evaluate(t);return i}],"-":{type:Rt,overloads:[[[Rt,Rt],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[Rt],(t,[e])=>-e.evaluate(t)]]},"/":[Rt,[Rt,Rt],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[Rt,[Rt,Rt],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[Rt,[],()=>Math.LN2],pi:[Rt,[],()=>Math.PI],e:[Rt,[],()=>Math.E],"^":[Rt,[Rt,Rt],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[Rt,[Rt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Rt,[Rt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Rt,[Rt],(t,[e])=>Math.log(e.evaluate(t))],log2:[Rt,[Rt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Rt,[Rt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Rt,[Rt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Rt,[Rt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Rt,[Rt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Rt,[Rt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Rt,[Rt],(t,[e])=>Math.atan(e.evaluate(t))],min:[Rt,Qo(Rt),(t,e)=>Math.min(...e.map(i=>i.evaluate(t)))],max:[Rt,Qo(Rt),(t,e)=>Math.max(...e.map(i=>i.evaluate(t)))],abs:[Rt,[Rt],(t,[e])=>Math.abs(e.evaluate(t))],round:[Rt,[Rt],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[Rt,[Rt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Rt,[Rt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Yi,[Xi,Ni],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[Yi,[Ni],(t,[e])=>t.id()===e.value],"filter-type-==":[Yi,[Xi],(t,[e])=>t.geometryType()===e.value],"filter-<":[Yi,[Xi,Ni],(t,[e,i])=>{const s=t.properties()[e.value],c=i.value;return typeof s==typeof c&&s<c}],"filter-id-<":[Yi,[Ni],(t,[e])=>{const i=t.id(),s=e.value;return typeof i==typeof s&&i<s}],"filter->":[Yi,[Xi,Ni],(t,[e,i])=>{const s=t.properties()[e.value],c=i.value;return typeof s==typeof c&&s>c}],"filter-id->":[Yi,[Ni],(t,[e])=>{const i=t.id(),s=e.value;return typeof i==typeof s&&i>s}],"filter-<=":[Yi,[Xi,Ni],(t,[e,i])=>{const s=t.properties()[e.value],c=i.value;return typeof s==typeof c&&s<=c}],"filter-id-<=":[Yi,[Ni],(t,[e])=>{const i=t.id(),s=e.value;return typeof i==typeof s&&i<=s}],"filter->=":[Yi,[Xi,Ni],(t,[e,i])=>{const s=t.properties()[e.value],c=i.value;return typeof s==typeof c&&s>=c}],"filter-id->=":[Yi,[Ni],(t,[e])=>{const i=t.id(),s=e.value;return typeof i==typeof s&&i>=s}],"filter-has":[Yi,[Ni],(t,[e])=>e.value in t.properties()],"filter-has-id":[Yi,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[Yi,[Gr(Xi)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Yi,[Gr(Ni)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Yi,[Xi,Gr(Ni)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Yi,[Xi,Gr(Ni)],(t,[e,i])=>function(s,c,h,p){for(;h<=p;){const y=h+p>>1;if(c[y]===s)return!0;c[y]>s?p=y-1:h=y+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Yi,overloads:[[[Yi,Yi],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[Qo(Yi),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:Yi,overloads:[[[Yi,Yi],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[Qo(Yi),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[Yi,[Yi],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Yi,[Xi],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[Xi,[Xi],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Xi,[Xi],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Xi,Qo(Ni),(t,e)=>e.map(i=>ls(i.evaluate(t))).join("")],"resolved-locale":[Xi,[Hc],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[Rt,[Rt,Rt,Ni],(t,e)=>{const[i,s,c]=e.map(p=>p.evaluate(t));if(i>s||i===s)return i;let h;if(typeof c=="string")h=function(p){let y=0;if(p.length===0)return y;for(let b=0;b<p.length;b++)y=(y<<5)-y+p.charCodeAt(b),y|=0;return y}(c);else{if(typeof c!="number")throw new rr(`Invalid seed input: ${c}`);h=c}return i+hp(h)()*(s-i)}]});var Ha=Hh;function Yh(t){return{result:"success",value:t}}function ea(t){return{result:"error",value:t}}function fp(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function cu(t){return t["property-type"]==="data-driven"}function Kh(t){return fp(t.expression,"measure-light")}function pp(t){return fp(t.expression,"zoom")}function Jh(t){return!!t.expression&&t.expression.interpolated}function uu(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function mp(t){return t}function Qh(t,e){const i=e.type==="color",s=t.stops&&typeof t.stops[0][0]=="object",c=s||!(s||t.property!==void 0),h=t.type||(Jh(e)?"exponential":"interval");if(i&&((t=ah({},t)).stops&&(t.stops=t.stops.map(w=>[w[0],Kn.parse(w[1])])),t.default=Kn.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!zh[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let p,y,b;if(h==="exponential")p=_p;else if(h==="interval")p=ag;else if(h==="categorical"){p=og,y=Object.create(null);for(const w of t.stops)y[w[0]]=w[1];b=typeof t.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);p=gp}if(s){const w={},S=[];for(let R=0;R<t.stops.length;R++){const O=t.stops[R],F=O[0].zoom;w[F]===void 0&&(w[F]={zoom:F,type:t.type,property:t.property,default:t.default,stops:[]},S.push(F)),w[F].stops.push([O[0].value,O[1]])}const I=[];for(const R of S)I.push([w[R].zoom,Qh(w[R],e)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:is.interpolationFactor.bind(void 0,P),zoomStops:I.map(R=>R[0]),evaluate:({zoom:R},O)=>_p({stops:I,base:t.base},e,R).evaluate(R,O)}}if(c){const w=h==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:is.interpolationFactor.bind(void 0,w),zoomStops:t.stops.map(S=>S[0]),evaluate:({zoom:S})=>p(t,e,S,y,b)}}return{kind:"source",evaluate(w,S){const I=S&&S.properties?S.properties[t.property]:void 0;return I===void 0?Gl(t.default,e.default):p(t,e,I,y,b)}}}function Gl(t,e,i){return t!==void 0?t:e!==void 0?e:i!==void 0?i:void 0}function og(t,e,i,s,c){return Gl(typeof i===c?s[i]:void 0,t.default,e.default)}function ag(t,e,i){if(ka(i)!=="number")return Gl(t.default,e.default);const s=t.stops.length;if(s===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[s-1][0])return t.stops[s-1][1];const c=Jo(t.stops.map(h=>h[0]),i);return t.stops[c][1]}function _p(t,e,i){const s=t.base!==void 0?t.base:1;if(ka(i)!=="number")return Gl(t.default,e.default);const c=t.stops.length;if(c===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[c-1][0])return t.stops[c-1][1];const h=Jo(t.stops.map(S=>S[0]),i),p=function(S,I,P,R){const O=R-P,F=S-P;return O===0?0:I===1?F/O:(Math.pow(I,F)-1)/(Math.pow(I,O)-1)}(i,s,t.stops[h][0],t.stops[h+1][0]),y=t.stops[h][1],b=t.stops[h+1][1];let w=Wc[e.type]||mp;if(t.colorSpace&&t.colorSpace!=="rgb"){const S=zh[t.colorSpace];w=(I,P)=>S.reverse(S.interpolate(S.forward(I),S.forward(P),p))}return typeof y.evaluate=="function"?{evaluate(...S){const I=y.evaluate.apply(void 0,S),P=b.evaluate.apply(void 0,S);if(I!==void 0&&P!==void 0)return w(I,P,p)}}:w(y,b,p)}function gp(t,e,i){return e.type==="color"?i=Kn.parse(i):e.type==="formatted"?i=Sr.fromString(i.toString()):e.type==="resolvedImage"?i=ri.fromString(i.toString()):ka(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Gl(i,t.default,e.default)}class hu{constructor(e,i,s,c){this.expression=e,this._warningHistory={},this._evaluator=new Xf(s,c),this._defaultValue=i?function(h){return h.type==="color"&&(uu(h.default)||Array.isArray(h.default))?new Kn(0,0,0,0):h.type==="color"?Kn.parse(h.default)||null:h.default===void 0?null:h.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,s,c,h,p,y,b){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=s,this._evaluator.canonical=c||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,s,c,h,p,y,b){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=s||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new rr(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function $l(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Ha}function du(t,e,i,s){const c=new ip(Ha,[],e?function(p){const y={color:as,string:Xi,number:Rt,enum:Xi,boolean:Yi,formatted:Pa,resolvedImage:Cl};return p.type==="array"?Gr(y[p.value]||Ni,p.length):y[p.type]}(e):void 0,void 0,void 0,i,s),h=c.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Yh(new hu(h,e,i,s)):ea(c.errors)}class ed{constructor(e,i,s){this.kind=e,this._styleExpression=i,this.isLightConstant=s,this.isStateDependent=e!=="constant"&&!Bl(i.expression),this.isConfigDependent=!Nl(i.expression)}evaluateWithoutErrorHandling(e,i,s,c,h,p){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,c,h,p)}evaluate(e,i,s,c,h,p){return this._styleExpression.evaluate(e,i,s,c,h,p)}}class Wl{constructor(e,i,s,c,h){this.kind=e,this.zoomStops=s,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Bl(i.expression),this.isLightConstant=h,this.isConfigDependent=!Nl(i.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,i,s,c,h,p){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,c,h,p)}evaluate(e,i,s,c,h,p){return this._styleExpression.evaluate(e,i,s,c,h,p)}interpolationFactor(e,i,s){return this.interpolationType?is.interpolationFactor(this.interpolationType,e,i,s):0}}function fu(t,e,i,s){if((t=du(t,e,i,s)).result==="error")return t;const c=t.value.expression,h=Ba(c);if(!h&&!cu(e))return ea([new Os("","data expressions not supported")]);const p=Er(c,["zoom","pitch","distance-from-center"]);if(!p&&!pp(e))return ea([new Os("","zoom expressions not supported")]);const y=Er(c,["measure-light"]);if(!y&&!Kh(e))return ea([new Os("","measure-light expression not supported")]);const b=e.expression&&e.expression.relaxZoomRestriction,w=ql(c);return w||p||b?w instanceof Os?ea([w]):w instanceof is&&!Jh(e)?ea([new Os("",'"interpolate" expressions cannot be used with this property')]):Yh(w?new Wl(h?"camera":"composite",t.value,w.labels,w instanceof is?w.interpolation:void 0,y):new ed(h?"constant":"source",t.value,y)):ea([new Os("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Hl{constructor(e,i){this._parameters=e,this._specification=i,ah(this,Qh(this._parameters,this._specification))}static deserialize(e){return new Hl(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ql(t){let e=null;if(t instanceof Fh)e=ql(t.result);else if(t instanceof Oh){for(const i of t.args)if(e=ql(i),e)break}else(t instanceof Vl||t instanceof is)&&t.input instanceof Oi&&t.input.name==="zoom"&&(e=t);return e instanceof Os||t.eachChild(i=>{const s=ql(i);s instanceof Os?e=s:e&&s&&e!==s&&(e=new Os("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var lg=Ss,Ms=3;function Ss(t,e,i){var s=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var c=new Int32Array(this.arrayBuffer);t=c[0],this.d=(e=c[1])+2*(i=c[2]);for(var h=0;h<this.d*this.d;h++){var p=c[Ms+h],y=c[Ms+h+1];s.push(p===y?null:c.subarray(p,y))}var b=c[Ms+s.length+1];this.keys=c.subarray(c[Ms+s.length],b),this.bboxes=c.subarray(b),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var w=0;w<this.d*this.d;w++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var S=i/e*t;this.min=-S,this.max=t+S}Ss.prototype.insert=function(t,e,i,s,c){this._forEachCell(e,i,s,c,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(s),this.bboxes.push(c)},Ss.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ss.prototype._insertCell=function(t,e,i,s,c,h){this.cells[c].push(h)},Ss.prototype.query=function(t,e,i,s,c){var h=this.min,p=this.max;if(t<=h&&e<=h&&p<=i&&p<=s&&!c)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(t,e,i,s,this._queryCell,y,{},c),y},Ss.prototype._queryCell=function(t,e,i,s,c,h,p,y){var b=this.cells[c];if(b!==null)for(var w=this.keys,S=this.bboxes,I=0;I<b.length;I++){var P=b[I];if(p[P]===void 0){var R=4*P;(y?y(S[R+0],S[R+1],S[R+2],S[R+3]):t<=S[R+2]&&e<=S[R+3]&&i>=S[R+0]&&s>=S[R+1])?(p[P]=!0,h.push(w[P])):p[P]=!1}}},Ss.prototype._forEachCell=function(t,e,i,s,c,h,p,y){for(var b=this._convertToCellCoord(t),w=this._convertToCellCoord(e),S=this._convertToCellCoord(i),I=this._convertToCellCoord(s),P=b;P<=S;P++)for(var R=w;R<=I;R++){var O=this.d*R+P;if((!y||y(this._convertFromCellCoord(P),this._convertFromCellCoord(R),this._convertFromCellCoord(P+1),this._convertFromCellCoord(R+1)))&&c.call(this,t,e,i,s,O,h,p,y))return}},Ss.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Ss.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Ss.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=Ms+this.cells.length+1+1,i=0,s=0;s<this.cells.length;s++)i+=this.cells[s].length;var c=new Int32Array(e+i+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var h=e,p=0;p<t.length;p++){var y=t[p];c[Ms+p]=h,c.set(y,h),h+=y.length}return c[Ms+t.length]=h,c.set(this.keys,h),c[Ms+t.length+1]=h+=this.keys.length,c.set(this.bboxes,h),h+=this.bboxes.length,c.buffer};var qs=tt(lg);const Zl={};function Bt(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Zl[e]={klass:t,omit:i.omit||[]}}Bt(Object,"Object"),qs.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.add(i),{buffer:i}},qs.deserialize=function(t){return new qs(t.buffer)},Object.defineProperty(qs,"name",{value:"Grid"}),Bt(qs,"Grid"),Bt(Kn,"Color"),Bt(Error,"Error"),Bt(Sr,"Formatted"),Bt(Da,"FormattedSection"),Bt(tr,"AJAXError"),Bt(ri,"ResolvedImage"),Bt(Hl,"StylePropertyFunction"),Bt(hu,"StyleExpression",{omit:["_evaluator"]}),Bt(Wl,"ZoomDependentExpression"),Bt(ed,"ZoomConstantExpression"),Bt(Oi,"CompoundExpression",{omit:["_evaluate"]});for(const t in Ha)Zl[Ha[t]._classRegistryKey]||Bt(Ha[t],`Expression${t}`);function yp(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function pu(t){return self.ImageBitmap&&t instanceof ImageBitmap}function Mo(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(yp(t)||pu(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.add(i.buffer),i}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const s of t)i.push(Mo(s,e));return i}if(t instanceof Map){const i={$name:"Map"};for(const[s,c]of t.entries())i[s]=Mo(c);return i}if(typeof t=="object"){const i=t.constructor,s=i._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const c=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(const h in t)t.hasOwnProperty(h)&&(Zl[s].omit.indexOf(h)>=0||(c[h]=Mo(t[h],e)));t instanceof Error&&(c.message=t.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(c.$name=s),c}throw new Error("can't serialize object of type "+typeof t)}function ta(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||yp(t)||pu(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(ta);if(typeof t=="object"){const e=t.$name||"Object";if(e==="Map"){const c=new Map;for(const h of Object.keys(t))h!=="$name"&&c.set(h,ta(t[h]));return c}const{klass:i}=Zl[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const s=Object.create(i.prototype);for(const c of Object.keys(t))c!=="$name"&&(s[c]=ta(t[c]));return s}throw new Error("can't deserialize object of type "+typeof t)}const Ht={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function So(t){for(const e of t)if(td(e.charCodeAt(0)))return!0;return!1}function cg(t){for(const e of t)if(!ug(e.charCodeAt(0)))return!1;return!0}function ug(t){return!(Ht.Arabic(t)||Ht["Arabic Supplement"](t)||Ht["Arabic Extended-A"](t)||Ht["Arabic Presentation Forms-A"](t)||Ht["Arabic Presentation Forms-B"](t))}function td(t){return!(t!==746&&t!==747&&(t<4352||!(Ht["Bopomofo Extended"](t)||Ht.Bopomofo(t)||Ht["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Ht["CJK Compatibility Ideographs"](t)||Ht["CJK Compatibility"](t)||Ht["CJK Radicals Supplement"](t)||Ht["CJK Strokes"](t)||!(!Ht["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Ht["CJK Unified Ideographs Extension A"](t)||Ht["CJK Unified Ideographs"](t)||Ht["Enclosed CJK Letters and Months"](t)||Ht["Hangul Compatibility Jamo"](t)||Ht["Hangul Jamo Extended-A"](t)||Ht["Hangul Jamo Extended-B"](t)||Ht["Hangul Jamo"](t)||Ht["Hangul Syllables"](t)||Ht.Hiragana(t)||Ht["Ideographic Description Characters"](t)||Ht.Kanbun(t)||Ht["Kangxi Radicals"](t)||Ht["Katakana Phonetic Extensions"](t)||Ht.Katakana(t)&&t!==12540||!(!Ht["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Ht["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Ht["Unified Canadian Aboriginal Syllabics"](t)||Ht["Unified Canadian Aboriginal Syllabics Extended"](t)||Ht["Vertical Forms"](t)||Ht["Yijing Hexagram Symbols"](t)||Ht["Yi Syllables"](t)||Ht["Yi Radicals"](t))))}function xp(t){return!(td(t)||function(e){return!!(Ht["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Ht["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Ht["Letterlike Symbols"](e)||Ht["Number Forms"](e)||Ht["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Ht["Control Pictures"](e)&&e!==9251||Ht["Optical Character Recognition"](e)||Ht["Enclosed Alphanumerics"](e)||Ht["Geometric Shapes"](e)||Ht["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Ht["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ht["CJK Symbols and Punctuation"](e)||Ht.Katakana(e)||Ht["Private Use Area"](e)||Ht["CJK Compatibility Forms"](e)||Ht["Small Form Variants"](e)||Ht["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function vp(t){return t>=1424&&t<=2303||Ht["Arabic Presentation Forms-A"](t)||Ht["Arabic Presentation Forms-B"](t)}function bp(t,e){return!(!e&&vp(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Ht.Khmer(t))}function id(t){for(const e of t)if(vp(e.charCodeAt(0)))return!0;return!1}const nd="deferred",rd="loading",sd="loaded";let od=null,$r="unavailable",Eo=null;const wp=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&($r="error"),od&&od(t)};function ad(){ld.fire(new $o("pluginStateChange",{pluginStatus:$r,pluginURL:Eo}))}const ld=new Aa,Ao=function(){return $r},cd=function(){if($r!==nd||!Eo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");$r=rd,ad(),Eo&&We({url:Eo},t=>{t?wp(t):($r=sd,ad())})},ns={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>$r===sd||ns.applyArabicShaping!=null,isLoading:()=>$r===rd,setState(t){$r=t.pluginStatus,Eo=t.pluginURL},isParsed:()=>ns.applyArabicShaping!=null&&ns.processBidirectionalText!=null&&ns.processStyledBidirectionalText!=null,getPluginURL:()=>Eo};class On{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,s){for(const c of i)if(!bp(c.charCodeAt(0),s))return!1;return!0}(e,ns.isLoaded())}}class mu{constructor(e,i,s,c){this.property=e,this.value=i,this.expression=function(h,p,y,b){if(uu(h))return new Hl(h,p);if($l(h)||Array.isArray(h)&&h.length>0){const w=fu(h,p,y,b);if(w.result==="error")throw new Error(w.value.map(S=>`${S.key}: ${S.message}`).join(", "));return w.value}{let w=h;return typeof h=="string"&&p.type==="color"&&(w=Kn.parse(h)),{kind:"constant",isConfigDependent:!1,evaluate:()=>w}}}(i===void 0?e.specification.default:i,e.specification,s,c)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,s){return this.property.possiblyEvaluate(this,e,i,s)}}class ud{constructor(e,i,s){this.property=e,this.value=new mu(e,void 0,i,s)}transitioned(e,i){return new hd(this.property,this.value,i,Nt({},e.transition,this.transition),e.now)}untransitioned(){return new hd(this.property,this.value,null,{},0)}}class Zs{constructor(e,i,s){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=s,this.isConfigDependent=!1}getValue(e){return hn(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new ud(this._values[e].property,this._scope,this._options)),this._values[e].value=new mu(this._values[e].property,i===null?void 0:hn(i),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,i){i&&(this._options=i);const s=this._properties.properties;if(e)for(const c in e){const h=e[c];if(hi(c,"-transition")){const p=c.slice(0,-11);s[p]&&this.setTransition(p,h)}else s[c]&&this.setValue(c,h)}}getTransition(e){return hn(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new ud(this._values[e].property)),this._values[e].transition=hn(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(e[i]=s);const c=this.getTransition(i);c!==void 0&&(e[`${i}-transition`]=c)}return e}transitioned(e,i){const s=new ia(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].transitioned(e,i._values[c]);return s}untransitioned(){const e=new ia(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class hd{constructor(e,i,s,c,h){const p=c.delay||0,y=c.duration||0;h=h||0,this.property=e,this.value=i,this.begin=h+p,this.end=this.begin+y,e.specification.transition&&(c.delay||c.duration)&&(this.prior=s)}possiblyEvaluate(e,i,s){const c=e.now||0,h=this.value.possiblyEvaluate(e,i,s),p=this.prior;if(p){if(c>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(c<this.begin)return p.possiblyEvaluate(e,i,s);{const y=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,i,s),h,qe(y))}}return h}}class ia{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,s){const c=new Xl(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].possiblyEvaluate(e,i,s);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class hg{constructor(e,i,s){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=s,this.isConfigDependent=!1}getValue(e){return hn(this._values[e].value)}setValue(e,i){this._values[e]=new mu(this._values[e].property,i===null?void 0:hn(i),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(e[i]=s)}return e}possiblyEvaluate(e,i,s){const c=new Xl(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].possiblyEvaluate(e,i,s);return c}}class qa{constructor(e,i,s){this.property=e,this.value=i,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,s,c){return this.property.evaluate(this.value,this.parameters,e,i,s,c)}}class Xl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class gt{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,s){const c=Wc[this.specification.type];return c?c(e,i,s):e}}class ti{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,s,c){return new qa(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},s,c)}:e.expression,i)}interpolate(e,i,s){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new qa(this,{kind:"constant",value:void 0},e.parameters);const c=Wc[this.specification.type];return c?new qa(this,{kind:"constant",value:c(e.value.value,i.value.value,s)},e.parameters):e}evaluate(e,i,s,c,h,p){return e.kind==="constant"?e.value:e.evaluate(i,s,c,h,p)}}class na{constructor(e){this.specification=e}possiblyEvaluate(e,i,s,c){return!!e.expression.evaluate(i,null,{},s,c)}interpolate(){return!1}}class Fn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new On(0,{});for(const s in e){const c=e[s];c.specification.overridable&&this.overridableProperties.push(s);const h=this.defaultPropertyValues[s]=new mu(c,void 0),p=this.defaultTransitionablePropertyValues[s]=new ud(c);this.defaultTransitioningPropertyValues[s]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=h.possiblyEvaluate(i)}}}function Yl(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Kl(t){if(Array.isArray(t))return t.map(Kl);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=Kl(t[i]);return e}return Yl(t)}Bt(ti,"DataDrivenProperty"),Bt(gt,"DataConstantProperty"),Bt(na,"ColorRampProperty");var Ie=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function dd(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!dd(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function rs(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};dd(t)||(t=Jl(t));const i=t;let s=!0;try{s=function(w){if(!Za(w))return w;let S=Kl(w);return fd(S),S=Tp(S),S}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const c=Ie[`filter_${e}`],h=du(s,c);let p=null;if(h.result==="error")throw new Error(h.value.map(w=>`${w.key}: ${w.message}`).join(", "));p=(w,S,I)=>h.value.evaluate(w,S,{},I);let y=null,b=null;if(s!==i){const w=du(i,c);if(w.result==="error")throw new Error(w.value.map(S=>`${S.key}: ${S.message}`).join(", "));y=(S,I,P,R,O)=>w.value.evaluate(S,I,{},P,void 0,void 0,R,O),b=!Ba(w.value.expression)}return{filter:p,dynamicFilter:y||void 0,needGeometry:Mp(s),needFeature:!!b}}function Tp(t){if(!Array.isArray(t))return t;const e=function(i){if(dg.has(i[0])){for(let s=1;s<i.length;s++)if(Za(i[s]))return!0}return i}(t);return e===!0?e:e.map(i=>Tp(i))}function fd(t){let e=!1;const i=[];if(t[0]==="case"){for(let s=1;s<t.length-1;s+=2)e=e||Za(t[s]),i.push(t[s+1]);i.push(t[t.length-1])}else if(t[0]==="match"){e=e||Za(t[1]);for(let s=2;s<t.length-1;s+=2)i.push(t[s+1]);i.push(t[t.length-1])}else if(t[0]==="step"){e=e||Za(t[1]);for(let s=1;s<t.length-1;s+=2)i.push(t[s+1])}e&&(t.length=0,t.push("any",...i));for(let s=1;s<t.length;s++)fd(t[s])}function Za(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<t.length;i++)if(Za(t[i]))return!0;return!1}const dg=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function fg(t,e){return t<e?-1:t>e?1:0}function Mp(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(Mp(t[e]))return!0;return!1}function Jl(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?Ql(t[1],t[2],"=="):e==="!="?ec(Ql(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Ql(t[1],t[2],e):e==="any"?(i=t.slice(1),["any"].concat(i.map(Jl))):e==="all"?["all"].concat(t.slice(1).map(Jl)):e==="none"?["all"].concat(t.slice(1).map(Jl).map(ec)):e==="in"?pd(t[1],t.slice(2)):e==="!in"?ec(pd(t[1],t.slice(2))):e==="has"?Sp(t[1]):e!=="!has"||ec(Sp(t[1]));var i}function Ql(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function pd(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",t,["literal",e.sort(fg)]]:["filter-in-small",t,["literal",e]]}}function Sp(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function ec(t){return["!",t]}const _u="";function md(t,e){return e?`${t}${_u}${e}`:t}const tc="-transition";class Wr extends Aa{constructor(e,i,s,c){if(super(),this.id=e.id,this.fqid=md(this.id,s),this.type=e.type,this.scope=s,this.options=c,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new hg(i.layout,this.scope,c),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),i.paint)){this._transitionablePaint=new Zs(i.paint,this.scope,c);for(const h in e.paint)this.setPaintProperty(h,e.paint[h]);for(const h in e.layout)this.setLayoutProperty(h,e.layout[h]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Xl(i.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const s=this._unevaluatedLayout;s._properties.properties[e]&&(s.setValue(e,i),this.isConfigDependent=this.isConfigDependent||s.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return hi(e,tc)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const s=this._transitionablePaint,c=s._properties.properties;if(hi(e,tc)){const I=e.slice(0,-11);return c[I]&&s.setTransition(I,i||void 0),!1}if(!c[e])return!1;const h=s._values[e],p=h.value.isDataDriven(),y=h.value;s.setValue(e,i),this.isConfigDependent=this.isConfigDependent||s.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const b=s._values[e].value,w=b.isDataDriven(),S=hi(e,"pattern")||e==="line-dasharray";return w||p||S||this._handleOverridablePaintPropertyUpdate(e,y,b)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i){return null}_handleOverridablePaintPropertyUpdate(e,i,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return on({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof qa&&cu(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=rs(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}}const pg={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class gu{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Pn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function rn(t,e=1){let i=0,s=0;return{members:t.map(c=>{const h=pg[c.type].BYTES_PER_ELEMENT,p=i=ic(i,Math.max(e,h)),y=c.components||1;return s=Math.max(s,h),i+=h*y,{name:c.name,type:c.type,components:y,offset:p}}),size:ic(i,Math.max(s,e)),alignment:e}}function ic(t,e){return Math.ceil(t/e)*e}class Es extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const c=2*e;return this.int16[c+0]=i,this.int16[c+1]=s,e}}Es.prototype.bytesPerElement=4,Bt(Es,"StructArrayLayout2i4");class Br extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,s)}emplace(e,i,s,c){const h=3*e;return this.int16[h+0]=i,this.int16[h+1]=s,this.int16[h+2]=c,e}}Br.prototype.bytesPerElement=6,Bt(Br,"StructArrayLayout3i6");class Xs extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,s,c)}emplace(e,i,s,c,h){const p=4*e;return this.int16[p+0]=i,this.int16[p+1]=s,this.int16[p+2]=c,this.int16[p+3]=h,e}}Xs.prototype.bytesPerElement=8,Bt(Xs,"StructArrayLayout4i8");class _d extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,c,h)}emplace(e,i,s,c,h,p){const y=5*e;return this.int16[y+0]=i,this.int16[y+1]=s,this.int16[y+2]=c,this.int16[y+3]=h,this.int16[y+4]=p,e}}_d.prototype.bytesPerElement=10,Bt(_d,"StructArrayLayout5i10");class gd extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,h,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,s,c,h,p,y)}emplace(e,i,s,c,h,p,y,b){const w=6*e,S=12*e,I=3*e;return this.int16[w+0]=i,this.int16[w+1]=s,this.uint8[S+4]=c,this.uint8[S+5]=h,this.uint8[S+6]=p,this.uint8[S+7]=y,this.float32[I+2]=b,e}}gd.prototype.bytesPerElement=12,Bt(gd,"StructArrayLayout2i4ub1f12");class Io extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,s,c)}emplace(e,i,s,c,h){const p=4*e;return this.float32[p+0]=i,this.float32[p+1]=s,this.float32[p+2]=c,this.float32[p+3]=h,e}}Io.prototype.bytesPerElement=16,Bt(Io,"StructArrayLayout4f16");class Co extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,c,h)}emplace(e,i,s,c,h,p){const y=6*e,b=3*e;return this.uint16[y+0]=i,this.uint16[y+1]=s,this.uint16[y+2]=c,this.uint16[y+3]=h,this.float32[b+2]=p,e}}Co.prototype.bytesPerElement=12,Bt(Co,"StructArrayLayout4ui1f12");class Xa extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,s,c)}emplace(e,i,s,c,h){const p=4*e;return this.uint16[p+0]=i,this.uint16[p+1]=s,this.uint16[p+2]=c,this.uint16[p+3]=h,e}}Xa.prototype.bytesPerElement=8,Bt(Xa,"StructArrayLayout4ui8");class yu extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,c,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,s,c,h,p)}emplace(e,i,s,c,h,p,y){const b=6*e;return this.int16[b+0]=i,this.int16[b+1]=s,this.int16[b+2]=c,this.int16[b+3]=h,this.int16[b+4]=p,this.int16[b+5]=y,e}}yu.prototype.bytesPerElement=12,Bt(yu,"StructArrayLayout6i12");class nc extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,c,h,p,y,b,w,S,I,P){const R=this.length;return this.resize(R+1),this.emplace(R,e,i,s,c,h,p,y,b,w,S,I,P)}emplace(e,i,s,c,h,p,y,b,w,S,I,P,R){const O=12*e;return this.int16[O+0]=i,this.int16[O+1]=s,this.int16[O+2]=c,this.int16[O+3]=h,this.uint16[O+4]=p,this.uint16[O+5]=y,this.uint16[O+6]=b,this.uint16[O+7]=w,this.int16[O+8]=S,this.int16[O+9]=I,this.int16[O+10]=P,this.int16[O+11]=R,e}}nc.prototype.bytesPerElement=24,Bt(nc,"StructArrayLayout4i4ui4i24");class yd extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,s,c,h,p)}emplace(e,i,s,c,h,p,y){const b=10*e,w=5*e;return this.int16[b+0]=i,this.int16[b+1]=s,this.int16[b+2]=c,this.float32[w+2]=h,this.float32[w+3]=p,this.float32[w+4]=y,e}}yd.prototype.bytesPerElement=20,Bt(yd,"StructArrayLayout3i3f20");class xd extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}xd.prototype.bytesPerElement=4,Bt(xd,"StructArrayLayout1ul4");class Fs extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const c=2*e;return this.uint16[c+0]=i,this.uint16[c+1]=s,e}}Fs.prototype.bytesPerElement=4,Bt(Fs,"StructArrayLayout2ui4");class vd extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,c,h,p,y,b,w,S,I,P,R){const O=this.length;return this.resize(O+1),this.emplace(O,e,i,s,c,h,p,y,b,w,S,I,P,R)}emplace(e,i,s,c,h,p,y,b,w,S,I,P,R,O){const F=20*e,U=10*e;return this.int16[F+0]=i,this.int16[F+1]=s,this.int16[F+2]=c,this.int16[F+3]=h,this.int16[F+4]=p,this.float32[U+3]=y,this.float32[U+4]=b,this.float32[U+5]=w,this.float32[U+6]=S,this.int16[F+14]=I,this.uint32[U+8]=P,this.uint16[F+18]=R,this.uint16[F+19]=O,e}}vd.prototype.bytesPerElement=40,Bt(vd,"StructArrayLayout5i4f1i1ul2ui40");class rc extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,c,h,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,s,c,h,p,y)}emplace(e,i,s,c,h,p,y,b){const w=8*e;return this.int16[w+0]=i,this.int16[w+1]=s,this.int16[w+2]=c,this.int16[w+4]=h,this.int16[w+5]=p,this.int16[w+6]=y,this.int16[w+7]=b,e}}rc.prototype.bytesPerElement=16,Bt(rc,"StructArrayLayout3i2i2i16");class xu extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,c,h)}emplace(e,i,s,c,h,p){const y=4*e,b=8*e;return this.float32[y+0]=i,this.float32[y+1]=s,this.float32[y+2]=c,this.int16[b+6]=h,this.int16[b+7]=p,e}}xu.prototype.bytesPerElement=16,Bt(xu,"StructArrayLayout2f1f2i16");class bd extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,s,c)}emplace(e,i,s,c,h){const p=12*e,y=3*e;return this.uint8[p+0]=i,this.uint8[p+1]=s,this.float32[y+1]=c,this.float32[y+2]=h,e}}bd.prototype.bytesPerElement=12,Bt(bd,"StructArrayLayout2ub2f12");class hr extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,s)}emplace(e,i,s,c){const h=3*e;return this.uint16[h+0]=i,this.uint16[h+1]=s,this.uint16[h+2]=c,e}}hr.prototype.bytesPerElement=6,Bt(hr,"StructArrayLayout3ui6");class Ya extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,h,p,y,b,w,S,I,P,R,O,F,U,$,J,te,ee,ce){const ae=this.length;return this.resize(ae+1),this.emplace(ae,e,i,s,c,h,p,y,b,w,S,I,P,R,O,F,U,$,J,te,ee,ce)}emplace(e,i,s,c,h,p,y,b,w,S,I,P,R,O,F,U,$,J,te,ee,ce,ae){const fe=30*e,ve=15*e,Se=60*e;return this.int16[fe+0]=i,this.int16[fe+1]=s,this.int16[fe+2]=c,this.float32[ve+2]=h,this.float32[ve+3]=p,this.uint16[fe+8]=y,this.uint16[fe+9]=b,this.uint32[ve+5]=w,this.uint32[ve+6]=S,this.uint32[ve+7]=I,this.uint16[fe+16]=P,this.uint16[fe+17]=R,this.uint16[fe+18]=O,this.float32[ve+10]=F,this.float32[ve+11]=U,this.uint8[Se+48]=$,this.uint8[Se+49]=J,this.uint8[Se+50]=te,this.uint32[ve+13]=ee,this.int16[fe+28]=ce,this.uint8[Se+58]=ae,e}}Ya.prototype.bytesPerElement=60,Bt(Ya,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class vu extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,h,p,y,b,w,S,I,P,R,O,F,U,$,J,te,ee,ce,ae,fe,ve,Se,De,Ee,Ue,Ye,Fe,Ze,ze){const He=this.length;return this.resize(He+1),this.emplace(He,e,i,s,c,h,p,y,b,w,S,I,P,R,O,F,U,$,J,te,ee,ce,ae,fe,ve,Se,De,Ee,Ue,Ye,Fe,Ze,ze)}emplace(e,i,s,c,h,p,y,b,w,S,I,P,R,O,F,U,$,J,te,ee,ce,ae,fe,ve,Se,De,Ee,Ue,Ye,Fe,Ze,ze,He){const vt=20*e,Ke=40*e,jt=80*e;return this.float32[vt+0]=i,this.float32[vt+1]=s,this.int16[Ke+4]=c,this.int16[Ke+5]=h,this.int16[Ke+6]=p,this.int16[Ke+7]=y,this.int16[Ke+8]=b,this.int16[Ke+9]=w,this.int16[Ke+10]=S,this.int16[Ke+11]=I,this.int16[Ke+12]=P,this.uint16[Ke+13]=R,this.uint16[Ke+14]=O,this.uint16[Ke+15]=F,this.uint16[Ke+16]=U,this.uint16[Ke+17]=$,this.uint16[Ke+18]=J,this.uint16[Ke+19]=te,this.uint16[Ke+20]=ee,this.uint16[Ke+21]=ce,this.uint16[Ke+22]=ae,this.uint16[Ke+23]=fe,this.uint16[Ke+24]=ve,this.uint16[Ke+25]=Se,this.uint16[Ke+26]=De,this.uint16[Ke+27]=Ee,this.uint32[vt+14]=Ue,this.float32[vt+15]=Ye,this.float32[vt+16]=Fe,this.float32[vt+17]=Ze,this.float32[vt+18]=ze,this.uint8[jt+76]=He,e}}vu.prototype.bytesPerElement=80,Bt(vu,"StructArrayLayout2f9i15ui1ul4f1ub80");class sc extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}sc.prototype.bytesPerElement=4,Bt(sc,"StructArrayLayout1f4");class Po extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,c,h)}emplace(e,i,s,c,h,p){const y=5*e;return this.float32[y+0]=i,this.float32[y+1]=s,this.float32[y+2]=c,this.float32[y+3]=h,this.float32[y+4]=p,e}}Po.prototype.bytesPerElement=20,Bt(Po,"StructArrayLayout5f20");class wd extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,h,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,s,c,h,p,y)}emplace(e,i,s,c,h,p,y,b){const w=7*e;return this.float32[w+0]=i,this.float32[w+1]=s,this.float32[w+2]=c,this.float32[w+3]=h,this.float32[w+4]=p,this.float32[w+5]=y,this.float32[w+6]=b,e}}wd.prototype.bytesPerElement=28,Bt(wd,"StructArrayLayout7f28");class oc extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,s,c)}emplace(e,i,s,c,h){const p=6*e;return this.uint32[3*e+0]=i,this.uint16[p+2]=s,this.uint16[p+3]=c,this.uint16[p+4]=h,e}}oc.prototype.bytesPerElement=12,Bt(oc,"StructArrayLayout1ul3ui12");class Td extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Td.prototype.bytesPerElement=2,Bt(Td,"StructArrayLayout1ui2");class ra extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,s)}emplace(e,i,s,c){const h=3*e;return this.float32[h+0]=i,this.float32[h+1]=s,this.float32[h+2]=c,e}}ra.prototype.bytesPerElement=12,Bt(ra,"StructArrayLayout3f12");class ac extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const c=2*e;return this.float32[c+0]=i,this.float32[c+1]=s,e}}ac.prototype.bytesPerElement=8,Bt(ac,"StructArrayLayout2f8");class Md extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,h,p,y,b,w,S,I,P,R,O,F,U){const $=this.length;return this.resize($+1),this.emplace($,e,i,s,c,h,p,y,b,w,S,I,P,R,O,F,U)}emplace(e,i,s,c,h,p,y,b,w,S,I,P,R,O,F,U,$){const J=16*e;return this.float32[J+0]=i,this.float32[J+1]=s,this.float32[J+2]=c,this.float32[J+3]=h,this.float32[J+4]=p,this.float32[J+5]=y,this.float32[J+6]=b,this.float32[J+7]=w,this.float32[J+8]=S,this.float32[J+9]=I,this.float32[J+10]=P,this.float32[J+11]=R,this.float32[J+12]=O,this.float32[J+13]=F,this.float32[J+14]=U,this.float32[J+15]=$,e}}Md.prototype.bytesPerElement=64,Bt(Md,"StructArrayLayout16f64");class lc extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,c,h,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,s,c,h,p,y)}emplace(e,i,s,c,h,p,y,b){const w=10*e,S=5*e;return this.uint16[w+0]=i,this.uint16[w+1]=s,this.uint16[w+2]=c,this.uint16[w+3]=h,this.float32[S+2]=p,this.float32[S+3]=y,this.float32[S+4]=b,e}}lc.prototype.bytesPerElement=20,Bt(lc,"StructArrayLayout4ui3f20");class Sd extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}Sd.prototype.bytesPerElement=1,Bt(Sd,"StructArrayLayout1ub1");class Ep extends gu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ep.prototype.size=40;class Ap extends vd{get(e){return new Ep(this,e)}}Bt(Ap,"CollisionBoxArray");class Ip extends gu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Ip.prototype.size=60;class Cp extends Ya{get(e){return new Ip(this,e)}}Bt(Cp,"PlacedSymbolArray");class Pp extends gu{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Pp.prototype.size=80;class Dp extends vu{get(e){return new Pp(this,e)}}Bt(Dp,"SymbolInstanceArray");class Lp extends sc{getoffsetX(e){return this.float32[1*e+0]}}Bt(Lp,"GlyphOffsetArray");class cc extends Es{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Bt(cc,"SymbolLineVertexArray");class kp extends gu{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}kp.prototype.size=12;class Rp extends oc{get(e){return new kp(this,e)}}Bt(Rp,"FeatureIndexArray");class uc extends Fs{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Bt(uc,"FillExtrusionCentroidArray");const mg=rn([{name:"a_pos",components:2,type:"Int16"}],4),zp=rn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class $n{constructor(e=[]){this.segments=e}_prepareSegment(e,i,s,c){let h=this.segments[this.segments.length-1];return e>$n.MAX_VERTEX_ARRAY_LENGTH&&we(`Max vertices per segment is ${$n.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!h||h.vertexLength+e>$n.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==c)&&(h={vertexOffset:i,primitiveOffset:s,vertexLength:0,primitiveLength:0},c!==void 0&&(h.sortKey=c),this.segments.push(h)),h}prepareSegment(e,i,s,c){return this._prepareSegment(e,i.length,s.length,c)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,s,c){return new $n([{vertexOffset:e,primitiveOffset:i,vertexLength:s,primitiveLength:c,vaos:{},sortKey:0}])}}function Ed(t,e){return 256*(t=wt(Math.floor(t),0,255))+wt(Math.floor(e),0,255)}$n.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Bt($n,"SegmentVector");const Op=rn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Fp=rn([{name:"a_dash",components:4,type:"Uint16"}]);var hc={exports:{}},bu={exports:{}};(function(t){t.exports=function(e,i){var s,c,h,p,y,b,w,S;for(c=e.length-(s=3&e.length),h=i,y=3432918353,b=461845907,S=0;S<c;)w=255&e.charCodeAt(S)|(255&e.charCodeAt(++S))<<8|(255&e.charCodeAt(++S))<<16|(255&e.charCodeAt(++S))<<24,++S,h=27492+(65535&(p=5*(65535&(h=(h^=w=(65535&(w=(w=(65535&w)*y+(((w>>>16)*y&65535)<<16)&4294967295)<<15|w>>>17))*b+(((w>>>16)*b&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(w=0,s){case 3:w^=(255&e.charCodeAt(S+2))<<16;case 2:w^=(255&e.charCodeAt(S+1))<<8;case 1:h^=w=(65535&(w=(w=(65535&(w^=255&e.charCodeAt(S)))*y+(((w>>>16)*y&65535)<<16)&4294967295)<<15|w>>>17))*b+(((w>>>16)*b&65535)<<16)&4294967295}return h^=e.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0}})(bu);var Ad=bu.exports,Bp={exports:{}};(function(t){t.exports=function(e,i){for(var s,c=e.length,h=i^c,p=0;c>=4;)s=1540483477*(65535&(s=255&e.charCodeAt(p)|(255&e.charCodeAt(++p))<<8|(255&e.charCodeAt(++p))<<16|(255&e.charCodeAt(++p))<<24))+((1540483477*(s>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),c-=4,++p;switch(c){case 3:h^=(255&e.charCodeAt(p+2))<<16;case 2:h^=(255&e.charCodeAt(p+1))<<8;case 1:h=1540483477*(65535&(h^=255&e.charCodeAt(p)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0}})(Bp);var Np=Ad,Vp=Bp.exports;hc.exports=Np,hc.exports.murmur3=Np,hc.exports.murmur2=Vp;var Id=tt(hc.exports);class dc{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,s,c){this.ids.push(Up(e)),this.positions.push(i,s,c)}eachPosition(e,i){const s=Up(e);let c=0,h=this.ids.length-1;for(;c<h;){const p=c+h>>1;this.ids[p]>=s?h=p:c=p+1}for(;this.ids[c]===s;)i(this.positions[3*c],this.positions[3*c+1],this.positions[3*c+2]),c++}static serialize(e,i){const s=new Float64Array(e.ids),c=new Uint32Array(e.positions);return Cd(s,c,0,s.length-1),i&&(i.add(s.buffer),i.add(c.buffer)),{ids:s,positions:c}}static deserialize(e){const i=new dc;let s;i.ids=e.ids,i.positions=e.positions;for(const c of i.ids)c!==s&&i.uniqueIds.push(c),s=c;return i.indexed=!0,i}}function Up(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Id(String(t))}function Cd(t,e,i,s){for(;i<s;){const c=t[i+s>>1];let h=i-1,p=s+1;for(;;){do h++;while(t[h]<c);do p--;while(t[p]>c);if(h>=p)break;wu(t,h,p),wu(e,3*h,3*p),wu(e,3*h+1,3*p+1),wu(e,3*h+2,3*p+2)}p-i<s-p?(Cd(t,e,i,p),i=p+1):(Cd(t,e,p+1,s),s=p)}}function wu(t,e,i){const s=t[e];t[e]=t[i],t[i]=s}Bt(dc,"FeaturePositionMap");class Ys{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}}class Tu extends Ys{constructor(e){super(e),this.current=0}set(e,i,s){this.fetchUniformLocation(e,i)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}}class Lr extends Ys{constructor(e){super(e),this.current=0}set(e,i,s){this.fetchUniformLocation(e,i)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Do extends Ys{constructor(e){super(e),this.current=[0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}}class jp extends Ys{constructor(e){super(e),this.current=[0,0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}}class d extends Ys{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class n extends Ys{constructor(e){super(e),this.current=Kn.transparent}set(e,i,s){this.fetchUniformLocation(e,i)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const a=new Float32Array(16);class f extends Ys{constructor(e){super(e),this.current=a}set(e,i,s){if(this.fetchUniformLocation(e,i)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let c=1;c<16;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}}const g=new Float32Array(9),x=new Float32Array(4);class T extends Ys{constructor(e){super(e),this.current=x}set(e,i,s){if(this.fetchUniformLocation(e,i)){for(let c=0;c<4;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}}}function E(t){return[Ed(255*t.r,255*t.g),Ed(255*t.b,255*t.a)]}class C{constructor(e,i,s){this.value=e,this.uniformNames=i.map(c=>`u_${c}`),this.type=s}setUniform(e,i,s,c,h){i.set(e,h,c.constantOr(this.value))}getBinding(e,i){return this.type==="color"?new n(e):new Lr(e)}}class D{constructor(e,i){this.uniformNames=i.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,s,c,h){const p=h==="u_pattern"||h==="u_dash"?this.pattern:h==="u_pixel_ratio"?this.pixelRatio:null;p&&i.set(e,h,p)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new d(e):new Lr(e)}}class L{constructor(e,i,s,c){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=i.map(h=>({name:`a_${h}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,i,s,c,h,p,y){const b=this.paintVertexArray.length,w=this.expression.evaluate(new On(0,{brightness:p}),i,{},h,c,y);this.paintVertexArray.resize(e),this._setPaintValue(b,e,w)}updatePaintArray(e,i,s,c,h,p,y){const b=this.expression.evaluate({zoom:0,brightness:y},s,c,void 0,h);this._setPaintValue(e,i,b)}_setPaintValue(e,i,s){if(this.type==="color"){const c=E(s);for(let h=e;h<i;h++)this.paintVertexArray.emplace(h,c[0],c[1])}else{for(let c=e;c<i;c++)this.paintVertexArray.emplace(c,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class z{constructor(e,i,s,c,h,p){this.expression=e,this.uniformNames=i.map(y=>`u_${y}_t`),this.type=s,this.useIntegerZoom=c,this.zoom=h,this.maxValue=0,this.paintVertexAttributes=i.map(y=>({name:`a_${y}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,i,s,c,h,p,y){const b=this.expression.evaluate(new On(this.zoom,{brightness:p}),i,{},h,c,y),w=this.expression.evaluate(new On(this.zoom+1,{brightness:p}),i,{},h,c,y),S=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(S,e,b,w)}updatePaintArray(e,i,s,c,h,p,y){const b=this.expression.evaluate({zoom:this.zoom,brightness:y},s,c,void 0,h),w=this.expression.evaluate({zoom:this.zoom+1,brightness:y},s,c,void 0,h);this._setPaintValue(e,i,b,w)}_setPaintValue(e,i,s,c){if(this.type==="color"){const h=E(s),p=E(c);for(let y=e;y<i;y++)this.paintVertexArray.emplace(y,h[0],h[1],p[0],p[1])}else{for(let h=e;h<i;h++)this.paintVertexArray.emplace(h,s,c);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,s,c,h){const p=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,y=wt(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);i.set(e,h,y)}getBinding(e,i){return new Lr(e)}}class B{constructor(e,i,s,c,h){this.expression=e,this.layerId=h,this.paintVertexAttributes=(s==="array"?Fp:Op).members;for(let p=0;p<i.length;++p);this.paintVertexArray=new c}populatePaintArray(e,i,s){const c=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(c,e,i.patterns&&i.patterns[this.layerId],s)}updatePaintArray(e,i,s,c,h,p,y){this._setPaintValues(e,i,s.patterns&&s.patterns[this.layerId],p)}_setPaintValues(e,i,s,c){if(!c||!s)return;const h=c[s];if(!h)return;const{tl:p,br:y,pixelRatio:b}=h;for(let w=e;w<i;w++)this.paintVertexArray.emplace(w,p[0],p[1],y[0],y[1],b)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class V{constructor(e,i,s=()=>!0){this.binders={},this._buffers=[];const c=[];for(const h in e.paint._values){const p=e.paint.get(h);if(!s(h)||!(p instanceof qa&&cu(p.property.specification)))continue;const y=q(h,e.type),b=p.value,w=p.property.specification.type,S=!!p.property.useIntegerZoom,I=h==="line-dasharray"||h.endsWith("pattern"),P=h==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(b.kind!=="constant"||P)if(b.kind==="source"||P||I){const R=re(h,w,"source");this.binders[h]=I?new B(b,y,w,R,e.id):new L(b,y,w,R),c.push(`/a_${h}`)}else{const R=re(h,w,"composite");this.binders[h]=new z(b,y,w,S,i,R),c.push(`/z_${h}`)}else this.binders[h]=I?new D(b.value,y):new C(b.value,y,w),c.push(`/u_${h}`)}this.cacheKey=c.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof L||i instanceof z?i.maxValue:0}populatePaintArrays(e,i,s,c,h,p,y){for(const b in this.binders){const w=this.binders[b];(w instanceof L||w instanceof z||w instanceof B)&&w.populatePaintArray(e,i,s,c,h,p,y)}}setConstantPatternPositions(e){for(const i in this.binders){const s=this.binders[i];s instanceof D&&s.setConstantPatternPositions(e)}}updatePaintArrays(e,i,s,c,h,p,y,b){let w=!1;const S=Object.keys(e),I=S.length!==0,P=I?S:i.uniqueIds;for(const R in this.binders){const O=this.binders[R];if((O instanceof L||O instanceof z||O instanceof B)&&(O.expression.isStateDependent===!0||O.expression.isLightConstant===!1)){const F=h.paint.get(R);O.expression=F.value;for(const U of P){const $=e[U.toString()];i.eachPosition(U,(J,te,ee)=>{const ce=c.feature(J);O.updatePaintArray(te,ee,ce,$,p,y,b)})}if(!I)for(const U of s.uniqueIds){const $=e[U.toString()];s.eachPosition(U,(J,te,ee)=>{const ce=c.feature(J);O.updatePaintArray(te,ee,ce,$,p,y,b)})}w=!0}}return w}defines(){const e=[];for(const i in this.binders){const s=this.binders[i];(s instanceof C||s instanceof D)&&e.push(...s.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof L||s instanceof z||s instanceof B)for(let c=0;c<s.paintVertexAttributes.length;c++)e.push(s.paintVertexAttributes[c].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof C||s instanceof D||s instanceof z)for(const c of s.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof C||c instanceof D||c instanceof z)for(const h of c.uniformNames)i.push({name:h,property:s,binding:c.getBinding(e,h)})}return i}setUniforms(e,i,s,c,h){for(const{name:p,property:y,binding:b}of s)this.binders[y].setUniform(e,b,h,c.get(y),p)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof L||i instanceof z||i instanceof B)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const s=this.binders[i];(s instanceof L||s instanceof z||s instanceof B)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof L||i instanceof z||i instanceof B)&&i.destroy()}}}class H{constructor(e,i,s=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new V(c,i,s);this.needsUpload=!1,this._featureMap=new dc,this._featureMapWithoutIds=new dc,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,s,c,h,p,y,b){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(e,i,c,h,p,y,b);i.id!==void 0?this._featureMap.add(i.id,s,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,s,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,s,c,h,p){for(const y of s)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,y,c,h,p||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const W={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function q(t,e){return W[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const j={"line-pattern":{source:Co,composite:Co},"fill-pattern":{source:Co,composite:Co},"fill-extrusion-pattern":{source:Co,composite:Co},"line-dasharray":{source:Xa,composite:Xa}},Y={color:{source:ac,composite:Io},number:{source:sc,composite:ac}};function re(t,e,i){const s=j[t];return s&&s[i]||Y[e][i]}Bt(C,"ConstantBinder"),Bt(D,"PatternConstantBinder"),Bt(L,"SourceExpressionBinder"),Bt(B,"PatternCompositeBinder"),Bt(z,"CompositeExpressionBinder"),Bt(V,"ProgramConfiguration",{omit:["_buffers"]}),Bt(H,"ProgramConfigurationSet");const Q=Pt/Math.PI/2,se=5,X=6,oe=16383,ue=64,de=[ue,32,16],_e=-Q,Pe=Q;function be(t,e,i,s=Q){return i=Qe(i),[t*Math.sin(i)*s,-e*s,t*Math.cos(i)*s]}function Ne(t,e,i){return be(Math.cos(Qe(t)),Math.sin(Qe(t)),e,i)}const Oe=63710088e-1,et=2*Math.PI*Oe;class Me{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Me(bn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,s=this.lat*i,c=e.lat*i,h=Math.sin(s)*Math.sin(c)+Math.cos(s)*Math.cos(c)*Math.cos((e.lng-this.lng)*i);return Oe*Math.acos(Math.min(h,1))}toBounds(e=0){const i=360*e/40075017,s=i/Math.cos(Math.PI/180*this.lat);return new ke({lng:this.lng-s,lat:this.lat-i},{lng:this.lng+s,lat:this.lat+i})}toEcef(e){return Ne(this.lat,this.lng,Q+e*Q/Oe)}static convert(e){if(e instanceof Me)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Me(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Me(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ke{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Me?new Me(e.lng,e.lat):Me.convert(e),this}setSouthWest(e){return this._sw=e instanceof Me?new Me(e.lng,e.lat):Me.convert(e),this}extend(e){const i=this._sw,s=this._ne;let c,h;if(e instanceof Me)c=e,h=e;else{if(!(e instanceof ke))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ke.convert(e)):this.extend(Me.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Me.convert(e)):this;if(c=e._sw,h=e._ne,!c||!h)return this}return i||s?(i.lng=Math.min(c.lng,i.lng),i.lat=Math.min(c.lat,i.lat),s.lng=Math.max(h.lng,s.lng),s.lat=Math.max(h.lat,s.lat)):(this._sw=new Me(c.lng,c.lat),this._ne=new Me(h.lng,h.lat)),this}getCenter(){return new Me((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Me(this.getWest(),this.getNorth())}getSouthEast(){return new Me(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:s}=Me.convert(e);let c=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&c}static convert(e){return!e||e instanceof ke?e:new ke(e)}}var me={};(function(t,e){(function(i){function s(h,p,y){var b=c(256*h,256*(p=Math.pow(2,y)-p-1),y),w=c(256*(h+1),256*(p+1),y);return b[0]+","+b[1]+","+w[0]+","+w[1]}function c(h,p,y){var b=2*Math.PI*6378137/256/Math.pow(2,y);return[h*b-2*Math.PI*6378137/2,p*b-2*Math.PI*6378137/2]}i.getURL=function(h,p,y,b,w,S){return S=S||{},h+"?"+["bbox="+s(y,b,w),"format="+(S.format||"image/png"),"service="+(S.service||"WMS"),"version="+(S.version||"1.1.1"),"request="+(S.request||"GetMap"),"srs="+(S.srs||"EPSG:3857"),"width="+(S.width||256),"height="+(S.height||256),"layers="+p].join("&")},i.getTileBBox=s,i.getMercCoords=c,Object.defineProperty(i,"__esModule",{value:!0})})(e)})(0,me);var Ae=me;class it{constructor(e,i,s){this.z=e,this.x=i,this.y=s,this.key=Et(0,e,e,i,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const s=Ae.getTileBBox(this.x,this.y,this.z),c=function(h,p,y){let b,w="";for(let S=h;S>0;S--)b=1<<S-1,w+=(p&b?1:0)+(y&b?2:0);return w}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class pt{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Et(e,i.z,i.z,i.x,i.y)}}class ht{constructor(e,i,s,c,h){this.overscaledZ=e,this.wrap=i,this.canonical=new it(s,+c,+h),this.key=i===0&&e===s?this.canonical.key:Et(i,e,s,c,h)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new ht(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ht(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Et(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return Et(this.wrap*+i,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new ht(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,s=2*this.canonical.x,c=2*this.canonical.y;return[new ht(i,this.wrap,i,s,c),new ht(i,this.wrap,i,s+1,c),new ht(i,this.wrap,i,s,c+1),new ht(i,this.wrap,i,s+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ht(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ht(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new pt(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Et(t,e,i,s,c){const h=1<<Math.min(i,22);let p=h*(c%h)+s%h;return t&&i<22&&(p+=h*h*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*p+i)+(e-i)}const Wt=[t=>{let e=t.canonical.x-1,i=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,i--),new ht(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,i=t.wrap;return e===1<<t.canonical.z&&(e=0,i++),new ht(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>new ht(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new ht(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];Bt(it,"CanonicalTileID"),Bt(ht,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Jt=0,qt=25.5;function Yt(t){return et*Math.cos(t*Math.PI/180)}function vi(t){return(180+t)/360}function ui(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function mi(t,e){return t/Yt(e)}function pi(t){return 360*t-180}function Fi(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function gn(t,e){return t*Yt(Fi(e))}const Ci=85.051129;function Bn(t){return Math.cos(Qe(wt(t,-Ci,Ci)))}function Pi(t,e){const i=wt(e,Jt,qt),s=Math.pow(2,i);return Bn(t)*et/(512*s)}function ji(t){return 1/Math.cos(t*Math.PI/180)}function Di(t,e=0){const i=Math.exp(Math.PI*(1-(t.y+e/Pt)/(1<<t.z)*2));return 80150034*i/(i*i+1)/Pt/(1<<t.z)}class Ui{constructor(e,i,s=0){this.x=+e,this.y=+i,this.z=+s}static fromLngLat(e,i=0){const s=Me.convert(e);return new Ui(vi(s.lng),ui(s.lat),mi(i,s.lat))}toLngLat(){return new Me(pi(this.x),Fi(this.y))}toAltitude(){return gn(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/et*ji(Fi(this.y))}}function Tn(t,e,i,s,c,h,p,y,b){const w=(e+s)/2,S=(i+c)/2,I=new le(w,S);y(I),function(P,R,O,F,U,$){const J=O-U,te=F-$;return Math.abs((F-R)*J-(O-P)*te)/Math.hypot(J,te)}(I.x,I.y,h.x,h.y,p.x,p.y)>=b?(Tn(t,e,i,w,S,h,I,y,b),Tn(t,w,S,s,c,I,p,y,b)):t.push(p)}function qi(t,e,i){let s=t[0],c=s.x,h=s.y;e(s);const p=[s];for(let y=1;y<t.length;y++){const b=t[y],{x:w,y:S}=b;e(b),Tn(p,c,h,w,S,s,b,e,i),c=w,h=S,s=b}return p}function dr(t,e,i,s){if(s(e,i)){const c=e.add(i)._mult(.5);dr(t,e,c,s),dr(t,c,i,s)}else t.push(i)}function Ar(t,e){let i=t[0];const s=[i];for(let c=1;c<t.length;c++){const h=t[c];dr(s,i,h,e),i=h}return s}const Hr=Math.pow(2,14)-1,Bs=-Hr-1;function qr(t,e){const i=Math.round(t.x*e),s=Math.round(t.y*e);return t.x=wt(i,Bs,Hr),t.y=wt(s,Bs,Hr),(i<t.x||i>t.x+1||s<t.y||s>t.y+1)&&we("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function fr(t,e,i){const s=t.loadGeometry(),c=t.extent,h=Pt/c;if(e&&i&&i.projection.isReprojectedInTileSpace){const p=1<<e.z,{scale:y,x:b,y:w,projection:S}=i,I=P=>{const R=pi((e.x+P.x/c)/p),O=Fi((e.y+P.y/c)/p),F=S.project(R,O);P.x=(F.x*y-b)*c,P.y=(F.y*y-w)*c};for(let P=0;P<s.length;P++)if(t.type!==1)s[P]=qi(s[P],I,1);else{const R=[];for(const O of s[P])O.x<0||O.x>=c||O.y<0||O.y>=c||(I(O),R.push(O));s[P]=R}}for(const p of s)for(const y of p)qr(y,h);return s}function sr(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?fr(t):[]}}function kr(t,e,i,s,c){t.emplaceBack(2*e+(s+1)/2,2*i+(c+1)/2)}function Nr(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Zr{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Es,this.indexArray=new hr,this.segments=new $n,this.programConfigurations=new H(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,s,c){const h=this.layers[0],p=[];let y=null;h.type==="circle"&&(y=h.layout.get("circle-sort-key"));for(const{feature:w,id:S,index:I,sourceLayerIndex:P}of e){const R=this.layers[0]._featureFilter.needGeometry,O=sr(w,R);if(!this.layers[0]._featureFilter.filter(new On(this.zoom),O,s))continue;const F=y?y.evaluate(O,{},s):void 0,U={id:S,properties:w.properties,type:w.type,sourceLayerIndex:P,index:I,geometry:R?O.geometry:fr(w,s,c),patterns:{},sortKey:F};p.push(U)}y&&p.sort((w,S)=>w.sortKey-S.sortKey);let b=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new yu,b=c.projection);for(const w of p){const{geometry:S,index:I,sourceLayerIndex:P}=w,R=e[I].feature;this.addFeature(w,S,I,i.availableImages,s,b,i.brightness),i.featureIndex.insert(R,S,I,P,this.index)}}update(e,i,s,c,h){const p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,p?this.stateDependentLayers:this.layers,s,c,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mg.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,zp.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,s,c,h,p,y){for(const b of i)for(const w of b){const S=w.x,I=w.y;if(S<0||S>=Pt||I<0||I>=Pt)continue;if(p){const O=p.projectTilePoint(S,I,h),F=p.upVector(h,S,I),U=this.globeExtVertexArray;Nr(U,O,F),Nr(U,O,F),Nr(U,O,F),Nr(U,O,F)}const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),R=P.vertexLength;kr(this.layoutVertexArray,S,I,-1,-1),kr(this.layoutVertexArray,S,I,1,-1),kr(this.layoutVertexArray,S,I,1,1),kr(this.layoutVertexArray,S,I,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+2,R+3),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},c,h,y)}}function Ns(t,e){for(let i=0;i<t.length;i++)if(Ks(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Ks(t,e[i]))return!0;return!!pc(t,e)}function Lo(t,e,i){return!!Ks(t,e)||!!mc(e,t,i)}function sa(t,e){if(t.length===1)return Mu(e,t[0]);for(let i=0;i<e.length;i++){const s=e[i];for(let c=0;c<s.length;c++)if(Ks(t,s[c]))return!0}for(let i=0;i<t.length;i++)if(Mu(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(pc(t,e[i]))return!0;return!1}function fc(t,e,i){if(t.length>1){if(pc(t,e))return!0;for(let s=0;s<e.length;s++)if(mc(e[s],t,i))return!0}for(let s=0;s<t.length;s++)if(mc(t[s],e,i))return!0;return!1}function pc(t,e){if(t.length===0||e.length===0)return!1;for(let i=0;i<t.length-1;i++){const s=t[i],c=t[i+1];for(let h=0;h<e.length-1;h++)if(Pd(s,c,e[h],e[h+1]))return!0}return!1}function Pd(t,e,i,s){return Ge(t,i,s)!==Ge(e,i,s)&&Ge(t,e,i)!==Ge(t,e,s)}function mc(t,e,i){const s=i*i;if(e.length===1)return t.distSqr(e[0])<s;for(let c=1;c<e.length;c++)if(Ka(t,e[c-1],e[c])<s)return!0;return!1}function Ka(t,e,i){const s=e.distSqr(i);if(s===0)return t.distSqr(e);const c=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/s;return t.distSqr(c<0?e:c>1?i:i.sub(e)._mult(c)._add(e))}function Mu(t,e){let i,s,c,h=!1;for(let p=0;p<t.length;p++){i=t[p];for(let y=0,b=i.length-1;y<i.length;b=y++)s=i[y],c=i[b],s.y>e.y!=c.y>e.y&&e.x<(c.x-s.x)*(e.y-s.y)/(c.y-s.y)+s.x&&(h=!h)}return h}function Ks(t,e){let i=!1;for(let s=0,c=t.length-1;s<t.length;c=s++){const h=t[s],p=t[c];h.y>e.y!=p.y>e.y&&e.x<(p.x-h.x)*(e.y-h.y)/(p.y-h.y)+h.x&&(i=!i)}return i}function _x(t,e,i,s,c){for(const p of t)if(e<=p.x&&i<=p.y&&s>=p.x&&c>=p.y)return!0;const h=[new le(e,i),new le(e,c),new le(s,c),new le(s,i)];if(t.length>2){for(const p of h)if(Ks(t,p))return!0}for(let p=0;p<t.length-1;p++)if(EE(t[p],t[p+1],h))return!0;return!1}function EE(t,e,i){const s=i[0],c=i[2];if(t.x<s.x&&e.x<s.x||t.x>c.x&&e.x>c.x||t.y<s.y&&e.y<s.y||t.y>c.y&&e.y>c.y)return!1;const h=Ge(t,e,i[0]);return h!==Ge(t,e,i[1])||h!==Ge(t,e,i[2])||h!==Ge(t,e,i[3])}function Su(t,e,i,s,c,h){let p=e.y-t.y,y=t.x-e.x;if(h=h||0){const b=p*p+y*y;if(b===0)return!0;const w=Math.sqrt(b);p/=w,y/=w}return!((i.x-t.x)*p+(i.y-t.y)*y-h<0||(s.x-t.x)*p+(s.y-t.y)*y-h<0||(c.x-t.x)*p+(c.y-t.y)*y-h<0)}function _g(t,e,i,s,c,h,p){return!(Su(t,e,s,c,h,p)||Su(e,i,s,c,h,p)||Su(i,t,s,c,h,p)||Su(s,c,t,e,i,p)||Su(c,h,t,e,i,p)||Su(h,s,t,e,i,p))}function Eu(t,e,i){const s=e.paint.get(t).value;return s.kind==="constant"?s.value:i.programConfigurations.get(e.id).getMaxValue(t)}function Gp(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function gx(t,e,i,s,c){if(!e[0]&&!e[1])return t;const h=le.convert(e)._mult(c);i==="viewport"&&h._rotate(-s);const p=[];for(let y=0;y<t.length;y++)p.push(t[y].sub(h));return p}function yx(t,e,i,s){const c=le.convert(t)._mult(s);return e==="viewport"&&c._rotate(-i),c}Bt(Zr,"CircleBucket",{omit:["layers"]});const AE=new Fn({"circle-sort-key":new ti(Ie.layout_circle["circle-sort-key"]),visibility:new gt(Ie.layout_circle.visibility)});var IE={paint:new Fn({"circle-radius":new ti(Ie.paint_circle["circle-radius"]),"circle-color":new ti(Ie.paint_circle["circle-color"]),"circle-blur":new ti(Ie.paint_circle["circle-blur"]),"circle-opacity":new ti(Ie.paint_circle["circle-opacity"]),"circle-translate":new gt(Ie.paint_circle["circle-translate"]),"circle-translate-anchor":new gt(Ie.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new gt(Ie.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new gt(Ie.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ti(Ie.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ti(Ie.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ti(Ie.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new gt(Ie.paint_circle["circle-emissive-strength"])}),layout:AE},gr={},yr={};Object.defineProperty(yr,"__esModule",{value:!0}),yr.setMatrixArrayType=function(t){yr.ARRAY_TYPE=vx=t},yr.toRadian=function(t){return t*PE},yr.equals=function(t,e){return Math.abs(t-e)<=xx*Math.max(1,Math.abs(t),Math.abs(e))},yr.RANDOM=yr.ARRAY_TYPE=yr.EPSILON=void 0;var xx=1e-6;yr.EPSILON=xx;var vx=typeof Float32Array<"u"?Float32Array:Array;yr.ARRAY_TYPE=vx;var CE=Math.random;yr.RANDOM=CE;var PE=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Nn={};function gg(t){return gg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gg(t)}Object.defineProperty(Nn,"__esModule",{value:!0}),Nn.create=function(){var t=new Ja.ARRAY_TYPE(4);return Ja.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},Nn.clone=function(t){var e=new Ja.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Nn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Nn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},Nn.fromValues=function(t,e,i,s){var c=new Ja.ARRAY_TYPE(4);return c[0]=t,c[1]=e,c[2]=i,c[3]=s,c},Nn.set=function(t,e,i,s,c){return t[0]=e,t[1]=i,t[2]=s,t[3]=c,t},Nn.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},Nn.invert=function(t,e){var i=e[0],s=e[1],c=e[2],h=e[3],p=i*h-c*s;return p?(t[0]=h*(p=1/p),t[1]=-s*p,t[2]=-c*p,t[3]=i*p,t):null},Nn.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},Nn.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},Nn.multiply=wx,Nn.rotate=function(t,e,i){var s=e[0],c=e[1],h=e[2],p=e[3],y=Math.sin(i),b=Math.cos(i);return t[0]=s*b+h*y,t[1]=c*b+p*y,t[2]=s*-y+h*b,t[3]=c*-y+p*b,t},Nn.scale=function(t,e,i){var s=e[1],c=e[2],h=e[3],p=i[0],y=i[1];return t[0]=e[0]*p,t[1]=s*p,t[2]=c*y,t[3]=h*y,t},Nn.fromRotation=function(t,e){var i=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=i,t[2]=-i,t[3]=s,t},Nn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},Nn.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Nn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},Nn.LDU=function(t,e,i,s){return t[2]=s[2]/s[0],i[0]=s[0],i[1]=s[1],i[3]=s[3]-t[2]*i[1],[t,e,i]},Nn.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},Nn.subtract=Tx,Nn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Nn.equals=function(t,e){var i=t[0],s=t[1],c=t[2],h=t[3],p=e[0],y=e[1],b=e[2],w=e[3];return Math.abs(i-p)<=Ja.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(s-y)<=Ja.EPSILON*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(c-b)<=Ja.EPSILON*Math.max(1,Math.abs(c),Math.abs(b))&&Math.abs(h-w)<=Ja.EPSILON*Math.max(1,Math.abs(h),Math.abs(w))},Nn.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},Nn.multiplyScalarAndAdd=function(t,e,i,s){return t[0]=e[0]+i[0]*s,t[1]=e[1]+i[1]*s,t[2]=e[2]+i[2]*s,t[3]=e[3]+i[3]*s,t},Nn.sub=Nn.mul=void 0;var Ja=function(t,e){if(t&&t.__esModule)return t;if(t===null||gg(t)!=="object"&&typeof t!="function")return{default:t};var i=bx(void 0);if(i&&i.has(t))return i.get(t);var s={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var p=c?Object.getOwnPropertyDescriptor(t,h):null;p&&(p.get||p.set)?Object.defineProperty(s,h,p):s[h]=t[h]}return s.default=t,i&&i.set(t,s),s}(yr);function bx(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(bx=function(s){return s?i:e})(t)}function wx(t,e,i){var s=e[0],c=e[1],h=e[2],p=e[3],y=i[0],b=i[1],w=i[2],S=i[3];return t[0]=s*y+h*b,t[1]=c*y+p*b,t[2]=s*w+h*S,t[3]=c*w+p*S,t}function Tx(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}Nn.mul=wx,Nn.sub=Tx;var Un={};function yg(t){return yg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yg(t)}Object.defineProperty(Un,"__esModule",{value:!0}),Un.create=function(){var t=new ko.ARRAY_TYPE(6);return ko.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},Un.clone=function(t){var e=new ko.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},Un.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},Un.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},Un.fromValues=function(t,e,i,s,c,h){var p=new ko.ARRAY_TYPE(6);return p[0]=t,p[1]=e,p[2]=i,p[3]=s,p[4]=c,p[5]=h,p},Un.set=function(t,e,i,s,c,h,p){return t[0]=e,t[1]=i,t[2]=s,t[3]=c,t[4]=h,t[5]=p,t},Un.invert=function(t,e){var i=e[0],s=e[1],c=e[2],h=e[3],p=e[4],y=e[5],b=i*h-s*c;return b?(t[0]=h*(b=1/b),t[1]=-s*b,t[2]=-c*b,t[3]=i*b,t[4]=(c*y-h*p)*b,t[5]=(s*p-i*y)*b,t):null},Un.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},Un.multiply=Sx,Un.rotate=function(t,e,i){var s=e[0],c=e[1],h=e[2],p=e[3],y=e[4],b=e[5],w=Math.sin(i),S=Math.cos(i);return t[0]=s*S+h*w,t[1]=c*S+p*w,t[2]=s*-w+h*S,t[3]=c*-w+p*S,t[4]=y,t[5]=b,t},Un.scale=function(t,e,i){var s=e[1],c=e[2],h=e[3],p=e[4],y=e[5],b=i[0],w=i[1];return t[0]=e[0]*b,t[1]=s*b,t[2]=c*w,t[3]=h*w,t[4]=p,t[5]=y,t},Un.translate=function(t,e,i){var s=e[0],c=e[1],h=e[2],p=e[3],y=e[4],b=e[5],w=i[0],S=i[1];return t[0]=s,t[1]=c,t[2]=h,t[3]=p,t[4]=s*w+h*S+y,t[5]=c*w+p*S+b,t},Un.fromRotation=function(t,e){var i=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=i,t[2]=-i,t[3]=s,t[4]=0,t[5]=0,t},Un.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},Un.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},Un.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},Un.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},Un.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t},Un.subtract=Ex,Un.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t},Un.multiplyScalarAndAdd=function(t,e,i,s){return t[0]=e[0]+i[0]*s,t[1]=e[1]+i[1]*s,t[2]=e[2]+i[2]*s,t[3]=e[3]+i[3]*s,t[4]=e[4]+i[4]*s,t[5]=e[5]+i[5]*s,t},Un.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},Un.equals=function(t,e){var i=t[0],s=t[1],c=t[2],h=t[3],p=t[4],y=t[5],b=e[0],w=e[1],S=e[2],I=e[3],P=e[4],R=e[5];return Math.abs(i-b)<=ko.EPSILON*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(s-w)<=ko.EPSILON*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(c-S)<=ko.EPSILON*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(h-I)<=ko.EPSILON*Math.max(1,Math.abs(h),Math.abs(I))&&Math.abs(p-P)<=ko.EPSILON*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(y-R)<=ko.EPSILON*Math.max(1,Math.abs(y),Math.abs(R))},Un.sub=Un.mul=void 0;var ko=function(t,e){if(t&&t.__esModule)return t;if(t===null||yg(t)!=="object"&&typeof t!="function")return{default:t};var i=Mx(void 0);if(i&&i.has(t))return i.get(t);var s={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var p=c?Object.getOwnPropertyDescriptor(t,h):null;p&&(p.get||p.set)?Object.defineProperty(s,h,p):s[h]=t[h]}return s.default=t,i&&i.set(t,s),s}(yr);function Mx(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Mx=function(s){return s?i:e})(t)}function Sx(t,e,i){var s=e[0],c=e[1],h=e[2],p=e[3],y=e[4],b=e[5],w=i[0],S=i[1],I=i[2],P=i[3],R=i[4],O=i[5];return t[0]=s*w+h*S,t[1]=c*w+p*S,t[2]=s*I+h*P,t[3]=c*I+p*P,t[4]=s*R+h*O+y,t[5]=c*R+p*O+b,t}function Ex(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}Un.mul=Sx,Un.sub=Ex;var mn={};function xg(t){return xg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xg(t)}Object.defineProperty(mn,"__esModule",{value:!0}),mn.create=function(){var t=new As.ARRAY_TYPE(9);return As.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},mn.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},mn.clone=function(t){var e=new As.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},mn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},mn.fromValues=function(t,e,i,s,c,h,p,y,b){var w=new As.ARRAY_TYPE(9);return w[0]=t,w[1]=e,w[2]=i,w[3]=s,w[4]=c,w[5]=h,w[6]=p,w[7]=y,w[8]=b,w},mn.set=function(t,e,i,s,c,h,p,y,b,w){return t[0]=e,t[1]=i,t[2]=s,t[3]=c,t[4]=h,t[5]=p,t[6]=y,t[7]=b,t[8]=w,t},mn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},mn.transpose=function(t,e){if(t===e){var i=e[1],s=e[2],c=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=s,t[7]=c}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},mn.invert=function(t,e){var i=e[0],s=e[1],c=e[2],h=e[3],p=e[4],y=e[5],b=e[6],w=e[7],S=e[8],I=S*p-y*w,P=-S*h+y*b,R=w*h-p*b,O=i*I+s*P+c*R;return O?(t[0]=I*(O=1/O),t[1]=(-S*s+c*w)*O,t[2]=(y*s-c*p)*O,t[3]=P*O,t[4]=(S*i-c*b)*O,t[5]=(-y*i+c*h)*O,t[6]=R*O,t[7]=(-w*i+s*b)*O,t[8]=(p*i-s*h)*O,t):null},mn.adjoint=function(t,e){var i=e[0],s=e[1],c=e[2],h=e[3],p=e[4],y=e[5],b=e[6],w=e[7],S=e[8];return t[0]=p*S-y*w,t[1]=c*w-s*S,t[2]=s*y-c*p,t[3]=y*b-h*S,t[4]=i*S-c*b,t[5]=c*h-i*y,t[6]=h*w-p*b,t[7]=s*b-i*w,t[8]=i*p-s*h,t},mn.determinant=function(t){var e=t[3],i=t[4],s=t[5],c=t[6],h=t[7],p=t[8];return t[0]*(p*i-s*h)+t[1]*(-p*e+s*c)+t[2]*(h*e-i*c)},mn.multiply=Ix,mn.translate=function(t,e,i){var s=e[0],c=e[1],h=e[2],p=e[3],y=e[4],b=e[5],w=e[6],S=e[7],I=e[8],P=i[0],R=i[1];return t[0]=s,t[1]=c,t[2]=h,t[3]=p,t[4]=y,t[5]=b,t[6]=P*s+R*p+w,t[7]=P*c+R*y+S,t[8]=P*h+R*b+I,t},mn.rotate=function(t,e,i){var s=e[0],c=e[1],h=e[2],p=e[3],y=e[4],b=e[5],w=e[6],S=e[7],I=e[8],P=Math.sin(i),R=Math.cos(i);return t[0]=R*s+P*p,t[1]=R*c+P*y,t[2]=R*h+P*b,t[3]=R*p-P*s,t[4]=R*y-P*c,t[5]=R*b-P*h,t[6]=w,t[7]=S,t[8]=I,t},mn.scale=function(t,e,i){var s=i[0],c=i[1];return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=c*e[3],t[4]=c*e[4],t[5]=c*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},mn.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},mn.fromRotation=function(t,e){var i=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=i,t[2]=0,t[3]=-i,t[4]=s,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},mn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},mn.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},mn.fromQuat=function(t,e){var i=e[0],s=e[1],c=e[2],h=e[3],p=i+i,y=s+s,b=c+c,w=i*p,S=s*p,I=s*y,P=c*p,R=c*y,O=c*b,F=h*p,U=h*y,$=h*b;return t[0]=1-I-O,t[3]=S-$,t[6]=P+U,t[1]=S+$,t[4]=1-w-O,t[7]=R-F,t[2]=P-U,t[5]=R+F,t[8]=1-w-I,t},mn.normalFromMat4=function(t,e){var i=e[0],s=e[1],c=e[2],h=e[3],p=e[4],y=e[5],b=e[6],w=e[7],S=e[8],I=e[9],P=e[10],R=e[11],O=e[12],F=e[13],U=e[14],$=e[15],J=i*y-s*p,te=i*b-c*p,ee=i*w-h*p,ce=s*b-c*y,ae=s*w-h*y,fe=c*w-h*b,ve=S*F-I*O,Se=S*U-P*O,De=S*$-R*O,Ee=I*U-P*F,Ue=I*$-R*F,Ye=P*$-R*U,Fe=J*Ye-te*Ue+ee*Ee+ce*De-ae*Se+fe*ve;return Fe?(t[0]=(y*Ye-b*Ue+w*Ee)*(Fe=1/Fe),t[1]=(b*De-p*Ye-w*Se)*Fe,t[2]=(p*Ue-y*De+w*ve)*Fe,t[3]=(c*Ue-s*Ye-h*Ee)*Fe,t[4]=(i*Ye-c*De+h*Se)*Fe,t[5]=(s*De-i*Ue-h*ve)*Fe,t[6]=(F*fe-U*ae+$*ce)*Fe,t[7]=(U*ee-O*fe-$*te)*Fe,t[8]=(O*ae-F*ee+$*J)*Fe,t):null},mn.projection=function(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},mn.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},mn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},mn.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t},mn.subtract=Cx,mn.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t},mn.multiplyScalarAndAdd=function(t,e,i,s){return t[0]=e[0]+i[0]*s,t[1]=e[1]+i[1]*s,t[2]=e[2]+i[2]*s,t[3]=e[3]+i[3]*s,t[4]=e[4]+i[4]*s,t[5]=e[5]+i[5]*s,t[6]=e[6]+i[6]*s,t[7]=e[7]+i[7]*s,t[8]=e[8]+i[8]*s,t},mn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},mn.equals=function(t,e){var i=t[0],s=t[1],c=t[2],h=t[3],p=t[4],y=t[5],b=t[6],w=t[7],S=t[8],I=e[0],P=e[1],R=e[2],O=e[3],F=e[4],U=e[5],$=e[6],J=e[7],te=e[8];return Math.abs(i-I)<=As.EPSILON*Math.max(1,Math.abs(i),Math.abs(I))&&Math.abs(s-P)<=As.EPSILON*Math.max(1,Math.abs(s),Math.abs(P))&&Math.abs(c-R)<=As.EPSILON*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(h-O)<=As.EPSILON*Math.max(1,Math.abs(h),Math.abs(O))&&Math.abs(p-F)<=As.EPSILON*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(y-U)<=As.EPSILON*Math.max(1,Math.abs(y),Math.abs(U))&&Math.abs(b-$)<=As.EPSILON*Math.max(1,Math.abs(b),Math.abs($))&&Math.abs(w-J)<=As.EPSILON*Math.max(1,Math.abs(w),Math.abs(J))&&Math.abs(S-te)<=As.EPSILON*Math.max(1,Math.abs(S),Math.abs(te))},mn.sub=mn.mul=void 0;var As=function(t,e){if(t&&t.__esModule)return t;if(t===null||xg(t)!=="object"&&typeof t!="function")return{default:t};var i=Ax(void 0);if(i&&i.has(t))return i.get(t);var s={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var p=c?Object.getOwnPropertyDescriptor(t,h):null;p&&(p.get||p.set)?Object.defineProperty(s,h,p):s[h]=t[h]}return s.default=t,i&&i.set(t,s),s}(yr);function Ax(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Ax=function(s){return s?i:e})(t)}function Ix(t,e,i){var s=e[0],c=e[1],h=e[2],p=e[3],y=e[4],b=e[5],w=e[6],S=e[7],I=e[8],P=i[0],R=i[1],O=i[2],F=i[3],U=i[4],$=i[5],J=i[6],te=i[7],ee=i[8];return t[0]=P*s+R*p+O*w,t[1]=P*c+R*y+O*S,t[2]=P*h+R*b+O*I,t[3]=F*s+U*p+$*w,t[4]=F*c+U*y+$*S,t[5]=F*h+U*b+$*I,t[6]=J*s+te*p+ee*w,t[7]=J*c+te*y+ee*S,t[8]=J*h+te*b+ee*I,t}function Cx(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}mn.mul=Ix,mn.sub=Cx;var Ti={};function vg(t){return vg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vg(t)}Object.defineProperty(Ti,"__esModule",{value:!0}),Ti.create=function(){var t=new qn.ARRAY_TYPE(16);return qn.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},Ti.clone=function(t){var e=new qn.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Ti.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Ti.fromValues=function(t,e,i,s,c,h,p,y,b,w,S,I,P,R,O,F){var U=new qn.ARRAY_TYPE(16);return U[0]=t,U[1]=e,U[2]=i,U[3]=s,U[4]=c,U[5]=h,U[6]=p,U[7]=y,U[8]=b,U[9]=w,U[10]=S,U[11]=I,U[12]=P,U[13]=R,U[14]=O,U[15]=F,U},Ti.set=function(t,e,i,s,c,h,p,y,b,w,S,I,P,R,O,F,U){return t[0]=e,t[1]=i,t[2]=s,t[3]=c,t[4]=h,t[5]=p,t[6]=y,t[7]=b,t[8]=w,t[9]=S,t[10]=I,t[11]=P,t[12]=R,t[13]=O,t[14]=F,t[15]=U,t},Ti.identity=Dx,Ti.transpose=function(t,e){if(t===e){var i=e[1],s=e[2],c=e[3],h=e[6],p=e[7],y=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=s,t[9]=h,t[11]=e[14],t[12]=c,t[13]=p,t[14]=y}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},Ti.invert=function(t,e){var i=e[0],s=e[1],c=e[2],h=e[3],p=e[4],y=e[5],b=e[6],w=e[7],S=e[8],I=e[9],P=e[10],R=e[11],O=e[12],F=e[13],U=e[14],$=e[15],J=i*y-s*p,te=i*b-c*p,ee=i*w-h*p,ce=s*b-c*y,ae=s*w-h*y,fe=c*w-h*b,ve=S*F-I*O,Se=S*U-P*O,De=S*$-R*O,Ee=I*U-P*F,Ue=I*$-R*F,Ye=P*$-R*U,Fe=J*Ye-te*Ue+ee*Ee+ce*De-ae*Se+fe*ve;return Fe?(t[0]=(y*Ye-b*Ue+w*Ee)*(Fe=1/Fe),t[1]=(c*Ue-s*Ye-h*Ee)*Fe,t[2]=(F*fe-U*ae+$*ce)*Fe,t[3]=(P*ae-I*fe-R*ce)*Fe,t[4]=(b*De-p*Ye-w*Se)*Fe,t[5]=(i*Ye-c*De+h*Se)*Fe,t[6]=(U*ee-O*fe-$*te)*Fe,t[7]=(S*fe-P*ee+R*te)*Fe,t[8]=(p*Ue-y*De+w*ve)*Fe,t[9]=(s*De-i*Ue-h*ve)*Fe,t[10]=(O*ae-F*ee+$*J)*Fe,t[11]=(I*ee-S*ae-R*J)*Fe,t[12]=(y*Se-p*Ee-b*ve)*Fe,t[13]=(i*Ee-s*Se+c*ve)*Fe,t[14]=(F*te-O*ce-U*J)*Fe,t[15]=(S*ce-I*te+P*J)*Fe,t):null},Ti.adjoint=function(t,e){var i=e[0],s=e[1],c=e[2],h=e[3],p=e[4],y=e[5],b=e[6],w=e[7],S=e[8],I=e[9],P=e[10],R=e[11],O=e[12],F=e[13],U=e[14],$=e[15];return t[0]=y*(P*$-R*U)-I*(b*$-w*U)+F*(b*R-w*P),t[1]=-(s*(P*$-R*U)-I*(c*$-h*U)+F*(c*R-h*P)),t[2]=s*(b*$-w*U)-y*(c*$-h*U)+F*(c*w-h*b),t[3]=-(s*(b*R-w*P)-y*(c*R-h*P)+I*(c*w-h*b)),t[4]=-(p*(P*$-R*U)-S*(b*$-w*U)+O*(b*R-w*P)),t[5]=i*(P*$-R*U)-S*(c*$-h*U)+O*(c*R-h*P),t[6]=-(i*(b*$-w*U)-p*(c*$-h*U)+O*(c*w-h*b)),t[7]=i*(b*R-w*P)-p*(c*R-h*P)+S*(c*w-h*b),t[8]=p*(I*$-R*F)-S*(y*$-w*F)+O*(y*R-w*I),t[9]=-(i*(I*$-R*F)-S*(s*$-h*F)+O*(s*R-h*I)),t[10]=i*(y*$-w*F)-p*(s*$-h*F)+O*(s*w-h*y),t[11]=-(i*(y*R-w*I)-p*(s*R-h*I)+S*(s*w-h*y)),t[12]=-(p*(I*U-P*F)-S*(y*U-b*F)+O*(y*P-b*I)),t[13]=i*(I*U-P*F)-S*(s*U-c*F)+O*(s*P-c*I),t[14]=-(i*(y*U-b*F)-p*(s*U-c*F)+O*(s*b-c*y)),t[15]=i*(y*P-b*I)-p*(s*P-c*I)+S*(s*b-c*y),t},Ti.determinant=function(t){var e=t[0],i=t[1],s=t[2],c=t[3],h=t[4],p=t[5],y=t[6],b=t[7],w=t[8],S=t[9],I=t[10],P=t[11],R=t[12],O=t[13],F=t[14],U=t[15];return(e*p-i*h)*(I*U-P*F)-(e*y-s*h)*(S*U-P*O)+(e*b-c*h)*(S*F-I*O)+(i*y-s*p)*(w*U-P*R)-(i*b-c*p)*(w*F-I*R)+(s*b-c*y)*(w*O-S*R)},Ti.multiply=Lx,Ti.translate=function(t,e,i){var s,c,h,p,y,b,w,S,I,P,R,O,F=i[0],U=i[1],$=i[2];return e===t?(t[12]=e[0]*F+e[4]*U+e[8]*$+e[12],t[13]=e[1]*F+e[5]*U+e[9]*$+e[13],t[14]=e[2]*F+e[6]*U+e[10]*$+e[14],t[15]=e[3]*F+e[7]*U+e[11]*$+e[15]):(c=e[1],h=e[2],p=e[3],y=e[4],b=e[5],w=e[6],S=e[7],I=e[8],P=e[9],R=e[10],O=e[11],t[0]=s=e[0],t[1]=c,t[2]=h,t[3]=p,t[4]=y,t[5]=b,t[6]=w,t[7]=S,t[8]=I,t[9]=P,t[10]=R,t[11]=O,t[12]=s*F+y*U+I*$+e[12],t[13]=c*F+b*U+P*$+e[13],t[14]=h*F+w*U+R*$+e[14],t[15]=p*F+S*U+O*$+e[15]),t},Ti.scale=function(t,e,i){var s=i[0],c=i[1],h=i[2];return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*c,t[5]=e[5]*c,t[6]=e[6]*c,t[7]=e[7]*c,t[8]=e[8]*h,t[9]=e[9]*h,t[10]=e[10]*h,t[11]=e[11]*h,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Ti.rotate=function(t,e,i,s){var c,h,p,y,b,w,S,I,P,R,O,F,U,$,J,te,ee,ce,ae,fe,ve,Se,De,Ee,Ue=s[0],Ye=s[1],Fe=s[2],Ze=Math.hypot(Ue,Ye,Fe);return Ze<qn.EPSILON?null:(Ue*=Ze=1/Ze,Ye*=Ze,Fe*=Ze,c=Math.sin(i),h=Math.cos(i),b=e[1],w=e[2],S=e[3],P=e[5],R=e[6],O=e[7],U=e[9],$=e[10],J=e[11],te=Ue*Ue*(p=1-h)+h,ae=Ue*Ye*p-Fe*c,fe=Ye*Ye*p+h,ve=Fe*Ye*p+Ue*c,Se=Ue*Fe*p+Ye*c,De=Ye*Fe*p-Ue*c,Ee=Fe*Fe*p+h,t[0]=(y=e[0])*te+(I=e[4])*(ee=Ye*Ue*p+Fe*c)+(F=e[8])*(ce=Fe*Ue*p-Ye*c),t[1]=b*te+P*ee+U*ce,t[2]=w*te+R*ee+$*ce,t[3]=S*te+O*ee+J*ce,t[4]=y*ae+I*fe+F*ve,t[5]=b*ae+P*fe+U*ve,t[6]=w*ae+R*fe+$*ve,t[7]=S*ae+O*fe+J*ve,t[8]=y*Se+I*De+F*Ee,t[9]=b*Se+P*De+U*Ee,t[10]=w*Se+R*De+$*Ee,t[11]=S*Se+O*De+J*Ee,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},Ti.rotateX=function(t,e,i){var s=Math.sin(i),c=Math.cos(i),h=e[4],p=e[5],y=e[6],b=e[7],w=e[8],S=e[9],I=e[10],P=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=h*c+w*s,t[5]=p*c+S*s,t[6]=y*c+I*s,t[7]=b*c+P*s,t[8]=w*c-h*s,t[9]=S*c-p*s,t[10]=I*c-y*s,t[11]=P*c-b*s,t},Ti.rotateY=function(t,e,i){var s=Math.sin(i),c=Math.cos(i),h=e[0],p=e[1],y=e[2],b=e[3],w=e[8],S=e[9],I=e[10],P=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=h*c-w*s,t[1]=p*c-S*s,t[2]=y*c-I*s,t[3]=b*c-P*s,t[8]=h*s+w*c,t[9]=p*s+S*c,t[10]=y*s+I*c,t[11]=b*s+P*c,t},Ti.rotateZ=function(t,e,i){var s=Math.sin(i),c=Math.cos(i),h=e[0],p=e[1],y=e[2],b=e[3],w=e[4],S=e[5],I=e[6],P=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=h*c+w*s,t[1]=p*c+S*s,t[2]=y*c+I*s,t[3]=b*c+P*s,t[4]=w*c-h*s,t[5]=S*c-p*s,t[6]=I*c-y*s,t[7]=P*c-b*s,t},Ti.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},Ti.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Ti.fromRotation=function(t,e,i){var s,c,h,p=i[0],y=i[1],b=i[2],w=Math.hypot(p,y,b);return w<qn.EPSILON?null:(p*=w=1/w,y*=w,b*=w,s=Math.sin(e),c=Math.cos(e),t[0]=p*p*(h=1-c)+c,t[1]=y*p*h+b*s,t[2]=b*p*h-y*s,t[3]=0,t[4]=p*y*h-b*s,t[5]=y*y*h+c,t[6]=b*y*h+p*s,t[7]=0,t[8]=p*b*h+y*s,t[9]=y*b*h-p*s,t[10]=b*b*h+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},Ti.fromXRotation=function(t,e){var i=Math.sin(e),s=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Ti.fromYRotation=function(t,e){var i=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Ti.fromZRotation=function(t,e){var i=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Ti.fromRotationTranslation=kx,Ti.fromQuat2=function(t,e){var i=new qn.ARRAY_TYPE(3),s=-e[0],c=-e[1],h=-e[2],p=e[3],y=e[4],b=e[5],w=e[6],S=e[7],I=s*s+c*c+h*h+p*p;return I>0?(i[0]=2*(y*p+S*s+b*h-w*c)/I,i[1]=2*(b*p+S*c+w*s-y*h)/I,i[2]=2*(w*p+S*h+y*c-b*s)/I):(i[0]=2*(y*p+S*s+b*h-w*c),i[1]=2*(b*p+S*c+w*s-y*h),i[2]=2*(w*p+S*h+y*c-b*s)),kx(t,e,i),t},Ti.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},Ti.getScaling=Rx,Ti.getRotation=function(t,e){var i=new qn.ARRAY_TYPE(3);Rx(i,e);var s=1/i[0],c=1/i[1],h=1/i[2],p=e[0]*s,y=e[1]*c,b=e[2]*h,w=e[4]*s,S=e[5]*c,I=e[6]*h,P=e[8]*s,R=e[9]*c,O=e[10]*h,F=p+S+O,U=0;return F>0?(U=2*Math.sqrt(F+1),t[3]=.25*U,t[0]=(I-R)/U,t[1]=(P-b)/U,t[2]=(y-w)/U):p>S&&p>O?(U=2*Math.sqrt(1+p-S-O),t[3]=(I-R)/U,t[0]=.25*U,t[1]=(y+w)/U,t[2]=(P+b)/U):S>O?(U=2*Math.sqrt(1+S-p-O),t[3]=(P-b)/U,t[0]=(y+w)/U,t[1]=.25*U,t[2]=(I+R)/U):(U=2*Math.sqrt(1+O-p-S),t[3]=(y-w)/U,t[0]=(P+b)/U,t[1]=(I+R)/U,t[2]=.25*U),t},Ti.fromRotationTranslationScale=function(t,e,i,s){var c=e[0],h=e[1],p=e[2],y=e[3],b=c+c,w=h+h,S=p+p,I=c*b,P=c*w,R=c*S,O=h*w,F=h*S,U=p*S,$=y*b,J=y*w,te=y*S,ee=s[0],ce=s[1],ae=s[2];return t[0]=(1-(O+U))*ee,t[1]=(P+te)*ee,t[2]=(R-J)*ee,t[3]=0,t[4]=(P-te)*ce,t[5]=(1-(I+U))*ce,t[6]=(F+$)*ce,t[7]=0,t[8]=(R+J)*ae,t[9]=(F-$)*ae,t[10]=(1-(I+O))*ae,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},Ti.fromRotationTranslationScaleOrigin=function(t,e,i,s,c){var h=e[0],p=e[1],y=e[2],b=e[3],w=h+h,S=p+p,I=y+y,P=h*w,R=h*S,O=h*I,F=p*S,U=p*I,$=y*I,J=b*w,te=b*S,ee=b*I,ce=s[0],ae=s[1],fe=s[2],ve=c[0],Se=c[1],De=c[2],Ee=(1-(F+$))*ce,Ue=(R+ee)*ce,Ye=(O-te)*ce,Fe=(R-ee)*ae,Ze=(1-(P+$))*ae,ze=(U+J)*ae,He=(O+te)*fe,vt=(U-J)*fe,Ke=(1-(P+F))*fe;return t[0]=Ee,t[1]=Ue,t[2]=Ye,t[3]=0,t[4]=Fe,t[5]=Ze,t[6]=ze,t[7]=0,t[8]=He,t[9]=vt,t[10]=Ke,t[11]=0,t[12]=i[0]+ve-(Ee*ve+Fe*Se+He*De),t[13]=i[1]+Se-(Ue*ve+Ze*Se+vt*De),t[14]=i[2]+De-(Ye*ve+ze*Se+Ke*De),t[15]=1,t},Ti.fromQuat=function(t,e){var i=e[0],s=e[1],c=e[2],h=e[3],p=i+i,y=s+s,b=c+c,w=i*p,S=s*p,I=s*y,P=c*p,R=c*y,O=c*b,F=h*p,U=h*y,$=h*b;return t[0]=1-I-O,t[1]=S+$,t[2]=P-U,t[3]=0,t[4]=S-$,t[5]=1-w-O,t[6]=R+F,t[7]=0,t[8]=P+U,t[9]=R-F,t[10]=1-w-I,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Ti.frustum=function(t,e,i,s,c,h,p){var y=1/(i-e),b=1/(c-s),w=1/(h-p);return t[0]=2*h*y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*h*b,t[6]=0,t[7]=0,t[8]=(i+e)*y,t[9]=(c+s)*b,t[10]=(p+h)*w,t[11]=-1,t[12]=0,t[13]=0,t[14]=p*h*2*w,t[15]=0,t},Ti.perspectiveNO=zx,Ti.perspectiveZO=function(t,e,i,s,c){var h,p=1/Math.tan(e/2);return t[0]=p/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,c!=null&&c!==1/0?(t[10]=c*(h=1/(s-c)),t[14]=c*s*h):(t[10]=-1,t[14]=-s),t},Ti.perspectiveFromFieldOfView=function(t,e,i,s){var c=Math.tan(e.upDegrees*Math.PI/180),h=Math.tan(e.downDegrees*Math.PI/180),p=Math.tan(e.leftDegrees*Math.PI/180),y=Math.tan(e.rightDegrees*Math.PI/180),b=2/(p+y),w=2/(c+h);return t[0]=b,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=w,t[6]=0,t[7]=0,t[8]=-(p-y)*b*.5,t[9]=(c-h)*w*.5,t[10]=s/(i-s),t[11]=-1,t[12]=0,t[13]=0,t[14]=s*i/(i-s),t[15]=0,t},Ti.orthoNO=Ox,Ti.orthoZO=function(t,e,i,s,c,h,p){var y=1/(e-i),b=1/(s-c),w=1/(h-p);return t[0]=-2*y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*b,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=w,t[11]=0,t[12]=(e+i)*y,t[13]=(c+s)*b,t[14]=h*w,t[15]=1,t},Ti.lookAt=function(t,e,i,s){var c,h,p,y,b,w,S,I,P,R,O=e[0],F=e[1],U=e[2],$=s[0],J=s[1],te=s[2],ee=i[0],ce=i[1],ae=i[2];return Math.abs(O-ee)<qn.EPSILON&&Math.abs(F-ce)<qn.EPSILON&&Math.abs(U-ae)<qn.EPSILON?Dx(t):(S=O-ee,I=F-ce,P=U-ae,c=J*(P*=R=1/Math.hypot(S,I,P))-te*(I*=R),h=te*(S*=R)-$*P,p=$*I-J*S,(R=Math.hypot(c,h,p))?(c*=R=1/R,h*=R,p*=R):(c=0,h=0,p=0),y=I*p-P*h,b=P*c-S*p,w=S*h-I*c,(R=Math.hypot(y,b,w))?(y*=R=1/R,b*=R,w*=R):(y=0,b=0,w=0),t[0]=c,t[1]=y,t[2]=S,t[3]=0,t[4]=h,t[5]=b,t[6]=I,t[7]=0,t[8]=p,t[9]=w,t[10]=P,t[11]=0,t[12]=-(c*O+h*F+p*U),t[13]=-(y*O+b*F+w*U),t[14]=-(S*O+I*F+P*U),t[15]=1,t)},Ti.targetTo=function(t,e,i,s){var c=e[0],h=e[1],p=e[2],y=s[0],b=s[1],w=s[2],S=c-i[0],I=h-i[1],P=p-i[2],R=S*S+I*I+P*P;R>0&&(S*=R=1/Math.sqrt(R),I*=R,P*=R);var O=b*P-w*I,F=w*S-y*P,U=y*I-b*S;return(R=O*O+F*F+U*U)>0&&(O*=R=1/Math.sqrt(R),F*=R,U*=R),t[0]=O,t[1]=F,t[2]=U,t[3]=0,t[4]=I*U-P*F,t[5]=P*O-S*U,t[6]=S*F-I*O,t[7]=0,t[8]=S,t[9]=I,t[10]=P,t[11]=0,t[12]=c,t[13]=h,t[14]=p,t[15]=1,t},Ti.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},Ti.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},Ti.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t},Ti.subtract=Fx,Ti.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t},Ti.multiplyScalarAndAdd=function(t,e,i,s){return t[0]=e[0]+i[0]*s,t[1]=e[1]+i[1]*s,t[2]=e[2]+i[2]*s,t[3]=e[3]+i[3]*s,t[4]=e[4]+i[4]*s,t[5]=e[5]+i[5]*s,t[6]=e[6]+i[6]*s,t[7]=e[7]+i[7]*s,t[8]=e[8]+i[8]*s,t[9]=e[9]+i[9]*s,t[10]=e[10]+i[10]*s,t[11]=e[11]+i[11]*s,t[12]=e[12]+i[12]*s,t[13]=e[13]+i[13]*s,t[14]=e[14]+i[14]*s,t[15]=e[15]+i[15]*s,t},Ti.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},Ti.equals=function(t,e){var i=t[0],s=t[1],c=t[2],h=t[3],p=t[4],y=t[5],b=t[6],w=t[7],S=t[8],I=t[9],P=t[10],R=t[11],O=t[12],F=t[13],U=t[14],$=t[15],J=e[0],te=e[1],ee=e[2],ce=e[3],ae=e[4],fe=e[5],ve=e[6],Se=e[7],De=e[8],Ee=e[9],Ue=e[10],Ye=e[11],Fe=e[12],Ze=e[13],ze=e[14],He=e[15];return Math.abs(i-J)<=qn.EPSILON*Math.max(1,Math.abs(i),Math.abs(J))&&Math.abs(s-te)<=qn.EPSILON*Math.max(1,Math.abs(s),Math.abs(te))&&Math.abs(c-ee)<=qn.EPSILON*Math.max(1,Math.abs(c),Math.abs(ee))&&Math.abs(h-ce)<=qn.EPSILON*Math.max(1,Math.abs(h),Math.abs(ce))&&Math.abs(p-ae)<=qn.EPSILON*Math.max(1,Math.abs(p),Math.abs(ae))&&Math.abs(y-fe)<=qn.EPSILON*Math.max(1,Math.abs(y),Math.abs(fe))&&Math.abs(b-ve)<=qn.EPSILON*Math.max(1,Math.abs(b),Math.abs(ve))&&Math.abs(w-Se)<=qn.EPSILON*Math.max(1,Math.abs(w),Math.abs(Se))&&Math.abs(S-De)<=qn.EPSILON*Math.max(1,Math.abs(S),Math.abs(De))&&Math.abs(I-Ee)<=qn.EPSILON*Math.max(1,Math.abs(I),Math.abs(Ee))&&Math.abs(P-Ue)<=qn.EPSILON*Math.max(1,Math.abs(P),Math.abs(Ue))&&Math.abs(R-Ye)<=qn.EPSILON*Math.max(1,Math.abs(R),Math.abs(Ye))&&Math.abs(O-Fe)<=qn.EPSILON*Math.max(1,Math.abs(O),Math.abs(Fe))&&Math.abs(F-Ze)<=qn.EPSILON*Math.max(1,Math.abs(F),Math.abs(Ze))&&Math.abs(U-ze)<=qn.EPSILON*Math.max(1,Math.abs(U),Math.abs(ze))&&Math.abs($-He)<=qn.EPSILON*Math.max(1,Math.abs($),Math.abs(He))},Ti.sub=Ti.mul=Ti.ortho=Ti.perspective=void 0;var qn=function(t,e){if(t&&t.__esModule)return t;if(t===null||vg(t)!=="object"&&typeof t!="function")return{default:t};var i=Px(void 0);if(i&&i.has(t))return i.get(t);var s={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var p=c?Object.getOwnPropertyDescriptor(t,h):null;p&&(p.get||p.set)?Object.defineProperty(s,h,p):s[h]=t[h]}return s.default=t,i&&i.set(t,s),s}(yr);function Px(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Px=function(s){return s?i:e})(t)}function Dx(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Lx(t,e,i){var s=e[0],c=e[1],h=e[2],p=e[3],y=e[4],b=e[5],w=e[6],S=e[7],I=e[8],P=e[9],R=e[10],O=e[11],F=e[12],U=e[13],$=e[14],J=e[15],te=i[0],ee=i[1],ce=i[2],ae=i[3];return t[0]=te*s+ee*y+ce*I+ae*F,t[1]=te*c+ee*b+ce*P+ae*U,t[2]=te*h+ee*w+ce*R+ae*$,t[3]=te*p+ee*S+ce*O+ae*J,t[4]=(te=i[4])*s+(ee=i[5])*y+(ce=i[6])*I+(ae=i[7])*F,t[5]=te*c+ee*b+ce*P+ae*U,t[6]=te*h+ee*w+ce*R+ae*$,t[7]=te*p+ee*S+ce*O+ae*J,t[8]=(te=i[8])*s+(ee=i[9])*y+(ce=i[10])*I+(ae=i[11])*F,t[9]=te*c+ee*b+ce*P+ae*U,t[10]=te*h+ee*w+ce*R+ae*$,t[11]=te*p+ee*S+ce*O+ae*J,t[12]=(te=i[12])*s+(ee=i[13])*y+(ce=i[14])*I+(ae=i[15])*F,t[13]=te*c+ee*b+ce*P+ae*U,t[14]=te*h+ee*w+ce*R+ae*$,t[15]=te*p+ee*S+ce*O+ae*J,t}function kx(t,e,i){var s=e[0],c=e[1],h=e[2],p=e[3],y=s+s,b=c+c,w=h+h,S=s*y,I=s*b,P=s*w,R=c*b,O=c*w,F=h*w,U=p*y,$=p*b,J=p*w;return t[0]=1-(R+F),t[1]=I+J,t[2]=P-$,t[3]=0,t[4]=I-J,t[5]=1-(S+F),t[6]=O+U,t[7]=0,t[8]=P+$,t[9]=O-U,t[10]=1-(S+R),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function Rx(t,e){var i=e[4],s=e[5],c=e[6],h=e[8],p=e[9],y=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(i,s,c),t[2]=Math.hypot(h,p,y),t}function zx(t,e,i,s,c){var h,p=1/Math.tan(e/2);return t[0]=p/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,c!=null&&c!==1/0?(t[10]=(c+s)*(h=1/(s-c)),t[14]=2*c*s*h):(t[10]=-1,t[14]=-2*s),t}function Ox(t,e,i,s,c,h,p){var y=1/(e-i),b=1/(s-c),w=1/(h-p);return t[0]=-2*y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*b,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*w,t[11]=0,t[12]=(e+i)*y,t[13]=(c+s)*b,t[14]=(p+h)*w,t[15]=1,t}function Fx(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}Ti.perspective=zx,Ti.ortho=Ox,Ti.mul=Lx,Ti.sub=Fx;var gi={},bi={};function bg(t){return bg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},bg(t)}Object.defineProperty(bi,"__esModule",{value:!0}),bi.create=Nx,bi.clone=function(t){var e=new oa.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},bi.length=Vx,bi.fromValues=function(t,e,i){var s=new oa.ARRAY_TYPE(3);return s[0]=t,s[1]=e,s[2]=i,s},bi.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},bi.set=function(t,e,i,s){return t[0]=e,t[1]=i,t[2]=s,t},bi.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},bi.subtract=Ux,bi.multiply=jx,bi.divide=Gx,bi.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},bi.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},bi.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},bi.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},bi.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},bi.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},bi.scaleAndAdd=function(t,e,i,s){return t[0]=e[0]+i[0]*s,t[1]=e[1]+i[1]*s,t[2]=e[2]+i[2]*s,t},bi.distance=$x,bi.squaredDistance=Wx,bi.squaredLength=Hx,bi.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},bi.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},bi.normalize=function(t,e){var i=e[0],s=e[1],c=e[2],h=i*i+s*s+c*c;return h>0&&(h=1/Math.sqrt(h)),t[0]=e[0]*h,t[1]=e[1]*h,t[2]=e[2]*h,t},bi.dot=qx,bi.cross=function(t,e,i){var s=e[0],c=e[1],h=e[2],p=i[0],y=i[1],b=i[2];return t[0]=c*b-h*y,t[1]=h*p-s*b,t[2]=s*y-c*p,t},bi.lerp=function(t,e,i,s){var c=e[0],h=e[1],p=e[2];return t[0]=c+s*(i[0]-c),t[1]=h+s*(i[1]-h),t[2]=p+s*(i[2]-p),t},bi.hermite=function(t,e,i,s,c,h){var p=h*h,y=p*(2*h-3)+1,b=p*(h-2)+h,w=p*(h-1),S=p*(3-2*h);return t[0]=e[0]*y+i[0]*b+s[0]*w+c[0]*S,t[1]=e[1]*y+i[1]*b+s[1]*w+c[1]*S,t[2]=e[2]*y+i[2]*b+s[2]*w+c[2]*S,t},bi.bezier=function(t,e,i,s,c,h){var p=1-h,y=p*p,b=h*h,w=y*p,S=3*h*y,I=3*b*p,P=b*h;return t[0]=e[0]*w+i[0]*S+s[0]*I+c[0]*P,t[1]=e[1]*w+i[1]*S+s[1]*I+c[1]*P,t[2]=e[2]*w+i[2]*S+s[2]*I+c[2]*P,t},bi.random=function(t,e){e=e||1;var i=2*oa.RANDOM()*Math.PI,s=2*oa.RANDOM()-1,c=Math.sqrt(1-s*s)*e;return t[0]=Math.cos(i)*c,t[1]=Math.sin(i)*c,t[2]=s*e,t},bi.transformMat4=function(t,e,i){var s=e[0],c=e[1],h=e[2],p=i[3]*s+i[7]*c+i[11]*h+i[15];return t[0]=(i[0]*s+i[4]*c+i[8]*h+i[12])/(p=p||1),t[1]=(i[1]*s+i[5]*c+i[9]*h+i[13])/p,t[2]=(i[2]*s+i[6]*c+i[10]*h+i[14])/p,t},bi.transformMat3=function(t,e,i){var s=e[0],c=e[1],h=e[2];return t[0]=s*i[0]+c*i[3]+h*i[6],t[1]=s*i[1]+c*i[4]+h*i[7],t[2]=s*i[2]+c*i[5]+h*i[8],t},bi.transformQuat=function(t,e,i){var s=i[0],c=i[1],h=i[2],p=e[0],y=e[1],b=e[2],w=c*b-h*y,S=h*p-s*b,I=s*y-c*p,P=c*I-h*S,R=h*w-s*I,O=s*S-c*w,F=2*i[3];return S*=F,I*=F,R*=2,O*=2,t[0]=p+(w*=F)+(P*=2),t[1]=y+S+R,t[2]=b+I+O,t},bi.rotateX=function(t,e,i,s){var c=[],h=[];return c[0]=e[0]-i[0],c[1]=e[1]-i[1],c[2]=e[2]-i[2],h[0]=c[0],h[1]=c[1]*Math.cos(s)-c[2]*Math.sin(s),h[2]=c[1]*Math.sin(s)+c[2]*Math.cos(s),t[0]=h[0]+i[0],t[1]=h[1]+i[1],t[2]=h[2]+i[2],t},bi.rotateY=function(t,e,i,s){var c=[],h=[];return c[0]=e[0]-i[0],c[1]=e[1]-i[1],c[2]=e[2]-i[2],h[0]=c[2]*Math.sin(s)+c[0]*Math.cos(s),h[1]=c[1],h[2]=c[2]*Math.cos(s)-c[0]*Math.sin(s),t[0]=h[0]+i[0],t[1]=h[1]+i[1],t[2]=h[2]+i[2],t},bi.rotateZ=function(t,e,i,s){var c=[],h=[];return c[0]=e[0]-i[0],c[1]=e[1]-i[1],c[2]=e[2]-i[2],h[0]=c[0]*Math.cos(s)-c[1]*Math.sin(s),h[1]=c[0]*Math.sin(s)+c[1]*Math.cos(s),h[2]=c[2],t[0]=h[0]+i[0],t[1]=h[1]+i[1],t[2]=h[2]+i[2],t},bi.angle=function(t,e){var i=t[0],s=t[1],c=t[2],h=e[0],p=e[1],y=e[2],b=Math.sqrt(i*i+s*s+c*c)*Math.sqrt(h*h+p*p+y*y),w=b&&qx(t,e)/b;return Math.acos(Math.min(Math.max(w,-1),1))},bi.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},bi.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},bi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},bi.equals=function(t,e){var i=t[0],s=t[1],c=t[2],h=e[0],p=e[1],y=e[2];return Math.abs(i-h)<=oa.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(s-p)<=oa.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(c-y)<=oa.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))},bi.forEach=bi.sqrLen=bi.len=bi.sqrDist=bi.dist=bi.div=bi.mul=bi.sub=void 0;var oa=function(t,e){if(t&&t.__esModule)return t;if(t===null||bg(t)!=="object"&&typeof t!="function")return{default:t};var i=Bx(void 0);if(i&&i.has(t))return i.get(t);var s={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var p=c?Object.getOwnPropertyDescriptor(t,h):null;p&&(p.get||p.set)?Object.defineProperty(s,h,p):s[h]=t[h]}return s.default=t,i&&i.set(t,s),s}(yr);function Bx(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Bx=function(s){return s?i:e})(t)}function Nx(){var t=new oa.ARRAY_TYPE(3);return oa.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Vx(t){return Math.hypot(t[0],t[1],t[2])}function Ux(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function jx(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function Gx(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function $x(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function Wx(t,e){var i=e[0]-t[0],s=e[1]-t[1],c=e[2]-t[2];return i*i+s*s+c*c}function Hx(t){var e=t[0],i=t[1],s=t[2];return e*e+i*i+s*s}function qx(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}bi.sub=Ux,bi.mul=jx,bi.div=Gx,bi.dist=$x,bi.sqrDist=Wx,bi.len=Vx,bi.sqrLen=Hx;var aa,DE=(aa=Nx(),function(t,e,i,s,c,h){var p,y;for(e||(e=3),i||(i=0),y=s?Math.min(s*e+i,t.length):t.length,p=i;p<y;p+=e)aa[0]=t[p],aa[1]=t[p+1],aa[2]=t[p+2],c(aa,aa,h),t[p]=aa[0],t[p+1]=aa[1],t[p+2]=aa[2];return t});bi.forEach=DE;var Li={};function wg(t){return wg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wg(t)}Object.defineProperty(Li,"__esModule",{value:!0}),Li.create=Xx,Li.clone=function(t){var e=new Vs.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Li.fromValues=function(t,e,i,s){var c=new Vs.ARRAY_TYPE(4);return c[0]=t,c[1]=e,c[2]=i,c[3]=s,c},Li.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Li.set=function(t,e,i,s,c){return t[0]=e,t[1]=i,t[2]=s,t[3]=c,t},Li.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},Li.subtract=Yx,Li.multiply=Kx,Li.divide=Jx,Li.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},Li.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},Li.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},Li.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},Li.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},Li.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},Li.scaleAndAdd=function(t,e,i,s){return t[0]=e[0]+i[0]*s,t[1]=e[1]+i[1]*s,t[2]=e[2]+i[2]*s,t[3]=e[3]+i[3]*s,t},Li.distance=Qx,Li.squaredDistance=ev,Li.length=tv,Li.squaredLength=iv,Li.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},Li.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},Li.normalize=function(t,e){var i=e[0],s=e[1],c=e[2],h=e[3],p=i*i+s*s+c*c+h*h;return p>0&&(p=1/Math.sqrt(p)),t[0]=i*p,t[1]=s*p,t[2]=c*p,t[3]=h*p,t},Li.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Li.cross=function(t,e,i,s){var c=i[0]*s[1]-i[1]*s[0],h=i[0]*s[2]-i[2]*s[0],p=i[0]*s[3]-i[3]*s[0],y=i[1]*s[2]-i[2]*s[1],b=i[1]*s[3]-i[3]*s[1],w=i[2]*s[3]-i[3]*s[2],S=e[0],I=e[1],P=e[2],R=e[3];return t[0]=I*w-P*b+R*y,t[1]=-S*w+P*p-R*h,t[2]=S*b-I*p+R*c,t[3]=-S*y+I*h-P*c,t},Li.lerp=function(t,e,i,s){var c=e[0],h=e[1],p=e[2],y=e[3];return t[0]=c+s*(i[0]-c),t[1]=h+s*(i[1]-h),t[2]=p+s*(i[2]-p),t[3]=y+s*(i[3]-y),t},Li.random=function(t,e){var i,s,c,h,p,y;e=e||1;do p=(i=2*Vs.RANDOM()-1)*i+(s=2*Vs.RANDOM()-1)*s;while(p>=1);do y=(c=2*Vs.RANDOM()-1)*c+(h=2*Vs.RANDOM()-1)*h;while(y>=1);var b=Math.sqrt((1-p)/y);return t[0]=e*i,t[1]=e*s,t[2]=e*c*b,t[3]=e*h*b,t},Li.transformMat4=function(t,e,i){var s=e[0],c=e[1],h=e[2],p=e[3];return t[0]=i[0]*s+i[4]*c+i[8]*h+i[12]*p,t[1]=i[1]*s+i[5]*c+i[9]*h+i[13]*p,t[2]=i[2]*s+i[6]*c+i[10]*h+i[14]*p,t[3]=i[3]*s+i[7]*c+i[11]*h+i[15]*p,t},Li.transformQuat=function(t,e,i){var s=e[0],c=e[1],h=e[2],p=i[0],y=i[1],b=i[2],w=i[3],S=w*s+y*h-b*c,I=w*c+b*s-p*h,P=w*h+p*c-y*s,R=-p*s-y*c-b*h;return t[0]=S*w+R*-p+I*-b-P*-y,t[1]=I*w+R*-y+P*-p-S*-b,t[2]=P*w+R*-b+S*-y-I*-p,t[3]=e[3],t},Li.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},Li.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Li.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Li.equals=function(t,e){var i=t[0],s=t[1],c=t[2],h=t[3],p=e[0],y=e[1],b=e[2],w=e[3];return Math.abs(i-p)<=Vs.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(s-y)<=Vs.EPSILON*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(c-b)<=Vs.EPSILON*Math.max(1,Math.abs(c),Math.abs(b))&&Math.abs(h-w)<=Vs.EPSILON*Math.max(1,Math.abs(h),Math.abs(w))},Li.forEach=Li.sqrLen=Li.len=Li.sqrDist=Li.dist=Li.div=Li.mul=Li.sub=void 0;var Vs=function(t,e){if(t&&t.__esModule)return t;if(t===null||wg(t)!=="object"&&typeof t!="function")return{default:t};var i=Zx(void 0);if(i&&i.has(t))return i.get(t);var s={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var p=c?Object.getOwnPropertyDescriptor(t,h):null;p&&(p.get||p.set)?Object.defineProperty(s,h,p):s[h]=t[h]}return s.default=t,i&&i.set(t,s),s}(yr);function Zx(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Zx=function(s){return s?i:e})(t)}function Xx(){var t=new Vs.ARRAY_TYPE(4);return Vs.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Yx(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function Kx(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function Jx(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function Qx(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function ev(t,e){var i=e[0]-t[0],s=e[1]-t[1],c=e[2]-t[2],h=e[3]-t[3];return i*i+s*s+c*c+h*h}function tv(t){return Math.hypot(t[0],t[1],t[2],t[3])}function iv(t){var e=t[0],i=t[1],s=t[2],c=t[3];return e*e+i*i+s*s+c*c}Li.sub=Yx,Li.mul=Kx,Li.div=Jx,Li.dist=Qx,Li.sqrDist=ev,Li.len=tv,Li.sqrLen=iv;var LE=function(){var t=Xx();return function(e,i,s,c,h,p){var y,b;for(i||(i=4),s||(s=0),b=c?Math.min(c*i+s,e.length):e.length,y=s;y<b;y+=i)t[0]=e[y],t[1]=e[y+1],t[2]=e[y+2],t[3]=e[y+3],h(t,t,p),e[y]=t[0],e[y+1]=t[1],e[y+2]=t[2],e[y+3]=t[3];return e}}();function Tg(t){return Tg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Tg(t)}Li.forEach=LE,Object.defineProperty(gi,"__esModule",{value:!0}),gi.create=Mg,gi.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},gi.setAxisAngle=rv,gi.getAxisAngle=function(t,e){var i=2*Math.acos(e[3]),s=Math.sin(i/2);return s>_c.EPSILON?(t[0]=e[0]/s,t[1]=e[1]/s,t[2]=e[2]/s):(t[0]=1,t[1]=0,t[2]=0),i},gi.getAngle=function(t,e){var i=uv(t,e);return Math.acos(2*i*i-1)},gi.multiply=sv,gi.rotateX=function(t,e,i){i*=.5;var s=e[0],c=e[1],h=e[2],p=e[3],y=Math.sin(i),b=Math.cos(i);return t[0]=s*b+p*y,t[1]=c*b+h*y,t[2]=h*b-c*y,t[3]=p*b-s*y,t},gi.rotateY=function(t,e,i){i*=.5;var s=e[0],c=e[1],h=e[2],p=e[3],y=Math.sin(i),b=Math.cos(i);return t[0]=s*b-h*y,t[1]=c*b+p*y,t[2]=h*b+s*y,t[3]=p*b-c*y,t},gi.rotateZ=function(t,e,i){i*=.5;var s=e[0],c=e[1],h=e[2],p=e[3],y=Math.sin(i),b=Math.cos(i);return t[0]=s*b+c*y,t[1]=c*b-s*y,t[2]=h*b+p*y,t[3]=p*b-h*y,t},gi.calculateW=function(t,e){var i=e[0],s=e[1],c=e[2];return t[0]=i,t[1]=s,t[2]=c,t[3]=Math.sqrt(Math.abs(1-i*i-s*s-c*c)),t},gi.exp=ov,gi.ln=av,gi.pow=function(t,e,i){return av(t,e),cv(t,t,i),ov(t,t),t},gi.slerp=Wp,gi.random=function(t){var e=_c.RANDOM(),i=_c.RANDOM(),s=_c.RANDOM(),c=Math.sqrt(1-e),h=Math.sqrt(e);return t[0]=c*Math.sin(2*Math.PI*i),t[1]=c*Math.cos(2*Math.PI*i),t[2]=h*Math.sin(2*Math.PI*s),t[3]=h*Math.cos(2*Math.PI*s),t},gi.invert=function(t,e){var i=e[0],s=e[1],c=e[2],h=e[3],p=i*i+s*s+c*c+h*h,y=p?1/p:0;return t[0]=-i*y,t[1]=-s*y,t[2]=-c*y,t[3]=h*y,t},gi.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},gi.fromMat3=lv,gi.fromEuler=function(t,e,i,s){var c=.5*Math.PI/180;e*=c,i*=c,s*=c;var h=Math.sin(e),p=Math.cos(e),y=Math.sin(i),b=Math.cos(i),w=Math.sin(s),S=Math.cos(s);return t[0]=h*b*S-p*y*w,t[1]=p*y*S+h*b*w,t[2]=p*b*w-h*y*S,t[3]=p*b*S+h*y*w,t},gi.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},gi.setAxes=gi.sqlerp=gi.rotationTo=gi.equals=gi.exactEquals=gi.normalize=gi.sqrLen=gi.squaredLength=gi.len=gi.length=gi.lerp=gi.dot=gi.scale=gi.mul=gi.add=gi.set=gi.copy=gi.fromValues=gi.clone=void 0;var _c=$p(yr),kE=$p(mn),la=$p(bi),Is=$p(Li);function nv(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(nv=function(s){return s?i:e})(t)}function $p(t,e){if(t&&t.__esModule)return t;if(t===null||Tg(t)!=="object"&&typeof t!="function")return{default:t};var i=nv(e);if(i&&i.has(t))return i.get(t);var s={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var p=c?Object.getOwnPropertyDescriptor(t,h):null;p&&(p.get||p.set)?Object.defineProperty(s,h,p):s[h]=t[h]}return s.default=t,i&&i.set(t,s),s}function Mg(){var t=new _c.ARRAY_TYPE(4);return _c.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function rv(t,e,i){i*=.5;var s=Math.sin(i);return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=Math.cos(i),t}function sv(t,e,i){var s=e[0],c=e[1],h=e[2],p=e[3],y=i[0],b=i[1],w=i[2],S=i[3];return t[0]=s*S+p*y+c*w-h*b,t[1]=c*S+p*b+h*y-s*w,t[2]=h*S+p*w+s*b-c*y,t[3]=p*S-s*y-c*b-h*w,t}function ov(t,e){var i=e[0],s=e[1],c=e[2],h=e[3],p=Math.sqrt(i*i+s*s+c*c),y=Math.exp(h),b=p>0?y*Math.sin(p)/p:0;return t[0]=i*b,t[1]=s*b,t[2]=c*b,t[3]=y*Math.cos(p),t}function av(t,e){var i=e[0],s=e[1],c=e[2],h=e[3],p=Math.sqrt(i*i+s*s+c*c),y=p>0?Math.atan2(p,h)/p:0;return t[0]=i*y,t[1]=s*y,t[2]=c*y,t[3]=.5*Math.log(i*i+s*s+c*c+h*h),t}function Wp(t,e,i,s){var c,h,p,y,b,w=e[0],S=e[1],I=e[2],P=e[3],R=i[0],O=i[1],F=i[2],U=i[3];return(h=w*R+S*O+I*F+P*U)<0&&(h=-h,R=-R,O=-O,F=-F,U=-U),1-h>_c.EPSILON?(c=Math.acos(h),p=Math.sin(c),y=Math.sin((1-s)*c)/p,b=Math.sin(s*c)/p):(y=1-s,b=s),t[0]=y*w+b*R,t[1]=y*S+b*O,t[2]=y*I+b*F,t[3]=y*P+b*U,t}function lv(t,e){var i,s=e[0]+e[4]+e[8];if(s>0)i=Math.sqrt(s+1),t[3]=.5*i,t[0]=(e[5]-e[7])*(i=.5/i),t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var c=0;e[4]>e[0]&&(c=1),e[8]>e[3*c+c]&&(c=2);var h=(c+1)%3,p=(c+2)%3;i=Math.sqrt(e[3*c+c]-e[3*h+h]-e[3*p+p]+1),t[c]=.5*i,t[3]=(e[3*h+p]-e[3*p+h])*(i=.5/i),t[h]=(e[3*h+c]+e[3*c+h])*i,t[p]=(e[3*p+c]+e[3*c+p])*i}return t}gi.clone=Is.clone,gi.fromValues=Is.fromValues,gi.copy=Is.copy,gi.set=Is.set,gi.add=Is.add,gi.mul=sv;var cv=Is.scale;gi.scale=cv;var uv=Is.dot;gi.dot=uv,gi.lerp=Is.lerp;var hv=Is.length;gi.length=hv,gi.len=hv;var dv=Is.squaredLength;gi.squaredLength=dv,gi.sqrLen=dv;var Sg=Is.normalize;gi.normalize=Sg,gi.exactEquals=Is.exactEquals,gi.equals=Is.equals;var Js,fv,pv,RE=(Js=la.create(),fv=la.fromValues(1,0,0),pv=la.fromValues(0,1,0),function(t,e,i){var s=la.dot(e,i);return s<-.999999?(la.cross(Js,fv,e),la.len(Js)<1e-6&&la.cross(Js,pv,e),la.normalize(Js,Js),rv(t,Js,Math.PI),t):s>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(la.cross(Js,e,i),t[0]=Js[0],t[1]=Js[1],t[2]=Js[2],t[3]=1+s,Sg(t,t))});gi.rotationTo=RE;var Eg,Ag,zE=(Eg=Mg(),Ag=Mg(),function(t,e,i,s,c,h){return Wp(Eg,e,c,h),Wp(Ag,i,s,h),Wp(t,Eg,Ag,2*h*(1-h)),t});gi.sqlerp=zE;var Qs,OE=(Qs=kE.create(),function(t,e,i,s){return Qs[0]=i[0],Qs[3]=i[1],Qs[6]=i[2],Qs[1]=s[0],Qs[4]=s[1],Qs[7]=s[2],Qs[2]=-e[0],Qs[5]=-e[1],Qs[8]=-e[2],Sg(t,lv(t,Qs))});gi.setAxes=OE;var Bi={};function Ig(t){return Ig=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ig(t)}Object.defineProperty(Bi,"__esModule",{value:!0}),Bi.create=function(){var t=new ss.ARRAY_TYPE(8);return ss.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},Bi.clone=function(t){var e=new ss.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},Bi.fromValues=function(t,e,i,s,c,h,p,y){var b=new ss.ARRAY_TYPE(8);return b[0]=t,b[1]=e,b[2]=i,b[3]=s,b[4]=c,b[5]=h,b[6]=p,b[7]=y,b},Bi.fromRotationTranslationValues=function(t,e,i,s,c,h,p){var y=new ss.ARRAY_TYPE(8);y[0]=t,y[1]=e,y[2]=i,y[3]=s;var b=.5*c,w=.5*h,S=.5*p;return y[4]=b*s+w*i-S*e,y[5]=w*s+S*t-b*i,y[6]=S*s+b*e-w*t,y[7]=-b*t-w*e-S*i,y},Bi.fromRotationTranslation=gv,Bi.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},Bi.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Bi.fromMat4=function(t,e){var i=ca.create();mv.getRotation(i,e);var s=new ss.ARRAY_TYPE(3);return mv.getTranslation(s,e),gv(t,i,s),t},Bi.copy=yv,Bi.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Bi.set=function(t,e,i,s,c,h,p,y,b){return t[0]=e,t[1]=i,t[2]=s,t[3]=c,t[4]=h,t[5]=p,t[6]=y,t[7]=b,t},Bi.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},Bi.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},Bi.getTranslation=function(t,e){var i=e[4],s=e[5],c=e[6],h=e[7],p=-e[0],y=-e[1],b=-e[2],w=e[3];return t[0]=2*(i*w+h*p+s*b-c*y),t[1]=2*(s*w+h*y+c*p-i*b),t[2]=2*(c*w+h*b+i*y-s*p),t},Bi.translate=function(t,e,i){var s=e[0],c=e[1],h=e[2],p=e[3],y=.5*i[0],b=.5*i[1],w=.5*i[2],S=e[4],I=e[5],P=e[6],R=e[7];return t[0]=s,t[1]=c,t[2]=h,t[3]=p,t[4]=p*y+c*w-h*b+S,t[5]=p*b+h*y-s*w+I,t[6]=p*w+s*b-c*y+P,t[7]=-s*y-c*b-h*w+R,t},Bi.rotateX=function(t,e,i){var s=-e[0],c=-e[1],h=-e[2],p=e[3],y=e[4],b=e[5],w=e[6],S=e[7],I=y*p+S*s+b*h-w*c,P=b*p+S*c+w*s-y*h,R=w*p+S*h+y*c-b*s,O=S*p-y*s-b*c-w*h;return ca.rotateX(t,e,i),t[4]=I*(p=t[3])+O*(s=t[0])+P*(h=t[2])-R*(c=t[1]),t[5]=P*p+O*c+R*s-I*h,t[6]=R*p+O*h+I*c-P*s,t[7]=O*p-I*s-P*c-R*h,t},Bi.rotateY=function(t,e,i){var s=-e[0],c=-e[1],h=-e[2],p=e[3],y=e[4],b=e[5],w=e[6],S=e[7],I=y*p+S*s+b*h-w*c,P=b*p+S*c+w*s-y*h,R=w*p+S*h+y*c-b*s,O=S*p-y*s-b*c-w*h;return ca.rotateY(t,e,i),t[4]=I*(p=t[3])+O*(s=t[0])+P*(h=t[2])-R*(c=t[1]),t[5]=P*p+O*c+R*s-I*h,t[6]=R*p+O*h+I*c-P*s,t[7]=O*p-I*s-P*c-R*h,t},Bi.rotateZ=function(t,e,i){var s=-e[0],c=-e[1],h=-e[2],p=e[3],y=e[4],b=e[5],w=e[6],S=e[7],I=y*p+S*s+b*h-w*c,P=b*p+S*c+w*s-y*h,R=w*p+S*h+y*c-b*s,O=S*p-y*s-b*c-w*h;return ca.rotateZ(t,e,i),t[4]=I*(p=t[3])+O*(s=t[0])+P*(h=t[2])-R*(c=t[1]),t[5]=P*p+O*c+R*s-I*h,t[6]=R*p+O*h+I*c-P*s,t[7]=O*p-I*s-P*c-R*h,t},Bi.rotateByQuatAppend=function(t,e,i){var s=i[0],c=i[1],h=i[2],p=i[3],y=e[0],b=e[1],w=e[2],S=e[3];return t[0]=y*p+S*s+b*h-w*c,t[1]=b*p+S*c+w*s-y*h,t[2]=w*p+S*h+y*c-b*s,t[3]=S*p-y*s-b*c-w*h,t[4]=(y=e[4])*p+(S=e[7])*s+(b=e[5])*h-(w=e[6])*c,t[5]=b*p+S*c+w*s-y*h,t[6]=w*p+S*h+y*c-b*s,t[7]=S*p-y*s-b*c-w*h,t},Bi.rotateByQuatPrepend=function(t,e,i){var s=e[0],c=e[1],h=e[2],p=e[3],y=i[0],b=i[1],w=i[2],S=i[3];return t[0]=s*S+p*y+c*w-h*b,t[1]=c*S+p*b+h*y-s*w,t[2]=h*S+p*w+s*b-c*y,t[3]=p*S-s*y-c*b-h*w,t[4]=s*(S=i[7])+p*(y=i[4])+c*(w=i[6])-h*(b=i[5]),t[5]=c*S+p*b+h*y-s*w,t[6]=h*S+p*w+s*b-c*y,t[7]=p*S-s*y-c*b-h*w,t},Bi.rotateAroundAxis=function(t,e,i,s){if(Math.abs(s)<ss.EPSILON)return yv(t,e);var c=Math.hypot(i[0],i[1],i[2]);s*=.5;var h=Math.sin(s),p=h*i[0]/c,y=h*i[1]/c,b=h*i[2]/c,w=Math.cos(s),S=e[0],I=e[1],P=e[2],R=e[3];t[0]=S*w+R*p+I*b-P*y,t[1]=I*w+R*y+P*p-S*b,t[2]=P*w+R*b+S*y-I*p,t[3]=R*w-S*p-I*y-P*b;var O=e[4],F=e[5],U=e[6],$=e[7];return t[4]=O*w+$*p+F*b-U*y,t[5]=F*w+$*y+U*p-O*b,t[6]=U*w+$*b+O*y-F*p,t[7]=$*w-O*p-F*y-U*b,t},Bi.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t},Bi.multiply=xv,Bi.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t},Bi.lerp=function(t,e,i,s){var c=1-s;return vv(e,i)<0&&(s=-s),t[0]=e[0]*c+i[0]*s,t[1]=e[1]*c+i[1]*s,t[2]=e[2]*c+i[2]*s,t[3]=e[3]*c+i[3]*s,t[4]=e[4]*c+i[4]*s,t[5]=e[5]*c+i[5]*s,t[6]=e[6]*c+i[6]*s,t[7]=e[7]*c+i[7]*s,t},Bi.invert=function(t,e){var i=Hp(e);return t[0]=-e[0]/i,t[1]=-e[1]/i,t[2]=-e[2]/i,t[3]=e[3]/i,t[4]=-e[4]/i,t[5]=-e[5]/i,t[6]=-e[6]/i,t[7]=e[7]/i,t},Bi.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},Bi.normalize=function(t,e){var i=Hp(e);if(i>0){i=Math.sqrt(i);var s=e[0]/i,c=e[1]/i,h=e[2]/i,p=e[3]/i,y=e[4],b=e[5],w=e[6],S=e[7],I=s*y+c*b+h*w+p*S;t[0]=s,t[1]=c,t[2]=h,t[3]=p,t[4]=(y-s*I)/i,t[5]=(b-c*I)/i,t[6]=(w-h*I)/i,t[7]=(S-p*I)/i}return t},Bi.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},Bi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},Bi.equals=function(t,e){var i=t[0],s=t[1],c=t[2],h=t[3],p=t[4],y=t[5],b=t[6],w=t[7],S=e[0],I=e[1],P=e[2],R=e[3],O=e[4],F=e[5],U=e[6],$=e[7];return Math.abs(i-S)<=ss.EPSILON*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(s-I)<=ss.EPSILON*Math.max(1,Math.abs(s),Math.abs(I))&&Math.abs(c-P)<=ss.EPSILON*Math.max(1,Math.abs(c),Math.abs(P))&&Math.abs(h-R)<=ss.EPSILON*Math.max(1,Math.abs(h),Math.abs(R))&&Math.abs(p-O)<=ss.EPSILON*Math.max(1,Math.abs(p),Math.abs(O))&&Math.abs(y-F)<=ss.EPSILON*Math.max(1,Math.abs(y),Math.abs(F))&&Math.abs(b-U)<=ss.EPSILON*Math.max(1,Math.abs(b),Math.abs(U))&&Math.abs(w-$)<=ss.EPSILON*Math.max(1,Math.abs(w),Math.abs($))},Bi.sqrLen=Bi.squaredLength=Bi.len=Bi.length=Bi.dot=Bi.mul=Bi.setReal=Bi.getReal=void 0;var ss=Cg(yr),ca=Cg(gi),mv=Cg(Ti);function _v(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(_v=function(s){return s?i:e})(t)}function Cg(t,e){if(t&&t.__esModule)return t;if(t===null||Ig(t)!=="object"&&typeof t!="function")return{default:t};var i=_v(e);if(i&&i.has(t))return i.get(t);var s={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var p=c?Object.getOwnPropertyDescriptor(t,h):null;p&&(p.get||p.set)?Object.defineProperty(s,h,p):s[h]=t[h]}return s.default=t,i&&i.set(t,s),s}function gv(t,e,i){var s=.5*i[0],c=.5*i[1],h=.5*i[2],p=e[0],y=e[1],b=e[2],w=e[3];return t[0]=p,t[1]=y,t[2]=b,t[3]=w,t[4]=s*w+c*b-h*y,t[5]=c*w+h*p-s*b,t[6]=h*w+s*y-c*p,t[7]=-s*p-c*y-h*b,t}function yv(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function xv(t,e,i){var s=e[0],c=e[1],h=e[2],p=e[3],y=i[4],b=i[5],w=i[6],S=i[7],I=e[4],P=e[5],R=e[6],O=e[7],F=i[0],U=i[1],$=i[2],J=i[3];return t[0]=s*J+p*F+c*$-h*U,t[1]=c*J+p*U+h*F-s*$,t[2]=h*J+p*$+s*U-c*F,t[3]=p*J-s*F-c*U-h*$,t[4]=s*S+p*y+c*w-h*b+I*J+O*F+P*$-R*U,t[5]=c*S+p*b+h*y-s*w+P*J+O*U+R*F-I*$,t[6]=h*S+p*w+s*b-c*y+R*J+O*$+I*U-P*F,t[7]=p*S-s*y-c*b-h*w+O*J-I*F-P*U-R*$,t}Bi.getReal=ca.copy,Bi.setReal=ca.copy,Bi.mul=xv;var vv=ca.dot;Bi.dot=vv;var bv=ca.length;Bi.length=bv,Bi.len=bv;var Hp=ca.squaredLength;Bi.squaredLength=Hp,Bi.sqrLen=Hp;var Ii={};function Pg(t){return Pg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pg(t)}Object.defineProperty(Ii,"__esModule",{value:!0}),Ii.create=Tv,Ii.clone=function(t){var e=new gc.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},Ii.fromValues=function(t,e){var i=new gc.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},Ii.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},Ii.set=function(t,e,i){return t[0]=e,t[1]=i,t},Ii.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},Ii.subtract=Mv,Ii.multiply=Sv,Ii.divide=Ev,Ii.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},Ii.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},Ii.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},Ii.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},Ii.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},Ii.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},Ii.scaleAndAdd=function(t,e,i,s){return t[0]=e[0]+i[0]*s,t[1]=e[1]+i[1]*s,t},Ii.distance=Av,Ii.squaredDistance=Iv,Ii.length=Cv,Ii.squaredLength=Pv,Ii.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},Ii.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},Ii.normalize=function(t,e){var i=e[0],s=e[1],c=i*i+s*s;return c>0&&(c=1/Math.sqrt(c)),t[0]=e[0]*c,t[1]=e[1]*c,t},Ii.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},Ii.cross=function(t,e,i){var s=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=s,t},Ii.lerp=function(t,e,i,s){var c=e[0],h=e[1];return t[0]=c+s*(i[0]-c),t[1]=h+s*(i[1]-h),t},Ii.random=function(t,e){e=e||1;var i=2*gc.RANDOM()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t},Ii.transformMat2=function(t,e,i){var s=e[0],c=e[1];return t[0]=i[0]*s+i[2]*c,t[1]=i[1]*s+i[3]*c,t},Ii.transformMat2d=function(t,e,i){var s=e[0],c=e[1];return t[0]=i[0]*s+i[2]*c+i[4],t[1]=i[1]*s+i[3]*c+i[5],t},Ii.transformMat3=function(t,e,i){var s=e[0],c=e[1];return t[0]=i[0]*s+i[3]*c+i[6],t[1]=i[1]*s+i[4]*c+i[7],t},Ii.transformMat4=function(t,e,i){var s=e[0],c=e[1];return t[0]=i[0]*s+i[4]*c+i[12],t[1]=i[1]*s+i[5]*c+i[13],t},Ii.rotate=function(t,e,i,s){var c=e[0]-i[0],h=e[1]-i[1],p=Math.sin(s),y=Math.cos(s);return t[0]=c*y-h*p+i[0],t[1]=c*p+h*y+i[1],t},Ii.angle=function(t,e){var i=t[0],s=t[1],c=e[0],h=e[1],p=Math.sqrt(i*i+s*s)*Math.sqrt(c*c+h*h);return Math.acos(Math.min(Math.max(p&&(i*c+s*h)/p,-1),1))},Ii.zero=function(t){return t[0]=0,t[1]=0,t},Ii.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},Ii.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Ii.equals=function(t,e){var i=t[0],s=t[1],c=e[0],h=e[1];return Math.abs(i-c)<=gc.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(s-h)<=gc.EPSILON*Math.max(1,Math.abs(s),Math.abs(h))},Ii.forEach=Ii.sqrLen=Ii.sqrDist=Ii.dist=Ii.div=Ii.mul=Ii.sub=Ii.len=void 0;var gc=function(t,e){if(t&&t.__esModule)return t;if(t===null||Pg(t)!=="object"&&typeof t!="function")return{default:t};var i=wv(void 0);if(i&&i.has(t))return i.get(t);var s={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var p=c?Object.getOwnPropertyDescriptor(t,h):null;p&&(p.get||p.set)?Object.defineProperty(s,h,p):s[h]=t[h]}return s.default=t,i&&i.set(t,s),s}(yr);function wv(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(wv=function(s){return s?i:e})(t)}function Tv(){var t=new gc.ARRAY_TYPE(2);return gc.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function Mv(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function Sv(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function Ev(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function Av(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function Iv(t,e){var i=e[0]-t[0],s=e[1]-t[1];return i*i+s*s}function Cv(t){return Math.hypot(t[0],t[1])}function Pv(t){var e=t[0],i=t[1];return e*e+i*i}Ii.len=Cv,Ii.sub=Mv,Ii.mul=Sv,Ii.div=Ev,Ii.dist=Av,Ii.sqrDist=Iv,Ii.sqrLen=Pv;var FE=function(){var t=Tv();return function(e,i,s,c,h,p){var y,b;for(i||(i=2),s||(s=0),b=c?Math.min(c*i+s,e.length):e.length,y=s;y<b;y+=i)t[0]=e[y],t[1]=e[y+1],h(t,t,p),e[y]=t[0],e[y+1]=t[1];return e}}();function Dg(t){return Dg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dg(t)}Ii.forEach=FE,Object.defineProperty(gr,"__esModule",{value:!0}),r.a7=gr.vec4=r.N=gr.vec3=gr.vec2=gr.quat2=r.bi=gr.quat=r.a6=gr.mat4=r.co=gr.mat3=gr.mat2d=r.b4=gr.mat2=gr.glMatrix=void 0;var BE=Ro(yr);gr.glMatrix=BE;var NE=Ro(Nn);r.b4=gr.mat2=NE;var VE=Ro(Un);gr.mat2d=VE;var UE=Ro(mn);r.co=gr.mat3=UE;var jE=Ro(Ti);r.a6=gr.mat4=jE;var GE=Ro(gi);r.bi=gr.quat=GE;var $E=Ro(Bi);gr.quat2=$E;var WE=Ro(Ii);gr.vec2=WE;var HE=Ro(bi);r.N=gr.vec3=HE;var qE=Ro(Li);function Dv(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Dv=function(s){return s?i:e})(t)}function Ro(t,e){if(t&&t.__esModule)return t;if(t===null||Dg(t)!=="object"&&typeof t!="function")return{default:t};var i=Dv(e);if(i&&i.has(t))return i.get(t);var s={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var p=c?Object.getOwnPropertyDescriptor(t,h):null;p&&(p.get||p.set)?Object.defineProperty(s,h,p):s[h]=t[h]}return s.default=t,i&&i.set(t,s),s}r.a7=gr.vec4=qE;class Lg{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,s){const c=r.N.dot(i,this.dir);if(Math.abs(c)<1e-6)return!1;const h=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/c;return s[0]=this.pos[0]+this.dir[0]*h,s[1]=this.pos[1]+this.dir[1]*h,s[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(e,i,s){if(r.N.equals(this.pos,e)||i===0)return s[0]=s[1]=s[2]=0,!1;const[c,h,p]=this.dir,y=this.pos[0]-e[0],b=this.pos[1]-e[1],w=this.pos[2]-e[2],S=c*c+h*h+p*p,I=2*(y*c+b*h+w*p),P=I*I-4*S*(y*y+b*b+w*w-i*i);if(P<0){const R=Math.max(-I/2,0),O=y+c*R,F=b+h*R,U=w+p*R,$=Math.hypot(O,F,U);return s[0]=O*i/$,s[1]=F*i/$,s[2]=U*i/$,!1}{const R=(-I-Math.sqrt(P))/(2*S);if(R<0){const O=Math.hypot(y,b,w);return s[0]=y*i/O,s[1]=b*i/O,s[2]=w*i/O,!1}return s[0]=y+c*R,s[1]=b+h*R,s[2]=w+p*R,!0}}}class kg{constructor(e,i,s,c,h){this.TL=e,this.TR=i,this.BR=s,this.BL=c,this.horizon=h}static fromInvProjectionMatrix(e,i,s){const c=[-1,1,1],h=[1,1,1],p=[1,-1,1],y=[-1,-1,1],b=r.N.transformMat4(c,c,e),w=r.N.transformMat4(h,h,e),S=r.N.transformMat4(p,p,e),I=r.N.transformMat4(y,y,e);return new kg(b,w,S,I,i/s)}}function Dd(t,e,i){let s=1/0,c=-1/0;const h=[];for(const p of t){r.N.sub(h,p,e);const y=r.N.dot(h,i);s=Math.min(s,y),c=Math.max(c,y)}return[s,c]}function Lv(t,e){let i=!0;for(let s=0;s<t.planes.length;s++){const c=t.planes[s];let h=0;for(let p=0;p<e.length;p++)h+=r.N.dot(c,e[p])+c[3]>=0;if(h===0)return 0;h!==e.length&&(i=!1)}return i?2:1}function kv(t,e){for(const i of t.projections){const s=Dd(e,t.points[0],i.axis);if(i.projection[1]<s[0]||i.projection[0]>s[1])return 0}return 1}function Rv(t,e){let i=0;const s=[0,0,0,0];for(let c=0;c<t.length;c++)s[0]=t[c][0],s[1]=t[c][1],s[2]=t[c][2],s[3]=1,r.a7.dot(s,e)>=0&&i++;return i}class Rg{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=jn.fromPoints(this.points),this.projections=[],this.frustumEdges=[r.N.sub([],this.points[2],this.points[3]),r.N.sub([],this.points[0],this.points[3]),r.N.sub([],this.points[4],this.points[0]),r.N.sub([],this.points[5],this.points[1]),r.N.sub([],this.points[6],this.points[2]),r.N.sub([],this.points[7],this.points[3])];for(const s of this.frustumEdges){const c=[0,-s[2],s[1]],h=[s[2],0,-s[0]];this.projections.push({axis:c,projection:Dd(this.points,this.points[0],c)}),this.projections.push({axis:h,projection:Dd(this.points,this.points[0],h)})}}static fromInvProjectionMatrix(e,i,s,c){const h=Math.pow(2,s),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const S=r.a7.transformMat4([],w,e),I=1/S[3]/i*h;return r.a7.mul(S,S,[I,I,c?1/S[3]:I,I])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const S=r.N.sub([],p[w[0]],p[w[1]]),I=r.N.sub([],p[w[2]],p[w[1]]),P=r.N.normalize([],r.N.cross([],S,I)),R=-r.N.dot(P,p[w[1]]);return P.concat(R)}),b=[];for(let w=0;w<p.length;w++)b.push([p[w][0],p[w][1],p[w][2]]);return new Rg(b,y)}intersectsPrecise(e,i,s){for(let c=0;c<i.length;c++)if(!Rv(e,i[c]))return 0;for(let c=0;c<this.planes.length;c++)if(!Rv(e,this.planes[c]))return 0;for(const c of s)for(const h of this.frustumEdges){const p=r.N.cross([],c,h),y=r.N.length(p);if(y===0)continue;r.N.scale(p,p,1/y);const b=Dd(this.points,this.points[0],p),w=Dd(e,this.points[0],p);if(b[0]>w[1]||w[0]>b[1])return 0}return 1}}class jn{static fromPoints(e){const i=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const c of e)r.N.min(i,i,c),r.N.max(s,s,c);return new jn(i,s)}static fromTileIdAndHeight(e,i,s){const c=1<<e.canonical.z,h=e.canonical.x,p=e.canonical.y;return new jn([h/c,p/c,i],[(h+1)/c,(p+1)/c,s])}static applyTransform(e,i){const s=e.getCorners();for(let c=0;c<s.length;++c)r.N.transformMat4(s[c],s[c],i);return jn.fromPoints(s)}static projectAabbCorners(e,i){const s=e.getCorners();for(let c=0;c<s.length;++c)r.N.transformMat4(s[c],s[c],i);return s}constructor(e,i){this.min=e,this.max=i,this.center=r.N.scale([],r.N.add([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],s=r.N.clone(this.min),c=r.N.clone(this.max);for(let h=0;h<i.length;h++)s[h]=i[h]?this.min[h]:this.center[h],c[h]=i[h]?this.center[h]:this.max[h];return c[2]=this.max[2],new jn(s,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Lv(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Lv(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?kv(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?kv(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Bt(jn,"Aabb");const ZE=rn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:qp}=ZE,XE=rn([{name:"a_pos_3",components:3,type:"Int16"}]);var zv=rn([{name:"a_pos",type:"Int16",components:2}]);function Zp(t){return t*Q/Oe}const YE=[new jn([_e,_e,_e],[Pe,Pe,Pe]),new jn([_e,_e,_e],[0,0,Pe]),new jn([0,_e,_e],[Pe,0,Pe]),new jn([_e,0,_e],[0,Pe,Pe]),new jn([0,0,_e],[Pe,Pe,Pe])];function Ov(t,e,i,s=!0){const c=r.N.scale([],t._camera.position,t.worldSize),h=[e,i,1,1];r.a7.transformMat4(h,h,t.pixelMatrixInverse),r.a7.scale(h,h,1/h[3]);const p=r.N.sub([],h,c),y=r.N.normalize([],p),b=t.globeMatrix,w=[b[12],b[13],b[14]],S=r.N.sub([],w,c),I=r.N.length(S),P=r.N.normalize([],S),R=t.worldSize/(2*Math.PI),O=r.N.dot(P,y),F=Math.asin(R/I);if(F<Math.acos(O)){if(!s)return null;const Ee=[],Ue=[];r.N.scale(Ee,y,I/O),r.N.normalize(Ue,r.N.sub(Ue,Ee,S)),r.N.normalize(y,r.N.add(y,S,r.N.scale(y,Ue,Math.tan(F)*I)))}const U=[];new Lg(c,y).closestPointOnSphere(w,R,U);const $=r.N.normalize([],ne(b,0)),J=r.N.normalize([],ne(b,1)),te=r.N.normalize([],ne(b,2)),ee=r.N.dot($,U),ce=r.N.dot(J,U),ae=r.N.dot(te,U),fe=Zt(Math.asin(-ce/R));let ve=Zt(Math.atan2(ee,ae));ve=t.center.lng+function(Ee,Ue){const Ye=(Ue-Ee+180)%360-180;return Ye<-180?Ye+360:Ye}(t.center.lng,ve);const Se=vi(ve),De=wt(ui(fe),0,1);return new Ui(Se,De)}class KE{constructor(e,i,s){this.a=r.N.sub([],e,s),this.b=r.N.sub([],i,s),this.center=s;const c=r.N.normalize([],this.a),h=r.N.normalize([],this.b);this.angle=Math.acos(r.N.dot(c,h))}}function zg(t,e){if(t.angle===0)return null;let i;return i=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(s,c,h,p){const y=Math.sin(h);return s*(Math.sin((1-p)*h)/y)+c*(Math.sin(p*h)/y)}(t.a[e],t.b[e],t.angle,wt(i,0,1))+t.center[e]}function zo(t){if(t.z<=1)return YE[t.z+2*t.y+t.x];const e=Og(Xp(t));return jn.fromPoints(e)}function ua(t,e,i){return r.N.scale(t,t,1-i),r.N.scaleAndAdd(t,t,e,i)}function Fv(t,e,i){for(const s of t)r.N.transformMat4(s,s,e),r.N.scale(s,s,i)}function Bv(t,e,i,s){const c=e/t.worldSize,h=t.globeMatrix;if(i.z<=1){const Se=zo(i).getCorners();return Fv(Se,h,c),jn.fromPoints(Se)}const p=Xp(i,s),y=Og(p,Q+Zp(t._tileCoverLift));Fv(y,h,c);const b=Number.MAX_VALUE,w=[-b,-b,-b],S=[b,b,b];if(p.contains(t.center)){for(const Ee of y)r.N.min(S,S,Ee),r.N.max(w,w,Ee);w[2]=0;const Se=t.point,De=[Se.x*c,Se.y*c,0];return r.N.min(S,S,De),r.N.max(w,w,De),new jn(S,w)}if(t._tileCoverLift>0){for(const Se of y)r.N.min(S,S,Se),r.N.max(w,w,Se);return new jn(S,w)}const I=[h[12]*c,h[13]*c,h[14]*c],P=p.getCenter(),R=wt(t.center.lat,-Ci,Ci),O=wt(P.lat,-Ci,Ci),F=vi(t.center.lng),U=ui(R);let $=F-vi(P.lng);const J=U-ui(O);$>.5?$-=1:$<-.5&&($+=1);let te=0;if(Math.abs($)>Math.abs(J))te=$>=0?1:3;else{te=J>=0?0:2;const Se=[h[4]*c,h[5]*c,h[6]*c],De=-Math.sin(Qe(J>=0?p.getSouth():p.getNorth()))*Q;r.N.scaleAndAdd(I,I,Se,De)}const ee=y[te],ce=y[(te+1)%4],ae=new KE(ee,ce,I),fe=[zg(ae,0)||ee[0],zg(ae,1)||ee[1],zg(ae,2)||ee[2]],ve=Qa(t.zoom);if(ve>0){const Se=function({x:Ee,y:Ue,z:Ye},Fe,Ze,ze,He){const vt=1/(1<<Ye);let Ke=Ee*vt,jt=Ke+vt,Lt=Ue*vt,rt=Lt+vt,oi=0;const Xt=(Ke+jt)/2-ze;return Xt>.5?oi=-1:Xt<-.5&&(oi=1),Ke=((Ke+oi)*Fe-(ze*=Fe))*Ze+ze,jt=((jt+oi)*Fe-ze)*Ze+ze,Lt=(Lt*Fe-(He*=Fe))*Ze+He,rt=(rt*Fe-He)*Ze+He,[[Ke,rt,0],[jt,rt,0],[jt,Lt,0],[Ke,Lt,0]]}(i,e,t._pixelsPerMercatorPixel,F,U);for(let Ee=0;Ee<y.length;Ee++)ua(y[Ee],Se[Ee],ve);const De=r.N.add([],Se[te],Se[(te+1)%4]);r.N.scale(De,De,.5),ua(fe,De,ve)}for(const Se of y)r.N.min(S,S,Se),r.N.max(w,w,Se);return S[2]=Math.min(ee[2],ce[2]),r.N.min(S,S,fe),r.N.max(w,w,fe),new jn(S,w)}function Xp({x:t,y:e,z:i},s=!1){const c=1/(1<<i),h=new Me(pi(t*c),e===(1<<i)-1&&s?-90:Fi((e+1)*c)),p=new Me(pi((t+1)*c),e===0&&s?90:Fi(e*c));return new ke(h,p)}function Og(t,e=Q){const i=Qe(t.getNorth()),s=Qe(t.getSouth()),c=Math.cos(i),h=Math.cos(s),p=Math.sin(i),y=Math.sin(s),b=t.getWest(),w=t.getEast();return[be(h,y,b,e),be(h,y,w,e),be(c,p,w,e),be(c,p,b,e)]}function Ld(t,e,i,s){const c=1<<i.z,h=(t/Pt+i.x)/c;return Ne(Fi((e/Pt+i.y)/c),pi(h),s)}function Yp({min:t,max:e}){return oe/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Nv=new Float64Array(16);function Kp(t){const e=Yp(t),i=r.a6.fromScaling(Nv,[e,e,e]);return r.a6.translate(i,i,r.N.negate([],t.min))}function Fg(t){const e=r.a6.fromTranslation(Nv,t.min),i=1/Yp(t);return r.a6.scale(e,e,[i,i,i])}function Bg(t){const e=Pt/(2*Math.PI);return t/(2*Math.PI)/e}function Vv(t,e){return Pt/(512*Math.pow(2,t))*Yp(zo(e))}function Uv(t,e,i,s,c){const h=Bg(i),p=[t,e,-i/(2*Math.PI)],y=r.a6.identity(new Float64Array(16));return r.a6.translate(y,y,p),r.a6.scale(y,y,[h,h,h]),r.a6.rotateX(y,y,Qe(-c)),r.a6.rotateY(y,y,Qe(-s)),y}function Qa(t){return Qt(se,X,t)}function jv(t,e){const i=Ne(e.lat,e.lng),s=function(h){const p=Ne(h._center.lat,h._center.lng),y=r.N.fromValues(0,1,0);let b=r.N.cross([],y,p);const w=r.a6.fromRotation([],-h.angle,p);b=r.N.transformMat4(b,b,w),r.a6.fromRotation(w,-h._pitch,b);const S=r.N.normalize([],p);return r.N.scale(S,S,Zp(h.cameraToCenterDistance/h.pixelsPerMeter)),r.N.transformMat4(S,S,w),r.N.add([],p,S)}(t),c=r.N.subtract([],s,i);return r.N.angle(c,i)}function Ng(t,e){return jv(t,e)>Math.PI/2*1.01}const Gv=Qe(85),JE=Math.cos(Gv),QE=Math.sin(Gv),eA=r.a6.create(),$v=t=>{const e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Wv(t,e,i,s,c,h,p,y,b){if(h&&t.queryGeometry.isAboveHorizon)return!1;h&&(b*=t.pixelToTileUnitsFactor);const w=t.tileID.canonical,S=i.projection.upVectorScale(w,i.center.lat,i.worldSize).metersToTile;for(const I of e)for(const P of I){const R=P.add(y),O=c&&i.elevation?i.elevation.exaggeration()*c.getElevationAt(R.x,R.y,!0):0,F=i.projection.projectTilePoint(R.x,R.y,w);if(O>0){const te=i.projection.upVector(w,R.x,R.y);F.x+=te[0]*S*O,F.y+=te[1]*S*O,F.z+=te[2]*S*O}const U=h?R:tA(F.x,F.y,F.z,s),$=h?t.tilespaceRays.map(te=>nA(te,O)):t.queryGeometry.screenGeometry,J=r.a7.transformMat4([],[F.x,F.y,F.z,1],s);if(!p&&h?b*=J[3]/i.cameraToCenterDistance:p&&!h&&(b*=i.cameraToCenterDistance/J[3]),h){const te=Fi((P.y/Pt+w.y)/(1<<w.z));b/=i.projection.pixelsPerMeter(te,1)/mi(1,te)}if(Lo($,U,b))return!0}return!1}function tA(t,e,i,s){const c=r.a7.transformMat4([],[t,e,i,1],s);return new le(c[0]/c[3],c[1]/c[3])}const Hv=r.N.fromValues(0,0,0),iA=r.N.fromValues(0,0,1);function nA(t,e){const i=r.N.create();return Hv[2]=e,t.intersectsPlane(Hv,iA,i),new le(i[0],i[1])}class qv extends Zr{}function Zv(t,{width:e,height:i},s,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*i*s)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*i*s);return t.width=e,t.height=i,t.data=c,t}function Xv(t,e,i){const{width:s,height:c}=e;s===t.width&&c===t.height||(Vg(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,s),height:Math.min(t.height,c)},i),t.width=s,t.height=c,t.data=e.data)}function Vg(t,e,i,s,c,h,p){if(c.width===0||c.height===0)return e;if(c.width>t.width||c.height>t.height||i.x>t.width-c.width||i.y>t.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||s.x>e.width-c.width||s.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const y=t.data,b=e.data,w=h===4&&p;for(let S=0;S<c.height;S++){const I=((i.y+S)*t.width+i.x)*h,P=((s.y+S)*e.width+s.x)*h;if(w)for(let R=0;R<c.width;R++){const O=I+R*h+3,F=P+R*h;b[F+0]=255,b[F+1]=255,b[F+2]=255,b[F+3]=y[O]}else for(let R=0;R<c.width*h;R++)b[P+R]=y[I+R]}return e}Bt(qv,"HeatmapBucket",{omit:["layers"]});class el{constructor(e,i){Zv(this,e,1,i)}resize(e){Xv(this,new el(e),1)}clone(){return new el({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,c,h){Vg(e,i,s,c,h,1)}}class Cs{constructor(e,i){Zv(this,e,4,i)}resize(e){Xv(this,new Cs(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Cs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,c,h,p){Vg(e,i,s,c,h,4,p)}}class Yv{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}Bt(el,"AlphaImage"),Bt(Cs,"RGBAImage");const rA=new Fn({visibility:new gt(Ie.layout_heatmap.visibility)});var sA={paint:new Fn({"heatmap-radius":new ti(Ie.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ti(Ie.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new gt(Ie.paint_heatmap["heatmap-intensity"]),"heatmap-color":new na(Ie.paint_heatmap["heatmap-color"]),"heatmap-opacity":new gt(Ie.paint_heatmap["heatmap-opacity"])}),layout:rA};function kd(t){const e={},i=t.resolution||256,s=t.clips?t.clips.length:1,c=t.image||new Cs({width:i,height:s}),h=(p,y,b)=>{e[t.evaluationKey]=b;const w=t.expression.evaluate(e);w&&(c.data[p+y+0]=Math.floor(255*w.r/w.a),c.data[p+y+1]=Math.floor(255*w.g/w.a),c.data[p+y+2]=Math.floor(255*w.b/w.a),c.data[p+y+3]=Math.floor(255*w.a))};if(t.clips)for(let p=0,y=0;p<s;++p,y+=4*i)for(let b=0,w=0;b<i;b++,w+=4){const S=b/(i-1),{start:I,end:P}=t.clips[p];h(y,w,I*(1-S)+P*S)}else for(let p=0,y=0;p<i;p++,y+=4)h(0,y,p/(i-1));return c}const oA=new Fn({visibility:new gt(Ie.layout_hillshade.visibility)});var aA={paint:new Fn({"hillshade-illumination-direction":new gt(Ie.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new gt(Ie.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new gt(Ie.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new gt(Ie.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new gt(Ie.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new gt(Ie.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new gt(Ie.paint_hillshade["hillshade-emissive-strength"])}),layout:oA};const lA=rn([{name:"a_pos",components:2,type:"Int16"}],4),{members:cA}=lA;var Ug={exports:{}};function Jp(t,e,i){i=i||2;var s,c,h,p,y,b,w,S=e&&e.length,I=S?e[0]*i:t.length,P=Kv(t,0,I,i,!0),R=[];if(!P||P.next===P.prev)return R;if(S&&(P=function(F,U,$,J){var te,ee,ce,ae=[];for(te=0,ee=U.length;te<ee;te++)(ce=Kv(F,U[te]*J,te<ee-1?U[te+1]*J:F.length,J,!1))===ce.next&&(ce.steiner=!0),ae.push(gA(ce));for(ae.sort(pA),te=0;te<ae.length;te++)$=mA(ae[te],$);return $}(t,e,P,i)),t.length>80*i){s=h=t[0],c=p=t[1];for(var O=i;O<I;O+=i)(y=t[O])<s&&(s=y),(b=t[O+1])<c&&(c=b),y>h&&(h=y),b>p&&(p=b);w=(w=Math.max(h-s,p-c))!==0?32767/w:0}return Rd(P,R,i,s,c,w,0),R}function Kv(t,e,i,s,c){var h,p;if(c===$g(t,e,i,s)>0)for(h=e;h<i;h+=s)p=eb(h,t[h],t[h+1],p);else for(h=i-s;h>=e;h-=s)p=eb(h,t[h],t[h+1],p);return p&&Qp(p,p.next)&&(Od(p),p=p.next),p}function yc(t,e){if(!t)return t;e||(e=t);var i,s=t;do if(i=!1,s.steiner||!Qp(s,s.next)&&lr(s.prev,s,s.next)!==0)s=s.next;else{if(Od(s),(s=e=s.prev)===s.next)break;i=!0}while(i||s!==e);return e}function Rd(t,e,i,s,c,h,p){if(t){!p&&h&&function(S,I,P,R){var O=S;do O.z===0&&(O.z=jg(O.x,O.y,I,P,R)),O.prevZ=O.prev,O.nextZ=O.next,O=O.next;while(O!==S);O.prevZ.nextZ=null,O.prevZ=null,function(F){var U,$,J,te,ee,ce,ae,fe,ve=1;do{for($=F,F=null,ee=null,ce=0;$;){for(ce++,J=$,ae=0,U=0;U<ve&&(ae++,J=J.nextZ);U++);for(fe=ve;ae>0||fe>0&&J;)ae!==0&&(fe===0||!J||$.z<=J.z)?(te=$,$=$.nextZ,ae--):(te=J,J=J.nextZ,fe--),ee?ee.nextZ=te:F=te,te.prevZ=ee,ee=te;$=J}ee.nextZ=null,ve*=2}while(ce>1)}(O)}(t,s,c,h);for(var y,b,w=t;t.prev!==t.next;)if(y=t.prev,b=t.next,h?hA(t,s,c,h):uA(t))e.push(y.i/i|0),e.push(t.i/i|0),e.push(b.i/i|0),Od(t),t=b.next,w=b.next;else if((t=b)===w){p?p===1?Rd(t=dA(yc(t),e,i),e,i,s,c,h,2):p===2&&fA(t,e,i,s,c,h):Rd(yc(t),e,i,s,c,h,1);break}}}function uA(t){var e=t.prev,i=t,s=t.next;if(lr(e,i,s)>=0)return!1;for(var c=e.x,h=i.x,p=s.x,y=e.y,b=i.y,w=s.y,S=c<h?c<p?c:p:h<p?h:p,I=y<b?y<w?y:w:b<w?b:w,P=c>h?c>p?c:p:h>p?h:p,R=y>b?y>w?y:w:b>w?b:w,O=s.next;O!==e;){if(O.x>=S&&O.x<=P&&O.y>=I&&O.y<=R&&Au(c,y,h,b,p,w,O.x,O.y)&&lr(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function hA(t,e,i,s){var c=t.prev,h=t,p=t.next;if(lr(c,h,p)>=0)return!1;for(var y=c.x,b=h.x,w=p.x,S=c.y,I=h.y,P=p.y,R=y<b?y<w?y:w:b<w?b:w,O=S<I?S<P?S:P:I<P?I:P,F=y>b?y>w?y:w:b>w?b:w,U=S>I?S>P?S:P:I>P?I:P,$=jg(R,O,e,i,s),J=jg(F,U,e,i,s),te=t.prevZ,ee=t.nextZ;te&&te.z>=$&&ee&&ee.z<=J;){if(te.x>=R&&te.x<=F&&te.y>=O&&te.y<=U&&te!==c&&te!==p&&Au(y,S,b,I,w,P,te.x,te.y)&&lr(te.prev,te,te.next)>=0||(te=te.prevZ,ee.x>=R&&ee.x<=F&&ee.y>=O&&ee.y<=U&&ee!==c&&ee!==p&&Au(y,S,b,I,w,P,ee.x,ee.y)&&lr(ee.prev,ee,ee.next)>=0))return!1;ee=ee.nextZ}for(;te&&te.z>=$;){if(te.x>=R&&te.x<=F&&te.y>=O&&te.y<=U&&te!==c&&te!==p&&Au(y,S,b,I,w,P,te.x,te.y)&&lr(te.prev,te,te.next)>=0)return!1;te=te.prevZ}for(;ee&&ee.z<=J;){if(ee.x>=R&&ee.x<=F&&ee.y>=O&&ee.y<=U&&ee!==c&&ee!==p&&Au(y,S,b,I,w,P,ee.x,ee.y)&&lr(ee.prev,ee,ee.next)>=0)return!1;ee=ee.nextZ}return!0}function dA(t,e,i){var s=t;do{var c=s.prev,h=s.next.next;!Qp(c,h)&&Jv(c,s,s.next,h)&&zd(c,h)&&zd(h,c)&&(e.push(c.i/i|0),e.push(s.i/i|0),e.push(h.i/i|0),Od(s),Od(s.next),s=t=h),s=s.next}while(s!==t);return yc(s)}function fA(t,e,i,s,c,h){var p=t;do{for(var y=p.next.next;y!==p.prev;){if(p.i!==y.i&&yA(p,y)){var b=Qv(p,y);return p=yc(p,p.next),b=yc(b,b.next),Rd(p,e,i,s,c,h,0),void Rd(b,e,i,s,c,h,0)}y=y.next}p=p.next}while(p!==t)}function pA(t,e){return t.x-e.x}function mA(t,e){var i=function(c,h){var p,y=h,b=c.x,w=c.y,S=-1/0;do{if(w<=y.y&&w>=y.next.y&&y.next.y!==y.y){var I=y.x+(w-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(I<=b&&I>S&&(S=I,p=y.x<y.next.x?y:y.next,I===b))return p}y=y.next}while(y!==h);if(!p)return null;var P,R=p,O=p.x,F=p.y,U=1/0;y=p;do b>=y.x&&y.x>=O&&b!==y.x&&Au(w<F?b:S,w,O,F,w<F?S:b,w,y.x,y.y)&&(P=Math.abs(w-y.y)/(b-y.x),zd(y,c)&&(P<U||P===U&&(y.x>p.x||y.x===p.x&&_A(p,y)))&&(p=y,U=P)),y=y.next;while(y!==R);return p}(t,e);if(!i)return e;var s=Qv(i,t);return yc(s,s.next),yc(i,i.next)}function _A(t,e){return lr(t.prev,t,e.prev)<0&&lr(e.next,t,t.next)<0}function jg(t,e,i,s,c){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function gA(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function Au(t,e,i,s,c,h,p,y){return(c-p)*(e-y)>=(t-p)*(h-y)&&(t-p)*(s-y)>=(i-p)*(e-y)&&(i-p)*(h-y)>=(c-p)*(s-y)}function yA(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(i,s){var c=i;do{if(c.i!==i.i&&c.next.i!==i.i&&c.i!==s.i&&c.next.i!==s.i&&Jv(c,c.next,i,s))return!0;c=c.next}while(c!==i);return!1}(t,e)&&(zd(t,e)&&zd(e,t)&&function(i,s){var c=i,h=!1,p=(i.x+s.x)/2,y=(i.y+s.y)/2;do c.y>y!=c.next.y>y&&c.next.y!==c.y&&p<(c.next.x-c.x)*(y-c.y)/(c.next.y-c.y)+c.x&&(h=!h),c=c.next;while(c!==i);return h}(t,e)&&(lr(t.prev,t,e.prev)||lr(t,e.prev,e))||Qp(t,e)&&lr(t.prev,t,t.next)>0&&lr(e.prev,e,e.next)>0)}function lr(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function Qp(t,e){return t.x===e.x&&t.y===e.y}function Jv(t,e,i,s){var c=tm(lr(t,e,i)),h=tm(lr(t,e,s)),p=tm(lr(i,s,t)),y=tm(lr(i,s,e));return c!==h&&p!==y||!(c!==0||!em(t,i,e))||!(h!==0||!em(t,s,e))||!(p!==0||!em(i,t,s))||!(y!==0||!em(i,e,s))}function em(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function tm(t){return t>0?1:t<0?-1:0}function zd(t,e){return lr(t.prev,t,t.next)<0?lr(t,e,t.next)>=0&&lr(t,t.prev,e)>=0:lr(t,e,t.prev)<0||lr(t,t.next,e)<0}function Qv(t,e){var i=new Gg(t.i,t.x,t.y),s=new Gg(e.i,e.x,e.y),c=t.next,h=e.prev;return t.next=e,e.prev=t,i.next=c,c.prev=i,s.next=i,i.prev=s,h.next=s,s.prev=h,s}function eb(t,e,i,s){var c=new Gg(t,e,i);return s?(c.next=s.next,c.prev=s,s.next.prev=c,s.next=c):(c.prev=c,c.next=c),c}function Od(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Gg(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function $g(t,e,i,s){for(var c=0,h=e,p=i-s;h<i;h+=s)c+=(t[p]-t[h])*(t[h+1]+t[p+1]),p=h;return c}Ug.exports=Jp,Ug.exports.default=Jp,Jp.deviation=function(t,e,i,s){var c=e&&e.length,h=Math.abs($g(t,0,c?e[0]*i:t.length,i));if(c)for(var p=0,y=e.length;p<y;p++)h-=Math.abs($g(t,e[p]*i,p<y-1?e[p+1]*i:t.length,i));var b=0;for(p=0;p<s.length;p+=3){var w=s[p]*i,S=s[p+1]*i,I=s[p+2]*i;b+=Math.abs((t[w]-t[I])*(t[S+1]-t[w+1])-(t[w]-t[S])*(t[I+1]-t[w+1]))}return h===0&&b===0?0:Math.abs((b-h)/h)},Jp.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},s=0,c=0;c<t.length;c++){for(var h=0;h<t[c].length;h++)for(var p=0;p<e;p++)i.vertices.push(t[c][h][p]);c>0&&i.holes.push(s+=t[c-1].length)}return i};var im=tt(Ug.exports);function Wg(t,e){const i=t.length;if(i<=1)return[t];const s=[];let c,h;for(let p=0;p<i;p++){const y=nt(t[p]);y!==0&&(t[p].area=Math.abs(y),h===void 0&&(h=y<0),h===y<0?(c&&s.push(c),c=[t[p]]):c.push(t[p]))}if(c&&s.push(c),e>1)for(let p=0;p<s.length;p++)s[p].length<=e||(q_(s[p],e,1,s[p].length-1,xA),s[p]=s[p].slice(0,e));return s}function xA(t,e){return e.area-t.area}function Hg(t,e,i){const s=i.patternDependencies;let c=!1;for(const h of e){const p=h.paint.get(`${t}-pattern`);p.isConstant()||(c=!0);const y=p.constantOr(null);y&&(c=!0,s[y]=!0)}return c}function qg(t,e,i,s,c){const h=c.patternDependencies;for(const p of e){const y=p.paint.get(`${t}-pattern`).value;if(y.kind!=="constant"){let b=y.evaluate({zoom:s},i,{},c.availableImages);b=b&&b.name?b.name:b,h[b]=!0,i.patterns[p.id]=b}}return i}class Zg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Es,this.indexArray=new hr,this.indexArray2=new Fs,this.programConfigurations=new H(e.layers,e.zoom),this.segments=new $n,this.segments2=new $n,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,s,c){this.hasPattern=Hg("fill",this.layers,i);const h=this.layers[0].layout.get("fill-sort-key"),p=[];for(const{feature:y,id:b,index:w,sourceLayerIndex:S}of e){const I=this.layers[0]._featureFilter.needGeometry,P=sr(y,I);if(!this.layers[0]._featureFilter.filter(new On(this.zoom),P,s))continue;const R=h?h.evaluate(P,{},s,i.availableImages):void 0,O={id:b,properties:y.properties,type:y.type,sourceLayerIndex:S,index:w,geometry:I?P.geometry:fr(y,s,c),patterns:{},sortKey:R};p.push(O)}h&&p.sort((y,b)=>y.sortKey-b.sortKey);for(const y of p){const{geometry:b,index:w,sourceLayerIndex:S}=y;if(this.hasPattern){const I=qg("fill",this.layers,y,this.zoom,i);this.patternFeatures.push(I)}else this.addFeature(y,b,w,s,{},i.availableImages,i.brightness);i.featureIndex.insert(e[w].feature,b,w,S,this.index)}}update(e,i,s,c,h){const p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,p?this.stateDependentLayers:this.layers,s,c,h)}addFeatures(e,i,s,c,h,p){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,i,s,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,cA),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,s,c,h,p=[],y){for(const b of Wg(i,500)){let w=0;for(const F of b)w+=F.length;const S=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),I=S.vertexLength,P=[],R=[];for(const F of b){if(F.length===0)continue;F!==b[0]&&R.push(P.length/2);const U=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),$=U.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack($+F.length-1,$),P.push(F[0].x),P.push(F[0].y);for(let J=1;J<F.length;J++)this.layoutVertexArray.emplaceBack(F[J].x,F[J].y),this.indexArray2.emplaceBack($+J-1,$+J),P.push(F[J].x),P.push(F[J].y);U.vertexLength+=F.length,U.primitiveLength+=F.length}const O=im(P,R);for(let F=0;F<O.length;F+=3)this.indexArray.emplaceBack(I+O[F],I+O[F+1],I+O[F+2]);S.vertexLength+=w,S.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,p,c,y)}}Bt(Zg,"FillBucket",{omit:["layers","patternFeatures"]});const vA=new Fn({"fill-sort-key":new ti(Ie.layout_fill["fill-sort-key"]),visibility:new gt(Ie.layout_fill.visibility)});var bA={paint:new Fn({"fill-antialias":new gt(Ie.paint_fill["fill-antialias"]),"fill-opacity":new ti(Ie.paint_fill["fill-opacity"]),"fill-color":new ti(Ie.paint_fill["fill-color"]),"fill-outline-color":new ti(Ie.paint_fill["fill-outline-color"]),"fill-translate":new gt(Ie.paint_fill["fill-translate"]),"fill-translate-anchor":new gt(Ie.paint_fill["fill-translate-anchor"]),"fill-pattern":new ti(Ie.paint_fill["fill-pattern"]),"fill-emissive-strength":new gt(Ie.paint_fill["fill-emissive-strength"])}),layout:vA};const wA=rn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),TA=rn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),MA=rn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),SA=rn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),EA=rn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:AA}=wA;var nm={},IA=dt,tb=Iu;function Iu(t,e,i,s,c){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=s,this._values=c,t.readFields(CA,this,e)}function CA(t,e,i){t==1?e.id=i.readVarint():t==2?function(s,c){for(var h=s.readVarint()+s.pos;s.pos<h;){var p=c._keys[s.readVarint()],y=c._values[s.readVarint()];c.properties[p]=y}}(i,e):t==3?e.type=i.readVarint():t==4&&(e._geometry=i.pos)}function PA(t){for(var e,i,s=0,c=0,h=t.length,p=h-1;c<h;p=c++)s+=((i=t[p]).x-(e=t[c]).x)*(e.y+i.y);return s}Iu.types=["Unknown","Point","LineString","Polygon"],Iu.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,s=1,c=0,h=0,p=0,y=[];t.pos<i;){if(c<=0){var b=t.readVarint();s=7&b,c=b>>3}if(c--,s===1||s===2)h+=t.readSVarint(),p+=t.readSVarint(),s===1&&(e&&y.push(e),e=[]),e.push(new IA(h,p));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&y.push(e),y},Iu.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,s=0,c=0,h=0,p=1/0,y=-1/0,b=1/0,w=-1/0;t.pos<e;){if(s<=0){var S=t.readVarint();i=7&S,s=S>>3}if(s--,i===1||i===2)(c+=t.readSVarint())<p&&(p=c),c>y&&(y=c),(h+=t.readSVarint())<b&&(b=h),h>w&&(w=h);else if(i!==7)throw new Error("unknown command "+i)}return[p,b,y,w]},Iu.prototype.toGeoJSON=function(t,e,i){var s,c,h=this.extent*Math.pow(2,i),p=this.extent*t,y=this.extent*e,b=this.loadGeometry(),w=Iu.types[this.type];function S(R){for(var O=0;O<R.length;O++){var F=R[O];R[O]=[360*(F.x+p)/h-180,360/Math.PI*Math.atan(Math.exp((180-360*(F.y+y)/h)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(s=0;s<b.length;s++)I[s]=b[s][0];S(b=I);break;case 2:for(s=0;s<b.length;s++)S(b[s]);break;case 3:for(b=function(R){var O=R.length;if(O<=1)return[R];for(var F,U,$=[],J=0;J<O;J++){var te=PA(R[J]);te!==0&&(U===void 0&&(U=te<0),U===te<0?(F&&$.push(F),F=[R[J]]):F.push(R[J]))}return F&&$.push(F),$}(b),s=0;s<b.length;s++)for(c=0;c<b[s].length;c++)S(b[s][c])}b.length===1?b=b[0]:w="Multi"+w;var P={type:"Feature",geometry:{type:w,coordinates:b},properties:this.properties};return"id"in this&&(P.id=this.id),P};var DA=tb,ib=nb;function nb(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(LA,this,e),this.length=this._features.length}function LA(t,e,i){t===15?e.version=i.readVarint():t===1?e.name=i.readString():t===5?e.extent=i.readVarint():t===2?e._features.push(i.pos):t===3?e._keys.push(i.readString()):t===4&&e._values.push(function(s){for(var c=null,h=s.readVarint()+s.pos;s.pos<h;){var p=s.readVarint()>>3;c=p===1?s.readString():p===2?s.readFloat():p===3?s.readDouble():p===4?s.readVarint64():p===5?s.readVarint():p===6?s.readSVarint():p===7?s.readBoolean():null}return c}(i))}nb.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new DA(this._pbf,e,this.extent,this._keys,this._values)};var kA=ib;function RA(t,e,i){if(t===3){var s=new kA(i,i.readVarint()+i.pos);s.length&&(e[s.name]=s)}}var Xg=nm.VectorTile=function(t,e){this.layers=t.readFields(RA,{},e)},rm=nm.VectorTileFeature=tb;function sm(t,e,i,s){const c=[],h=s===0?(p,y,b,w,S,I)=>{p.push(new le(I,b+(I-y)/(w-y)*(S-b)))}:(p,y,b,w,S,I)=>{p.push(new le(y+(I-b)/(S-b)*(w-y),I))};for(const p of t){const y=[];for(const b of p){if(b.length<=2)continue;const w=[];for(let P=0;P<b.length-1;P++){const R=b[P].x,O=b[P].y,F=b[P+1].x,U=b[P+1].y,$=s===0?R:O,J=s===0?F:U;$<e?J>e&&h(w,R,O,F,U,e):$>i?J<i&&h(w,R,O,F,U,i):w.push(b[P]),J<e&&$>=e&&h(w,R,O,F,U,e),J>i&&$<=i&&h(w,R,O,F,U,i)}let S=b[b.length-1];const I=s===0?S.x:S.y;I>=e&&I<=i&&w.push(S),w.length&&(S=w[w.length-1],w[0].x===S.x&&w[0].y===S.y||w.push(w[0]),y.push(w))}y.length&&c.push(y)}return c}function om(t,e){return t.x-e.x||t.y-e.y}function rb(t,e){return om(t.min,e.min)===0&&om(t.max,e.max)===0}function sb(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function ob(t,e,i){const s=1/Pt,c=1/(1<<i.canonical.z),h=(e.x*s+i.canonical.x)*c+i.wrap,p=(e.y*s+i.canonical.y)*c;return{min:new le((t.x*s+i.canonical.x)*c+i.wrap,(t.y*s+i.canonical.y)*c),max:new le(h,p)}}function zA(t,e,i){const s=1<<i.canonical.z,c=((e.x-i.wrap)*s-i.canonical.x)*Pt,h=(e.y*s-i.canonical.y)*Pt;return{min:new le(((t.x-i.wrap)*s-i.canonical.x)*Pt,(t.y*s-i.canonical.y)*Pt),max:new le(c,h)}}function ab(t,e,i,s,c,h,p){const y=t.indices,b=t.vertices,w=[];for(let S=s;S<s+c;S+=3){const I=e[i[S+0]+h],P=e[i[S+1]+h],R=e[i[S+2]+h],O=Math.min(I.x,P.x,R.x),F=Math.max(I.x,P.x,R.x),U=Math.min(I.y,P.y,R.y),$=Math.max(I.y,P.y,R.y);w.length=0,t.grid.query(new le(O,U),new le(F,$),w);for(let J=0;J<w.length;J++){const te=w[J];if(_g(b[y[3*te+0]],b[y[3*te+1]],b[y[3*te+2]],I,P,R,p))return!0}}return!1}function lb(t,e,i,s){if(!t||!i)return!1;let c=t.vertices;if(!e.canonical.equals(s.canonical)||e.wrap!==s.wrap){if(i.vertices.length<t.vertices.length)return lb(i,s,t,e);const h=e.canonical,p=s.canonical,y=Math.pow(2,p.z-h.z);c=t.vertices.map(b=>new le(b.x*h.x*Pt*y-p.x*Pt,b.y*h.y*Pt*y-p.y*Pt))}return ab(i,c,t.indices,0,t.indices.length,0,0)}nm.VectorTileLayer=ib;class cb{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const s=this.toIdx(e,i);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function ub(t,e,i,s){let c=0,h=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(s[p])<1e-15){if(i[p]<t[p]||i[p]>e[p])return null}else{const y=1/s[p];let b=(t[p]-i[p])*y,w=(e[p]-i[p])*y;if(b>w){const S=b;b=w,w=S}if(b>c&&(c=b),w<h&&(h=w),c>h)return null}return c}function hb(t,e,i,s,c,h,p,y,b,w,S){const I=s-t,P=c-e,R=h-i,O=p-t,F=y-e,U=b-i,$=S[1]*U-S[2]*F,J=S[2]*O-S[0]*U,te=S[0]*F-S[1]*O,ee=I*$+P*J+R*te;if(Math.abs(ee)<1e-15)return null;const ce=1/ee,ae=w[0]-t,fe=w[1]-e,ve=w[2]-i,Se=(ae*$+fe*J+ve*te)*ce;if(Se<0||Se>1)return null;const De=fe*R-ve*P,Ee=ve*I-ae*R,Ue=ae*P-fe*I,Ye=(S[0]*De+S[1]*Ee+S[2]*Ue)*ce;return Ye<0||Se+Ye>1?null:(O*De+F*Ee+U*Ue)*ce}function db(t,e,i){return(t-e)/(i-e)}function fb(t,e,i,s,c,h,p,y,b){const w=1<<i,S=h-s,I=p-c,P=(t+1)/w*S+s,R=(e+0)/w*I+c,O=(e+1)/w*I+c;y[0]=(t+0)/w*S+s,y[1]=R,b[0]=P,b[1]=O}class pb{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(h){const p=Math.ceil(Math.log2(h.dim/8)),y=[];let b=Math.ceil(Math.pow(2,p));const w=1/b,S=(R,O,F,U,$)=>{const J=U?1:0,te=(R+1)*F-J,ee=O*F,ce=(O+1)*F-J;$[0]=R*F,$[1]=ee,$[2]=te,$[3]=ce};let I=new cb(b);const P=[];for(let R=0;R<b*b;R++){S(R%b,Math.floor(R/b),w,!1,P);const O=tl(P[0],P[1],h),F=tl(P[2],P[1],h),U=tl(P[2],P[3],h),$=tl(P[0],P[3],h);I.minimums.push(Math.min(O,F,U,$)),I.maximums.push(Math.max(O,F,U,$)),I.leaves.push(1)}for(y.push(I),b/=2;b>=1;b/=2){const R=y[y.length-1];I=new cb(b);for(let O=0;O<b*b;O++){S(O%b,Math.floor(O/b),2,!0,P);const F=R.getElevation(P[0],P[1]),U=R.getElevation(P[2],P[1]),$=R.getElevation(P[2],P[3]),J=R.getElevation(P[0],P[3]),te=R.isLeaf(P[0],P[1]),ee=R.isLeaf(P[2],P[1]),ce=R.isLeaf(P[2],P[3]),ae=R.isLeaf(P[0],P[3]),fe=Math.min(F.min,U.min,$.min,J.min),ve=Math.max(F.max,U.max,$.max,J.max),Se=te&&ee&&ce&&ae;I.maximums.push(ve),I.minimums.push(fe),I.leaves.push(ve-fe<=5&&Se?1:0)}y.push(I)}return y}(this.dem),s=i.length-1,c=i[s];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(i,0,0,s,0)}raycastRoot(e,i,s,c,h,p,y=1){return ub([e,i,-100],[s,c,this.maximums[0]*y],h,p)}raycast(e,i,s,c,h,p,y=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,i,s,c,h,p,y);if(b==null)return null;const w=[],S=[],I=[],P=[],R=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;R.length>0;){const{idx:O,t:F,nodex:U,nodey:$,depth:J}=R.pop();if(this.leaves[O]){fb(U,$,J,e,i,s,c,I,P);const ee=1<<J,ce=(U+0)/ee,ae=(U+1)/ee,fe=($+0)/ee,ve=($+1)/ee,Se=tl(ce,fe,this.dem)*y,De=tl(ae,fe,this.dem)*y,Ee=tl(ae,ve,this.dem)*y,Ue=tl(ce,ve,this.dem)*y,Ye=hb(I[0],I[1],Se,P[0],I[1],De,P[0],P[1],Ee,h,p),Fe=hb(P[0],P[1],Ee,I[0],P[1],Ue,I[0],I[1],Se,h,p),Ze=Math.min(Ye!==null?Ye:Number.MAX_VALUE,Fe!==null?Fe:Number.MAX_VALUE);if(Ze!==Number.MAX_VALUE)return Ze;{const ze=r.N.scaleAndAdd([],h,p,F);if(mb(Se,De,Ue,Ee,db(ze[0],I[0],P[0]),db(ze[1],I[1],P[1]))>=ze[2])return F}continue}let te=0;for(let ee=0;ee<this._siblingOffset.length;ee++){fb((U<<1)+this._siblingOffset[ee][0],($<<1)+this._siblingOffset[ee][1],J+1,e,i,s,c,I,P),I[2]=-100,P[2]=this.maximums[this.childOffsets[O]+ee]*y;const ce=ub(I,P,h,p);if(ce!=null){const ae=ce;w[ee]=ae;let fe=!1;for(let ve=0;ve<te&&!fe;ve++)ae>=w[S[ve]]&&(S.splice(ve,0,ee),fe=!0);fe||(S[te]=ee),te++}}for(let ee=0;ee<te;ee++){const ce=S[ee];R.push({idx:this.childOffsets[O]+ce,t:w[ce],nodex:(U<<1)+this._siblingOffset[ce][0],nodey:($<<1)+this._siblingOffset[ce][1],depth:J+1})}}return null}_addNode(e,i,s){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,s,c,h){if(e[c].isLeaf(i,s)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);const p=c-1,y=e[p];let b=0,w=0;for(let S=0;S<this._siblingOffset.length;S++){const I=2*i+this._siblingOffset[S][0],P=2*s+this._siblingOffset[S][1],R=y.getElevation(I,P),O=y.isLeaf(I,P),F=this._addNode(R.min,R.max,O);O&&(b|=1<<S),w||(w=F)}for(let S=0;S<this._siblingOffset.length;S++)b&1<<S||this._construct(e,2*i+this._siblingOffset[S][0],2*s+this._siblingOffset[S][1],p,w+S)}}function mb(t,e,i,s,c,h){return Ri(Ri(t,i,h),Ri(e,s,h),c)}function tl(t,e,i){const s=i.dim,c=wt(t*s-.5,0,s-1),h=wt(e*s-.5,0,s-1),p=Math.floor(c),y=Math.floor(h),b=Math.min(p+1,s-1),w=Math.min(y+1,s-1);return mb(i.get(p,y),i.get(b,y),i.get(p,w),i.get(b,w),c-p,h-y)}const OA={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function FA(t,e,i){return(256*t*256+256*e+i)/10-1e4}function BA(t,e,i){return 256*t+e+i/256-32768}class am{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,s,c=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return we(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const h=this.dim=i.height-2,p=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=c,this._modifiedForSources={},!c){for(let b=0;b<h;b++)p[this._idx(-1,b)]=p[this._idx(0,b)],p[this._idx(h,b)]=p[this._idx(h-1,b)],p[this._idx(b,-1)]=p[this._idx(b,0)],p[this._idx(b,h)]=p[this._idx(b,h-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(h,-1)]=p[this._idx(h-1,0)],p[this._idx(-1,h)]=p[this._idx(0,h-1)],p[this._idx(h,h)]=p[this._idx(h-1,h-1)]}const y=s==="terrarium"?BA:FA;for(let b=0;b<p.length;++b){const w=4*b;this.floatView[b]=y(this.pixels[w],this.pixels[w+1],this.pixels[w+2])}this._timestamp=Xe.now()}_buildQuadTree(){this._tree=new pb(this)}get(e,i,s=!1){s&&(e=wt(e,-1,this.dim),i=wt(i,-1,this.dim));const c=this._idx(e,i);return this.floatView[c]}set(e,i,s){const c=this._idx(e,i),h=this.floatView[c];return this.floatView[c]=s,s-h}static getUnpackVector(e){return OA[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const s=[0,0,0,0],c=am.getUnpackVector(i);let h=Math.floor((e+c[3])/c[2]);return s[2]=h%256,h=Math.floor(h/256),s[1]=h%256,h=Math.floor(h/256),s[0]=h,s}getPixels(){return new Yv({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=i*this.dim,h=i*this.dim+this.dim,p=s*this.dim,y=s*this.dim+this.dim;switch(i){case-1:c=h-1;break;case 1:h=c+1}switch(s){case-1:p=y-1;break;case 1:y=p+1}const b=-i*this.dim,w=-s*this.dim;for(let S=p;S<y;S++)for(let I=c;I<h;I++){const P=4*this._idx(I,S),R=4*this._idx(I+b,S+w);this.pixels[P+0]=e.pixels[R+0],this.pixels[P+1]=e.pixels[R+1],this.pixels[P+2]=e.pixels[R+2],this.pixels[P+3]=e.pixels[R+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Bt(am,"DEMData"),Bt(pb,"DemMinMaxQuadTree",{omit:["dem"]});class Cu{constructor(e,i,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=s}static create(e,i,s){const c=s||e.findDEMTileFor(i);if(!c||!c.dem)return;const h=c.dem,p=c.tileID,y=1<<i.canonical.z-p.canonical.z;return new Cu(c,h.dim/Pt/y,[(i.canonical.x/y-p.canonical.x)*h.dim,(i.canonical.y/y-p.canonical.y)*h.dim])}tileCoordToPixel(e,i){const s=i*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),h=Math.floor(s);return new le(c,h)}getElevationAt(e,i,s,c){const h=e*this._scale+this._offset[0],p=i*this._scale+this._offset[1],y=Math.floor(h),b=Math.floor(p),w=this._dem;return c=!!c,s?Ri(Ri(w.get(y,b,c),w.get(y,b+1,c),p-b),Ri(w.get(y+1,b,c),w.get(y+1,b+1,c),p-b),h-y):w.get(y,b,c)}getElevationAtPixel(e,i,s){return this._dem.get(e,i,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*mi(1,e)*this._dem.stride}}const NA=rm.types,VA=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],UA=["fill-extrusion-flood-light-ground-radius"],jA=Math.pow(2,13),GA=Math.pow(2,15)-1,_b=new le(0,1),il=2147483648;function Fd(t,e,i,s,c,h,p,y){t.emplaceBack((e<<1)+p,(i<<1)+h,(Math.floor(s*jA)<<1)+c,Math.round(y))}function lm(t,e,i,s,c,h){t.emplaceBack(e.x,e.y,(i.x<<1)+s,(i.y<<1)+c,h)}function Bd(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class gb{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class yb{constructor(){this.centroidXY=new le(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new le(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new le(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new le(this.max.x-this.min.x,this.max.y-this.min.y)}}class xb{constructor(){this.acc=new le(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,s){this.accCount++,this.acc._add(i);let c=!!this.borders;i.x<e.min.x?(e.min.x=i.x,c=!0):i.x>e.max.x&&(e.max.x=i.x,c=!0),i.y<e.min.y?(e.min.y=i.y,c=!0):i.y>e.max.y&&(e.max.y=i.y,c=!0),((i.x===0||i.x===Pt)&&i.x===s.x)!=((i.y===0||i.y===Pt)&&i.y===s.y)&&this.processBorderOverlap(i,s),c&&this.checkBorderIntersection(i,s)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Ri(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>Pt!=e.x>Pt&&this.addBorderIntersection(1,Ri(i.y,e.y,(Pt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Ri(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>Pt!=e.y>Pt&&this.addBorderIntersection(3,Ri(i.x,e.x,(Pt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];i<s[0]&&(s[0]=i),i>s[1]&&(s[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const s=e.x===0?0:1;this.addBorderIntersection(s,i.y),this.addBorderIntersection(s,e.y)}else{const s=e.y===0?2:3;this.addBorderIntersection(s,i.x),this.addBorderIntersection(s,e.x)}}centroid(){return this.accCount===0?new le(0,0):new le(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function vb(t,e){const i=t.add(e)._unit(),s=wt(t.x*i.x+t.y*i.y,-1,1);var c,h,p;return c=Math.acos(s),Math.min(4,Math.max(-4,Math.tan(c)))/4*GA*((h=t).x*(p=e).y-h.y*p.x<0?-1:1)}const $A=[t=>t.x<0,t=>t.x>Pt,t=>t.y<0,t=>t.y>Pt];function WA(t,e,i,s){const c=[4];if(s===0)return c;i._mult(s);const h=t.sub(i),p=e.sub(i),y=[t,e,h,p];for(let b=0;b<4;b++)for(const w of y)if($A[b](w)){c.push(b);break}return c}class bb{constructor(e){this.vertexArray=new _d,this.indexArray=new hr,this.programConfigurations=new H(e.layers,e.zoom,i=>UA.includes(i)),this._segments=new $n,this.hiddenByLandmarkVertexArray=new Sd,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new $n}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,s,c=!1){const h=e.length;if(h>2){let p=Math.max(0,this._segments.get().length-1);const y=this._segments._prepareSegment(4*h,this.vertexArray.length,2*this._segmentToGroundQuads[p].length);let b;p!==this._segments.get().length-1&&(p++,this._segmentToGroundQuads[p]=[],this._segmentToRegionTriCounts[p]=[0,0,0,0,0]);{const w=e[0],S=e[1];b=vb(w.sub(e[h-1])._perp()._unit(),S.sub(w)._perp()._unit())}for(let w=0;w<h;w++){const S=w===h-1?0:w+1,I=e[w],P=e[S],R=e[S===h-1?0:S+1],O=P.sub(I)._perp()._unit(),F=vb(O,R.sub(P)._perp()._unit()),U=b,$=F;if(Yg(I,P,i)||c&&Mb(I,i)&&Mb(P,i)){b=F;continue}const J=y.vertexLength;lm(this.vertexArray,I,P,1,1,U),lm(this.vertexArray,I,P,1,0,U),lm(this.vertexArray,I,P,0,1,$),lm(this.vertexArray,I,P,0,0,$),y.vertexLength+=4;const te=WA(I,P,O,s);for(const ee of te)this._segmentToGroundQuads[p].push({id:J,region:ee}),this._segmentToRegionTriCounts[p][ee]+=2,y.primitiveLength+=2;b=F}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let s=0;s<i;s++)this._segmentToGroundQuads[s].sort((c,h)=>c.region-h.region);for(let s=0;s<i;s++){const c=this._segmentToGroundQuads[s],h=e[s],p=this._segmentToRegionTriCounts[s];p.reduce((b,w)=>b+w,0);let y=0;for(let b=0;b<=4;b++){const w=p[b];if(w!==0){let S=this.regionSegments[b];S||(S=this.regionSegments[b]=new $n);const I={vertexOffset:h.vertexOffset,primitiveOffset:h.primitiveOffset+y,vertexLength:h.vertexLength,primitiveLength:w};S.get().push(I)}y+=w}for(let b=0;b<c.length;b++){const w=c[b].id;this.indexArray.emplaceBack(w,w+1,w+3),this.indexArray.emplaceBack(w,w+3,w+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,s,c,h,p){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,s,c,h,p)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,TA.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,s,c,h,p){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,s,c,h,p)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const s=e.flags&il?1:0;for(let c=e.groundVertexArrayOffset;c<i;++c)this.hiddenByLandmarkVertexArray.emplace(c,s);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,SA.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class cm{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new hr,this.footprintVertices=new Es,this.footprintSegments=[],this.layoutVertexArray=new Xs,this.centroidVertexArray=new uc,this.indexArray=new hr,this.programConfigurations=new H(e.layers,e.zoom,i=>VA.includes(i)),this.segments=new $n,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new bb(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,i,s,c){this.features=[],this.hasPattern=Hg("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Di(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:h,id:p,index:y,sourceLayerIndex:b}of e){const w=this.layers[0]._featureFilter.needGeometry,S=sr(h,w);if(!this.layers[0]._featureFilter.filter(new On(this.zoom),S,s))continue;const I={id:p,sourceLayerIndex:b,index:y,geometry:w?S.geometry:fr(h,s,c),properties:h.properties,type:h.type,patterns:{}},P=this.layoutVertexArray.length;this.hasPattern?this.features.push(qg("fill-extrusion",this.layers,I,this.zoom,i)):this.addFeature(I,I.geometry,y,s,{},i.availableImages,c,i.brightness),i.featureIndex.insert(h,I.geometry,y,b,this.index,P)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,s,c,h,p){for(const y of this.features){const{geometry:b}=y;this.addFeature(y,b,y.index,i,s,c,h,p)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,s,c,h){const p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;const y=p?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,i,y,s,c,h),this.groundEffect.update(e,i,y,s,c,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,AA),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,EA.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,MA.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,s,c,h,p,y,b){const w=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,S=[new le(0,0),new le(Pt,Pt)],I=y.projection,P=I.name==="globe",R=NA[e.type]==="Polygon",O=new xb;O.centroidDataIndex=this.centroidData.length;const F=new yb,U=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},c)<=0,$=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},c);F.height=$,F.vertexArrayOffset=this.layoutVertexArray.length,F.groundVertexArrayOffset=this.groundEffect.vertexArray.length,P&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new yu);const J=Wg(i,500);for(let ve=J.length-1;ve>=0;ve--){const Se=J[ve];(Se.length===0||(te=Se[0]).every(De=>De.x<=0)||te.every(De=>De.x>=Pt)||te.every(De=>De.y<=0)||te.every(De=>De.y>=Pt))&&J.splice(ve,1)}var te;let ee;if(P)ee=Ib(J,S,c);else{ee=[];for(const ve of J)ee.push({polygon:ve,bounds:S})}const ce=R?this.edgeRadius:0,ae=ce>0&&this.zoom<17,fe=(ve,Se)=>{if(ve.length===0)return!1;const De=ve[ve.length-1];return Se.x===De.x&&Se.y===De.y};for(const{polygon:ve,bounds:Se}of ee){let De=0,Ee=0;for(const Ze of ve)R&&!Ze[0].equals(Ze[Ze.length-1])&&Ze.push(Ze[0]),Ee+=R?Ze.length-1:Ze.length;const Ue=this.segments.prepareSegment((R?5:4)*Ee,this.layoutVertexArray,this.indexArray);F.footprintSegIdx<0&&(F.footprintSegIdx=this.footprintSegments.length),F.polygonSegIdx<0&&(F.polygonSegIdx=this.polygonSegments.length);const Ye={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Fe=new gb;if(Fe.vertexOffset=this.footprintVertices.length,Fe.indexOffset=3*this.footprintIndices.length,Fe.ringIndices=[],R){const Ze=[],ze=[];De=Ue.vertexLength;for(let vt=0;vt<ve.length;vt++){const Ke=ve[vt];Ke.length&&vt!==0&&ze.push(Ze.length/2);const jt=[];let Lt,rt;Lt=Ke[1].sub(Ke[0])._perp()._unit(),Fe.ringIndices.push(Ke.length-1);for(let oi=1;oi<Ke.length;oi++){const Xt=Ke[oi],Ut=Ke[oi===Ke.length-1?1:oi+1],st=Xt.clone();if(ce){rt=Ut.sub(Xt)._perp()._unit();const ii=Lt.add(rt)._unit(),Mi=ce*Math.min(4,1/(Lt.x*ii.x+Lt.y*ii.y));st.x+=Mi*ii.x,st.y+=Mi*ii.y,st.x=Math.round(st.x),st.y=Math.round(st.y),Lt=rt}!U||ce!==0&&!ae||fe(jt,st)||jt.push(st),Fd(this.layoutVertexArray,st.x,st.y,0,0,1,1,0),Ue.vertexLength++,this.footprintVertices.emplaceBack(Xt.x,Xt.y),Ze.push(Xt.x,Xt.y),P&&Bd(this.layoutVertexExtArray,I.projectTilePoint(st.x,st.y,c),I.upVector(c,st.x,st.y))}U&&(ce===0||ae)&&(jt.length!==0&&fe(jt,jt[0])&&jt.pop(),this.groundEffect.addData(jt,Se,w))}const He=im(Ze,ze);for(let vt=0;vt<He.length;vt+=3)this.footprintIndices.emplaceBack(Fe.vertexOffset+He[vt+0],Fe.vertexOffset+He[vt+1],Fe.vertexOffset+He[vt+2]),this.indexArray.emplaceBack(De+He[vt],De+He[vt+2],De+He[vt+1]),Ue.primitiveLength++;Fe.indexCount+=He.length,Fe.vertexCount+=this.footprintVertices.length-Fe.vertexOffset}for(let Ze=0;Ze<ve.length;Ze++){const ze=ve[Ze];O.startRing(F,ze[0]);let He=ze.length>4&&Sb(ze[ze.length-2],ze[0],ze[1]),vt=ce?HA(ze[ze.length-2],ze[0],ze[1],ce):0;const Ke=[];let jt,Lt,rt;Lt=ze[1].sub(ze[0])._perp()._unit();let oi=!0;for(let Xt=1,Ut=0;Xt<ze.length;Xt++){let st=ze[Xt-1],ii=ze[Xt];const Mi=ze[Xt===ze.length-1?1:Xt+1];if(O.appendEdge(F,ii,st),Yg(ii,st,Se)){ce&&(Lt=Mi.sub(ii)._perp()._unit(),oi=!oi);continue}const ai=ii.sub(st)._perp(),Si=ai.x/(Math.abs(ai.x)+Math.abs(ai.y)),fi=ai.y>0?1:0,zi=st.dist(ii);if(Ut+zi>32768&&(Ut=0),ce){rt=Mi.sub(ii)._perp()._unit();let Wi=Tb(st,ii,Mi,wb(Lt,rt),ce);isNaN(Wi)&&(Wi=0);const Ki=ii.sub(st)._unit();st=st.add(Ki.mult(vt))._round(),ii=ii.add(Ki.mult(-Wi))._round(),vt=Wi,Lt=rt,U&&this.zoom>=17&&(fe(Ke,st)||Ke.push(st),fe(Ke,ii)||Ke.push(ii))}const _i=Ue.vertexLength,_n=ze.length>4&&Sb(st,ii,Mi);let Gi=Eb(Ut,He,oi);if(Fd(this.layoutVertexArray,st.x,st.y,Si,fi,0,0,Gi),Fd(this.layoutVertexArray,st.x,st.y,Si,fi,0,1,Gi),Ut+=zi,Gi=Eb(Ut,_n,!oi),He=_n,Fd(this.layoutVertexArray,ii.x,ii.y,Si,fi,0,0,Gi),Fd(this.layoutVertexArray,ii.x,ii.y,Si,fi,0,1,Gi),Ue.vertexLength+=4,this.indexArray.emplaceBack(_i+0,_i+1,_i+2),this.indexArray.emplaceBack(_i+1,_i+3,_i+2),Ue.primitiveLength+=2,ce){const Wi=De+(Xt===1?ze.length-2:Xt-2),Ki=Xt===1?De:Wi+1;if(this.indexArray.emplaceBack(_i+1,Wi,_i+3),this.indexArray.emplaceBack(Wi,Ki,_i+3),Ue.primitiveLength+=2,jt===void 0&&(jt=_i),!Yg(Mi,ze[Xt],Se)){const $i=Xt===ze.length-1?jt:Ue.vertexLength;this.indexArray.emplaceBack(_i+2,_i+3,$i),this.indexArray.emplaceBack(_i+3,$i+1,$i),this.indexArray.emplaceBack(_i+3,Ki,$i+1),Ue.primitiveLength+=3}oi=!oi}if(P){const Wi=this.layoutVertexExtArray,Ki=I.projectTilePoint(st.x,st.y,c),$i=I.projectTilePoint(ii.x,ii.y,c),zn=I.upVector(c,st.x,st.y),ln=I.upVector(c,ii.x,ii.y);Bd(Wi,Ki,zn),Bd(Wi,Ki,zn),Bd(Wi,$i,ln),Bd(Wi,$i,ln)}}R&&(De+=ze.length-1),U&&ce&&this.zoom>=17&&(Ke.length!==0&&fe(Ke,Ke[0])&&Ke.pop(),this.groundEffect.addData(Ke,Se,w,ce>0))}this.footprintSegments.push(Fe),Ye.triangleCount=this.indexArray.length-Ye.triangleArrayOffset,this.polygonSegments.push(Ye),++F.footprintSegLen,++F.polygonSegLen}if(F.vertexCount=this.layoutVertexArray.length-F.vertexArrayOffset,F.groundVertexCount=this.groundEffect.vertexArray.length-F.groundVertexArrayOffset,F.vertexCount!==0){if(F.centroidXY=O.borders?_b:this.encodeCentroid(O,F),this.centroidData.push(F),O.borders){this.featuresOnBorder.push(O);const ve=this.featuresOnBorder.length-1;for(let Se=0;Se<O.borders.length;Se++)O.borders[Se][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Se].push(ve)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,p,c,b),this.groundEffect.addPaintPropertiesData(e,s,h,p,c,b),this.maxHeight=Math.max(this.maxHeight,$)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,s)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}splitToSubtiles(){const e=[];for(let y=0;y<this.centroidData.length;y++){const b=this.centroidData[y],w=+(b.min.y+b.max.y>Pt),S=2*w+(+(b.min.x+b.max.x>Pt)^w);for(let I=0;I<b.polygonSegLen;I++){const P=b.polygonSegIdx+I;e.push({centroidIdx:y,subtile:S,polygonSegmentIdx:P,triangleSegmentIdx:this.polygonSegments[P].triangleSegIdx})}}const i=new hr;e.sort((y,b)=>y.triangleSegmentIdx===b.triangleSegmentIdx?y.subtile-b.subtile:y.triangleSegmentIdx-b.triangleSegmentIdx);let s=0,c=0,h=0;for(const y of e){if(y.triangleSegmentIdx!==s)break;h++}const p=e.length;for(;c!==e.length;){s=e[c].triangleSegmentIdx;let y=0,b=c,w=c;for(let S=b;S<h&&e[S].subtile===y;S++)w++;for(;b!==h;){const S=e[b];y=S.subtile;const I=this.centroidData[S.centroidIdx].min.clone(),P=this.centroidData[S.centroidIdx].max.clone(),R={vertexOffset:this.segments.segments[s].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[s].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let O=b;O<w;O++){const F=e[O],U=this.polygonSegments[F.polygonSegmentIdx],$=this.centroidData[F.centroidIdx].min,J=this.centroidData[F.centroidIdx].max,te=this.indexArray.uint16;for(let ee=U.triangleArrayOffset;ee<U.triangleArrayOffset+U.triangleCount;ee++)i.emplaceBack(te[3*ee],te[3*ee+1],te[3*ee+2]);R.primitiveLength+=U.triangleCount,I.x=Math.min(I.x,$.x),I.y=Math.min(I.y,$.y),P.x=Math.max(P.x,J.x),P.y=Math.max(P.y,J.y)}R.primitiveLength>0&&this.triangleSubSegments.push({segment:R,min:I,max:P}),b=w;for(let O=b;O<h&&e[O].subtile===e[b].subtile;O++)w++}c=h;for(let S=c;S<p&&e[S].triangleSegmentIdx===e[c].triangleSegmentIdx;S++)h++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,s){let c=0,h=0;const p=1<<e.canonical.z;if(i){const F=i.getMinMaxForTile(e);F&&(c=F.min,h=F.max)}h+=this.maxHeight;const y=e.toUnwrapped();let b;const w=[y.canonical.x/p+y.wrap,y.canonical.y/p],S=[(y.canonical.x+1)/p+y.wrap,(y.canonical.y+1)/p],I=new $n,P=(F,U,$)=>[F[0]*(1-$[0])+U[0]*$[0],F[1]*(1-$[1])+U[1]*$[1]],R=[],O=[];for(const F of this.triangleSubSegments){R[0]=F.min.x/Pt,R[1]=F.min.y/Pt,O[0]=F.max.x/Pt,O[1]=F.max.y/Pt;const U=P(w,S,R),$=P(w,S,O);if(new jn([U[0],U[1],c],[$[0],$[1],h]).intersectsPrecise(s)===0){b&&(I.segments.push(b),b=void 0);continue}const J=F.segment;b&&b.vertexOffset!==J.vertexOffset&&(I.segments.push(b),b=void 0),b?(b.vertexLength+=J.vertexLength,b.primitiveLength+=J.primitiveLength):b={vertexOffset:J.vertexOffset,primitiveLength:J.primitiveLength,vertexLength:J.vertexLength,primitiveOffset:J.primitiveOffset,sortKey:void 0,vaos:{}}}return b&&I.segments.push(b),I}encodeCentroid(e,i){const s=e.centroid(),c=i.span(),h=Math.min(7,Math.round(c.x*this.tileToMeter/10)),p=Math.min(7,Math.round(c.y*this.tileToMeter/10));return new le(wt(s.x,1,Pt-1)<<3|h,wt(s.y,1,Pt-1)<<3|p)}encodeBorderCentroid(e){if(!e.borders)return new le(0,0);const i=e.borders,s=Number.MAX_VALUE;if(i[0][0]!==s||i[1][0]!==s){const c=i[0][0]!==s?0:1;return new le(6|(i[0][0]!==s?0:65528),(i[c][0]+i[c][1])/2<<3|6)}{const c=i[2][0]!==s?2:3;return new le((i[c][0]+i[c][1])/2<<3|6,6|(i[2][0]!==s?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=il,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,s=e.vertexCount+e.vertexArrayOffset,c=e.flags&il?_b:e.centroidXY,h=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==c.y||h!==c.x){for(let p=i;p<s;++p)this.centroidVertexArray.emplace(p,c.x,c.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const s=i.getReplacementRegionsForTile(e.toUnwrapped());if(function(h,p){if(h.length!==p.length)return!1;for(let y=0;y<h.length;y++)if(h[y].sourceId!==p[y].sourceId||!rb(h[y],p[y]))return!1;return!0}(this.activeReplacements,s))return;if(this.activeReplacements=s,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const h of this.centroidData)h.flags&=2147483647;const c=[];for(const h of this.activeReplacements){const p=Math.pow(2,h.footprintTileId.canonical.z-e.canonical.z);for(const y of this.centroidData)if(!(y.flags&il||h.min.x>y.max.x||y.min.x>h.max.x||h.min.y>y.max.y||y.min.y>h.max.y))for(let b=0;b<y.footprintSegLen;b++){const w=this.footprintSegments[y.footprintSegIdx+b];if(c.length=0,qA(this.footprintVertices,w.vertexOffset,w.vertexCount,h.footprintTileId.canonical,e.canonical,c),ab(h.footprint,c,this.footprintIndices.uint16,w.indexOffset,w.indexCount,-w.vertexOffset,-p)){y.flags|=il;break}}}for(const h of this.centroidData)this.writeCentroidToBuffer(h);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,s){let c=!1;for(let h=0;h<s.footprintSegLen;h++){const p=this.footprintSegments[s.footprintSegIdx+h];let y=0;for(const b of p.ringIndices){for(let w=y,S=b+y-1;w<b+y;S=w++){const I=this.footprintVertices.int16[2*(w+p.vertexOffset)+0],P=this.footprintVertices.int16[2*(w+p.vertexOffset)+1],R=this.footprintVertices.int16[2*(S+p.vertexOffset)+1];P>i!=R>i&&e<(this.footprintVertices.int16[2*(S+p.vertexOffset)+0]-I)*(i-P)/(R-P)+I&&(c=!c)}y=b}}return c}getHeightAtTileCoord(e,i){let s=Number.NEGATIVE_INFINITY,c=!0;const h=4*(e+Pt)*Pt+(i+Pt);if(this.partLookup.hasOwnProperty(h)){const p=this.partLookup[h];return p?{height:p.height,hidden:!!(p.flags&il)}:void 0}for(const p of this.centroidData)e>p.max.x||p.min.x>e||i>p.max.y||p.min.y>i||this.footprintContainsPoint(e,i,p)&&p&&p.height>s&&(s=p.height,this.partLookup[h]=p,c=!!(p.flags&il));if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:c};this.partLookup[h]=void 0}}function wb(t,e){const i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function HA(t,e,i,s){const c=e.sub(t)._perp()._unit(),h=i.sub(e)._perp()._unit();return Tb(t,e,i,wb(c,h),s)}function Tb(t,e,i,s,c){const h=Math.sqrt(1-s*s);return Math.min(t.dist(e)/3,e.dist(i)/3,c*h/s)}function Yg(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function Mb(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function Sb(t,e,i){if(t.x<0||t.x>=Pt||e.x<0||e.x>=Pt||i.x<0||i.x>=Pt)return!1;const s=i.sub(e),c=s.perp(),h=t.sub(e);return(s.x*h.x+s.y*h.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(h.x*h.x+h.y*h.y))>-.866&&c.x*h.x+c.y*h.y<0}function Eb(t,e,i){const s=e?2|t:-3&t;return i?1|s:-2&s}function Ab(){const t=Math.PI/32,e=Math.tan(t),i=Oe;return i*Math.sqrt(1+2*e*e)-i}function Ib(t,e,i){const s=1<<i.z,c=pi(i.x/s),h=pi((i.x+1)/s),p=Fi(i.y/s),y=Fi((i.y+1)/s);return function(b,w,S,I,P=0,R){const O=[];if(!b.length||!S||!I)return O;const F=(ae,fe)=>{for(const ve of ae)O.push({polygon:ve,bounds:fe})},U=Math.ceil(Math.log2(S)),$=Math.ceil(Math.log2(I)),J=U-$,te=[];for(let ae=0;ae<Math.abs(J);ae++)te.push(J>0?0:1);for(let ae=0;ae<Math.min(U,$);ae++)te.push(0),te.push(1);let ee=b;if(ee=sm(ee,w[0].y-P,w[1].y+P,1),ee=sm(ee,w[0].x-P,w[1].x+P,0),!ee.length)return O;const ce=[];for(te.length?ce.push({polygons:ee,bounds:w,depth:0}):F(ee,w);ce.length;){const ae=ce.pop(),fe=ae.depth,ve=te[fe],Se=ae.bounds[0],De=ae.bounds[1],Ee=ve===0?Se.x:Se.y,Ue=ve===0?De.x:De.y,Ye=R?R(ve,Ee,Ue):.5*(Ee+Ue),Fe=sm(ae.polygons,Ee-P,Ye+P,ve),Ze=sm(ae.polygons,Ye-P,Ue+P,ve);if(Fe.length){const ze=[Se,new le(ve===0?Ye:De.x,ve===1?Ye:De.y)];te.length>fe+1?ce.push({polygons:Fe,bounds:ze,depth:fe+1}):F(Fe,ze)}if(Ze.length){const ze=[new le(ve===0?Ye:Se.x,ve===1?Ye:Se.y),De];te.length>fe+1?ce.push({polygons:Ze,bounds:ze,depth:fe+1}):F(Ze,ze)}}return O}(t,e,Math.ceil((h-c)/11.25),Math.ceil((p-y)/11.25),1,(b,w,S)=>{if(b===0)return .5*(w+S);{const I=Fi((i.y+w/Pt)/s);return(ui(.5*(Fi((i.y+S/Pt)/s)+I))*s-i.y)*Pt}})}function qA(t,e,i,s,c,h){const p=Math.pow(2,s.z-c.z);for(let y=0;y<i;y++){let b=t.int16[2*(y+e)+0],w=t.int16[2*(y+e)+1];b=(b+c.x*Pt)*p-s.x*Pt,w=(w+c.y*Pt)*p-s.y*Pt,h.push(new le(b,w))}}Bt(cm,"FillExtrusionBucket",{omit:["layers","features"]}),Bt(yb,"PartData"),Bt(gb,"FootprintSegment"),Bt(xb,"BorderCentroidData"),Bt(bb,"GroundEffect");const ZA=new Fn({visibility:new gt(Ie["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new gt(Ie["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var XA={paint:new Fn({"fill-extrusion-opacity":new gt(Ie["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ti(Ie["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new gt(Ie["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new gt(Ie["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ti(Ie["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ti(Ie["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ti(Ie["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new gt(Ie["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new gt(Ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new gt(Ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new gt(Ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new gt(Ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new gt(Ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new gt(Ie["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new gt(Ie["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new ti(Ie["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new ti(Ie["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new gt(Ie["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new gt(Ie["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new gt(Ie["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new gt(Ie["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new gt(Ie["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:ZA};class Pu extends le{constructor(e,i,s){super(e,i),this.z=s}}function Nd(t,e){return t.x*e.x+t.y*e.y}function Cb(t,e){if(t.length===1){let i=0;const s=e[i++];let c;for(;!c||s.equals(c);)if(c=e[i++],!c)return 1/0;for(;i<e.length;i++){const h=e[i],p=t[0],y=c.sub(s),b=h.sub(s),w=p.sub(s),S=Nd(y,y),I=Nd(y,b),P=Nd(b,b),R=Nd(w,y),O=Nd(w,b),F=S*P-I*I,U=(P*R-I*O)/F,$=(S*O-I*R)/F,J=s.z*(1-U-$)+c.z*U+h.z*$;if(isFinite(J))return J}return 1/0}{let i=1/0;for(const s of e)i=Math.min(i,s.z);return i}}function Pb(t,e,i,s,c,h,p,y){const b=p*c.getElevationAt(t,e,!0,!0),w=h[0]!==0,S=w?h[1]===0?p*(h[0]/7-450):p*function(I,P,R){const O=Math.floor(P[0]/8),F=Math.floor(P[1]/8),U=10*(P[0]-8*O),$=10*(P[1]-8*F),J=I.getElevationAt(O,F,!0,!0),te=I.getMeterToDEM(R),ee=Math.floor(.5*(U*te-1)),ce=Math.floor(.5*($*te-1)),ae=I.tileCoordToPixel(O,F),fe=2*ee+1,ve=2*ce+1,Se=function(Ze,ze,He,vt,Ke){return[Ze.getElevationAtPixel(ze,He,!0),Ze.getElevationAtPixel(ze+Ke,He,!0),Ze.getElevationAtPixel(ze,He+Ke,!0),Ze.getElevationAtPixel(ze+vt,He+Ke,!0)]}(I,ae.x-ee,ae.y-ce,fe,ve),De=Math.abs(Se[0]-Se[1]),Ee=Math.abs(Se[2]-Se[3]),Ue=Math.abs(Se[0]-Se[2])+Math.abs(Se[1]-Se[3]),Ye=Math.min(.25,.5*te*(De+Ee)/fe),Fe=Math.min(.25,.5*te*Ue/ve);return J+Math.max(Ye*U,Fe*$)}(c,h,y):b;return{base:b+(i===0)?-1:i,top:w?Math.max(S+s,b+i+2):b+s}}const YA=rn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:KA}=YA,JA=rn([{name:"a_packed",components:4,type:"Float32"}]),{members:QA}=JA;class Db{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new el({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const s=this.getKey(e,i);return this.positions[s]}trim(){const e=this.width,i=this.height=en(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,s){const c=[];let h=e.length%2==1?-e[e.length-1]*s:0,p=e[0]*s,y=!0;c.push({left:h,right:p,isDash:y,zeroLength:e[0]===0});let b=e[0];for(let w=1;w<e.length;w++){y=!y;const S=e[w];h=b*s,b+=S,p=b*s,c.push({left:h,right:p,isDash:y,zeroLength:S===0})}return c}addRoundDash(e,i,s){const c=i/2;for(let h=-s;h<=s;h++){const p=this.width*(this.nextRow+s+h);let y=0,b=e[y];for(let w=0;w<this.width;w++){w/b.right>1&&(b=e[++y]);const S=Math.abs(w-b.left),I=Math.abs(w-b.right),P=Math.min(S,I);let R;const O=h/s*(c+1);if(b.isDash){const F=c-Math.abs(O);R=Math.sqrt(P*P+F*F)}else R=c-Math.sqrt(P*P+O*O);this.image.data[p+w]=Math.max(0,Math.min(255,R+128))}}}addRegularDash(e,i){for(let b=e.length-1;b>=0;--b){const w=e[b],S=e[b+1];w.zeroLength?e.splice(b,1):S&&S.isDash===w.isDash&&(S.left=w.left,e.splice(b,1))}const s=e[0],c=e[e.length-1];s.isDash===c.isDash&&(s.left=c.left-this.width,c.right=s.right+this.width);const h=this.width*this.nextRow;let p=0,y=e[p];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++p]);const w=Math.abs(b-y.left),S=Math.abs(b-y.right),I=Math.min(w,S);this.image.data[h+b]=Math.max(0,Math.min(255,(y.isDash?I:-I)+i+128))}}addDash(e,i){const s=this.getKey(e,i);if(this.positions[s])return this.positions[s];const c=i==="round",h=c?7:0,p=2*h+1;if(this.nextRow+p>this.height)return we("LineAtlas out of space"),null;e.length===0&&e.push(1);let y=0;for(let S=0;S<e.length;S++)e[S]<0&&(we("Negative value is found in line dasharray, replacing values with 0"),e[S]=0),y+=e[S];if(y!==0){const S=this.width/y,I=this.getDashRanges(e,this.width,S);c?this.addRoundDash(I,S,h):this.addRegularDash(I,i==="square"?.5*S:0)}const b=this.nextRow+h;this.nextRow+=p;const w={tl:[b,h],br:[y,0]};return this.positions[s]=w,w}}Bt(Db,"LineAtlas");const eI=rm.types,tI=Math.cos(Math.PI/180*37.5);class Kg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new gd,this.layoutVertexArray2=new Io,this.indexArray=new hr,this.programConfigurations=new H(e.layers,e.zoom),this.segments=new $n,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,s,c){this.hasPattern=Hg("line",this.layers,i);const h=this.layers[0].layout.get("line-sort-key"),p=[];for(const{feature:S,id:I,index:P,sourceLayerIndex:R}of e){const O=this.layers[0]._featureFilter.needGeometry,F=sr(S,O);if(!this.layers[0]._featureFilter.filter(new On(this.zoom),F,s))continue;const U=h?h.evaluate(F,{},s):void 0,$={id:I,properties:S.properties,type:S.type,sourceLayerIndex:R,index:P,geometry:O?F.geometry:fr(S,s,c),patterns:{},sortKey:U};p.push($)}h&&p.sort((S,I)=>S.sortKey-I.sortKey);const{lineAtlas:y,featureIndex:b}=i,w=this.addConstantDashes(y);for(const S of p){const{geometry:I,index:P,sourceLayerIndex:R}=S;if(w&&this.addFeatureDashes(S,y),this.hasPattern){const O=qg("line",this.layers,S,this.zoom,i);this.patternFeatures.push(O)}else this.addFeature(S,I,P,s,y.positions,i.availableImages,i.brightness);b.insert(e[P].feature,I,P,R,this.index)}}addConstantDashes(e){let i=!1;for(const s of this.layers){const c=s.paint.get("line-dasharray").value,h=s.layout.get("line-cap").value;if(c.kind!=="constant"||h.kind!=="constant")i=!0;else{const p=h.value,y=c.value;if(!y)continue;e.addDash(y,p)}}return i}addFeatureDashes(e,i){const s=this.zoom;for(const c of this.layers){const h=c.paint.get("line-dasharray").value,p=c.layout.get("line-cap").value;if(h.kind==="constant"&&p.kind==="constant")continue;let y,b;if(h.kind==="constant"){if(y=h.value,!y)continue}else y=h.evaluate({zoom:s},e);b=p.kind==="constant"?p.value:p.evaluate({zoom:s},e),i.addDash(y,b),e.patterns[c.id]=i.getKey(y,b)}}update(e,i,s,c,h){const p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,p?this.stateDependentLayers:this.layers,s,c,h)}addFeatures(e,i,s,c,h,p){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,i,s,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,QA)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,KA),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,s,c,h,p,y){const b=this.layers[0].layout,w=b.get("line-join").evaluate(e,{}),S=b.get("line-cap").evaluate(e,{}),I=b.get("line-miter-limit"),P=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const R of i)this.addLine(R,e,w,S,I,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,p,c,y)}addLine(e,i,s,c,h,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let $=0;$<e.length-1;$++)this.totalDistance+=e[$].dist(e[$+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=eI[i.type]==="Polygon";let b=e.length;for(;b>=2&&e[b-1].equals(e[b-2]);)b--;let w=0;for(;w<b-1&&e[w].equals(e[w+1]);)w++;if(b<(y?3:2))return;s==="bevel"&&(h=1.05);const S=this.overscaling<=16?15*Pt/(512*this.overscaling):0,I=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let P,R,O,F,U;this.e1=this.e2=-1,y&&(P=e[b-2],U=e[w].sub(P)._unit()._perp());for(let $=w;$<b;$++){if(O=$===b-1?y?e[w+1]:void 0:e[$+1],O&&e[$].equals(O))continue;U&&(F=U),P&&(R=P),P=e[$],U=O?O.sub(P)._unit()._perp():F,F=F||U;let J=F.add(U);J.x===0&&J.y===0||J._unit();const te=F.x*U.x+F.y*U.y,ee=J.x*U.x+J.y*U.y,ce=ee!==0?1/ee:1/0,ae=2*Math.sqrt(2-2*ee),fe=ee<tI&&R&&O,ve=F.x*U.y-F.y*U.x>0;if(fe&&$>w){const Ee=P.dist(R);if(Ee>2*S){const Ue=P.sub(P.sub(R)._mult(S/Ee)._round());this.updateDistance(R,Ue),this.addCurrentVertex(Ue,F,0,0,I),R=Ue}}const Se=R&&O;let De=Se?s:y?"butt":c;if(Se&&De==="round"&&(ce<p?De="miter":ce<=2&&(De="fakeround")),De==="miter"&&ce>h&&(De="bevel"),De==="bevel"&&(ce>2&&(De="flipbevel"),ce<h&&(De="miter")),R&&this.updateDistance(R,P),De==="miter")J._mult(ce),this.addCurrentVertex(P,J,0,0,I);else if(De==="flipbevel"){if(ce>100)J=U.mult(-1);else{const Ee=ce*F.add(U).mag()/F.sub(U).mag();J._perp()._mult(Ee*(ve?-1:1))}this.addCurrentVertex(P,J,0,0,I),this.addCurrentVertex(P,J.mult(-1),0,0,I)}else if(De==="bevel"||De==="fakeround"){const Ee=-Math.sqrt(ce*ce-1),Ue=ve?Ee:0,Ye=ve?0:Ee;if(R&&this.addCurrentVertex(P,F,Ue,Ye,I),De==="fakeround"){const Fe=Math.round(180*ae/Math.PI/20);for(let Ze=1;Ze<Fe;Ze++){let ze=Ze/Fe;if(ze!==.5){const vt=ze-.5;ze+=ze*vt*(ze-1)*((1.0904+te*(te*(3.55645-1.43519*te)-3.2452))*vt*vt+(.848013+te*(.215638*te-1.06021)))}const He=U.sub(F)._mult(ze)._add(F)._unit()._mult(ve?-1:1);this.addHalfVertex(P,He.x,He.y,!1,ve,0,I)}}O&&this.addCurrentVertex(P,U,-Ue,-Ye,I)}else if(De==="butt")this.addCurrentVertex(P,J,0,0,I);else if(De==="square"){const Ee=R?1:-1;R||this.addCurrentVertex(P,J,Ee,Ee,I),this.addCurrentVertex(P,J,0,0,I),R&&this.addCurrentVertex(P,J,Ee,Ee,I)}else De==="round"&&(R&&(this.addCurrentVertex(P,F,0,0,I),this.addCurrentVertex(P,F,1,1,I,!0)),O&&(this.addCurrentVertex(P,U,-1,-1,I,!0),this.addCurrentVertex(P,U,0,0,I)));if(fe&&$<b-1){const Ee=P.dist(O);if(Ee>2*S){const Ue=P.add(O.sub(P)._mult(S/Ee)._round());this.updateDistance(P,Ue),this.addCurrentVertex(Ue,U,0,0,I),P=Ue}}}}addCurrentVertex(e,i,s,c,h,p=!1){const y=i.y*c-i.x,b=-i.y-i.x*c;this.addHalfVertex(e,i.x+i.y*s,i.y-i.x*s,p,!1,s,h),this.addHalfVertex(e,y,b,p,!0,-c,h)}addHalfVertex({x:e,y:i},s,c,h,p,y,b){this.layoutVertexArray.emplaceBack((e<<1)+(h?1:0),(i<<1)+(p?1:0),Math.round(63*s)+128,Math.round(63*c)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const w=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),b.primitiveLength++),p?this.e2=w:this.e1=w}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}Bt(Kg,"LineBucket",{omit:["layers","patternFeatures"]});const iI=new Fn({"line-cap":new ti(Ie.layout_line["line-cap"]),"line-join":new ti(Ie.layout_line["line-join"]),"line-miter-limit":new gt(Ie.layout_line["line-miter-limit"]),"line-round-limit":new gt(Ie.layout_line["line-round-limit"]),"line-sort-key":new ti(Ie.layout_line["line-sort-key"]),visibility:new gt(Ie.layout_line.visibility)});var Lb={paint:new Fn({"line-opacity":new ti(Ie.paint_line["line-opacity"]),"line-color":new ti(Ie.paint_line["line-color"]),"line-translate":new gt(Ie.paint_line["line-translate"]),"line-translate-anchor":new gt(Ie.paint_line["line-translate-anchor"]),"line-width":new ti(Ie.paint_line["line-width"]),"line-gap-width":new ti(Ie.paint_line["line-gap-width"]),"line-offset":new ti(Ie.paint_line["line-offset"]),"line-blur":new ti(Ie.paint_line["line-blur"]),"line-dasharray":new ti(Ie.paint_line["line-dasharray"]),"line-pattern":new ti(Ie.paint_line["line-pattern"]),"line-gradient":new na(Ie.paint_line["line-gradient"]),"line-trim-offset":new gt(Ie.paint_line["line-trim-offset"]),"line-emissive-strength":new gt(Ie.paint_line["line-emissive-strength"]),"line-border-width":new ti(Ie.paint_line["line-border-width"]),"line-border-color":new ti(Ie.paint_line["line-border-color"])}),layout:iI};function kb(t,e,i){return e*(Pt/(t.tileSize*Math.pow(2,i-t.tileID.overscaledZ)))}function Rb(t,e){return 1/kb(t,1,e.tileZoom)}function zb(t,e,i,s){return t.translatePosMatrix(s||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Ob=t=>{const e=[];Fb(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=t.paint.get("line-trim-offset");return i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER"),e};function Fb(t){const e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}const Bb=new class extends ti{possiblyEvaluate(t,e){return e=new On(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,s){return e=Nt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,s)}}(Lb.paint.properties["line-width"].specification);function Nb(t,e){return e>0?e+2*t:t}Bb.useIntegerZoom=!0;const nI=rn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),rI=rn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),sI=rn([{name:"a_projected_pos",components:4,type:"Float32"}],4);rn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const oI=rn([{name:"a_z_offset",components:1,type:"Float32"}],4),aI=rn([{name:"a_texb",components:2,type:"Uint16"}]),lI=rn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),cI=rn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);rn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Vb=rn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),uI=rn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);rn([{name:"triangle",components:3,type:"Uint16"}]),rn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),rn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),rn([{type:"Float32",name:"offsetX"}]),rn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Cr=24;const eo=128;function Jg(t,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new On(t+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:c}=i;let h=0;for(;h<s.length&&s[h]<=t;)h++;h=Math.max(0,h-1);let p=h;for(;p<s.length&&s[p]<t+1;)p++;p=Math.min(s.length-1,p);const y=s[h],b=s[p];return i.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:b,interpolationType:c}:{kind:"camera",minZoom:y,maxZoom:b,minSize:i.evaluate(new On(y)),maxSize:i.evaluate(new On(b)),interpolationType:c}}}function um(t,{uSize:e,uSizeT:i},{lowerSize:s,upperSize:c}){return t.kind==="source"?s/eo:t.kind==="composite"?Ri(s/eo,c/eo,i):e}function Du(t,e){let i=0,s=0;if(t.kind==="constant")s=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:c,minZoom:h,maxZoom:p}=t,y=c?wt(is.interpolationFactor(c,e,h,p),0,1):0;t.kind==="camera"?s=Ri(t.minSize,t.maxSize,y):i=y}return{uSizeT:i,uSize:s}}var hI=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:eo,evaluateSizeForFeature:um,evaluateSizeForZoom:Du,getSizeData:Jg});function dI(t,e,i){return t.sections.forEach(s=>{s.text=function(c,h,p){const y=h.layout.get("text-transform").evaluate(p,{});return y==="uppercase"?c=c.toLocaleUpperCase():y==="lowercase"&&(c=c.toLocaleLowerCase()),ns.applyArabicShaping&&(c=ns.applyArabicShaping(c)),c}(s.text,e,i)}),t}const Vd={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function fI(t){return t==="︶"||t==="﹈"||t==="︸"||t==="﹄"||t==="﹂"||t==="︾"||t==="︼"||t==="︺"||t==="︘"||t==="﹀"||t==="︐"||t==="︓"||t==="︔"||t==="｀"||t==="￣"||t==="︑"||t==="︒"}function pI(t){return t==="︵"||t==="﹇"||t==="︷"||t==="﹃"||t==="﹁"||t==="︽"||t==="︻"||t==="︹"||t==="︗"||t==="︿"}var mI={read:function(t,e,i,s,c){var h,p,y=8*c-s-1,b=(1<<y)-1,w=b>>1,S=-7,I=i?c-1:0,P=i?-1:1,R=t[e+I];for(I+=P,h=R&(1<<-S)-1,R>>=-S,S+=y;S>0;h=256*h+t[e+I],I+=P,S-=8);for(p=h&(1<<-S)-1,h>>=-S,S+=s;S>0;p=256*p+t[e+I],I+=P,S-=8);if(h===0)h=1-w;else{if(h===b)return p?NaN:1/0*(R?-1:1);p+=Math.pow(2,s),h-=w}return(R?-1:1)*p*Math.pow(2,h-s)},write:function(t,e,i,s,c,h){var p,y,b,w=8*h-c-1,S=(1<<w)-1,I=S>>1,P=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=s?0:h-1,O=s?1:-1,F=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,p=S):(p=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-p))<1&&(p--,b*=2),(e+=p+I>=1?P/b:P*Math.pow(2,1-I))*b>=2&&(p++,b/=2),p+I>=S?(y=0,p=S):p+I>=1?(y=(e*b-1)*Math.pow(2,c),p+=I):(y=e*Math.pow(2,I-1)*Math.pow(2,c),p=0));c>=8;t[i+R]=255&y,R+=O,y/=256,c-=8);for(p=p<<c|y,w+=c;w>0;t[i+R]=255&p,R+=O,p/=256,w-=8);t[i+R-O]|=128*F}},Ub=Rn,hm=mI;function Rn(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Rn.Varint=0,Rn.Fixed64=1,Rn.Bytes=2,Rn.Fixed32=5;var Qg=4294967296,jb=1/Qg,Gb=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ha(t){return t.type===Rn.Bytes?t.readVarint()+t.pos:t.pos+1}function Lu(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function $b(t,e,i){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(s);for(var c=i.pos-1;c>=t;c--)i.buf[c+s]=i.buf[c]}function _I(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function gI(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function yI(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function xI(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function vI(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function bI(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function wI(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function TI(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function MI(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function dm(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function ku(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function Wb(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Rn.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var s=this.readVarint(),c=s>>3,h=this.pos;this.type=7&s,t(c,e,this),this.pos===h&&this.skip(s)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=dm(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Wb(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=dm(this.buf,this.pos)+dm(this.buf,this.pos+4)*Qg;return this.pos+=8,t},readSFixed64:function(){var t=dm(this.buf,this.pos)+Wb(this.buf,this.pos+4)*Qg;return this.pos+=8,t},readFloat:function(){var t=hm.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=hm.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,s=this.buf;return e=127&(i=s[this.pos++]),i<128?e:(e|=(127&(i=s[this.pos++]))<<7,i<128?e:(e|=(127&(i=s[this.pos++]))<<14,i<128?e:(e|=(127&(i=s[this.pos++]))<<21,i<128?e:function(c,h,p){var y,b,w=p.buf;if(y=(112&(b=w[p.pos++]))>>4,b<128||(y|=(127&(b=w[p.pos++]))<<3,b<128)||(y|=(127&(b=w[p.pos++]))<<10,b<128)||(y|=(127&(b=w[p.pos++]))<<17,b<128)||(y|=(127&(b=w[p.pos++]))<<24,b<128)||(y|=(1&(b=w[p.pos++]))<<31,b<128))return Lu(c,y,h);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=s[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Gb?function(i,s,c){return Gb.decode(i.subarray(s,c))}(this.buf,e,t):function(i,s,c){for(var h="",p=s;p<c;){var y,b,w,S=i[p],I=null,P=S>239?4:S>223?3:S>191?2:1;if(p+P>c)break;P===1?S<128&&(I=S):P===2?(192&(y=i[p+1]))==128&&(I=(31&S)<<6|63&y)<=127&&(I=null):P===3?(b=i[p+2],(192&(y=i[p+1]))==128&&(192&b)==128&&((I=(15&S)<<12|(63&y)<<6|63&b)<=2047||I>=55296&&I<=57343)&&(I=null)):P===4&&(b=i[p+2],w=i[p+3],(192&(y=i[p+1]))==128&&(192&b)==128&&(192&w)==128&&((I=(15&S)<<18|(63&y)<<12|(63&b)<<6|63&w)<=65535||I>=1114112)&&(I=null)),I===null?(I=65533,P=1):I>65535&&(I-=65536,h+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),h+=String.fromCharCode(I),p+=P}return h}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Rn.Bytes)return t.push(this.readVarint(e));var i=ha(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Rn.Bytes)return t.push(this.readSVarint());var e=ha(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Rn.Bytes)return t.push(this.readBoolean());var e=ha(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Rn.Bytes)return t.push(this.readFloat());var e=ha(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Rn.Bytes)return t.push(this.readDouble());var e=ha(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Rn.Bytes)return t.push(this.readFixed32());var e=ha(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Rn.Bytes)return t.push(this.readSFixed32());var e=ha(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Rn.Bytes)return t.push(this.readFixed64());var e=ha(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Rn.Bytes)return t.push(this.readSFixed64());var e=ha(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Rn.Varint)for(;this.buf[this.pos++]>127;);else if(e===Rn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Rn.Fixed32)this.pos+=4;else{if(e!==Rn.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),ku(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),ku(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),ku(this.buf,-1&t,this.pos),ku(this.buf,Math.floor(t*jb),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),ku(this.buf,-1&t,this.pos),ku(this.buf,Math.floor(t*jb),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,i){var s,c;if(e>=0?(s=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(h,p,y){y.buf[y.pos++]=127&h|128,h>>>=7,y.buf[y.pos++]=127&h|128,h>>>=7,y.buf[y.pos++]=127&h|128,h>>>=7,y.buf[y.pos++]=127&h|128,y.buf[y.pos]=127&(h>>>=7)}(s,0,i),function(h,p){var y=(7&h)<<4;p.buf[p.pos++]|=y|((h>>>=3)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h)))))}(c,i)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(s,c,h){for(var p,y,b=0;b<c.length;b++){if((p=c.charCodeAt(b))>55295&&p<57344){if(!y){p>56319||b+1===c.length?(s[h++]=239,s[h++]=191,s[h++]=189):y=p;continue}if(p<56320){s[h++]=239,s[h++]=191,s[h++]=189,y=p;continue}p=y-55296<<10|p-56320|65536,y=null}else y&&(s[h++]=239,s[h++]=191,s[h++]=189,y=null);p<128?s[h++]=p:(p<2048?s[h++]=p>>6|192:(p<65536?s[h++]=p>>12|224:(s[h++]=p>>18|240,s[h++]=p>>12&63|128),s[h++]=p>>6&63|128),s[h++]=63&p|128)}return h}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&$b(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),hm.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),hm.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var s=this.pos-i;s>=128&&$b(i,s,this),this.pos=i-1,this.writeVarint(s),this.pos+=s},writeMessage:function(t,e,i){this.writeTag(t,Rn.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,_I,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,gI,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,vI,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,yI,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,xI,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,bI,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,wI,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,TI,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,MI,e)},writeBytesField:function(t,e){this.writeTag(t,Rn.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Rn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Rn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Rn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Rn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Rn.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Rn.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Rn.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Rn.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Rn.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var Ru=tt(Ub);const ey=3;function SI(t,e,i){e.glyphs=[],t===1&&i.readMessage(EI,e)}function EI(t,e,i){if(t===3){const{id:s,bitmap:c,width:h,height:p,left:y,top:b,advance:w}=i.readMessage(AI,{});e.glyphs.push({id:s,bitmap:new el({width:h+2*ey,height:p+2*ey},c),metrics:{width:h,height:p,left:y,top:b,advance:w}})}else t===4?e.ascender=i.readSVarint():t===5&&(e.descender=i.readSVarint())}function AI(t,e,i){t===1?e.id=i.readVarint():t===2?e.bitmap=i.readBytes():t===3?e.width=i.readVarint():t===4?e.height=i.readVarint():t===5?e.left=i.readSVarint():t===6?e.top=i.readSVarint():t===7&&(e.advance=i.readVarint())}const Hb=ey,Ps={horizontal:1,vertical:2,horizontalOnly:3};class Ud{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const s=new Ud;return s.scale=e||1,s.fontStack=i,s}static forImage(e){const i=new Ud;return i.imageName=e,i}}class zu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const s=new zu;for(let c=0;c<e.sections.length;c++){const h=e.sections[c];h.image?s.addImageSection(h):s.addTextSection(h,i)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,s){let c="";for(let h=0;h<i.length;h++){const p=i.charCodeAt(h+1)||null,y=i.charCodeAt(h-1)||null;c+=!s&&(p&&xp(p)&&!Vd[i[h+1]]||y&&xp(y)&&!Vd[i[h-1]])||!Vd[i[h]]?i[h]:Vd[i[h]]}return c}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&fm[this.text.charCodeAt(s)];s++)e++;let i=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&fm[this.text.charCodeAt(s)];s--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const s=new zu;return s.text=this.text.substring(e,i),s.sectionIndex=this.sectionIndex.slice(e,i),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Ud.forText(e.scale,e.fontStack||i));const s=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(s)}addImageSection(e){const i=e.image?e.image.namePrimary:"";if(i.length===0)return void we("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCodePoint(s),this.sections.push(Ud.forImage(i)),this.sectionIndex.push(this.sections.length-1)):we("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ty(t,e,i,s,c,h,p,y,b,w,S,I,P,R,O){const F=zu.fromFeature(t,c);I===Ps.vertical&&F.verticalizePunctuation(P);let U=[];const $=function(ae,fe,ve,Se,De,Ee){if(!ae)return[];const Ue=[],Ye=function(He,vt,Ke,jt,Lt,rt){let oi=0;for(let Xt=0;Xt<He.length();Xt++){const Ut=He.getSection(Xt);oi+=qb(He.getCodePoint(Xt),Ut,jt,Lt,vt,rt)}return oi/Math.max(1,Math.ceil(oi/Ke))}(ae,fe,ve,Se,De,Ee),Fe=ae.text.indexOf("​")>=0;let Ze=0;for(let He=0;He<ae.length();He++){const vt=ae.getSection(He),Ke=ae.getCodePoint(He);if(fm[Ke]||(Ze+=qb(Ke,vt,Se,De,fe,Ee)),He<ae.length()-1){const jt=!((ze=Ke)<11904||!(Ht["Bopomofo Extended"](ze)||Ht.Bopomofo(ze)||Ht["CJK Compatibility Forms"](ze)||Ht["CJK Compatibility Ideographs"](ze)||Ht["CJK Compatibility"](ze)||Ht["CJK Radicals Supplement"](ze)||Ht["CJK Strokes"](ze)||Ht["CJK Symbols and Punctuation"](ze)||Ht["CJK Unified Ideographs Extension A"](ze)||Ht["CJK Unified Ideographs"](ze)||Ht["Enclosed CJK Letters and Months"](ze)||Ht["Halfwidth and Fullwidth Forms"](ze)||Ht.Hiragana(ze)||Ht["Ideographic Description Characters"](ze)||Ht["Kangxi Radicals"](ze)||Ht["Katakana Phonetic Extensions"](ze)||Ht.Katakana(ze)||Ht["Vertical Forms"](ze)||Ht["Yi Radicals"](ze)||Ht["Yi Syllables"](ze)));(II[Ke]||jt||vt.imageName)&&Ue.push(Xb(He+1,Ze,Ye,Ue,CI(Ke,ae.getCodePoint(He+1),jt&&Fe),!1))}}var ze;return Yb(Xb(ae.length(),Ze,Ye,Ue,0,!0))}(F,w,h,e,s,R),{processBidirectionalText:J,processStyledBidirectionalText:te}=ns;if(J&&F.sections.length===1){const ae=J(F.toString(),$);for(const fe of ae){const ve=new zu;ve.text=fe,ve.sections=F.sections;for(let Se=0;Se<fe.length;Se++)ve.sectionIndex.push(0);U.push(ve)}}else if(te){const ae=te(F.text,F.sectionIndex,$);for(const fe of ae){const ve=new zu;ve.text=fe[0],ve.sectionIndex=fe[1],ve.sections=F.sections,U.push(ve)}}else U=function(ae,fe){const ve=[],Se=ae.text;let De=0;for(const Ee of fe)ve.push(ae.substring(De,Ee)),De=Ee;return De<Se.length&&ve.push(ae.substring(De,Se.length)),ve}(F,$);const ee=[],ce={positionedLines:ee,text:F.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ae,fe,ve,Se,De,Ee,Ue,Ye,Fe,Ze,ze,He){let vt=0,Ke=0,jt=0;const Lt=Ye==="right"?1:Ye==="left"?0:.5;let rt=!1;for(const Mi of De){const ai=Mi.getSections();for(const Si of ai){if(Si.imageName)continue;const fi=fe[Si.fontStack];if(fi&&(rt=fi.ascender!==void 0&&fi.descender!==void 0,!rt))break}if(!rt)break}let oi=0;for(const Mi of De){Mi.trim();const ai=Mi.getMaxScale(),Si=(ai-1)*Cr,fi={positionedGlyphs:[],lineOffset:0};ae.positionedLines[oi]=fi;const zi=fi.positionedGlyphs;let _i=0;if(!Mi.length()){Ke+=Ee,++oi;continue}let _n=0,Gi=0;for(let Ki=0;Ki<Mi.length();Ki++){const $i=Mi.getSection(Ki),zn=Mi.getSectionIndex(Ki),ln=Mi.getCodePoint(Ki);let Wn=$i.scale,cr=null,Ir=null,Dn=null,Vn=Cr,xr=0;const vr=!(Fe===Ps.horizontal||!ze&&!td(ln)||ze&&(fm[ln]||(Xt=ln,Ht.Arabic(Xt)||Ht["Arabic Supplement"](Xt)||Ht["Arabic Extended-A"](Xt)||Ht["Arabic Presentation Forms-A"](Xt)||Ht["Arabic Presentation Forms-B"](Xt))));if($i.imageName){const br=Se[$i.imageName];if(!br)continue;Dn=$i.imageName,ae.iconsInText=ae.iconsInText||!0,Ir=br.paddedRect;const Mn=br.displaySize;Wn=Wn*Cr/He,cr={width:Mn[0],height:Mn[1],left:0,top:-Hb,advance:vr?Mn[1]:Mn[0],localGlyph:!1},xr=rt?-cr.height*Wn:ai*Cr-17-Mn[1]*Wn,Vn=cr.advance;const ds=(vr?Mn[0]:Mn[1])*Wn-Cr*ai;ds>0&&ds>_i&&(_i=ds)}else{const br=ve[$i.fontStack];if(!br)continue;br[ln]&&(Ir=br[ln]);const Mn=fe[$i.fontStack];if(!Mn)continue;const ds=Mn.glyphs[ln];if(!ds)continue;if(cr=ds.metrics,Vn=ln!==8203?Cr:0,rt){const cl=Mn.ascender!==void 0?Math.abs(Mn.ascender):0,Xr=Mn.descender!==void 0?Math.abs(Mn.descender):0,fs=(cl+Xr)*Wn;_n<fs&&(_n=fs,Gi=(cl-Xr)/2*Wn),xr=-cl*Wn}else xr=(ai-Wn)*Cr-17}vr?(ae.verticalizable=!0,zi.push({glyph:ln,imageName:Dn,x:vt,y:Ke+xr,vertical:vr,scale:Wn,localGlyph:cr.localGlyph,fontStack:$i.fontStack,sectionIndex:zn,metrics:cr,rect:Ir}),vt+=Vn*Wn+Ze):(zi.push({glyph:ln,imageName:Dn,x:vt,y:Ke+xr,vertical:vr,scale:Wn,localGlyph:cr.localGlyph,fontStack:$i.fontStack,sectionIndex:zn,metrics:cr,rect:Ir}),vt+=cr.advance*Wn+Ze)}zi.length!==0&&(jt=Math.max(vt-Ze,jt),rt?Kb(zi,Lt,_i,Gi,Ee*ai/2):Kb(zi,Lt,_i,0,Ee/2)),vt=0;const Wi=Ee*ai+_i;fi.lineOffset=Math.max(_i,Si),Ke+=Wi,++oi}var Xt;const Ut=Ke,{horizontalAlign:st,verticalAlign:ii}=iy(Ue);(function(Mi,ai,Si,fi,zi,_i){const _n=(ai-Si)*zi,Gi=-_i*fi;for(const Wi of Mi)for(const Ki of Wi.positionedGlyphs)Ki.x+=_n,Ki.y+=Gi})(ae.positionedLines,Lt,st,ii,jt,Ut),ae.top+=-ii*Ut,ae.bottom=ae.top+Ut,ae.left+=-st*jt,ae.right=ae.left+jt,ae.hasBaseline=rt}(ce,e,i,s,U,p,y,b,I,w,P,O),!function(ae){for(const fe of ae)if(fe.positionedGlyphs.length!==0)return!1;return!0}(ee)&&ce}const fm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},II={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function qb(t,e,i,s,c,h){if(e.imageName){const p=s[e.imageName];return p?p.displaySize[0]*e.scale*Cr/h+c:0}{const p=i[e.fontStack],y=p&&p.glyphs[t];return y?y.metrics.advance*e.scale+c:0}}function Zb(t,e,i,s){const c=Math.pow(t-e,2);return s?t<e?c/2:2*c:c+Math.abs(i)*i}function CI(t,e,i){let s=0;return t===10&&(s-=1e4),i&&(s+=150),t!==40&&t!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function Xb(t,e,i,s,c,h){let p=null,y=Zb(e,i,c,h);for(const b of s){const w=Zb(e-b.x,i,c,h)+b.badness;w<=y&&(p=b,y=w)}return{index:t,x:e,priorBreak:p,badness:y}}function Yb(t){return t?Yb(t.priorBreak).concat(t.index):[]}function iy(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Kb(t,e,i,s,c){if(!(e||i||s||c))return;const h=t.length-1,p=t[h],y=(p.x+p.metrics.advance*p.scale)*e;for(let b=0;b<=h;b++)t[b].x-=y,t[b].y+=i+s+c}function PI(t,e,i,s){const{horizontalAlign:c,verticalAlign:h}=iy(s),p=i[0]-t.displaySize[0]*c,y=i[1]-t.displaySize[1]*h;return{imagePrimary:t,imageSecondary:e,top:y,bottom:y+t.displaySize[1],left:p,right:p+t.displaySize[0]}}function Jb(t,e,i,s,c,h){const p=t.imagePrimary;let y;if(p.content){const U=p.content,$=p.pixelRatio||1;y=[U[0]/$,U[1]/$,p.displaySize[0]-U[2]/$,p.displaySize[1]-U[3]/$]}const b=e.left*h,w=e.right*h;let S,I,P,R;i==="width"||i==="both"?(R=c[0]+b-s[3],I=c[0]+w+s[1]):(R=c[0]+(b+w-p.displaySize[0])/2,I=R+p.displaySize[0]);const O=e.top*h,F=e.bottom*h;return i==="height"||i==="both"?(S=c[1]+O-s[0],P=c[1]+F+s[2]):(S=c[1]+(O+F-p.displaySize[1])/2,P=S+p.displaySize[1]),{imagePrimary:p,imageSecondary:void 0,top:S,right:I,bottom:P,left:R,collisionPadding:y}}class da extends le{constructor(e,i,s,c,h){super(e,i),this.angle=c,this.z=s,h!==void 0&&(this.segment=h)}clone(){return new da(this.x,this.y,this.z,this.angle,this.segment)}}function Qb(t,e,i,s,c){if(e.segment===void 0)return!0;let h=e,p=e.segment+1,y=0;for(;y>-i/2;){if(p--,p<0)return!1;y-=t[p].dist(h),h=t[p]}y+=t[p].dist(t[p+1]),p++;const b=[];let w=0;for(;y<i/2;){const S=t[p],I=t[p+1];if(!I)return!1;let P=t[p-1].angleTo(S)-S.angleTo(I);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:y,angleDelta:P}),w+=P;y-b[0].distance>s;)w-=b.shift().angleDelta;if(w>c)return!1;p++,y+=S.dist(I)}return!0}function e1(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function t1(t,e,i){return t?.6*e*i:0}function i1(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function DI(t,e,i,s,c,h){const p=t1(i,c,h),y=i1(i,s)*h;let b=0;const w=e1(t)/2;for(let S=0;S<t.length-1;S++){const I=t[S],P=t[S+1],R=I.dist(P);if(b+R>w){const O=(w-b)/R,F=Ri(I.x,P.x,O),U=Ri(I.y,P.y,O),$=new da(F,U,0,P.angleTo(I),S);return!p||Qb(t,$,y,p,e)?$:void 0}b+=R}}function LI(t,e,i,s,c,h,p,y,b){const w=t1(s,h,p),S=i1(s,c),I=S*p,P=t[0].x===0||t[0].x===b||t[0].y===0||t[0].y===b;return e-I<e/4&&(e=I+e/4),n1(t,P?e/2*y%e:(S/2+2*h)*p*y%e,e,w,i,I,P,!1,b)}function n1(t,e,i,s,c,h,p,y,b){const w=h/2,S=e1(t);let I=0,P=e-i,R=[];for(let O=0;O<t.length-1;O++){const F=t[O],U=t[O+1],$=F.dist(U),J=U.angleTo(F);for(;P+i<I+$;){P+=i;const te=(P-I)/$,ee=Ri(F.x,U.x,te),ce=Ri(F.y,U.y,te);if(ee>=0&&ee<b&&ce>=0&&ce<b&&P-w>=0&&P+w<=S){const ae=new da(ee,ce,0,J,O);s&&!Qb(t,ae,h,s,c)||R.push(ae)}}I+=$}return y||R.length||p||(R=n1(t,I/2,i,s,c,h,p,!0,b)),R}function r1(t,e,i,s,c){const h=[];for(let p=0;p<t.length;p++){const y=t[p];let b;for(let w=0;w<y.length-1;w++){let S=y[w],I=y[w+1];S.x<e&&I.x<e||(S.x<e?S=new le(e,S.y+(e-S.x)/(I.x-S.x)*(I.y-S.y))._round():I.x<e&&(I=new le(e,S.y+(e-S.x)/(I.x-S.x)*(I.y-S.y))._round()),S.y<i&&I.y<i||(S.y<i?S=new le(S.x+(i-S.y)/(I.y-S.y)*(I.x-S.x),i)._round():I.y<i&&(I=new le(S.x+(i-S.y)/(I.y-S.y)*(I.x-S.x),i)._round()),S.x>=s&&I.x>=s||(S.x>=s?S=new le(s,S.y+(s-S.x)/(I.x-S.x)*(I.y-S.y))._round():I.x>=s&&(I=new le(s,S.y+(s-S.x)/(I.x-S.x)*(I.y-S.y))._round()),S.y>=c&&I.y>=c||(S.y>=c?S=new le(S.x+(c-S.y)/(I.y-S.y)*(I.x-S.x),c)._round():I.y>=c&&(I=new le(S.x+(c-S.y)/(I.y-S.y)*(I.x-S.x),c)._round()),b&&S.equals(b[b.length-1])||(b=[S],h.push(b)),b.push(I)))))}}return h}function s1(t){let e=0,i=0;for(const p of t)e+=p.w*p.h,i=Math.max(i,p.w);t.sort((p,y)=>y.h-p.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let c=0,h=0;for(const p of t)for(let y=s.length-1;y>=0;y--){const b=s[y];if(!(p.w>b.w||p.h>b.h)){if(p.x=b.x,p.y=b.y,h=Math.max(h,p.y+p.h),c=Math.max(c,p.x+p.w),p.w===b.w&&p.h===b.h){const w=s.pop();y<s.length&&(s[y]=w)}else p.h===b.h?(b.x+=p.w,b.w-=p.w):p.w===b.w?(b.y+=p.h,b.h-=p.h):(s.push({x:b.x+p.w,y:b.y,w:b.w-p.w,h:p.h}),b.y+=p.h,b.h-=p.h);break}}return{w:c,h,fill:e/(c*h)||0}}Bt(da,"Anchor");const hs=1;class ny{constructor(e,{pixelRatio:i,version:s,stretchX:c,stretchY:h,content:p}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=c,this.stretchY=h,this.content=p,this.version=s}get tl(){return[this.paddedRect.x+hs,this.paddedRect.y+hs]}get br(){return[this.paddedRect.x+this.paddedRect.w-hs,this.paddedRect.y+this.paddedRect.h-hs]}get displaySize(){return[(this.paddedRect.w-2*hs)/this.pixelRatio,(this.paddedRect.h-2*hs)/this.pixelRatio]}}class o1{constructor(e,i){const s={},c={};this.haveRenderCallbacks=[];const h=[];this.addImages(e,s,h),this.addImages(i,c,h);const{w:p,h:y}=s1(h),b=new Cs({width:p||1,height:y||1});for(const w in e){const S=e[w],I=s[w].paddedRect;Cs.copy(S.data,b,{x:0,y:0},{x:I.x+hs,y:I.y+hs},S.data,S.sdf)}for(const w in i){const S=i[w],I=c[w].paddedRect,P=I.x+hs,R=I.y+hs,O=S.data.width,F=S.data.height;Cs.copy(S.data,b,{x:0,y:0},{x:P,y:R},S.data),Cs.copy(S.data,b,{x:0,y:F-1},{x:P,y:R-1},{width:O,height:1}),Cs.copy(S.data,b,{x:0,y:0},{x:P,y:R+F},{width:O,height:1}),Cs.copy(S.data,b,{x:O-1,y:0},{x:P-1,y:R},{width:1,height:F}),Cs.copy(S.data,b,{x:0,y:0},{x:P+O,y:R},{width:1,height:F})}this.image=b,this.iconPositions=s,this.patternPositions=c}addImages(e,i,s){for(const c in e){const h=e[c],p={x:0,y:0,w:h.data.width+2*hs,h:h.data.height+2*hs};s.push(p),i[c]=new ny(p,h),h.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,i,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>e.hasImage(c,s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,s);for(const c in e.getUpdatedImages(s))this.patchUpdatedImage(this.iconPositions[c],e.getImage(c,s),i),this.patchUpdatedImage(this.patternPositions[c],e.getImage(c,s),i)}patchUpdatedImage(e,i,s){if(!e||!i||e.version===i.version)return;e.version=i.version;const[c,h]=e.tl,p=!!Object.keys(this.patternPositions).length;s.update(i.data,{useMipmap:p},{x:c,y:h})}}Bt(ny,"ImagePosition"),Bt(o1,"ImageAtlas");const jd=1e20;function a1(t,e,i,s,c,h,p,y,b){for(let w=e;w<e+s;w++)l1(t,i*h+w,h,c,p,y,b);for(let w=i;w<i+c;w++)l1(t,w*h+e,1,s,p,y,b)}function l1(t,e,i,s,c,h,p){h[0]=0,p[0]=-jd,p[1]=jd,c[0]=t[e];for(let y=1,b=0,w=0;y<s;y++){c[y]=t[e+y*i];const S=y*y;do{const I=h[b];w=(c[y]-c[I]+S-I*I)/(y-I)/2}while(w<=p[b]&&--b>-1);b++,h[b]=y,p[b]=w,p[b+1]=jd}for(let y=0,b=0;y<s;y++){for(;p[b+1]<y;)b++;const w=h[b],S=y-w;t[e+y*i]=c[w]+S*S}}const to=2,ry={none:0,ideographs:1,all:2};class Ou{constructor(e,i,s){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=s,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,s){const c=[],h=this.urls[i]||G.GLYPHS_URL;for(const p in e)for(const y of e[p])c.push({stack:p,id:y});Ji(c,({stack:p,id:y},b)=>{let w=this.entries[p];w||(w=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let S=w.glyphs[y];if(S!==void 0)return void b(null,{stack:p,id:y,glyph:S});if(S=this._tinySDF(w,p,y),S)return w.glyphs[y]=S,void b(null,{stack:p,id:y,glyph:S});const I=Math.floor(y/256);if(256*I>65535)return void b(new Error("glyphs > 65535 not supported"));if(w.ranges[I])return void b(null,{stack:p,id:y,glyph:S});let P=w.requests[I];P||(P=w.requests[I]=[],Ou.loadGlyphRange(p,I,h,this.requestManager,(R,O)=>{if(O){w.ascender=O.ascender,w.descender=O.descender;for(const F in O.glyphs)this._doesCharSupportLocalGlyph(+F)||(w.glyphs[+F]=O.glyphs[+F]);w.ranges[I]=!0}for(const F of P)F(R,O);delete w.requests[I]})),P.push((R,O)=>{R?b(R):O&&b(null,{stack:p,id:y,glyph:O.glyphs[y]||null})})},(p,y)=>{if(p)s(p);else if(y){const b={};for(const{stack:w,id:S,glyph:I}of y)b[w]===void 0&&(b[w]={}),b[w].glyphs===void 0&&(b[w].glyphs={}),b[w].glyphs[S]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},b[w].ascender=this.entries[w].ascender,b[w].descender=this.entries[w].descender;s(null,b)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==ry.none&&(this.localGlyphMode===ry.all?!!this.localFontFamily:!!this.localFontFamily&&(Ht["CJK Unified Ideographs"](e)||Ht["Hangul Syllables"](e)||Ht.Hiragana(e)||Ht.Katakana(e)||Ht["CJK Symbols and Punctuation"](e)||Ht["CJK Unified Ideographs Extension A"](e)||Ht["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,i,s){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(s))return;let h=e.tinySDF;if(!h){let F="400";/bold/i.test(i)?F="900":/medium/i.test(i)?F="500":/light/i.test(i)&&(F="200"),h=e.tinySDF=new Ou.TinySDF({fontFamily:c,fontWeight:F,fontSize:24*to,buffer:3*to,radius:8*to}),h.fontWeight=F}if(this.localGlyphs[h.fontWeight][s])return this.localGlyphs[h.fontWeight][s];const p=String.fromCodePoint(s),{data:y,width:b,height:w,glyphWidth:S,glyphHeight:I,glyphLeft:P,glyphTop:R,glyphAdvance:O}=h.draw(p);return this.localGlyphs[h.fontWeight][s]={id:s,bitmap:new el({width:b,height:w},y),metrics:{width:S/to,height:I/to,left:P/to,top:R/to-27,advance:O/to,localGlyph:!0}}}}Ou.loadGlyphRange=function(t,e,i,s,c){const h=256*e,p=h+255,y=s.transformRequest(s.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${h}-${p}`),Ur.Glyphs);We(y,(b,w)=>{if(b)c(b);else if(w){const S={},I=function(P){return new Ru(P).readFields(SI,{})}(w);for(const P of I.glyphs)S[P.id]=P;c(null,{glyphs:S,ascender:I.ascender,descender:I.descender})}})},Ou.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:s=.25,fontFamily:c="sans-serif",fontWeight:h="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=i;const y=this.size=t+4*e,b=this._createCanvas(y),w=this.ctx=b.getContext("2d",{willReadFrequently:!0});w.font=`${p} ${h} ${t}px ${c}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:c,actualBoundingBoxRight:h}=this.ctx.measureText(t),p=Math.ceil(i),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-c))),b=Math.min(this.size-this.buffer,p+Math.ceil(s)),w=y+2*this.buffer,S=b+2*this.buffer,I=Math.max(w*S,0),P=new Uint8ClampedArray(I),R={data:P,width:w,height:S,glyphWidth:y,glyphHeight:b,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(y===0||b===0)return R;const{ctx:O,buffer:F,gridInner:U,gridOuter:$}=this;O.clearRect(F,F,y,b),O.fillText(t,F,F+p);const J=O.getImageData(F,F,y,b);$.fill(jd,0,I),U.fill(0,0,I);for(let te=0;te<b;te++)for(let ee=0;ee<y;ee++){const ce=J.data[4*(te*y+ee)+3]/255;if(ce===0)continue;const ae=(te+F)*w+ee+F;if(ce===1)$[ae]=0,U[ae]=jd;else{const fe=.5-ce;$[ae]=fe>0?fe*fe:0,U[ae]=fe<0?fe*fe:0}}a1($,0,0,w,S,w,this.f,this.v,this.z),a1(U,F,F,y,b,w,this.f,this.v,this.z);for(let te=0;te<I;te++){const ee=Math.sqrt($[te])-Math.sqrt(U[te]);P[te]=Math.round(255-255*(ee/this.radius+this.cutoff))}return R}};const nl=hs;function c1(t,e,i,s){const c=[],h=t.imagePrimary,p=h.pixelRatio,y=h.paddedRect.w-2*nl,b=h.paddedRect.h-2*nl,w=t.right-t.left,S=t.bottom-t.top,I=h.stretchX||[[0,y]],P=h.stretchY||[[0,b]],R=(Ee,Ue)=>Ee+Ue[1]-Ue[0],O=I.reduce(R,0),F=P.reduce(R,0),U=y-O,$=b-F;let J=0,te=O,ee=0,ce=F,ae=0,fe=U,ve=0,Se=$;if(h.content&&s){const Ee=h.content;J=pm(I,0,Ee[0]),ee=pm(P,0,Ee[1]),te=pm(I,Ee[0],Ee[2]),ce=pm(P,Ee[1],Ee[3]),ae=Ee[0]-J,ve=Ee[1]-ee,fe=Ee[2]-Ee[0]-te,Se=Ee[3]-Ee[1]-ce}const De=(Ee,Ue,Ye,Fe)=>{const Ze=mm(Ee.stretch-J,te,w,t.left),ze=_m(Ee.fixed-ae,fe,Ee.stretch,O),He=mm(Ue.stretch-ee,ce,S,t.top),vt=_m(Ue.fixed-ve,Se,Ue.stretch,F),Ke=mm(Ye.stretch-J,te,w,t.left),jt=_m(Ye.fixed-ae,fe,Ye.stretch,O),Lt=mm(Fe.stretch-ee,ce,S,t.top),rt=_m(Fe.fixed-ve,Se,Fe.stretch,F),oi=new le(Ze,He),Xt=new le(Ke,He),Ut=new le(Ke,Lt),st=new le(Ze,Lt),ii=new le(ze/p,vt/p),Mi=new le(jt/p,rt/p),ai=e*Math.PI/180;if(ai){const Gi=Math.sin(ai),Wi=Math.cos(ai),Ki=[Wi,-Gi,Gi,Wi];oi._matMult(Ki),Xt._matMult(Ki),st._matMult(Ki),Ut._matMult(Ki)}const Si=Ee.stretch+Ee.fixed,fi=Ye.stretch+Ye.fixed,zi=Ue.stretch+Ue.fixed,_i=Fe.stretch+Fe.fixed,_n=t.imageSecondary;return{tl:oi,tr:Xt,bl:st,br:Ut,texPrimary:{x:h.paddedRect.x+nl+Si,y:h.paddedRect.y+nl+zi,w:fi-Si,h:_i-zi},texSecondary:_n?{x:_n.paddedRect.x+nl+Si,y:_n.paddedRect.y+nl+zi,w:fi-Si,h:_i-zi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ii,pixelOffsetBR:Mi,minFontScaleX:fe/p/w,minFontScaleY:Se/p/S,isSDF:i}};if(s&&(h.stretchX||h.stretchY)){const Ee=u1(I,U,O),Ue=u1(P,$,F);for(let Ye=0;Ye<Ee.length-1;Ye++){const Fe=Ee[Ye],Ze=Ee[Ye+1];for(let ze=0;ze<Ue.length-1;ze++)c.push(De(Fe,Ue[ze],Ze,Ue[ze+1]))}}else c.push(De({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:b+1}));return c}function pm(t,e,i){let s=0;for(const c of t)s+=Math.max(e,Math.min(i,c[1]))-Math.max(e,Math.min(i,c[0]));return s}function u1(t,e,i){const s=[{fixed:-nl,stretch:0}];for(const[c,h]of t){const p=s[s.length-1];s.push({fixed:c-p.stretch,stretch:p.stretch}),s.push({fixed:c-p.stretch,stretch:p.stretch+(h-c)})}return s.push({fixed:e+nl,stretch:i}),s}function mm(t,e,i,s){return t/e*i+s}function _m(t,e,i,s){return t-e*i/s}function kI(t,e,i,s){const c=e+t.positionedLines[s].lineOffset;return s===0?i+c/2:i+(c+(e+t.positionedLines[s-1].lineOffset))/2}function RI(t,e=1,i=!1){let s=1/0,c=1/0,h=-1/0,p=-1/0;const y=t[0];for(let R=0;R<y.length;R++){const O=y[R];(!R||O.x<s)&&(s=O.x),(!R||O.y<c)&&(c=O.y),(!R||O.x>h)&&(h=O.x),(!R||O.y>p)&&(p=O.y)}const b=Math.min(h-s,p-c);let w=b/2;const S=new us([],zI);if(b===0)return new le(s,c);for(let R=s;R<h;R+=b)for(let O=c;O<p;O+=b)S.push(new Fu(R+w,O+w,w,t));let I=function(R){let O=0,F=0,U=0;const $=R[0];for(let J=0,te=$.length,ee=te-1;J<te;ee=J++){const ce=$[J],ae=$[ee],fe=ce.x*ae.y-ae.x*ce.y;F+=(ce.x+ae.x)*fe,U+=(ce.y+ae.y)*fe,O+=3*fe}return new Fu(F/O,U/O,0,R)}(t),P=S.length;for(;S.length;){const R=S.pop();(R.d>I.d||!I.d)&&(I=R,i&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,P)),R.max-I.d<=e||(w=R.h/2,S.push(new Fu(R.p.x-w,R.p.y-w,w,t)),S.push(new Fu(R.p.x+w,R.p.y-w,w,t)),S.push(new Fu(R.p.x-w,R.p.y+w,w,t)),S.push(new Fu(R.p.x+w,R.p.y+w,w,t)),P+=4)}return i&&(console.log(`num probes: ${P}`),console.log(`best distance: ${I.d}`)),I.p}function zI(t,e){return e.max-t.max}class Fu{constructor(e,i,s,c){this.p=new le(e,i),this.h=s,this.d=function(h,p){let y=!1,b=1/0;for(let w=0;w<p.length;w++){const S=p[w];for(let I=0,P=S.length,R=P-1;I<P;R=I++){const O=S[I],F=S[R];O.y>h.y!=F.y>h.y&&h.x<(F.x-O.x)*(h.y-O.y)/(F.y-O.y)+O.x&&(y=!y),b=Math.min(b,Ka(h,O,F))}}return(y?1:-1)*Math.sqrt(b)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}}const sy=Number.POSITIVE_INFINITY,OI=Math.sqrt(2);function h1(t,[e,i]){let s=0,c=0;if(i===sy){e<0&&(e=0);const h=e/OI;switch(t){case"top-right":case"top-left":c=h-7;break;case"bottom-right":case"bottom-left":c=7-h;break;case"bottom":c=7-e;break;case"top":c=e-7}switch(t){case"top-right":case"bottom-right":s=-h;break;case"top-left":case"bottom-left":s=h;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":c=i-7;break;case"bottom-right":case"bottom-left":case"bottom":c=7-i}switch(t){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,c]}function oy(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function FI(t,e,i,s,c,h,p,y,b,w,S,I,P,R,O){let F=h.textMaxSize.evaluate(e,{},I);F===void 0&&(F=p);const U=t.layers[0].layout,$=U.get("icon-offset").evaluate(e,{},I),J=f1(i.horizontal)||i.vertical,te=P.name==="globe",ee=Cr,ce=p/ee,ae=t.tilePixelRatio*F/ee,fe=(Ze=t.overscaling,t.zoom>18&&Ze>2&&(Ze>>=1),Math.max(Pt/(512*Ze),1)*U.get("symbol-spacing")),ve=U.get("text-padding")*t.tilePixelRatio,Se=U.get("icon-padding")*t.tilePixelRatio,De=Qe(U.get("text-max-angle")),Ee=U.get("text-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",Ue=U.get("icon-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",Ye=U.get("symbol-placement"),Fe=fe/2;var Ze;const ze=U.get("icon-text-fit").evaluate(e,{},I),He=U.get("icon-text-fit-padding").evaluate(e,{},I),vt=ze!=="none";let Ke;t.hasAnyIconTextFit===!1&&vt&&(t.hasAnyIconTextFit=!0),s&&vt&&(t.allowVerticalPlacement&&i.vertical&&(Ke=Jb(s,i.vertical,ze,He,$,ce)),J&&(s=Jb(s,J,ze,He,$,ce)));const jt=(Lt,rt,oi)=>{if(rt.x<0||rt.x>=Pt||rt.y<0||rt.y>=Pt)return;let Xt=null;if(te){const{x:Ut,y:st,z:ii}=P.projectTilePoint(rt.x,rt.y,oi);Xt={anchor:new da(Ut,st,ii,0,void 0),up:P.upVector(oi,rt.x,rt.y)}}(function(Ut,st,ii,Mi,ai,Si,fi,zi,_i,_n,Gi,Wi,Ki,$i,zn,ln,Wn,cr,Ir,Dn,Vn,xr,vr,br,Mn,ds,cl){const Xr=Ut.addToLineVertexArray(st,Mi);let fs,Ls,of,Fm,pw,mw,_w,gw=0,yw=0,xw=0,vw=0,Cy=-1,Py=-1;const Oo={};let bw=Id("");const wc=ii?ii.anchor:st,Dy=_i.layout.get("icon-text-fit").evaluate(Vn,{},Mn)!=="none";let Ly=0,ky=0;if(_i._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Ly,ky]=_i.layout.get("text-offset").evaluate(Vn,{},Mn).map(ps=>ps*Cr):(Ly=_i.layout.get("text-radial-offset").evaluate(Vn,{},Mn)*Cr,ky=sy),Ut.allowVerticalPlacement&&ai.vertical){const ps=ai.vertical;if(zn)mw=ay(ps),zi&&(_w=ay(zi));else{const ms=_i.layout.get("text-rotate").evaluate(Vn,{},Mn)+90;of=gm(_n,wc,st,Gi,Wi,Ki,ps,$i,ms,ln),zi&&(Fm=gm(_n,wc,st,Gi,Wi,Ki,zi,cr,ms))}}if(Si){const ps=_i.layout.get("icon-rotate").evaluate(Vn,{},Mn),ms=c1(Si,ps,vr,Dy),$u=zi?c1(zi,ps,vr,Dy):void 0;Ls=gm(_n,wc,st,Gi,Wi,Ki,Si,cr,ps),gw=4*ms.length;const ww=Ut.iconSizeData;let Tc=null;ww.kind==="source"?(Tc=[eo*_i.layout.get("icon-size").evaluate(Vn,{},Mn)],Tc[0]>rl&&we(`${Ut.layerIds[0]}: Value for "icon-size" is >= ${Gd}. Reduce your "icon-size".`)):ww.kind==="composite"&&(Tc=[eo*xr.compositeIconSizes[0].evaluate(Vn,{},Mn),eo*xr.compositeIconSizes[1].evaluate(Vn,{},Mn)],(Tc[0]>rl||Tc[1]>rl)&&we(`${Ut.layerIds[0]}: Value for "icon-size" is >= ${Gd}. Reduce your "icon-size".`)),Ut.addSymbols(Ut.icon,ms,Tc,Dn,Ir,Vn,!1,ii,st,Xr.lineStartIndex,Xr.lineLength,-1,br,Mn,ds,cl),Cy=Ut.icon.placedSymbolArray.length-1,$u&&(yw=4*$u.length,Ut.addSymbols(Ut.icon,$u,Tc,Dn,Ir,Vn,Ps.vertical,ii,st,Xr.lineStartIndex,Xr.lineLength,-1,br,Mn,ds,cl),Py=Ut.icon.placedSymbolArray.length-1)}for(const ps in ai.horizontal){const ms=ai.horizontal[ps];fs||(bw=Id(ms.text),zn?pw=ay(ms):fs=gm(_n,wc,st,Gi,Wi,Ki,ms,$i,_i.layout.get("text-rotate").evaluate(Vn,{},Mn),ln));const $u=ms.positionedLines.length===1;if(xw+=d1(Ut,ii,st,ms,fi,_i,zn,Vn,ln,Xr,ai.vertical?Ps.horizontal:Ps.horizontalOnly,$u?Object.keys(ai.horizontal):[ps],Oo,Cy,xr,br,Mn,ds),$u)break}ai.vertical&&(vw+=d1(Ut,ii,st,ai.vertical,fi,_i,zn,Vn,ln,Xr,Ps.vertical,["vertical"],Oo,Py,xr,br,Mn,ds));let ul=-1;const Ry=(ps,ms)=>ps?Math.max(ps,ms):ms;ul=Ry(pw,ul),ul=Ry(mw,ul),ul=Ry(_w,ul);const tP=ul>-1?1:0;Ut.glyphOffsetArray.length>=65535&&we("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Vn.sortKey!==void 0&&Ut.addToSortKeyRanges(Ut.symbolInstances.length,Vn.sortKey),Ut.symbolInstances.emplaceBack(st.x,st.y,wc.x,wc.y,wc.z,Oo.right>=0?Oo.right:-1,Oo.center>=0?Oo.center:-1,Oo.left>=0?Oo.left:-1,Oo.vertical>=0?Oo.vertical:-1,Cy,Py,bw,fs!==void 0?fs:Ut.collisionBoxArray.length,fs!==void 0?fs+1:Ut.collisionBoxArray.length,of!==void 0?of:Ut.collisionBoxArray.length,of!==void 0?of+1:Ut.collisionBoxArray.length,Ls!==void 0?Ls:Ut.collisionBoxArray.length,Ls!==void 0?Ls+1:Ut.collisionBoxArray.length,Fm||Ut.collisionBoxArray.length,Fm?Fm+1:Ut.collisionBoxArray.length,Gi,xw,vw,gw,yw,tP,0,Ly,ky,ul,0,Dy?1:0)})(t,rt,Xt,Lt,i,s,c,Ke,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,ve,Ee,b,0,Se,Ue,$,e,h,w,S,I,R,O)};if(Ye==="line")for(const Lt of r1(e.geometry,0,0,Pt,Pt)){const rt=LI(Lt,fe,De,i.vertical||J,s,ee,ae,t.overscaling,Pt);for(const oi of rt)J&&BI(t,J.text,Fe,oi)||jt(Lt,oi,I)}else if(Ye==="line-center"){for(const Lt of e.geometry)if(Lt.length>1){const rt=DI(Lt,De,i.vertical||J,s,ee,ae);rt&&jt(Lt,rt,I)}}else if(e.type==="Polygon")for(const Lt of Wg(e.geometry,0)){const rt=RI(Lt,16);jt(Lt[0],new da(rt.x,rt.y,0,0,void 0),I)}else if(e.type==="LineString")for(const Lt of e.geometry)jt(Lt,new da(Lt[0].x,Lt[0].y,0,0,void 0),I);else if(e.type==="Point")for(const Lt of e.geometry)for(const rt of Lt)jt([rt],new da(rt.x,rt.y,0,0,void 0),I)}const Gd=255,rl=Gd*eo;function d1(t,e,i,s,c,h,p,y,b,w,S,I,P,R,O,F,U,$){const J=function(ce,ae,fe,ve,Se,De,Ee,Ue){const Ye=[];if(ae.positionedLines.length===0)return Ye;const Fe=ve.layout.get("text-rotate").evaluate(De,{})*Math.PI/180,Ze=function(jt){const Lt=jt[0],rt=jt[1],oi=Lt*rt;return oi>0?[Lt,-rt]:oi<0?[-Lt,rt]:Lt===0?[rt,Lt]:[rt,-Lt]}(fe);let ze=Math.abs(ae.top-ae.bottom);for(const jt of ae.positionedLines)ze-=jt.lineOffset;const He=ae.positionedLines.length,vt=ze/He;let Ke=ae.top-fe[1];for(let jt=0;jt<He;++jt){const Lt=ae.positionedLines[jt];Ke=kI(ae,vt,Ke,jt);for(const rt of Lt.positionedGlyphs){if(!rt.rect)continue;const oi=rt.rect||{};let Xt=Hb+1,Ut=!0,st=1,ii=0;if(rt.imageName){const Dn=Ee[rt.imageName];if(!Dn)continue;if(Dn.sdf){we("SDF images are not supported in formatted text and will be ignored.");continue}Ut=!1,st=Dn.pixelRatio,Xt=hs/st}const Mi=(Se||Ue)&&rt.vertical,ai=rt.metrics.advance*rt.scale/2,Si=rt.metrics,fi=rt.rect;if(fi===null)continue;Ue&&ae.verticalizable&&(ii=rt.imageName?ai-rt.metrics.width*rt.scale/2:0);const zi=Se?[rt.x+ai,rt.y]:[0,0];let _i=[0,0],_n=[0,0],Gi=!1;Se||(Mi?(_n=[rt.x+ai+Ze[0],rt.y+Ze[1]-ii],Gi=!0):_i=[rt.x+ai+fe[0],rt.y+fe[1]-ii]);const Wi=fi.w*rt.scale/(st*(rt.localGlyph?to:1)),Ki=fi.h*rt.scale/(st*(rt.localGlyph?to:1));let $i,zn,ln,Wn;if(Mi){const Dn=rt.y-Ke,Vn=new le(-ai,ai-Dn),xr=-Math.PI/2,vr=new le(..._n);$i=new le(-ai+_i[0],_i[1]),$i._rotateAround(xr,Vn)._add(vr),$i.x+=-Dn+ai,$i.y-=(Si.left-Xt)*rt.scale;const br=rt.imageName?Si.advance*rt.scale:Cr*rt.scale,Mn=String.fromCodePoint(rt.glyph);fI(Mn)?$i.x+=(1-Xt)*rt.scale:pI(Mn)?$i.x+=br-Si.height*rt.scale+(-Xt-1)*rt.scale:$i.x+=rt.imageName||Si.width+2*Xt===fi.w&&Si.height+2*Xt===fi.h?(br-Ki)/2:(br-(Si.height+2*Xt)*rt.scale)/2,zn=new le($i.x,$i.y-Wi),ln=new le($i.x+Ki,$i.y),Wn=new le($i.x+Ki,$i.y-Wi)}else{const Dn=(Si.left-Xt)*rt.scale-ai+_i[0],Vn=(-Si.top-Xt)*rt.scale+_i[1],xr=Dn+Wi,vr=Vn+Ki;$i=new le(Dn,Vn),zn=new le(xr,Vn),ln=new le(Dn,vr),Wn=new le(xr,vr)}if(Fe){let Dn;Dn=Se?new le(0,0):Gi?new le(Ze[0],Ze[1]):new le(fe[0],fe[1]),$i._rotateAround(Fe,Dn),zn._rotateAround(Fe,Dn),ln._rotateAround(Fe,Dn),Wn._rotateAround(Fe,Dn)}const cr=new le(0,0),Ir=new le(0,0);Ye.push({tl:$i,tr:zn,bl:ln,br:Wn,texPrimary:oi,texSecondary:void 0,writingMode:ae.writingMode,glyphOffset:zi,sectionIndex:rt.sectionIndex,isSDF:Ut,pixelOffsetTL:cr,pixelOffsetBR:Ir,minFontScaleX:0,minFontScaleY:0})}}return Ye}(0,s,b,h,p,y,c,t.allowVerticalPlacement),te=t.textSizeData;let ee=null;te.kind==="source"?(ee=[eo*h.layout.get("text-size").evaluate(y,{},U)],ee[0]>rl&&we(`${t.layerIds[0]}: Value for "text-size" is >= ${Gd}. Reduce your "text-size".`)):te.kind==="composite"&&(ee=[eo*O.compositeTextSizes[0].evaluate(y,{},U),eo*O.compositeTextSizes[1].evaluate(y,{},U)],(ee[0]>rl||ee[1]>rl)&&we(`${t.layerIds[0]}: Value for "text-size" is >= ${Gd}. Reduce your "text-size".`)),t.addSymbols(t.text,J,ee,b,p,y,S,e,i,w.lineStartIndex,w.lineLength,R,F,U,$,!1);for(const ce of I)P[ce]=t.text.placedSymbolArray.length-1;return 4*J.length}function f1(t){for(const e in t)return t[e];return null}function gm(t,e,i,s,c,h,p,y,b,w){let S=p.top,I=p.bottom,P=p.left,R=p.right;const O=p.collisionPadding;if(O&&(P-=O[0],S-=O[1],R+=O[2],I+=O[3]),b){const F=new le(P,S),U=new le(R,S),$=new le(P,I),J=new le(R,I),te=Qe(b);let ee=new le(0,0);w&&(ee=new le(w[0],w[1])),F._rotateAround(te,ee),U._rotateAround(te,ee),$._rotateAround(te,ee),J._rotateAround(te,ee),P=Math.min(F.x,U.x,$.x,J.x),R=Math.max(F.x,U.x,$.x,J.x),S=Math.min(F.y,U.y,$.y,J.y),I=Math.max(F.y,U.y,$.y,J.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,P,S,R,I,y,s,c,h),t.length-1}function ay(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function BI(t,e,i,s){const c=t.compareText;if(e in c){const h=c[e];for(let p=h.length-1;p>=0;p--)if(s.dist(h[p])<i)return!0}else c[e]=[];return c[e].push(s),!1}function p1(t,e){const i=t.fovAboveCenter,s=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,c=(t._camera.position[2]*t.worldSize-s)/Math.cos(t._pitch),h=Math.sin(i)*c/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),p=Math.sin(t._pitch)*h+c;return Math.min(1.01*p,c*(1/t._horizonShift))}function $d(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),s=t.x*i,c=(t.x+1)*i,h=t.y*i,p=(t.y+1)*i,y=pi(s),b=pi(c),w=Fi(h),S=Fi(p),I=e.project(y,w),P=e.project(b,w),R=e.project(b,S),O=e.project(y,S);let F=Math.min(I.x,P.x,R.x,O.x),U=Math.min(I.y,P.y,R.y,O.y),$=Math.max(I.x,P.x,R.x,O.x),J=Math.max(I.y,P.y,R.y,O.y);const te=i/16;function ee(ae,fe,ve,Se,De,Ee){const Ue=(ve+De)/2,Ye=(Se+Ee)/2,Fe=e.project(pi(Ue),Fi(Ye)),Ze=Math.max(0,F-Fe.x,U-Fe.y,Fe.x-$,Fe.y-J);F=Math.min(F,Fe.x),$=Math.max($,Fe.x),U=Math.min(U,Fe.y),J=Math.max(J,Fe.y),Ze>te&&(ee(ae,Fe,ve,Se,Ue,Ye),ee(Fe,fe,Ue,Ye,De,Ee))}ee(I,P,s,h,c,h),ee(P,R,c,h,c,p),ee(R,O,c,p,s,p),ee(O,I,s,p,s,h),F-=te,U-=te,$+=te,J+=te;const ce=1/Math.max($-F,J-U);return{scale:ce,x:F*ce,y:U*ce,x2:$*ce,y2:J*ce,projection:e}}function m1(t,{x:e,y:i},s=0){return new le(((e-s)*t.scale-t.x)*Pt,(i*t.scale-t.y)*Pt)}const NI=r.a6.identity(new Float32Array(16));class sl{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new Me(0,0)}projectTilePoint(e,i,s){return{x:e,y:i,z:0}}locationPoint(e,i,s=!0){return e._coordinatePoint(e.locationCoordinate(i),s)}pixelsPerMeter(e,i){return mi(1,e)*i}pixelSpaceConversion(e,i,s){return 1}farthestPixelDistance(e){return p1(e,e.pixelsPerMeter)}pointCoordinate(e,i,s,c){const h=e.horizonLineFromTop(!1),p=new le(i,Math.max(h,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,c))}pointCoordinate3D(e,i,s){const c=new le(i,s);if(e.elevation)return e.elevation.pointCoordinate(c);{const h=this.pointCoordinate(e,c.x,c.y,0);return[h.x,h.y,h.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);const s=e.horizonLineFromTop();return i.y<s}createInversionMatrix(e,i){return NI}createTileMatrix(e,i,s){let c,h,p;const y=s.canonical,b=r.a6.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const w=$d(y,this);c=1,h=w.x+s.wrap*w.scale,p=w.y,r.a6.scale(b,b,[c/w.scale,c/w.scale,e.pixelsPerMeter/i])}else c=i/e.zoomScale(y.z),h=(y.x+Math.pow(2,y.z)*s.wrap)*c,p=y.y*c;return r.a6.translate(b,b,[h,p,0]),r.a6.scale(b,b,[c/Pt,c/Pt,1]),b}upVector(e,i,s){return[0,0,1]}upVectorScale(e,i,s){return{metersToTile:1}}}class VI extends sl{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,s]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(Qe(i));this.n=(c+Math.sin(Qe(s)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:s,c,r0:h}=this,p=Qe(e-this.center[0]),y=Qe(i),b=Math.sqrt(c-2*s*Math.sin(y))/s;return{x:b*Math.sin(p*s),y:b*Math.cos(p*s)-h,z:0}}unproject(e,i){const{n:s,c,r0:h}=this,p=h+i;let y=Math.atan2(e,Math.abs(p))*Math.sign(p);p*s<0&&(y-=Math.PI*Math.sign(e)*Math.sign(p));const b=Qe(this.center[0])*s;y=bn(y,-Math.PI-b,Math.PI-b);const w=wt(Zt(y/s)+this.center[0],-180,180),S=Math.asin(wt((c-(e*e+p*p)*s*s)/(2*s),-1,1)),I=wt(Zt(S),-Ci,Ci);return new Me(w,I)}}const Wd=1.340264,Hd=-.081106,qd=893e-6,Zd=.003796,ym=Math.sqrt(3)/2;class UI extends sl{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(ym*Math.sin(i)),c=s*s,h=c*c*c;return{x:.5*(e*Math.cos(s)/(ym*(Wd+3*Hd*c+h*(7*qd+9*Zd*c)))/Math.PI+.5),y:1-.5*(s*(Wd+Hd*c+h*(qd+Zd*c))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,c=s*s,h=c*c*c;for(let S,I,P,R=0;R<12&&(I=s*(Wd+Hd*c+h*(qd+Zd*c))-i,P=Wd+3*Hd*c+h*(7*qd+9*Zd*c),S=I/P,s=wt(s-S,-Math.PI/3,Math.PI/3),c=s*s,h=c*c*c,!(Math.abs(S)<1e-12));++R);const p=ym*e*(Wd+3*Hd*c+h*(7*qd+9*Zd*c))/Math.cos(s),y=Math.asin(Math.sin(s)/ym),b=wt(180*p/Math.PI,-180,180),w=wt(180*y/Math.PI,-Ci,Ci);return new Me(b,w)}}class jI extends sl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const s=360*(e-.5),c=wt(360*(.5-i),-Ci,Ci);return new Me(s,c)}}const Bu=Math.PI/2;function xm(t){return Math.tan((Bu+t)/2)}class GI extends sl{constructor(e){super(e),this.center=e.center||[0,30];const[i,s]=this.parallels=e.parallels||[30,30];let c=Qe(i),h=Qe(s);this.southernCenter=c+h<0,this.southernCenter&&(c=-c,h=-h);const p=Math.cos(c),y=xm(c);this.n=c===h?Math.sin(c):Math.log(p/Math.cos(h))/Math.log(xm(h)/y),this.f=p*Math.pow(xm(c),this.n)/this.n}project(e,i){i=Qe(i),this.southernCenter&&(i=-i),e=Qe(e-this.center[0]);const s=1e-6,{n:c,f:h}=this;h>0?i<-Bu+s&&(i=-Bu+s):i>Bu-s&&(i=Bu-s);const p=h/Math.pow(xm(i),c);let y=p*Math.sin(c*e),b=h-p*Math.cos(c*e);return y=.5*(y/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:y,y:this.southernCenter?b:1-b,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:s,f:c}=this,h=c-i,p=Math.sign(h),y=Math.sign(s)*Math.sqrt(e*e+h*h);let b=Math.atan2(e,Math.abs(h))*p;h*s<0&&(b-=Math.PI*Math.sign(e)*p);const w=wt(Zt(b/s)+this.center[0],-180,180),S=wt(Zt(2*Math.atan(Math.pow(c/y,1/s))-Bu),-Ci,Ci);return new Me(w,this.southernCenter?-S:S)}}class _1 extends sl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:vi(e),y:ui(i),z:0}}unproject(e,i){const s=pi(e),c=Fi(i);return new Me(s,c)}}const g1=Qe(Ci);class $I extends sl{project(e,i){const s=(i=Qe(i))*i,c=s*s;return{x:.5*((e=Qe(e))*(.8707-.131979*s+c*(c*(.003971*s-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+s*(.015085+c*(.028874*s-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,c=25,h=0,p=s*s;do{p=s*s;const w=p*p;h=(s*(1.007226+p*(.015085+w*(.028874*p-.044475-.005916*w)))-i)/(1.007226+p*(.045255+w*(.259866*p-.311325-.005916*11*w))),s=wt(s-h,-g1,g1)}while(Math.abs(h)>1e-6&&--c>0);p=s*s;const y=wt(Zt(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),b=Zt(s);return new Me(y,b)}}const y1=Qe(Ci);class WI extends sl{project(e,i){i=Qe(i),e=Qe(e);const s=Math.cos(i),c=2/Math.PI,h=Math.acos(s*Math.cos(e/2)),p=Math.sin(h)/h,y=.5*(e*c+2*s*Math.sin(e/2)/p)||0,b=.5*(i+Math.sin(i)/p)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,i){let s=e=(2*e-.5)*Math.PI,c=i=(2*(1-i)-1)*Math.PI,h=25;const p=1e-6;let y=0,b=0;do{const w=Math.cos(c),S=Math.sin(c),I=2*S*w,P=S*S,R=w*w,O=Math.cos(s/2),F=Math.sin(s/2),U=2*O*F,$=F*F,J=1-R*O*O,te=J?1/J:0,ee=J?Math.acos(w*O)*Math.sqrt(1/J):0,ce=.5*(2*ee*w*F+2*s/Math.PI)-e,ae=.5*(ee*S+c)-i,fe=.5*te*(R*$+ee*w*O*P)+1/Math.PI,ve=te*(U*I/4-ee*S*F),Se=.125*te*(I*F-ee*S*R*U),De=.5*te*(P*O+ee*$*w)+.5,Ee=ve*Se-De*fe;y=(ae*ve-ce*De)/Ee,b=(ce*Se-ae*fe)/Ee,s=wt(s-y,-Math.PI,Math.PI),c=wt(c-b,-y1,y1)}while((Math.abs(y)>p||Math.abs(b)>p)&&--h>0);return new Me(Zt(s),Zt(c))}}class x1 extends sl{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Qe(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:s,cosPhi:c}=this;return{x:Qe(e)*c*s+.5,y:-Math.sin(Qe(i))/c*s+.5,z:0}}unproject(e,i){const{scale:s,cosPhi:c}=this,h=-(i-.5)/s,p=wt(Zt((e-.5)/s)/c,-180,180),y=Math.asin(wt(h*c,-1,1)),b=wt(Zt(y),-Ci,Ci);return new Me(p,b)}}class HI extends _1{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,s){const c=Ld(e,i,s),h=Kp(zo(s));return r.N.transformMat4(c,c,h),{x:c[0],y:c[1],z:c[2]}}locationPoint(e,i){const s=Ne(i.lat,i.lng),c=r.N.normalize([],s),h=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude,p=mi(1,0)*Pt*h;r.N.scaleAndAdd(s,s,c,p);const y=r.a6.identity(new Float64Array(16));return r.a6.multiply(y,e.pixelMatrix,e.globeMatrix),r.N.transformMat4(s,s,y),new le(s[0],s[1])}pixelsPerMeter(e,i){return mi(1,0)*i}pixelSpaceConversion(e,i,s){const c=mi(1,e)*i,h=Ri(mi(1,45)*i,c,s);return this.pixelsPerMeter(e,i)/h}createTileMatrix(e,i,s){const c=Fg(zo(s.canonical));return r.a6.multiply(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,i){const{center:s}=e,c=Kp(zo(i));return r.a6.rotateY(c,c,Qe(s.lng)),r.a6.rotateX(c,c,Qe(s.lat)),r.a6.scale(c,c,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(e,i,s,c){return Ov(e,i,s,!0)||new Ui(0,0)}pointCoordinate3D(e,i,s){const c=this.pointCoordinate(e,i,s,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,i){return!Ov(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(c,h){const p=c.cameraToCenterDistance,y=c._centerAltitude*h,b=c._camera,w=c._camera.forward(),S=r.N.add([],r.N.scale([],w,-p),[0,0,y]),I=c.worldSize/(2*Math.PI),P=[0,0,-I],R=c.width/c.height,O=Math.tan(c.fovAboveCenter),F=r.N.scale([],b.up(),O),U=r.N.scale([],b.right(),O*R),$=r.N.normalize([],r.N.add([],r.N.add([],w,F),U)),J=[];let te;if(new Lg(S,$).closestPointOnSphere(P,I,J)){const ee=r.N.add([],J,P),ce=r.N.sub([],ee,S);te=Math.cos(c.fovAboveCenter)*r.N.length(ce)}else{const ee=r.N.sub([],S,P),ce=r.N.sub([],P,S);r.N.normalize(ce,ce);const ae=r.N.length(ee)-I;te=Math.sqrt(ae*(ae+2*I));const fe=Math.acos(te/(I+ae))-Math.acos(r.N.dot(w,ce));te*=Math.cos(fe)}return 1.01*te}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=Qa(e.zoom);if(s>0){const c=p1(e,mi(1,e.center.lat)*e.worldSize),h=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Ri(i,c+h*(1-Math.cos(p)),Math.pow(s,10))}return i}upVector(e,i,s){return Ld(i,s,e,1)}upVectorScale(e){return{metersToTile:Zp(Yp(zo(e)))}}}function v1(t){const e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new _1(t);case"equirectangular":return new jI(t);case"naturalEarth":return new $I(t);case"equalEarth":return new UI(t);case"winkelTripel":return new WI(t);case"albers":return i?new x1(t):new VI(t);case"lambertConformalConic":return i?new x1(t):new GI(t);case"globe":return new HI(t)}throw new Error(`Invalid projection name: ${t.name}`)}const qI=rm.types,ZI=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function vm(t,e,i,s,c,h,p,y,b,w,S,I,P){const R=y?Math.min(rl,Math.round(y[0])):0,O=y?Math.min(rl,Math.round(y[1])):0;t.emplaceBack(e,i,Math.round(32*s),Math.round(32*c),h,p,(R<<1)+(b?1:0),O,16*w,16*S,256*I,256*P)}function bm(t,e,i){t.emplaceBack(e,i)}function wm(t,e,i,s,c,h,p){t.emplaceBack(e,i,s,c,h,p)}function Tm(t,e,i,s,c){t.emplaceBack(e,i,s,c),t.emplaceBack(e,i,s,c),t.emplaceBack(e,i,s,c),t.emplaceBack(e,i,s,c)}function XI(t){for(const e of t.sections)if(id(e.text))return!0;return!1}class ly{constructor(e){this.layoutVertexArray=new nc,this.indexArray=new hr,this.programConfigurations=e,this.segments=new $n,this.dynamicLayoutVertexArray=new Io,this.opacityVertexArray=new xd,this.placedSymbolArray=new Cp,this.iconTransitioningVertexArray=new Fs,this.globeExtVertexArray=new yd,this.zOffsetVertexArray=new sc}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,s,c,h){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nI.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,sI.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,ZI,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,aI.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,rI.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||h)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,oI.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Bt(ly,"SymbolBuffers");class cy{constructor(e,i,s){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new s,this.segments=new $n,this.collisionVertexArray=new bd,this.collisionVertexArrayExt=new Io}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,lI.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,cI.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Bt(cy,"CollisionBuffers");class Mm{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=r.a6.identity([]),this.placementViewportMatrix=r.a6.identity([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Jg(this.zoom,i["text-size"]),this.iconSizeData=Jg(this.zoom,i["icon-size"]);const s=this.layers[0].layout,c=s.get("symbol-sort-key"),h=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(p=>Ps[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=s.get("symbol-z-elevate")}createArrays(){this.text=new ly(new H(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new ly(new H(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Lp,this.lineVertexArray=new cc,this.symbolInstances=new Dp}calculateGlyphDependencies(e,i,s,c,h){for(let p=0;p<e.length;p++){const y=e.codePointAt(p);if(y===void 0)break;if(i[y]=!0,c&&h&&y<=65535){const b=Vd[e.charAt(p)];b&&(i[b.charCodeAt(0)]=!0)}}}populate(e,i,s,c){const h=this.layers[0],p=h.layout,y=this.projection.name==="globe",b=p.get("text-font"),w=p.get("text-field"),S=p.get("icon-image"),I=(w.value.kind!=="constant"||w.value.value instanceof Sr&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),P=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,R=p.get("symbol-sort-key");if(this.features=[],!I&&!P)return;const O=i.iconDependencies,F=i.glyphDependencies,U=i.availableImages,$=new On(this.zoom);for(const{feature:J,id:te,index:ee,sourceLayerIndex:ce}of e){const ae=h._featureFilter.needGeometry,fe=sr(J,ae);if(!h._featureFilter.filter($,fe,s))continue;if(ae||(fe.geometry=fr(J,s,c)),y&&J.type!==1&&s.z<=5){const Ee=fe.geometry,Ue=.98078528056,Ye=(Fe,Ze)=>{const ze=Ld(Fe.x,Fe.y,s,1),He=Ld(Ze.x,Ze.y,s,1);return r.N.dot(ze,He)<Ue};for(let Fe=0;Fe<Ee.length;Fe++)Ee[Fe]=Ar(Ee[Fe],Ye)}let ve,Se;if(I){const Ee=h.getValueAndResolveTokens("text-field",fe,s,U),Ue=Sr.factory(Ee);XI(Ue)&&(this.hasRTLText=!0),(!this.hasRTLText||Ao()==="unavailable"||this.hasRTLText&&ns.isParsed())&&(ve=dI(Ue,h,fe))}if(P){const Ee=h.getValueAndResolveTokens("icon-image",fe,s,U);Se=Ee instanceof ri?Ee:ri.fromString(Ee)}if(!ve&&!Se)continue;const De=this.sortFeaturesByKey?R.evaluate(fe,{},s):void 0;if(this.features.push({id:te,text:ve,icon:Se,index:ee,sourceLayerIndex:ce,geometry:fe.geometry,properties:J.properties,type:qI[J.type],sortKey:De}),Se&&(O[Se.namePrimary]=!0,Se.nameSecondary&&(O[Se.nameSecondary]=!0)),ve){const Ee=b.evaluate(fe,{},s).join(","),Ue=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ps.vertical)>=0;for(const Ye of ve.sections)if(Ye.image)O[Ye.image.namePrimary]=!0;else{const Fe=So(ve.toString()),Ze=Ye.fontStack||Ee,ze=F[Ze]=F[Ze]||{};this.calculateGlyphDependencies(Ye.text,ze,Ue,this.allowVerticalPlacement,Fe)}}}p.get("symbol-placement")==="line"&&(this.features=function(J){const te={},ee={},ce=[];let ae=0;function fe(Ee){ce.push(J[Ee]),ae++}function ve(Ee,Ue,Ye){const Fe=ee[Ee];return delete ee[Ee],ee[Ue]=Fe,ce[Fe].geometry[0].pop(),ce[Fe].geometry[0]=ce[Fe].geometry[0].concat(Ye[0]),Fe}function Se(Ee,Ue,Ye){const Fe=te[Ue];return delete te[Ue],te[Ee]=Fe,ce[Fe].geometry[0].shift(),ce[Fe].geometry[0]=Ye[0].concat(ce[Fe].geometry[0]),Fe}function De(Ee,Ue,Ye){const Fe=Ye?Ue[0][Ue[0].length-1]:Ue[0][0];return`${Ee}:${Fe.x}:${Fe.y}`}for(let Ee=0;Ee<J.length;Ee++){const Ue=J[Ee],Ye=Ue.geometry,Fe=Ue.text?Ue.text.toString():null;if(!Fe){fe(Ee);continue}const Ze=De(Fe,Ye),ze=De(Fe,Ye,!0);if(Ze in ee&&ze in te&&ee[Ze]!==te[ze]){const He=Se(Ze,ze,Ye),vt=ve(Ze,ze,ce[He].geometry);delete te[Ze],delete ee[ze],ee[De(Fe,ce[vt].geometry,!0)]=vt,ce[He].geometry=null}else Ze in ee?ve(Ze,ze,Ye):ze in te?Se(Ze,ze,Ye):(fe(Ee),te[Ze]=ae-1,ee[ze]=ae-1)}return ce.filter(Ee=>Ee.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((J,te)=>J.sortKey-te.sortKey)}update(e,i,s,c,h){const p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;const y=p?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,i,y,s,c,h),this.icon.programConfigurations.updatePaintArrays(e,i,y,s,c,h)}updateZOffset(){const e=(h,p,y)=>{s+=p,s>h.length&&h.resize(s);for(let b=-p;b<0;b++)h.emplace(b+s,y)},i=(h,p,y)=>{c+=p,c>h.length&&h.resize(c);for(let b=-p;b<0;b++)h.emplace(b+c,y)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let s=0,c=0;for(let h=0;h<this.symbolInstances.length;h++){const p=this.symbolInstances.get(h),{numHorizontalGlyphVertices:y,numVerticalGlyphVertices:b,numIconVertices:w}=p,S=p.zOffset,I=w>0;if((y>0||b>0)&&(e(this.text.zOffsetVertexArray,y,S),e(this.text.zOffsetVertexArray,b,S)),I){const{placedIconSymbolIndex:P,verticalPlacedIconSymbolIndex:R}=p;P>=0&&i(this.icon.zOffsetVertexArray,w,S),R>=0&&i(this.icon.zOffsetVertexArray,p.numVerticalIconVertices,S)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=v1(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const s=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:c,y:h}of i)this.lineVertexArray.emplaceBack(c,h);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,i,s,c,h,p,y,b,w,S,I,P,R,O,F,U){const $=e.indexArray,J=e.layoutVertexArray,te=e.globeExtVertexArray,ee=e.segments.prepareSegment(4*i.length,J,$,this.canOverlap?p.sortKey:void 0),ce=this.glyphOffsetArray.length,ae=ee.vertexLength,fe=this.allowVerticalPlacement&&y===Ps.vertical?Math.PI/2:0,ve=p.text&&p.text.sections;for(let De=0;De<i.length;De++){const{tl:Ee,tr:Ue,bl:Ye,br:Fe,texPrimary:Ze,texSecondary:ze,pixelOffsetTL:He,pixelOffsetBR:vt,minFontScaleX:Ke,minFontScaleY:jt,glyphOffset:Lt,isSDF:rt,sectionIndex:oi}=i[De],Xt=ee.vertexLength,Ut=Lt[1];if(vm(J,w.x,w.y,Ee.x,Ut+Ee.y,Ze.x,Ze.y,s,rt,He.x,He.y,Ke,jt),vm(J,w.x,w.y,Ue.x,Ut+Ue.y,Ze.x+Ze.w,Ze.y,s,rt,vt.x,He.y,Ke,jt),vm(J,w.x,w.y,Ye.x,Ut+Ye.y,Ze.x,Ze.y+Ze.h,s,rt,He.x,vt.y,Ke,jt),vm(J,w.x,w.y,Fe.x,Ut+Fe.y,Ze.x+Ze.w,Ze.y+Ze.h,s,rt,vt.x,vt.y,Ke,jt),b){const{x:st,y:ii,z:Mi}=b.anchor,[ai,Si,fi]=b.up;wm(te,st,ii,Mi,ai,Si,fi),wm(te,st,ii,Mi,ai,Si,fi),wm(te,st,ii,Mi,ai,Si,fi),wm(te,st,ii,Mi,ai,Si,fi),Tm(e.dynamicLayoutVertexArray,st,ii,Mi,fe)}else Tm(e.dynamicLayoutVertexArray,w.x,w.y,w.z,fe);if(U){const st=ze||Ze;bm(e.iconTransitioningVertexArray,st.x,st.y),bm(e.iconTransitioningVertexArray,st.x+st.w,st.y),bm(e.iconTransitioningVertexArray,st.x,st.y+st.h),bm(e.iconTransitioningVertexArray,st.x+st.w,st.y+st.h)}$.emplaceBack(Xt,Xt+1,Xt+2),$.emplaceBack(Xt+1,Xt+2,Xt+3),ee.vertexLength+=4,ee.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Lt[0]),De!==i.length-1&&oi===i[De+1].sectionIndex||e.programConfigurations.populatePaintArrays(J.length,p,p.index,{},R,O,F,ve&&ve[oi])}const Se=b?b.anchor:w;e.placedSymbolArray.emplaceBack(Se.x,Se.y,Se.z,w.x,w.y,ce,this.glyphOffsetArray.length-ce,ae,S,I,w.segment,s?s[0]:0,s?s[1]:0,c[0],c[1],y,0,!1,0,P,0)}_commitLayoutVertex(e,i,s,c,h,p,y){e.emplaceBack(i,s,c,h,p,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,i,s,c,h,p,y){const b=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),w=b.vertexLength,S=y.tileAnchorX,I=y.tileAnchorY;for(let R=0;R<4;R++)s.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(s.collisionVertexArrayExt,i,e.padding,y.zOffset),this._commitLayoutVertex(s.layoutVertexArray,c,h,p,S,I,new le(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,c,h,p,S,I,new le(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,c,h,p,S,I,new le(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,c,h,p,S,I,new le(e.x1,e.y2)),b.vertexLength+=4;const P=s.indexArray;P.emplaceBack(w,w+1),P.emplaceBack(w+1,w+2),P.emplaceBack(w+2,w+3),P.emplaceBack(w+3,w),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,s,c,h,p){for(let y=c;y<h;y++){const b=s.get(y),w=this.getSymbolInstanceTextSize(e,p,i,y);this._addCollisionDebugVertices(b,w,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,i,s,c,h,p){for(let y=c;y<h;y++){const b=s.get(y),w=this.getSymbolInstanceIconSize(e,i,p.placedIconSymbolIndex);this._addCollisionDebugVertices(b,w,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new cy(rc,Vb.members,Fs),this.iconCollisionBox=new cy(rc,Vb.members,Fs);const s=Du(this.iconSizeData,e),c=Du(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){const p=this.symbolInstances.get(h);this._addTextDebugCollisionBoxes(c,e,i,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(c,e,i,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(s,e,i,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(s,e,i,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,i,s,c){const h=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:c),p=um(this.textSizeData,e,h)/Cr;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,i,s){const c=this.icon.placedSymbolArray.get(s),h=um(this.iconSizeData,e,c);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(e,i,s,c){e.emplaceBack(i,-s,-s,c),e.emplaceBack(i,s,-s,c),e.emplaceBack(i,s,s,c),e.emplaceBack(i,-s,s,c)}_updateTextDebugCollisionBoxes(e,i,s,c,h,p){for(let y=c;y<h;y++){const b=s.get(y),w=this.getSymbolInstanceTextSize(e,p,i,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,b.padding,p.zOffset)}}_updateIconDebugCollisionBoxes(e,i,s,c,h,p){for(let y=c;y<h;y++){const b=s.get(y),w=this.getSymbolInstanceIconSize(e,i,p.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,b.padding,p.zOffset)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=Du(this.iconSizeData,e),c=Du(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){const p=this.symbolInstances.get(h);this._updateTextDebugCollisionBoxes(c,e,i,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(c,e,i,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(s,e,i,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._updateIconDebugCollisionBoxes(s,e,i,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,s,c,h,p,y,b,w){const S={};if(i<s){const{x1:I,y1:P,x2:R,y2:O,padding:F,projectedAnchorX:U,projectedAnchorY:$,projectedAnchorZ:J,tileAnchorX:te,tileAnchorY:ee,featureIndex:ce}=e.get(i);S.textBox={x1:I,y1:P,x2:R,y2:O,padding:F,projectedAnchorX:U,projectedAnchorY:$,projectedAnchorZ:J,tileAnchorX:te,tileAnchorY:ee},S.textFeatureIndex=ce}if(c<h){const{x1:I,y1:P,x2:R,y2:O,padding:F,projectedAnchorX:U,projectedAnchorY:$,projectedAnchorZ:J,tileAnchorX:te,tileAnchorY:ee,featureIndex:ce}=e.get(c);S.verticalTextBox={x1:I,y1:P,x2:R,y2:O,padding:F,projectedAnchorX:U,projectedAnchorY:$,projectedAnchorZ:J,tileAnchorX:te,tileAnchorY:ee},S.verticalTextFeatureIndex=ce}if(p<y){const{x1:I,y1:P,x2:R,y2:O,padding:F,projectedAnchorX:U,projectedAnchorY:$,projectedAnchorZ:J,tileAnchorX:te,tileAnchorY:ee,featureIndex:ce}=e.get(p);S.iconBox={x1:I,y1:P,x2:R,y2:O,padding:F,projectedAnchorX:U,projectedAnchorY:$,projectedAnchorZ:J,tileAnchorX:te,tileAnchorY:ee},S.iconFeatureIndex=ce}if(b<w){const{x1:I,y1:P,x2:R,y2:O,padding:F,projectedAnchorX:U,projectedAnchorY:$,projectedAnchorZ:J,tileAnchorX:te,tileAnchorY:ee,featureIndex:ce}=e.get(b);S.verticalIconBox={x1:I,y1:P,x2:R,y2:O,padding:F,projectedAnchorX:U,projectedAnchorY:$,projectedAnchorZ:J,tileAnchorX:te,tileAnchorY:ee},S.verticalIconFeatureIndex=ce}return S}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const s=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const s=e.placedSymbolArray.get(i),c=s.vertexStartIndex+4*s.numGlyphs;for(let h=s.vertexStartIndex;h<c;h+=4)e.indexArray.emplaceBack(h,h+1,h+2),e.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),s=Math.cos(e),c=[],h=[],p=[];for(let y=0;y<this.symbolInstances.length;++y){p.push(y);const b=this.symbolInstances.get(y);c.push(0|Math.round(i*b.tileAnchorX+s*b.tileAnchorY)),h.push(b.featureIndex)}return p.sort((y,b)=>c[y]-c[b]||h[b]-h[y]),p}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===i?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const s=this.symbolInstances.get(i);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:h,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:w}=s;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),h>=0&&h!==c&&this.addIndicesForPlacedSymbol(this.text,h),p>=0&&p!==h&&p!==c&&this.addIndicesForPlacedSymbol(this.text,p),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Bt(Mm,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Mm.addDynamicAttributes=Tm;const YI=new Fn({"symbol-placement":new gt(Ie.layout_symbol["symbol-placement"]),"symbol-spacing":new gt(Ie.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new gt(Ie.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ti(Ie.layout_symbol["symbol-sort-key"]),"symbol-z-order":new gt(Ie.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new gt(Ie.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new gt(Ie.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new gt(Ie.layout_symbol["icon-ignore-placement"]),"icon-optional":new gt(Ie.layout_symbol["icon-optional"]),"icon-rotation-alignment":new gt(Ie.layout_symbol["icon-rotation-alignment"]),"icon-size":new ti(Ie.layout_symbol["icon-size"]),"icon-text-fit":new ti(Ie.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ti(Ie.layout_symbol["icon-text-fit-padding"]),"icon-image":new ti(Ie.layout_symbol["icon-image"]),"icon-rotate":new ti(Ie.layout_symbol["icon-rotate"]),"icon-padding":new gt(Ie.layout_symbol["icon-padding"]),"icon-keep-upright":new gt(Ie.layout_symbol["icon-keep-upright"]),"icon-offset":new ti(Ie.layout_symbol["icon-offset"]),"icon-anchor":new ti(Ie.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new gt(Ie.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new gt(Ie.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new gt(Ie.layout_symbol["text-rotation-alignment"]),"text-field":new ti(Ie.layout_symbol["text-field"]),"text-font":new ti(Ie.layout_symbol["text-font"]),"text-size":new ti(Ie.layout_symbol["text-size"]),"text-max-width":new ti(Ie.layout_symbol["text-max-width"]),"text-line-height":new ti(Ie.layout_symbol["text-line-height"]),"text-letter-spacing":new ti(Ie.layout_symbol["text-letter-spacing"]),"text-justify":new ti(Ie.layout_symbol["text-justify"]),"text-radial-offset":new ti(Ie.layout_symbol["text-radial-offset"]),"text-variable-anchor":new gt(Ie.layout_symbol["text-variable-anchor"]),"text-anchor":new ti(Ie.layout_symbol["text-anchor"]),"text-max-angle":new gt(Ie.layout_symbol["text-max-angle"]),"text-writing-mode":new gt(Ie.layout_symbol["text-writing-mode"]),"text-rotate":new ti(Ie.layout_symbol["text-rotate"]),"text-padding":new gt(Ie.layout_symbol["text-padding"]),"text-keep-upright":new gt(Ie.layout_symbol["text-keep-upright"]),"text-transform":new ti(Ie.layout_symbol["text-transform"]),"text-offset":new ti(Ie.layout_symbol["text-offset"]),"text-allow-overlap":new gt(Ie.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new gt(Ie.layout_symbol["text-ignore-placement"]),"text-optional":new gt(Ie.layout_symbol["text-optional"]),visibility:new gt(Ie.layout_symbol.visibility)});var uy={paint:new Fn({"icon-opacity":new ti(Ie.paint_symbol["icon-opacity"]),"icon-emissive-strength":new ti(Ie.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new ti(Ie.paint_symbol["text-emissive-strength"]),"icon-color":new ti(Ie.paint_symbol["icon-color"]),"icon-halo-color":new ti(Ie.paint_symbol["icon-halo-color"]),"icon-halo-width":new ti(Ie.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ti(Ie.paint_symbol["icon-halo-blur"]),"icon-translate":new gt(Ie.paint_symbol["icon-translate"]),"icon-translate-anchor":new gt(Ie.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ti(Ie.paint_symbol["icon-image-cross-fade"]),"text-opacity":new ti(Ie.paint_symbol["text-opacity"]),"text-color":new ti(Ie.paint_symbol["text-color"],{runtimeType:as,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new ti(Ie.paint_symbol["text-halo-color"]),"text-halo-width":new ti(Ie.paint_symbol["text-halo-width"]),"text-halo-blur":new ti(Ie.paint_symbol["text-halo-blur"]),"text-translate":new gt(Ie.paint_symbol["text-translate"]),"text-translate-anchor":new gt(Ie.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new gt(Ie.paint_symbol["icon-color-saturation"])}),layout:YI};class b1{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ia,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Bt(b1,"FormatSectionOverride",{omit:["defaultValue"]});class Sm extends Wr{constructor(e,i,s){super(e,uy,i,s)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const c=[];for(const h of s)c.indexOf(h)<0&&c.push(h);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,s,c){const h=this.layout.get(e).evaluate(i,{},s,c),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||$l(p.value)||!h?h:function(y,b){return b.replace(/{([^{}]+)}/g,(w,S)=>S in y?String(y[S]):"")}(i.properties,h)}createBucket(e){return new Mm(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of uy.paint.overridableProperties){if(!Sm.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),s=new b1(i),c=new hu(s,i.property.specification,this.scope,this.options);let h=null;h=i.value.kind==="constant"||i.value.kind==="source"?new ed("source",c):new Wl("composite",c,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new qa(i.property,h,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,s){return!(!this.layout||i.isDataDriven()||s.isDataDriven())&&Sm.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const s=e.get("text-field"),c=uy.paint.properties[i];let h=!1;const p=y=>{for(const b of y)if(c.overrides&&c.overrides.hasOverride(b))return void(h=!0)};if(s.value.kind==="constant"&&s.value.value instanceof Sr)p(s.value.value.sections);else if(s.value.kind==="source"){const y=w=>{h||(w instanceof Gs&&nr(w.value)===Pa?p(w.value.sections):w instanceof La?p(w.sections):w.eachChild(y))},b=s.value;b._styleExpression&&y(b._styleExpression.expression)}return h}getProgramIds(){const e=this.paint.get("icon-opacity").constantOr(1)!==0,i=this.paint.get("text-opacity").constantOr(1)!==0,s=[];return e&&s.push("symbolIcon"),i&&s.push("symbolSDF"),s}getDefaultProgramParams(e,i){return{config:new V(this,i),overrideFog:!1}}}const KI=new Fn({visibility:new gt(Ie.layout_background.visibility)});var JI={paint:new Fn({"background-color":new gt(Ie.paint_background["background-color"]),"background-pattern":new gt(Ie.paint_background["background-pattern"]),"background-opacity":new gt(Ie.paint_background["background-opacity"]),"background-emissive-strength":new gt(Ie.paint_background["background-emissive-strength"])}),layout:KI};const QI=new Fn({visibility:new gt(Ie.layout_raster.visibility)});var eC={paint:new Fn({"raster-opacity":new gt(Ie.paint_raster["raster-opacity"]),"raster-color":new na(Ie.paint_raster["raster-color"]),"raster-color-mix":new gt(Ie.paint_raster["raster-color-mix"]),"raster-color-range":new gt(Ie.paint_raster["raster-color-range"]),"raster-hue-rotate":new gt(Ie.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new gt(Ie.paint_raster["raster-brightness-min"]),"raster-brightness-max":new gt(Ie.paint_raster["raster-brightness-max"]),"raster-saturation":new gt(Ie.paint_raster["raster-saturation"]),"raster-contrast":new gt(Ie.paint_raster["raster-contrast"]),"raster-resampling":new gt(Ie.paint_raster["raster-resampling"]),"raster-fade-duration":new gt(Ie.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new gt(Ie.paint_raster["raster-emissive-strength"]),"raster-array-band":new gt(Ie.paint_raster["raster-array-band"]),"raster-elevation":new gt(Ie.paint_raster["raster-elevation"])}),layout:QI},hy=rn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class dy{constructor(e,i,s,c){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(i,c)}update(e,i,s){const{width:c,height:h}=e,{context:p}=this,{gl:y}=p;if(y.bindTexture(y.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!i||i.premultiply!==!1)),s||this.size&&this.size[0]===c&&this.size[1]===h){const{x:b,y:w}=s||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)y.texSubImage2D(y.TEXTURE_2D,0,b,w,y.RGBA,y.UNSIGNED_BYTE,e);else{let S=this.format,I=y.UNSIGNED_BYTE;this.format===y.R32F&&(S=y.RED,I=y.FLOAT),y.texSubImage2D(y.TEXTURE_2D,0,b,w,c,h,S,I,e.data)}}else if(this.size=[c,h],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let b=this.format;this.format===y.R8&&(b=y.RED),y.texImage2D(y.TEXTURE_2D,0,this.format,b,y.UNSIGNED_BYTE,e)}else{let b=this.format,w=this.format,S=y.UNSIGNED_BYTE;this.format===y.DEPTH_COMPONENT&&(b=y.DEPTH_COMPONENT16,S=y.UNSIGNED_SHORT),this.format===y.R8&&(w=y.RED),this.format===y.R32F&&(S=y.FLOAT,w=y.RED),y.texImage2D(y.TEXTURE_2D,0,b,c,h,0,w,S,e.data)}this.useMipmap=!!(i&&i.useMipmap),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(e,i,s=!1){const{context:c}=this,{gl:h}=c;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap&&!s?e===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,s,c){const{context:h}=this,{gl:p}=h;p.bindTexture(p.TEXTURE_2D,this.texture),i!==this.magFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),s!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,s),this.wrapS=s),c!==this.wrapT&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,c),this.wrapT=c)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Em{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:s}=this,{gl:c}=s;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,i),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,i),this.wrapS=i)}}function Am(t,e,i,s,c,h,p,y){const b=[t,e,1,i,s,1,c,h,1],w=[p,y,1],S=r.co.adjoint([],b),[I,P,R]=r.N.transformMat3(w,w,S);return r.co.multiply(b,b,[I,0,0,0,P,0,0,0,R])}function w1(t,e,i,s,c,h,p,y){const b=function(w,S,I,P,R,O,F,U){const $=Am(0,0,1,0,1,1,0,1),J=Am(w,S,I,P,R,O,F,U),te=r.co.adjoint([],$);return r.co.multiply(J,J,te)}(t,e,i,s,c,h,p,y);return[b[2]/b[8]/Pt,b[5]/b[8]/Pt]}function Im(t){return[t[0],Math.min(Math.max(t[1],-Ci),Ci)]}class T1 extends Aa{constructor(e,i,s,c){super(),this.id=e,this.dispatcher=s,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(c),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new $o("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=It(this.map._requestManager.transformRequest(this.url,Ur.Image),(s,c)=>{this._imageRequest=null,this._loaded=!0,s?this.fire(new rh(s)):c&&(this.image=c instanceof HTMLImageElement?Xe.getImageData(c):c,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Em(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new $o("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Em||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],s=e[0][1];for(const h of e)h[1]>s&&(s=h[1]),h[1]<i&&(i=h[1]);const c=(s+i)/2;if(c>Ci?this.onNorthPole=!0:c<-Ci&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const h=e.map(Ui.fromLngLat);this.tileID=function(p){let y=1/0,b=1/0,w=-1/0,S=-1/0;for(const F of p)y=Math.min(y,F.x),b=Math.min(b,F.y),w=Math.max(w,F.x),S=Math.max(S,F.y);const I=Math.max(w-y,S-b),P=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),R=Math.pow(2,P);let O=Math.floor((y+w)/2*R);return O>1&&(O-=1),new it(P,O,Math.floor((b+S)/2*R))}(h),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new $o("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const $ in this.tiles){const J=this.tiles[$];J.state!=="loaded"&&(J.state="loaded",J.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=$d(new it(0,0,0),this.map.transform.projection),s=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function($){const J=$[1].x-$[0].x,te=$[1].y-$[0].y,ee=$[2].x-$[1].x,ce=$[2].y-$[1].y,ae=$[3].x-$[2].x,fe=$[3].y-$[2].y,ve=$[0].x-$[3].x,Se=$[0].y-$[3].y,De=J*ce-ee*te,Ee=ee*fe-ae*ce,Ue=ae*Se-ve*fe,Ye=ve*te-J*Se;return De>0&&Ee>0&&Ue>0&&Ye>0||De<0&&Ee<0&&Ue<0&&Ye<0}(s))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const c=$d(this.tileID,this.map.transform.projection),[h,p,y,b]=this.coordinates.map($=>{const J=c.projection.project($[0],$[1]);return m1(c,J)._round()});this.perspectiveTransform=w1(h.x,h.y,p.x,p.y,y.x,y.y,b.x,b.y);const w=this._boundsArray=new Xs;w.emplaceBack(h.x,h.y,0,0),w.emplaceBack(p.x,p.y,Pt,0),w.emplaceBack(b.x,b.y,0,Pt),w.emplaceBack(y.x,y.y,Pt,Pt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(w,hy.members),this.boundsSegments=$n.simpleSegment(0,0,4,2);const S=[],I=[Im((P=this.coordinates)[0]),Im(P[1]),Im(P[2]),Im(P[3])];var P;const[R,O,F,U]=function($){let J=$[0][0],te=J,ee=$[0][1],ce=ee;for(let ae=1;ae<$.length;ae++)$[ae][0]<J?J=$[ae][0]:$[ae][0]>te&&(te=$[ae][0]),$[ae][1]<ee?ee=$[ae][1]:$[ae][1]>ce&&(ce=$[ae][1]);return[J,ee,te-J,ce-ee]}(I);{const $=new Xs,[J,te,ee,ce]=function(He){let vt=He[0].x,Ke=vt,jt=He[0].y,Lt=jt;for(let rt=1;rt<He.length;rt++)He[rt].x<vt?vt=He[rt].x:He[rt].x>Ke&&(Ke=He[rt].x),He[rt].y<jt?jt=He[rt].y:He[rt].y>Lt&&(Lt=He[rt].y);return[vt,jt,Ke-vt,Lt-jt]}(s),ae=He=>[(He.x-J)/ee,(He.y-te)/ce],[fe,ve,Se,De]=s.map(ae),Ee=function(He,vt,Ke,jt,Lt,rt,oi,Xt){const Ut=Am(0,0,1,0,1,1,0,1),st=Am(He,vt,Ke,jt,Lt,rt,oi,Xt),ii=r.co.adjoint([],st);return r.co.multiply(Ut,Ut,ii)}(fe[0],fe[1],ve[0],ve[1],Se[0],Se[1],De[0],De[1]);this.elevatedGlobePerspectiveTransform=w1(fe[0],fe[1],ve[0],ve[1],Se[0],Se[1],De[0],De[1]);const Ue=(He,vt)=>{S.push(He.lng);const Ke=Math.round((He.lng-R)/F*Pt),jt=Math.round((He.lat-O)/U*Pt),Lt=ae(vt),rt=r.N.transformMat3([],[Lt[0],Lt[1],1],Ee),oi=Math.round(rt[0]/rt[2]*Pt),Xt=Math.round(rt[1]/rt[2]*Pt);$.emplaceBack(Ke,jt,oi,Xt)},Ye=s[3].x-s[0].x,Fe=s[3].y-s[0].y,Ze=s[2].x-s[1].x,ze=s[2].y-s[1].y;for(let He=0;He<65;He++){const vt=He/64,Ke=[s[0].x+vt*Ye,s[0].y+vt*Fe],jt=[s[1].x+vt*Ze,s[1].y+vt*ze],Lt=jt[0]-Ke[0],rt=jt[1]-Ke[1];for(let oi=0;oi<65;oi++){const Xt=oi/64,Ut={x:Ke[0]+Lt*Xt,y:Ke[1]+rt*Xt,z:0};Ue(i.projection.unproject(Ut.x,Ut.y),Ut)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer($,hy.members)}{this.maxLongitudeTriangleSize=0;let $=[],J=new hr;const te=(ee,ce,ae)=>{J.emplaceBack(ee,ce,ae);const fe=S[ee],ve=S[ce],Se=S[ae],De=Math.min(Math.min(fe,ve),Se),Ee=Math.max(Math.max(fe,ve),Se)-De;Ee>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ee),$.push(De+Ee/2)};for(let ee=0;ee<64;ee++)for(let ce=0;ce<64;ce++){const ae=65*ee+ce,fe=ae+1,ve=ae+65,Se=ve+1;te(ae,ve,fe),te(fe,ve,Se)}[$,J]=function(ee,ce){const ae=Array.from({length:ee.length},(Se,De)=>De);ae.sort((Se,De)=>ee[Se]-ee[De]);const fe=[],ve=new hr;for(let Se=0;Se<ae.length;Se++){const De=ae[Se];fe.push(ee[De]);const Ee=3*De,Ue=Ee+1;ve.emplaceBack(ce.uint16[Ee],ce.uint16[Ue],ce.uint16[Ue+1])}return[fe,ve]}($,J),this.elevatedGlobeTrianglesCenterLongitudes=$,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(J)}this.elevatedGlobeSegments=$n.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,F/Pt,0,U/Pt,0,0,O,R,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,s=i.gl;!this._dirty||this.texture instanceof Em||(this.texture?this.texture.update(this.image):(this.texture=new dy(i,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const s=this.elevatedGlobeTrianglesCenterLongitudes;let c=((S,I)=>S+360*Math.round((I-S)/360))(e+180,s[0]);const h=new $n,p=(S,I)=>{h.segments.push({vertexOffset:0,primitiveOffset:S,vertexLength:i.segments[0].vertexLength,primitiveLength:I,sortKey:void 0,vaos:{}})},y=.51*this.maxLongitudeTriangleSize;if(Math.abs(s[0]-c)<=y){const S=Le(s,0,s.length,c+y);return S===s.length||p(S,he(s,S+1,s.length,c+360-y)-S),h}c<s[0]&&(c+=360);const b=he(s,0,s.length,c-y);if(b===s.length)return p(0,s.length),h;p(0,b-0);const w=Le(s,b+1,s.length,c+y);return w!==s.length&&p(w,s.length-w),h}}const tC=(Math.pow(256,2)-1)/16907520;class M1 extends Wr{constructor(e,i,s){super(e,eC,i,s),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isLayerDraped(e){return!(e&&e._source instanceof T1&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[s,c]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(s)&&isNaN(c)||s===this._curRampRange[0]&&c===this._curRampRange[1]||(this.colorRamp=kd({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:s,end:c}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[s,c])}}const iC=new Fn({visibility:new gt(Ie["layout_raster-particle"].visibility)});var nC={paint:new Fn({"raster-particle-array-band":new gt(Ie["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new gt(Ie["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new na(Ie["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new gt(Ie["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new gt(Ie["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new gt(Ie["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new gt(Ie["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:iC};class S1 extends Wr{constructor(e,i,s){super(e,nC,i,s),this._updateColorRamp(),this.onRemove=c=>{this.colorRampTexture&&this.colorRampTexture.destroy(),this.transformFeedbackObject&&c.painter.context.gl.deleteTransformFeedback(this.transformFeedbackObject),this.tileFramebuffer&&this.tileFramebuffer.destroy()},this.lastInvalidatedAt=Xe.now()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isLayerDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=kd({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Xe.now()}}class rC extends Wr{constructor(e,i){super(e,{},i),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const sC=new Fn({visibility:new gt(Ie.layout_sky.visibility)});var oC={paint:new Fn({"sky-type":new gt(Ie.paint_sky["sky-type"]),"sky-atmosphere-sun":new gt(Ie.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new gt(Ie.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new gt(Ie.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new gt(Ie.paint_sky["sky-gradient-radius"]),"sky-gradient":new na(Ie.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new gt(Ie.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new gt(Ie.paint_sky["sky-atmosphere-color"]),"sky-opacity":new gt(Ie.paint_sky["sky-opacity"])}),layout:sC};function fy(t,e,i){const s=[0,0,1],c=r.bi.identity([]);return r.bi.rotateY(c,c,i?-Qe(t)+Math.PI:Qe(t)),r.bi.rotateX(c,c,-Qe(e)),r.N.transformQuat(s,s,c),r.N.normalize(s,s)}var aC={paint:new Fn({})};function E1(t,e){const i=Cm(t.projection,t.zoom,t.width,t.height),s=function(h,p,y,b,w){const S=new Me(y.lng-180*ol,y.lat),I=new Me(y.lng+180*ol,y.lat),P=h.project(S.lng,S.lat),R=h.project(I.lng,I.lat),O=-Math.atan2(R.y-P.y,R.x-P.x),F=Ui.fromLngLat(y);F.y=wt(F.y,-1+ol,1-ol);const U=F.toLngLat(),$=h.project(U.lng,U.lat),J=Ui.fromLngLat(U);J.x+=ol;const te=J.toLngLat(),ee=h.project(te.lng,te.lat),ce=C1(ee.x-$.x,ee.y-$.y,O),ae=Ui.fromLngLat(U);ae.y+=ol;const fe=ae.toLngLat(),ve=h.project(fe.lng,fe.lat),Se=C1(ve.x-$.x,ve.y-$.y,O),De=Math.abs(ce.x)/Math.abs(Se.y),Ee=r.a6.identity([]);r.a6.rotateZ(Ee,Ee,-O*(1-(w?0:b)));const Ue=r.a6.identity([]);return r.a6.scale(Ue,Ue,[1,1-(1-De)*b,1]),Ue[4]=-Se.x/Se.y*b,r.a6.rotateZ(Ue,Ue,O),r.a6.multiply(Ue,Ee,Ue),Ue}(t.projection,0,t.center,i,e),c=A1(t);return r.a6.scale(s,s,[c,c,1]),s}function A1(t){const e=t.projection,i=Cm(t.projection,t.zoom,t.width,t.height),s=I1(e,t.center),c=I1(e,Me.convert(e.center));return Math.pow(2,s*i+(1-i)*c)}function Cm(t,e,i,s,c=1/0){const h=t.range;if(!h)return 0;const p=Math.min(c,Math.max(i,s)),y=Math.log(p/1024)/Math.LN2;return Qt(h[0]+y,h[1]+y,e)}const ol=1/4e4;function I1(t,e){const i=wt(e.lat,-Ci,Ci),s=new Me(e.lng-180*ol,i),c=new Me(e.lng+180*ol,i),h=t.project(s.lng,i),p=t.project(c.lng,i),y=Ui.fromLngLat(s),b=Ui.fromLngLat(c),w=p.x-h.x,S=p.y-h.y,I=b.x-y.x,P=b.y-y.y,R=Math.sqrt((I*I+P*P)/(w*w+S*S));return Math.log(R)/Math.LN2}function C1(t,e,i){const s=Math.cos(i),c=Math.sin(i);return{x:t*s-e*c,y:t*c+e*s}}function P1(t,e,i){r.a6.identity(t),r.a6.rotateZ(t,t,Qe(e[2])),r.a6.rotateX(t,t,Qe(e[0])),r.a6.rotateY(t,t,Qe(e[1])),r.a6.scale(t,t,i),r.a6.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Pm(t,e,i,s,c,h,p,y){const b=[i[0]-e[0],i[1]-e[1],0],w=[s[0]-e[0],s[1]-e[1],0];if(r.N.length(b)<1e-12||r.N.length(w)<1e-12)return r.bi.identity(t);const S=r.N.cross([],b,w);r.N.normalize(S,S),r.N.subtract(w,s,e),b[2]=(h-c)*y,w[2]=(p-c)*y;const I=b;return r.N.cross(I,b,w),r.N.normalize(I,I),r.bi.rotationTo(t,S,I)}function py(t,e,i=!1){const s=Qa(e.zoom),c=function(h,p,y){const b=p.worldSize,w=[h[12],h[13],h[14]],S=Fi(w[1]/b),I=pi(w[0]/b),P=r.a6.identity([]),R=mi(1,S)*b,O=mi(1,0)*b*Pi(S,p.zoom),F=1/Bg(b);let U=O*F;if(y){const ee=Cm(p.projection,p.zoom,p.width,p.height,1024);U=F*p.projection.pixelSpaceConversion(p.center.lat,b,ee)}const $=Ne(S,I);r.N.add($,$,r.N.scale([],r.N.normalize([],$),R*U*w[2]));const J=function(ee){const ce=[ee[0],ee[1],ee[2]];let ae=[0,1,0];const fe=r.N.cross([],ae,ce);return r.N.cross(ae,ce,fe),r.N.squaredLength(ae)===0&&(ae=[0,1,0],r.N.cross(fe,ce,ae)),r.N.normalize(fe,fe),r.N.normalize(ae,ae),r.N.normalize(ce,ce),[fe[0],fe[1],fe[2],0,ae[0],ae[1],ae[2],0,ce[0],ce[1],ce[2],0,ee[0],ee[1],ee[2],1]}($);r.a6.scale(P,P,[U,U,U*R]),r.a6.translate(P,P,[-w[0],-w[1],-w[2]]);const te=r.a6.multiply([],p.globeMatrix,J);return r.a6.multiply(te,te,P),r.a6.multiply(te,te,h),te}(t,e,i);if(s>0){const h=function(p,y){const b=y.worldSize,w=mi(1,0)*b*Pi(y.center.lat,y.zoom)/Bg(b),S=mi(1,y.center.lat)*b,I=r.a6.identity([]);return r.a6.rotateY(I,I,Qe(y.center.lng)),r.a6.rotateX(I,I,Qe(y.center.lat)),r.a6.translate(I,I,[0,0,Q]),r.a6.scale(I,I,[w,w,w*S]),r.a6.translate(I,I,[y.point.x-.5*b,y.point.y-.5*b,0]),r.a6.multiply(I,I,p),r.a6.multiply(I,y.globeMatrix,I)}(t,e);return function(p,y,b){const w=(O,F,U)=>{const $=r.N.length(O),J=r.N.length(F),te=ua(O,F,U);return r.N.scale(te,te,1/r.N.length(te)*Ri($,J,U))},S=w([p[0],p[1],p[2]],[y[0],y[1],y[2]],b),I=w([p[4],p[5],p[6]],[y[4],y[5],y[6]],b),P=w([p[8],p[9],p[10]],[y[8],y[9],y[10]],b),R=ua([p[12],p[13],p[14]],[y[12],y[13],y[14]],b);return[S[0],S[1],S[2],0,I[0],I[1],I[2],0,P[0],P[1],P[2],0,R[0],R[1],R[2],1]}(c,h,s)}return c}function D1(t,e,i,s){const c=jn.projectAabbCorners(s,i);let h=Number.MAX_VALUE,p=-1;for(let w=0;w<c.length;++w){const S=c[w];S[0]=(.5*S[0]+.5)*e.width,S[1]=(.5-.5*S[1])*e.height,S[2]<h&&(p=w,h=S[2])}const y=w=>new le(c[w][0],c[w][1]);let b;switch(p){case 0:case 6:b=[y(1),y(5),y(4),y(7),y(3),y(2),y(1)];break;case 1:case 7:b=[y(0),y(4),y(5),y(6),y(2),y(3),y(0)];break;case 3:case 5:b=[y(1),y(0),y(4),y(7),y(6),y(2),y(1)];break;default:b=[y(1),y(5),y(6),y(7),y(3),y(0),y(1)]}if(Ns(t,b))return h}const lC=rn([{name:"a_pos_3f",components:3,type:"Float32"}]),cC=rn([{name:"a_color_3f",components:3,type:"Float32"}]),uC=rn([{name:"a_color_4f",components:4,type:"Float32"}]),hC=rn([{name:"a_uv_2f",components:2,type:"Float32"}]),dC=rn([{name:"a_normal_3f",components:3,type:"Float32"}]),fC=rn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),pC=rn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class L1{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class k1{constructor(){this.instancedDataArray=new Md,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class my{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,i,s,c){this.tileToMeter=Di(s);const h=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:p,id:y,index:b,sourceLayerIndex:w}of e){const S=sr(p,h);if(!this.layers[0]._featureFilter.filter(new On(this.zoom),S,s))continue;const I={id:y,sourceLayerIndex:w,index:b,geometry:h?S.geometry:fr(p,s,c),properties:p.properties,type:p.type,patterns:{}},P=this.addFeature(I,I.geometry,S);P&&i.featureIndex.insert(p,I.geometry,b,w,this.index,this.instancesPerModel[P].instancedDataArray.length,Pt/32)}this.lookup=null}update(e,i,s,c){for(const h in this.instancesPerModel){const p=this.instancesPerModel[h];for(const y in e)p.idToFeaturesIndex.hasOwnProperty(y)&&this.evaluate(p.features[p.idToFeaturesIndex[y]],e[y],p,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];for(const c of s.features){const h=this.layers[0],p=c.feature,y=this.canonical,b=h.paint.get("model-rotation").evaluate(p,{},y),w=h.paint.get("model-scale").evaluate(p,{},y),S=h.paint.get("model-translation").evaluate(p,{},y);r.N.exactEquals(c.rotation,b)&&r.N.exactEquals(c.scale,w)&&r.N.exactEquals(c.translation,S)||(this.evaluate(c,c.featureStates,s,!0),e=!0)}}return e}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];s.instancedDataArray.length<0||s.instancedDataArray.length===0||(s.instancedDataBuffer?s.instancedDataBuffer.updateData(s.instancedDataArray):s.instancedDataBuffer=e.createVertexBuffer(s.instancedDataArray,fC.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const e in this.instancesPerModel){const i=this.instancesPerModel[e];i.instancedDataArray.length!==0&&i.instancedDataBuffer&&i.instancedDataBuffer.destroy()}}addFeature(e,i,s){const c=this.layers[0],h=c.layout.get("model-id").evaluate(s,{},this.canonical);if(!h)return we(`modelId is not evaluated for layer ${c.id} and it is not going to get rendered.`),h;this.instancesPerModel[h]||(this.instancesPerModel[h]=new k1);const p=this.instancesPerModel[h],y=p.instancedDataArray,b=new L1(s,y.length);for(const w of i)for(const S of w){if(S.x<0||S.x>=Pt||S.y<0||S.y>=Pt)continue;const I=(this.lookupDim-1)/Pt,P=this.lookupDim*(S.y*I|0)+S.x*I|0;if(this.lookup){if(this.lookup[P]!==0)continue;this.lookup[P]=1}this.instanceCount++;const R=y.length;y.resize(R+1),p.instancesEvaluatedElevation.push(0),y.float32[16*R]=S.x,y.float32[16*R+1]=S.y}return b.instancedDataCount=p.instancedDataArray.length-b.instancedDataOffset,b.instancedDataCount>0&&(e.id&&(p.idToFeaturesIndex[e.id]=p.features.length),p.features.push(b),this.evaluate(b,{},p,!1)),h}evaluate(e,i,s,c){const h=this.layers[0],p=e.feature,y=this.canonical,b=e.rotation=h.paint.get("model-rotation").evaluate(p,i,y),w=e.scale=h.paint.get("model-scale").evaluate(p,i,y),S=e.translation=h.paint.get("model-translation").evaluate(p,i,y),I=h.paint.get("model-color").evaluate(p,i,y);I.a=h.paint.get("model-color-mix-intensity").evaluate(p,i,y);const P=[];this.maxVerticalOffset<S[2]&&(this.maxVerticalOffset=S[2]),this.maxScale=Math.max(Math.max(this.maxScale,w[0]),Math.max(w[1],w[2])),P1(P,b,w);const R=Math.round(100*I.a)+I.b/1.05;for(let O=0;O<e.instancedDataCount;++O){const F=e.instancedDataOffset+O,U=16*F,$=s.instancedDataArray.float32;let J=0;c&&(J=$[U+6]-s.instancesEvaluatedElevation[F]);const te=0|$[U+1];$[U]=(0|$[U])+I.r/1.05,$[U+1]=te+I.g/1.05,$[U+2]=R,$[U+3]=1/(y.z>10?this.tileToMeter:Di(y,te)),$[U+4]=S[0],$[U+5]=S[1],$[U+6]=S[2]+J,$[U+7]=P[0],$[U+8]=P[1],$[U+9]=P[2],$[U+10]=P[4],$[U+11]=P[5],$[U+12]=P[6],$[U+13]=P[8],$[U+14]=P[9],$[U+15]=P[10],s.instancesEvaluatedElevation[F]=S[2]}}}Bt(my,"ModelBucket",{omit:["layers"]}),Bt(k1,"PerModelAttributes"),Bt(L1,"ModelFeature");const mC=new Fn({visibility:new gt(Ie.layout_model.visibility),"model-id":new ti(Ie.layout_model["model-id"])});var _C={paint:new Fn({"model-opacity":new gt(Ie.paint_model["model-opacity"]),"model-rotation":new ti(Ie.paint_model["model-rotation"]),"model-scale":new ti(Ie.paint_model["model-scale"]),"model-translation":new ti(Ie.paint_model["model-translation"]),"model-color":new ti(Ie.paint_model["model-color"]),"model-color-mix-intensity":new ti(Ie.paint_model["model-color-mix-intensity"]),"model-type":new gt(Ie.paint_model["model-type"]),"model-cast-shadows":new gt(Ie.paint_model["model-cast-shadows"]),"model-receive-shadows":new gt(Ie.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new gt(Ie.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new ti(Ie.paint_model["model-emissive-strength"]),"model-roughness":new ti(Ie.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new ti(Ie.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new gt(Ie.paint_model["model-cutoff-fade-range"])}),layout:mC};const xc=64,Nu={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function R1(t,e,i,s,c,h,p,y,b,w=!1){const S=i.zoom,I=i.project(s),P=Pi(s.lat,S),R=1/P;r.a6.identity(t),r.a6.translate(t,t,[I.x+p[0]*R,I.y+p[1]*R,p[2]]);let O=1,F=1;const U=i.worldSize;if(w){if(i.projection.name==="mercator"){let ee=0;i.elevation&&(ee=i.elevation.getAtPointOrZero(new Ui(I.x/U,I.y/U),0));const ce=r.a7.transformMat4([],[I.x,I.y,ee,1],i.projMatrix)[3]/i.cameraToCenterDistance;O=ce,F=ce*Pi(i.center.lat,S)}else if(i.projection.name==="globe"){const ee=py(t,i),ce=r.a6.multiply([],i.projMatrix,ee),ae=[0,0,0,1];r.a7.transformMat4(ae,ae,ce);const fe=ae[3]/i.cameraToCenterDistance,ve=Qa(S),Se=i.projection.pixelsPerMeter(s.lat,U)*Pi(s.lat,S),De=i.projection.pixelsPerMeter(i.center.lat,U)*Pi(i.center.lat,S);O=fe/Ri(Se,Bn(i.center.lat),ve),F=fe*P/Se,O*=De,F*=De}}else O=R;r.a6.scale(t,t,[O,O,F]);const $=[...t],J=e.orientation,te=[];if(P1(te,[J[0]+c[0],J[1]+c[1],J[2]+c[2]],h),r.a6.multiply(t,$,te),y&&i.elevation){let ee=0;const ce=[];if(b&&i.elevation){ee=function(ve,Se,De,Ee,Ue){const Ye=Se.elevation;if(!Ye)return 0;const Fe=jn.projectAabbCorners(De,Ee),Ze=mi(1,Ue.lat)*Se.worldSize,ze=function(ii,Mi){const ai=[0,0,1],Si=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const fi of Si){const zi=ii[fi.corners[0]],_i=ii[fi.corners[1]],_n=ii[fi.corners[2]],Gi=[_i[0]-zi[0],_i[1]-zi[1],Mi*(_i[2]-zi[2])],Wi=r.N.cross(Gi,Gi,[_n[0]-zi[0],_n[1]-zi[1],Mi*(_n[2]-zi[2])]);r.N.normalize(Wi,Wi),fi.dotProductWithUp=r.N.dot(Wi,ai)}return Si.sort((fi,zi)=>fi.dotProductWithUp-zi.dotProductWithUp),Si[0].corners}(Fe,Ze),He=Fe[ze[0]],vt=Fe[ze[1]],Ke=Fe[ze[2]],jt=Fe[ze[3]],Lt=Ye.getAtPointOrZero(new Ui(He[0]/Se.worldSize,He[1]/Se.worldSize),0),rt=Ye.getAtPointOrZero(new Ui(vt[0]/Se.worldSize,vt[1]/Se.worldSize),0),oi=Ye.getAtPointOrZero(new Ui(Ke[0]/Se.worldSize,Ke[1]/Se.worldSize),0),Xt=Ye.getAtPointOrZero(new Ui(jt[0]/Se.worldSize,jt[1]/Se.worldSize),0),Ut=(Lt+Xt)/2,st=(rt+oi)/2;return Ut>st?rt<oi?Pm(ve,vt,jt,He,rt,Xt,Lt,Ze):Pm(ve,Ke,He,jt,oi,Lt,Xt,Ze):Lt<Xt?Pm(ve,He,vt,Ke,Lt,rt,oi,Ze):Pm(ve,jt,Ke,vt,Xt,oi,rt,Ze),Math.max(Ut,st)}(ce,i,e.aabb,t,s);const ae=r.a6.fromQuat([],ce),fe=r.a6.multiply([],ae,te);r.a6.multiply(t,$,fe)}else ee=i.elevation.getAtPointOrZero(new Ui(I.x/U,I.y/U),0);ee!==0&&(t[14]+=ee)}}function Xd(t,e,i=!1){t.uploaded||(t.gfxTexture=new dy(e,t.image,i?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function gC(t,e,i){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,lC.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,dC.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,hC.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?cC:uC).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,pC.members,!0)),t.segments=$n.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);const s=t.material;s.pbrMetallicRoughness.baseColorTexture&&Xd(s.pbrMetallicRoughness.baseColorTexture,e),s.pbrMetallicRoughness.metallicRoughnessTexture&&Xd(s.pbrMetallicRoughness.metallicRoughnessTexture,e),s.normalTexture&&Xd(s.normalTexture,e),s.occlusionTexture&&Xd(s.occlusionTexture,e,i),s.emissionTexture&&Xd(s.emissionTexture,e)}function _y(t,e,i){if(t.meshes)for(const s of t.meshes)gC(s,e,i);if(t.children)for(const s of t.children)_y(s,e,i)}function Dm(t){if(t.meshes)for(const e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(const e of t.children)Dm(e)}function gy(t){if(t.meshes)for(const i of t.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(const i of t.children)gy(i)}class yC{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class xC{constructor(){this.tasks={},this.taskQueue=[],In(["process"],this),this.invoker=new yC(this.process),this.nextId=0}add(e,i){const s=this.nextId++,c=function({type:h,isSymbolTile:p,zoom:y}){return y=y||0,h==="message"?0:h!=="maybePrepare"||p?h!=="parseTile"||p?h==="parseTile"&&p?300-y:h==="maybePrepare"&&p?400-y:500:200-y:100-y}(i);if(c===0){Ct();try{e()}finally{}return null}return this.tasks[s]={fn:e,metadata:i,priority:c,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){Ct();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let c=0;c<this.taskQueue.length;c++){const h=this.tasks[this.taskQueue[c]];h.priority<i&&(i=h.priority,e=c)}if(e===null)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class z1{constructor(e,i,s){this.target=e,this.parent=i,this.mapId=s,this.callbacks={},this.cancelCallbacks={},In(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new xC}send(e,i,s,c,h=!1,p){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=p,this.callbacks[y]=s);const b=new Set;return this.target.postMessage({id:y,type:e,hasCallback:!!s,targetMapId:c,mustQueue:h,sourceMapId:this.mapId,data:Mo(i,b)},b),{cancel:()=>{s&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(e){const i=e.data,s=i.id;if(s&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const c=this.cancelCallbacks[s];delete this.cancelCallbacks[s],c&&c.cancel()}else if(i.mustQueue||Ct()){const c=this.callbacks[s],h=this.scheduler.add(()=>this.processTask(s,i),c&&c.metadata||{type:"message"});h&&(this.cancelCallbacks[s]=h)}else this.processTask(s,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const s=this.callbacks[e];delete this.callbacks[e],s&&(i.error?s(ta(i.error)):s(null,ta(i.data)))}else{const s=new Set,c=i.hasCallback?(p,y)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:p?Mo(p):null,data:Mo(y,s)},s)}:p=>{},h=ta(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,h,c);else if(this.parent.getWorkerSource){const p=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,p[0],h.source,h.scope)[p[1]](h,c)}else c(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class Vu{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=xn();const s=this.workerPool.acquire(this.id);for(let c=0;c<s.length;c++){const h=new Vu.Actor(s[c],i,this.id);h.name=`Worker ${c}`,this.actors.push(h)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,s){Ji(this.actors,(c,h)=>{c.send(e,i,h)},s=s||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}Vu.Actor=z1;var Yd={workerUrl:"",workerClass:null,workerParams:void 0};function vC(){return Yd.workerClass!=null?new Yd.workerClass:new self.Worker(Yd.workerUrl,Yd.workerParams)}const yy="mapboxgl_preloaded_worker_pool";class Kd{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Kd.workerCount;)this.workers.push(new vC);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[yy]}numActive(){return Object.keys(this.active).length}}let Jd;function Lm(){return Jd||(Jd=new Kd),Jd}Kd.workerCount=2;let km,xy,io,Uu,vy,ju=null;function O1(){return Ct()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:xy||G.DRACO_URL}function F1(){if(Ct()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Uu)return Uu;const t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Uu=WebAssembly.validate(t)?G.MESHOPT_SIMD_URL:G.MESHOPT_URL,Uu}const Rm={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},bC={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Qd={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function B1(t,e,i){const s=i.json.bufferViews.length,c=i.buffers.length;e.bufferView=s,i.json.bufferViews[s]={buffer:c,byteLength:t.byteLength},i.buffers[c]=t}const by="KHR_draco_mesh_compression";function wC(t,e){const i=t.extensions&&t.extensions[by];if(!i)return;const s=new io.Decoder,c=j1(e,i.bufferView),h=new io.Mesh;if(!s.DecodeArrayToMesh(c,c.byteLength,h))throw new Error("Failed to decode Draco mesh");const p=e.json.accessors[t.indices],y=Rm[p.componentType],b=p.count*y.BYTES_PER_ELEMENT,w=io._malloc(b);y===Uint16Array?s.GetTrianglesUInt16Array(h,b,w):s.GetTrianglesUInt32Array(h,b,w),B1(io.memory.buffer.slice(w,w+b),p,e),io._free(w);for(const S of Object.keys(i.attributes)){const I=s.GetAttributeByUniqueId(h,i.attributes[S]),P=e.json.accessors[t.attributes[S]],R=bC[P.componentType],O=P.count*Qd[P.type]*Rm[P.componentType].BYTES_PER_ELEMENT,F=io._malloc(O);s.GetAttributeDataArrayForAllPoints(h,I,io[R],O,F),B1(io.memory.buffer.slice(F,F+O),P,e),io._free(F)}s.destroy(),h.destroy(),delete t.extensions[by]}const zm="EXT_meshopt_compression";function TC(t,e){if(!t.extensions||!t.extensions[zm])return;const i=t.extensions[zm],s=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),c=new Uint8Array(i.count*i.byteStride);vy.decodeGltfBuffer(c,i.count,i.byteStride,s,i.mode,i.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=c.buffer,delete t.extensions[zm]}const N1=1179937895,V1=new TextDecoder("utf8");function U1(t,e){return new URL(t,e).href}function MC(t,e,i,s){return fetch(U1(t.uri,s)).then(c=>c.arrayBuffer()).then(c=>{e.buffers[i]=c})}function j1(t,e){const i=t.json.bufferViews[e];return new Uint8Array(t.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function SC(t,e,i,s){if(t.uri){const c=U1(t.uri,s);return fetch(c).then(h=>h.blob()).then(h=>createImageBitmap(h)).then(h=>{e.images[i]=h})}if(t.bufferView!==void 0){const c=j1(e,t.bufferView),h=new Blob([c],{type:t.mimeType});return createImageBitmap(h).then(p=>{e.images[i]=p})}}function G1(t,e=0,i){const s={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===N1){const S=new Uint32Array(t,e);let I=2;const P=(S[I++]>>2)-3,R=S[I++]>>2;if(I++,s.json=JSON.parse(V1.decode(S.subarray(I,I+R))),I+=R,I<P){const O=S[I++];I++;const F=e+(I<<2);s.buffers[0]=t.slice(F,F+O)}}else s.json=JSON.parse(V1.decode(new Uint8Array(t,e)));const{buffers:c,images:h,meshes:p,extensionsUsed:y,bufferViews:b}=s.json;let w=Promise.resolve();if(c){const S=[];for(let I=0;I<c.length;I++){const P=c[I];P.uri?S.push(MC(P,s,I,i)):s.buffers[I]||(s.buffers[I]=null)}w=Promise.all(S)}return w.then(()=>{const S=[],I=y&&y.includes(by),P=y&&y.includes(zm);if(I&&S.push(function(){if(!io)return km||(km=function(R){let O,F=null;function U(){O=new Uint8Array(F.buffer)}function $(){throw new Error("Unexpected Draco error.")}const J={a:{a:$,d:function(te,ee,ce){return O.copyWithin(te,ee,ee+ce)},c:function(te){const ee=O.length,ce=Math.max(te>>>0,Math.ceil(1.2*ee)),ae=Math.ceil((ce-ee)/65536);try{return F.grow(ae),U(),!0}catch{return!1}},b:$}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(R,J):R.then(te=>te.arrayBuffer()).then(te=>WebAssembly.instantiate(te,J))).then(te=>{const{Rb:ee,Qb:ce,P:ae,T:fe,X:ve,Ja:Se,La:De,Qa:Ee,Va:Ue,Wa:Ye,eb:Fe,jb:Ze,f:ze,e:He,yb:vt,zb:Ke,Ab:jt,Bb:Lt,Db:rt,Gb:oi}=te.instance.exports;F=He;const Xt=(()=>{let Ut=0,st=0,ii=0,Mi=0;return ai=>{ii&&(ee(Mi),ee(Ut),st+=ii,ii=Ut=0),Ut||(st+=128,Ut=ce(st));const Si=ai.length+7&-8;let fi=Ut;Si>=st&&(ii=Si,fi=Mi=ce(Si));for(let zi=0;zi<ai.length;zi++)O[fi+zi]=ai[zi];return fi}})();return U(),ze(),{memory:He,_free:ee,_malloc:ce,Mesh:class{constructor(){this.ptr=ae()}destroy(){fe(this.ptr)}},Decoder:class{constructor(){this.ptr=Se()}destroy(){Ze(this.ptr)}DecodeArrayToMesh(Ut,st,ii){const Mi=Xt(Ut),ai=De(this.ptr,Mi,st,ii.ptr);return!!ve(ai)}GetAttributeByUniqueId(Ut,st){return{ptr:Ee(this.ptr,Ut.ptr,st)}}GetTrianglesUInt16Array(Ut,st,ii){Ue(this.ptr,Ut.ptr,st,ii)}GetTrianglesUInt32Array(Ut,st,ii){Ye(this.ptr,Ut.ptr,st,ii)}GetAttributeDataArrayForAllPoints(Ut,st,ii,Mi,ai){Fe(this.ptr,Ut.ptr,st.ptr,ii,Mi,ai)}},DT_INT8:vt(),DT_UINT8:Ke(),DT_INT16:jt(),DT_UINT16:Lt(),DT_UINT32:rt(),DT_FLOAT32:oi()}})}(fetch(O1())),km.then(R=>{io=R,km=void 0}))}()),P&&S.push(function(){if(vy)return;const R=function(O){let F;const U=WebAssembly.instantiateStreaming(O,{}).then(te=>{F=te.instance,F.exports.__wasm_call_ctors()}),$={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},J={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:U,supported:!0,decodeGltfBuffer(te,ee,ce,ae,fe,ve){(function(Se,De,Ee,Ue,Ye,Fe,Ze){const ze=Se.exports.sbrk,He=Ue+3&-4,vt=ze(He*Ye),Ke=ze(Fe.length),jt=new Uint8Array(Se.exports.memory.buffer);jt.set(Fe,Ke);const Lt=De(vt,Ue,Ye,Ke,Fe.length);if(Lt===0&&Ze&&Ze(vt,He,Ye),Ee.set(jt.subarray(vt,vt+Ue*Ye)),ze(vt-ze(0)),Lt!==0)throw new Error(`Malformed buffer data: ${Lt}`)})(F,F.exports[J[fe]],te,ee,ce,ae,F.exports[$[ve]])}}}(fetch(F1()));return R.ready.then(()=>{vy=R})}()),h)for(let R=0;R<h.length;R++)S.push(SC(h[R],s,R,i));return(S.length?Promise.all(S):Promise.resolve()).then(()=>{if(I&&p)for(const{primitives:R}of p)for(const O of R)wC(O,s);if(P&&p&&b)for(const R of b)TC(R,s);return s})})}class $1{constructor(e,i,s){if(this.triangleCount=i.length/3,this.min=new le(0,0),this.max=new le(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0||s===0)return;const c=e.map(S=>S.x),h=e.map(S=>S.y);this.min=new le(Math.min(...c),Math.min(...h)),this.max=new le(Math.max(...c),Math.max(...h));const p=this.max.sub(this.min);p.x=Math.max(p.x,1),p.y=Math.max(p.y,1);const y=Math.max(p.x,p.y)/s;this.cellsX=Math.max(1,Math.ceil(p.x/y)),this.cellsY=Math.max(1,Math.ceil(p.y/y)),this.xScale=1/y,this.yScale=1/y;const b=[];for(let S=0;S<this.triangleCount;S++){const I=e[i[3*S+0]].sub(this.min),P=e[i[3*S+1]].sub(this.min),R=e[i[3*S+2]].sub(this.min),O=al(Math.floor(Math.min(I.x,P.x,R.x)),this.xScale,this.cellsX),F=al(Math.floor(Math.max(I.x,P.x,R.x)),this.xScale,this.cellsX),U=al(Math.floor(Math.min(I.y,P.y,R.y)),this.yScale,this.cellsY),$=al(Math.floor(Math.max(I.y,P.y,R.y)),this.yScale,this.cellsY),J=new le(0,0),te=new le(0,0),ee=new le(0,0),ce=new le(0,0);for(let ae=U;ae<=$;++ae){J.y=te.y=ae*y,ee.y=ce.y=(ae+1)*y;for(let fe=O;fe<=F;++fe)J.x=ee.x=fe*y,te.x=ce.x=(fe+1)*y,(_g(I,P,R,J,te,ce)||_g(I,P,R,J,ce,ee))&&b.push({cellIdx:ae*this.cellsX+fe,triIdx:S})}}if(b.length===0)return;b.sort((S,I)=>S.cellIdx-I.cellIdx||S.triIdx-I.triIdx);let w=0;for(;w<b.length;){const S=b[w].cellIdx,I={start:this.payload.length,len:0};for(;w<b.length&&b[w].cellIdx===S;)++I.len,this.payload.push(b[w++].triIdx);this.cells[S]=I}}query(e,i,s){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let b=0;b<this.lookup.length;b++)this.lookup[b]=0;const c=al(e.x-this.min.x,this.xScale,this.cellsX),h=al(i.x-this.min.x,this.xScale,this.cellsX),p=al(e.y-this.min.y,this.yScale,this.cellsY),y=al(i.y-this.min.y,this.yScale,this.cellsY);for(let b=p;b<=y;b++)for(let w=c;w<=h;w++){const S=this.cells[b*this.cellsX+w];if(S)for(let I=0;I<S.len;I++){const P=this.payload[S.start+I],R=Math.floor(P/8),O=1<<P%8;if(!(this.lookup[R]&O)&&(this.lookup[R]|=O,s.push(P),s.length===this.triangleCount))return}}}}function al(t,e,i){return Math.max(0,Math.min(i-1,Math.floor(t*e)))}function vc(t,e){const i=t.json.bufferViews[e.bufferView],s=Rm[e.componentType];return new s(t.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==Qd[e.type]*s.BYTES_PER_ELEMENT?i.byteStride/s.BYTES_PER_ELEMENT:Qd[e.type]))}function wy(t,e,i,s){const c=Rm[e.componentType],h=function(S){switch(S){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(c),p=t.json.bufferViews[e.bufferView],y=p.byteStride?p.byteStride/c.BYTES_PER_ELEMENT:Qd[e.type],b=i.float32,w=b.length/i.capacity;for(let S=0,I=0;S<e.count*y;S+=y,I+=w)for(let P=0;P<w;P++)b[I+P]=s[S+P]*h;i._trim()}function EC(t,e,i){const s=t.indices,c=t.attributes,h={};h.indexArray=new hr;const p=e.json.accessors[s],y=p.count/3;h.indexArray.reserve(y);const b=vc(e,p);for(let P=0;P<y;P++)h.indexArray.emplaceBack(b[3*P],b[3*P+1],b[3*P+2]);h.indexArray._trim(),h.vertexArray=new ra;const w=e.json.accessors[c.POSITION];h.vertexArray.reserve(w.count);const S=vc(e,w);for(let P=0;P<w.count;P++)h.vertexArray.emplaceBack(S[3*P],S[3*P+1],S[3*P+2]);if(h.vertexArray._trim(),h.aabb=new jn(w.min,w.max),h.centroid=function(P,R){const O=[0,0,0],F=P.length;if(F>0){for(let U=0;U<F;U++){const $=3*P[U];O[0]+=R[$],O[1]+=R[$+1],O[2]+=R[$+2]}O[0]/=F,O[1]/=F,O[2]/=F}return O}(b,S),c.COLOR_0!==void 0){const P=e.json.accessors[c.COLOR_0],R=Qd[P.type],O=vc(e,P);h.colorArray=R===3?new ra:new Io,h.colorArray.resize(P.count),wy(e,P,h.colorArray,O)}if(c.NORMAL!==void 0){h.normalArray=new ra;const P=e.json.accessors[c.NORMAL];h.normalArray.resize(P.count);const R=vc(e,P);wy(e,P,h.normalArray,R)}if(c.TEXCOORD_0!==void 0&&i.length>0){h.texcoordArray=new ac;const P=e.json.accessors[c.TEXCOORD_0];h.texcoordArray.resize(P.count);const R=vc(e,P);wy(e,P,h.texcoordArray,R)}if(c._FEATURE_ID_RGBA4444!==void 0){const P=e.json.accessors[c._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(h.featureData=vc(e,P))}c._FEATURE_RGBA4444!==void 0&&(h.featureData=new Uint32Array(vc(e,e.json.accessors[c._FEATURE_RGBA4444]).buffer));const I=t.material;return h.material=function(P,R){const{emissiveFactor:O=[0,0,0],alphaMode:F="OPAQUE",alphaCutoff:U=.5,normalTexture:$,occlusionTexture:J,emissiveTexture:te,doubleSided:ee}=P,{baseColorFactor:ce=[1,1,1,1],metallicFactor:ae=1,roughnessFactor:fe=1,baseColorTexture:ve,metallicRoughnessTexture:Se}=P.pbrMetallicRoughness||{},De=J?R[J.index]:void 0;if(J&&J.extensions&&J.extensions.KHR_texture_transform&&De){const Ee=J.extensions.KHR_texture_transform;De.offsetScale=[Ee.offset[0],Ee.offset[1],Ee.scale[0],Ee.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Kn(...ce),metallicFactor:ae,roughnessFactor:fe,baseColorTexture:ve?R[ve.index]:void 0,metallicRoughnessTexture:Se?R[Se.index]:void 0},doubleSided:ee,emissiveFactor:O,alphaMode:F,alphaCutoff:U,normalTexture:$?R[$.index]:void 0,occlusionTexture:De,emissionTexture:te?R[te.index]:void 0,defined:P.defined===void 0}}(I!==void 0?e.json.materials[I]:{defined:!1},i),h}function W1(t,e,i){const{matrix:s,rotation:c,translation:h,scale:p,mesh:y,extras:b,children:w}=t,S={};if(S.matrix=s||r.a6.fromRotationTranslationScale([],c||[0,0,0,1],h||[0,0,0],p||[1,1,1]),y!==void 0){S.meshes=i[y];const I=S.anchor=[0,0];for(const P of S.meshes){const{min:R,max:O}=P.aabb;I[0]+=R[0]+O[0],I[1]+=R[1]+O[1]}I[0]=Math.floor(I[0]/S.meshes.length/2),I[1]=Math.floor(I[1]/S.meshes.length/2)}if(b&&(b.id&&(S.id=b.id),b.lights&&(S.lights=function(I){if(!I.length)return[];const P=function($){const J=atob($),te=new Uint8Array(J.length);for(let ee=0;ee<J.length;ee++)te[ee]=J.codePointAt(ee);return te}(I),R=[],O=P.length/24,F=new Uint16Array(P.buffer),U=new Float32Array(P.buffer);for(let $=0;$<O;$++){const J=F[2*$*6]/30,te=F[2*$*6+1]/30,ee=F[2*$*6+10]/100,ce=U[6*$+1],ae=U[6*$+2],fe=U[6*$+3],ve=U[6*$+4],Se=fe-ce,De=ve-ae,Ee=Math.hypot(Se,De);R.push({pos:[ce+.5*Se,ae+.5*De,te],normal:[De/Ee,-Se/Ee,0],width:Ee,height:J,depth:ee,points:[ce,ae,fe,ve]})}return R}(b.lights))),w){const I=[];for(const P of w)I.push(W1(e.json.nodes[P],e,i));S.children=I}return S}function AC(t){if(t.vertices.length===0||t.indices.length===0)return null;const[e,i]=[t.vertices[0].clone(),t.vertices[0].clone()];for(let p=1;p<t.vertices.length;++p){const y=t.vertices[p];e.x=Math.min(e.x,y.x),e.y=Math.min(e.y,y.y),i.x=Math.max(i.x,y.x),i.y=Math.max(i.y,y.y)}const s=Math.ceil(Math.max(i.x-e.x,i.y-e.y)/256),c=Math.max(8,s),h=new $1(t.vertices,t.indices,c);return{vertices:t.vertices,indices:t.indices,grid:h,min:e,max:i}}function IC(t){if(!t.extras||!t.extras.ground)return null;const e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const s=[];for(const p of i){if(!Array.isArray(p)||p.length!==2)continue;const y=p[0],b=p[1];typeof y=="number"&&typeof b=="number"&&s.push(new le(y,b))}if(s.length<3)return null;s.length>1&&s[s.length-1].equals(s[0])&&s.pop();let c=0;for(let p=0;p<s.length;p++){const y=s[p],b=s[(p+1)%s.length],w=s[(p+2)%s.length];c+=(y.x-b.x)*(w.y-b.y)-(w.x-b.x)*(y.y-b.y)}c>0&&s.reverse();const h=im(s.flatMap(p=>[p.x,p.y]),[]);return h.length===0?null:{vertices:s,indices:h}}function CC(t){const e=[],i=[];let s=0;for(const c of t){s=e.length;const h=c.vertexArray.float32,p=c.indexArray.uint16;for(let y=0;y<c.vertexArray.length;y++)e.push(new le(h[3*y+0],h[3*y+1]));for(let y=0;y<3*c.indexArray.length;y++)i.push(p[y]+s)}if(i.length%3!=0)return null;for(let c=0;c<i.length;c+=3){const h=e[i[c+0]],p=e[i[c+1]],y=e[i[c+2]];(h.x-p.x)*(y.y-p.y)-(y.x-p.x)*(h.y-p.y)>0&&([i[c+1],i[c+2]]=[i[c+2],i[c+1]])}return{vertices:e,indices:i}}function H1(t){const e=function(b,w){const S=[],I=WebGL2RenderingContext;if(b.json.textures)for(const P of b.json.textures){const R={magFilter:I.LINEAR,minFilter:I.NEAREST,wrapS:I.REPEAT,wrapT:I.REPEAT};P.sampler!==void 0&&Object.assign(R,b.json.samplers[P.sampler]),S.push({image:w[P.source],sampler:R,uploaded:!1})}return S}(t,t.images),i=function(b,w){const S=[];for(const I of b.json.meshes){const P=[];for(const R of I.primitives)P.push(EC(R,b,w));S.push(P)}return S}(t,e),{scenes:s,scene:c,nodes:h}=t.json,p=s?s[c||0].nodes:h,y=[];for(const b of p)y.push(W1(h[b],t,i));return function(b,w,S){const I={},P=new Set;for(let R=0;R<b.length;R++){const O=S[w[R]];if(!O.extras)continue;const F=O.extras["mapbox:footprint:version"],U=O.extras["mapbox:footprint:id"];(F||U)&&P.add(R),F==="1.0.0"&&U&&(I[U]=R)}for(let R=0;R<b.length;R++){if(P.has(R))continue;const O=b[R],F=S[w[R]];if(!F.extras)continue;let U=null;O.id in I&&(U=CC(b[I[O.id]].meshes)),U||(U=IC(F)),U&&(O.footprint=AC(U))}if(P.size>0){const R=Array.from(P.values()).sort((O,F)=>O-F);for(let O=R.length-1;O>=0;O--)b.splice(R[O],1)}}(y,p,t.json.nodes),y}function PC(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);const e=t.vertexArray.float32,i=t.aabb.min[0]-1,s=t.aabb.min[1]-1,c=xc/(t.aabb.max[0]-i+2),h=xc/(t.aabb.max[1]-s+2);for(let p=0;p<e.length;p+=3){const y=e[p+2],b=(e[p+0]-i)*c|0,w=(e[p+1]-s)*h|0;y>t.heightmap[w*xc+b]&&(t.heightmap[w*xc+b]=y)}}function DC(t,e){const i={};i.indexArray=new hr,i.indexArray.reserve(4*t.length),i.vertexArray=new ra,i.vertexArray.reserve(10*t.length),i.colorArray=new Io,i.vertexArray.reserve(10*t.length);let s=0;for(const p of t){const y=Math.min(10,Math.max(4,1.3*p.height))*e,b=[-p.normal[1],p.normal[0],0],w=Math.min(.29,.1*p.width/p.depth),S=p.width-2*p.depth*e*(w+.01),I=r.N.scaleAndAdd([],p.pos,b,S/2),P=r.N.scaleAndAdd([],p.pos,b,-S/2),R=[I[0],I[1],I[2]+p.height],O=[P[0],P[1],P[2]+p.height],F=r.N.scaleAndAdd([],p.normal,b,w);r.N.scale(F,F,y);const U=r.N.scaleAndAdd([],p.normal,b,-w);r.N.scale(U,U,y),r.N.add(F,I,F),r.N.add(U,P,U),I[2]+=.1,P[2]+=.1,i.vertexArray.emplaceBack(F[0],F[1],F[2]),i.vertexArray.emplaceBack(U[0],U[1],U[2]),i.vertexArray.emplaceBack(I[0],I[1],I[2]),i.vertexArray.emplaceBack(P[0],P[1],P[2]),i.vertexArray.emplaceBack(R[0],R[1],R[2]),i.vertexArray.emplaceBack(O[0],O[1],O[2]),i.vertexArray.emplaceBack(I[0],I[1],I[2]),i.vertexArray.emplaceBack(P[0],P[1],P[2]),i.vertexArray.emplaceBack(F[0],F[1],F[2]),i.vertexArray.emplaceBack(U[0],U[1],U[2]);const $=S/y/2;i.colorArray.emplaceBack(-$-w,-1,$,.8),i.colorArray.emplaceBack($+w,-1,$,.8),i.colorArray.emplaceBack(-$,0,$,1.3),i.colorArray.emplaceBack($,0,$,1.3),i.colorArray.emplaceBack($+w,-.8,$,.7),i.colorArray.emplaceBack($+w,-.8,$,.7),i.colorArray.emplaceBack(0,0,$,1.3),i.colorArray.emplaceBack(0,0,$,1.3),i.colorArray.emplaceBack($+w,-1.2,$,.8),i.colorArray.emplaceBack($+w,-1.2,$,.8),i.indexArray.emplaceBack(6+s,4+s,8+s),i.indexArray.emplaceBack(7+s,9+s,5+s),i.indexArray.emplaceBack(0+s,1+s,2+s),i.indexArray.emplaceBack(1+s,3+s,2+s),s+=10}const c={defined:!0,emissiveFactor:[0,0,0]},h={};return h.baseColorFactor=Kn.white,c.pbrMetallicRoughness=h,i.material=c,i.aabb=new jn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}Bt($1,"TriangleGridIndex");class q1{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const s=e[i];this._stringToNumber[s]=i,this._numberToString[i]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const LC=["tile","layer","source","sourceLayer","state"];class Z1{constructor(e,i,s,c,h){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=s,this._y=c,this.properties=e.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const i of LC)this[i]!==void 0&&(e[i]=this[i]);return e}}class X1{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new qs(Pt,16,0),this.featureIndexArray=new Rp,this.promoteId=i,this.is3DTile=!1}insert(e,i,s,c,h,p=0,y=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,c,h,p);const w=this.grid;for(let S=0;S<i.length;S++){const I=i[S],P=[1/0,1/0,-1/0,-1/0];for(let R=0;R<I.length;R++){const O=I[R];P[0]=Math.min(P[0],O.x),P[1]=Math.min(P[1],O.y),P[2]=Math.max(P[2],O.x),P[3]=Math.max(P[3],O.y)}y!==0&&(P[0]-=y,P[1]-=y,P[2]+=y,P[3]+=y),P[0]<Pt&&P[1]<Pt&&P[2]>=0&&P[3]>=0&&w.insert(b,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Xg(new Ru(this.rawTileData)).layers,this.sourceLayerCoder=new q1(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,s,c){this.loadVTLayers();const h=e.params||{},p=rs(h.filter),y=e.tileResult,b=e.transform,w=y.bufferedTilespaceBounds,S=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(O,F,U,$)=>_x(y.bufferedTilespaceGeometry,O,F,U,$));S.sort(kC);let I=null;b.elevation&&S.length>0&&(I=Cu.create(b.elevation,this.tileID));const P={};let R;for(let O=0;O<S.length;O++){const F=S[O];if(F===R)continue;R=F;const U=this.featureIndexArray.get(F);let $=null;if(this.is3DTile){const J=this.bucketLayerIDs[0][0],te=i[J];if(te.type!=="model")continue;const{queryFeature:ee,intersectionZ:ce}=te.queryIntersectsMatchingFeature(y,U.featureIndex,p,b);ee&&this.appendToResult(P,J,U.featureIndex,ee,ce)}else this.loadMatchingFeature(P,U,p,h.layers,h.availableImages,i,s,c,(J,te,ee,ce=0)=>($||($=fr(J,this.tileID.canonical,e.tileTransform)),te.queryIntersectsFeature(y,J,ee,$,this.z,e.transform,e.pixelPosMatrix,I,ce)))}return P}loadMatchingFeature(e,i,s,c,h,p,y,b,w){const{featureIndex:S,bucketIndex:I,sourceLayerIndex:P,layoutVertexArrayOffset:R}=i,O=this.bucketLayerIDs[I];if(c&&!function(J,te){for(let ee=0;ee<J.length;ee++)if(te.indexOf(J[ee])>=0)return!0;return!1}(c,O))return;const F=this.sourceLayerCoder.decode(P),U=this.vtLayers[F].feature(S);if(s.needGeometry){const J=sr(U,!0);if(!s.filter(new On(this.tileID.overscaledZ),J,this.tileID.canonical))return}else if(!s.filter(new On(this.tileID.overscaledZ),U))return;const $=this.getId(U,F);for(let J=0;J<O.length;J++){const te=O[J];if(c&&c.indexOf(te)<0)continue;const ee=p[te];if(!ee)continue;let ce={};$!==void 0&&b&&(ce=b.getState(ee.sourceLayer||"_geojsonTileLayer",$));const ae=!w||w(U,ee,ce,R);if(!ae)continue;const fe=new Z1(U,this.z,this.x,this.y,$),ve=Nt({},y[te]);ve.paint=Y1(ve.paint,ee.paint,U,ce,h),ve.layout=Y1(ve.layout,ee.layout,U,ce,h),fe.layer=ve,this.appendToResult(e,te,S,fe,ae)}}appendToResult(e,i,s,c,h){let p=e[i];p===void 0&&(p=e[i]=[]),p.push({featureIndex:s,feature:c,intersectionZ:h})}lookupSymbolFeatures(e,i,s,c,h,p,y,b){const w={};this.loadVTLayers();const S=rs(h);for(const I of e)this.loadMatchingFeature(w,{bucketIndex:s,sourceLayerIndex:c,featureIndex:I,layoutVertexArrayOffset:0},S,p,y,b,i);return w}loadFeature(e){const{featureIndex:i,sourceLayerIndex:s}=e;this.loadVTLayers();const c=this.sourceLayerCoder.decode(s),h=this.vtFeatures[c];if(h[i])return h[i];const p=this.vtLayers[c].feature(i);return h[i]=p,p}hasLayer(e){for(const i of this.bucketLayerIDs)for(const s of i)if(e===s)return!0;return!1}getId(e,i){let s=e.id;if(this.promoteId){const c=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];c!=null&&(s=e.properties[c]),typeof s=="boolean"&&(s=Number(s))}return s}}function Y1(t,e,i,s,c){return Ei(t,(h,p)=>{const y=e instanceof Xl?e.get(p):null;return y&&y.evaluate?y.evaluate(i,s,c):y})}function kC(t,e){return e-t}Bt(X1,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Ty=new Float32Array(262144),bc=new Uint8Array(262144);function K1(t){let e=0;if(t.meshes)for(const i of t.meshes)e=Math.max(e,i.aabb.max[2]);if(t.children)for(const i of t.children)e=Math.max(e,K1(i));return e}function J1(t,e,i){if(t.meshes)for(const s of t.meshes)s.aabb.min[0]!==1/0&&i.insert(e,s.aabb.min[0],s.aabb.min[1],s.aabb.max[0],s.aabb.max[1]);if(t.children)for(const s of t.children)J1(s,e,i)}const Q1=["","wall","door","roof","window","lamp","logo"];class ew{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:K1(e)}}}getLocalBounds(){if(!this.node.meshes)return new jn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new jn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const s of this.node.meshes)this.node.lightMeshIndex!==e&&i.encapsulate(s.aabb),e++;this.aabb=i}return this.aabb}}class Om{constructor(e,i,s,c,h,p){this.id=i,this.modelTraits|=Nu.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,s&&(this.modelTraits|=Nu.HasMapboxMeshFeatures),c&&(this.modelTraits|=Nu.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=h,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const y of e)this.nodesInfo.push(new ew(y)),J1(y,p.featureIndexArray.length,p.grid),p.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,p.bucketLayerIDs.length-1,0)}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const s of i){const c=s.node;this.uploaded?this.updatePbrBuffer(c):_y(c,e,!0)}for(const s of i)Dm(s.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const s of e.meshes)s.pbrBuffer&&(s.pbrBuffer.updateData(s.featureArray),i=!0);return i}needsReEvaluation(e,i,s){const c=e.transform.projectionOptions,h=e.style.getBrightness(),p=this.brightness!==h;return!!(!this.uploaded||this.dirty||c.name!==this.projection.name||ef(s.paint.get("model-color").value,p)||ef(s.paint.get("model-color-mix-intensity").value,p)||ef(s.paint.get("model-roughness").value,p)||ef(s.paint.get("model-emissive-strength").value,p)||ef(s.paint.get("model-height-based-emissive-strength-multiplier").value,p))&&(this.projection=c,this.brightness=h,!0)}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const s=this.getNodesInfo(),c=this.id.canonical;for(const h of s){const p=h.feature;h.evaluatedScale=i.paint.get("model-scale").evaluate(p,{},c)}}evaluate(e){const i=this.getNodesInfo();for(const s of i){if(!s.node.meshes)continue;const c=s.feature,h=s.node.meshes&&s.node.meshes[0].featureData,p=s.evaluatedColor[2],y=s.evaluatedRMEA[2],b=this.id.canonical;if(s.hasTranslucentParts=!1,h){for(let w=0;w<Q1.length;w++){const S=Q1[w];S.length&&(c.properties.part=S);const I=e.paint.get("model-color").evaluate(c,{},b),P=e.paint.get("model-color-mix-intensity").evaluate(c,{},b);s.evaluatedColor[w]=[I.r,I.g,I.b,P],s.evaluatedRMEA[w][0]=e.paint.get("model-roughness").evaluate(c,{},b),s.evaluatedRMEA[w][2]=e.paint.get("model-emissive-strength").evaluate(c,{},b),s.evaluatedRMEA[w][3]=I.a,s.emissionHeightBasedParams[w]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(c,{},b),!s.hasTranslucentParts&&I.a<1&&(s.hasTranslucentParts=!0)}delete c.properties.part,zC(s,p!==s.evaluatedColor[2]||y!==s.evaluatedRMEA[2],this.modelTraits)}else s.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(c,{},b);s.evaluatedScale=e.paint.get("model-scale").evaluate(c,{},b),this.updatePbrBuffer(s.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,s,c){const h=e.findDEMTileFor(s);if(h&&(h.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(h.dem&&h.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=h.tileID.overscaledZ;const p=Cu.create(e,s,h);if(!p)return;this.modelTraits&Nu.HasMapboxMeshFeatures&&this.updateDEM(e,p,s,c);for(const y of this.getNodesInfo()){const b=y.node;if(!b.footprint||!b.footprint.vertices||!b.footprint.vertices.length)continue;const w=b.footprint.vertices;let S=p.getElevationAt(w[0].x,w[0].y,!0,!0);for(let I=1;I<w.length;I++)S=Math.min(S,p.getElevationAt(w[I].x,w[I].y,!0,!0));b.elevation=S}}this.terrainTile=h.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,s,c){let h=i._dem._modifiedForSources[c];if(h===void 0&&(i._dem._modifiedForSources[c]=[],h=i._dem._modifiedForSources[c]),h.includes(s.canonical))return;const p=i._dem.dim;h.push(s.canonical);let y=!1;for(const b of this.getNodesInfo()){const w=b.node;if(!w.footprint||!w.footprint.grid)continue;const S=w.footprint.grid,I=i.tileCoordToPixel(S.min.x,S.min.y),P=i.tileCoordToPixel(S.max.x,S.max.y),R=Math.min(Math.min(p-P.y,I.x),Math.min(I.y,p-P.x));if(R<0)continue;const O=wt(R,2,5);let F=Math.max(0,I.x-O),U=Math.max(0,I.y-O),$=Math.min(P.x+O,p-1),J=Math.min(P.y+O,p-1);for(let ae=U;ae<=J;++ae)for(let fe=F;fe<=$;++fe)bc[ae*p+fe]=255;let te=0,ee=0;for(let ae=0;ae<S.cellsY;++ae)for(let fe=0;fe<S.cellsX;++fe){if(!S.cells[ae*S.cellsX+fe])continue;const ve=i.tileCoordToPixel(S.min.x+fe/S.xScale,S.min.y+ae/S.yScale),Se=i.tileCoordToPixel(S.min.x+(fe+1)/S.xScale,S.min.y+(ae+1)/S.yScale);for(let De=ve.y;De<=Math.min(Se.y+1,p-1);++De)for(let Ee=ve.x;Ee<=Math.min(Se.x+1,p-1);++Ee)bc[De*p+Ee]===255&&(bc[De*p+Ee]=0,te+=i.getElevationAtPixel(Ee,De),ee++)}const ce=te/ee;F=Math.max(1,I.x-O),U=Math.max(1,I.y-O),$=Math.min(P.x+O,p-2),J=Math.min(P.y+O,p-2),y=!0;for(let ae=U;ae<=J;++ae)for(let fe=F;fe<=$;++fe)bc[ae*p+fe]===0&&(Ty[ae*p+fe]=i._dem.set(fe,ae,ce));for(let ae=1;ae<O;++ae){F=Math.max(1,I.x-ae),U=Math.max(1,I.y-ae),$=Math.min(P.x+ae,p-2),J=Math.min(P.y+ae,p-2);for(let fe=U;fe<=J;++fe)for(let ve=F;ve<=$;++ve){const Se=fe*p+ve;if(bc[Se]===255){let De=0,Ee=0,Ue=-1,Ye=-1;for(let Fe=-1;Fe<=1;++Fe)for(let Ze=-1;Ze<=1;++Ze){const ze=(fe+Fe)*p+ve+Ze;if(bc[ze]>=ae)continue;const He=Ty[ze],vt=Math.abs(He);vt>Ee&&(De=He,Ee=vt,Ue=Ze,Ye=Fe)}if(Ee>.1){const Fe=1-(ae+.5*Math.abs(Ue*Ye))/O;let Ze=i._dem.get(ve,fe)+De*Fe;const ze=i._dem.get(ve+Ue,fe+Ye),He=i._dem.get(ve-Ue,fe-Ye,!0);(Ze-ze)*(Ze-He)>0&&(Ze=(ze+He)/2),Ty[Se]=i._dem.set(ve,fe,Ze),bc[Se]=ae}}}}}y&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=Xe.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)Dm(i.node),gy(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const s=i.getReplacementRegionsForTile(e.toUnwrapped()),c=this.getNodesInfo();for(let h=0;h<this.nodesInfo.length;h++){const p=c[h].node;c[h].hiddenByReplacement=!!p.footprint&&!s.find(y=>y.footprint===p.footprint)}}getHeightAtTileCoord(e,i){const s=this.getNodesInfo(),c=[];for(let h=0;h<this.nodesInfo.length;h++){const p=s[h],y=p.node.meshes[0];if(e<y.aabb.min[0]||i<y.aabb.min[1]||e>y.aabb.max[0]||i>y.aabb.max[1])continue;const b=(e-y.aabb.min[0])/(y.aabb.max[0]-y.aabb.min[0])*xc|0,w=Math.min(63,(i-y.aabb.min[1])/(y.aabb.max[1]-y.aabb.min[1])*xc|0)*xc+Math.min(63,b);if(!(y.heightmap[w]<0&&p.node.footprint))return p.hiddenByReplacement?void 0:{height:y.heightmap[w],maxHeight:p.feature.properties.height,hidden:!1,verticalScale:p.evaluatedScale[2]};if(p.node.footprint.grid.query(new le(e,i),new le(e,i),c),c.length>0)return{height:void 0,maxHeight:p.feature.properties.height,hidden:p.hiddenByReplacement,verticalScale:p.evaluatedScale[2]}}}}function ef(t,e){return!t.isLightConstant&&e}function RC(t,e,i,s,c,h,p,y){let b=(61440&e|(61440&e)>>4)>>8,w=(3840&e|(3840&e)>>4)>>4,S=240&e|(240&e)>>4;i[3]>0&&(b=Ri(b,255*i[0],i[3]),w=Ri(w,255*i[1],i[3]),S=Ri(S,255*i[2],i[3]));const I=b<<8|w,P=S<<8|Math.floor(255*s[3]),R=function(ae){const fe=wt(ae,0,2);return Math.min(Math.round(.5*fe*255),255)}(s[2])<<8|15*s[0]<<4|15*s[1],O=wt(c[0],0,1),F=wt(c[1],0,1),U=wt(c[2],0,1),$=wt(c[3],0,1);let J,te,ee,ce;if(O!==F&&p!==h&&F!==O){const ae=p-h;te=1/(ae*(F-O)),ee=-(h+ae*O)/(ae*(F-O));const fe=wt(c[4],-1,1);ce=Math.pow(10,fe),J=255*U<<8|255*$}else J=65535,te=0,ee=1,ce=1;if(t.emplaceBack(I,P,R,J,te,ee,ce),y){const ae=y.length;y.clear();for(let fe=0;fe<ae;fe++)y.emplaceBack(I,P,R,J,te,ee,ce)}}function zC(t,e,i){const s=t.node;let c=0;const h=i&Nu.HasMeshoptCompression;for(const p of s.meshes){if(s.lights&&s.lightMeshIndex===c||!p.featureData)continue;p.featureArray=new lc,p.featureArray.reserve(p.featureData.length);let y=e;for(const b of p.featureData){const w=h?65535&b:b>>16&65535,S=h?b>>16&65535:65535&b,I=(15&S)<8?15&S:0,P=t.evaluatedRMEA[I],R=t.evaluatedColor[I],O=t.emissionHeightBasedParams[I];let F;if(y&&I===2&&s.lights&&(F=new lc,F.resize(10*s.lights.length)),RC(p.featureArray,w,R,P,O,p.aabb.min[2],p.aabb.max[2],F),F&&y){y=!1;const U=s.meshes[s.lightMeshIndex];U.featureArray=F,U.featureArray._trim()}}p.featureArray._trim(),c++}}function tw(t,e,i,s){const c=1<<t.z;e.lat=Fi((s/Pt+t.y)/c),e.lng=pi((i/Pt+t.x)/c)}Bt(Om,"Tiled3dModelBucket",{omit:["layers"]}),Bt(ew,"Tiled3dModelFeature");const OC={circle:class extends Wr{constructor(t,e,i){super(t,IE,e,i)}createBucket(t){return new Zr(t)}queryRadius(t){const e=t;return Eu("circle-radius",this,e)+Eu("circle-stroke-width",this,e)+Gp(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,s,c,h,p,y){const b=yx(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,t.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Wv(t,s,h,p,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,w)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){const i=$v(this);return{config:new V(this,e),defines:i,overrideFog:!1}}},heatmap:class extends Wr{createBucket(t){return new qv(t)}constructor(t,e,i){super(t,sA,e,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=kd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Eu("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,s,c,h,p,y){const b=this.paint.get("heatmap-radius").evaluate(e,i);return Wv(t,s,h,p,y,!0,!0,new le(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return t==="heatmap"?{config:new V(this,e),overrideFog:!1}:{}}},hillshade:class extends Wr{constructor(t,e,i){super(t,aA,e,i)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends Wr{constructor(t,e,i){super(t,bA,e,i)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(t,e){return{config:new V(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Zg(t)}queryRadius(){return Gp(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,s,c,h){return!t.queryGeometry.isAboveHorizon&&sa(gx(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,t.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends Wr{constructor(t,e,i){super(t,XA,e,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new cm(t)}queryRadius(){return Gp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,i,s,c,h,p,y,b){const w=yx(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,t.pixelToTileUnitsFactor),S=this.paint.get("fill-extrusion-height").evaluate(e,i),I=this.paint.get("fill-extrusion-base").evaluate(e,i),P=[0,0],R=y&&h.elevation,O=h.elevation?h.elevation.exaggeration():1,F=t.tile.getBucket(this);if(R&&F instanceof cm){const ee=F.centroidVertexArray,ce=b+1;ce<ee.length&&(P[0]=ee.geta_centroid_pos0(ce),P[1]=ee.geta_centroid_pos1(ce))}if(P[0]===0&&P[1]===1)return!1;h.projection.name==="globe"&&(s=Ib([s],[new le(0,0),new le(Pt,Pt)],t.tileID.canonical).map(ee=>ee.polygon).flat());const U=R?y:null,[$,J]=function(ee,ce,ae,fe,ve,Se,De,Ee,Ue,Ye,Fe){return ee.projection.name==="globe"?function(Ze,ze,He,vt,Ke,jt,Lt,rt,oi,Xt,Ut){const st=[],ii=[],Mi=Ze.projection.upVectorScale(Ut,Ze.center.lat,Ze.worldSize).metersToTile,ai=[0,0,0,1],Si=[0,0,0,1],fi=(_i,_n,Gi,Wi)=>{_i[0]=_n,_i[1]=Gi,_i[2]=Wi,_i[3]=1},zi=Ab();He>0&&(He+=zi),vt+=zi;for(const _i of ze){const _n=[],Gi=[];for(const Wi of _i){const Ki=Wi.x+Ke.x,$i=Wi.y+Ke.y,zn=Ze.projection.projectTilePoint(Ki,$i,Ut),ln=Ze.projection.upVector(Ut,Wi.x,Wi.y);let Wn=He,cr=vt;if(Lt){const Ir=Pb(Ki,$i,He,vt,Lt,rt,oi,Xt);Wn+=Ir.base,cr+=Ir.top}He!==0?fi(ai,zn.x+ln[0]*Mi*Wn,zn.y+ln[1]*Mi*Wn,zn.z+ln[2]*Mi*Wn):fi(ai,zn.x,zn.y,zn.z),fi(Si,zn.x+ln[0]*Mi*cr,zn.y+ln[1]*Mi*cr,zn.z+ln[2]*Mi*cr),r.N.transformMat4(ai,ai,jt),r.N.transformMat4(Si,Si,jt),_n.push(new Pu(ai[0],ai[1],ai[2])),Gi.push(new Pu(Si[0],Si[1],Si[2]))}st.push(_n),ii.push(Gi)}return[st,ii]}(ee,ce,ae,fe,ve,Se,De,Ee,Ue,Ye,Fe):De?function(Ze,ze,He,vt,Ke,jt,Lt,rt,oi){const Xt=[],Ut=[],st=[0,0,0,1];for(const ii of Ze){const Mi=[],ai=[];for(const Si of ii){const fi=Si.x+vt.x,zi=Si.y+vt.y,_i=Pb(fi,zi,ze,He,jt,Lt,rt,oi);st[0]=fi,st[1]=zi,st[2]=_i.base,st[3]=1,r.a7.transformMat4(st,st,Ke),st[3]=Math.max(st[3],1e-5);const _n=new Pu(st[0]/st[3],st[1]/st[3],st[2]/st[3]);st[0]=fi,st[1]=zi,st[2]=_i.top,st[3]=1,r.a7.transformMat4(st,st,Ke),st[3]=Math.max(st[3],1e-5);const Gi=new Pu(st[0]/st[3],st[1]/st[3],st[2]/st[3]);Mi.push(_n),ai.push(Gi)}Xt.push(Mi),Ut.push(ai)}return[Xt,Ut]}(ce,ae,fe,ve,Se,De,Ee,Ue,Ye):function(Ze,ze,He,vt,Ke){const jt=[],Lt=[],rt=Ke[8]*ze,oi=Ke[9]*ze,Xt=Ke[10]*ze,Ut=Ke[11]*ze,st=Ke[8]*He,ii=Ke[9]*He,Mi=Ke[10]*He,ai=Ke[11]*He;for(const Si of Ze){const fi=[],zi=[];for(const _i of Si){const _n=_i.x+vt.x,Gi=_i.y+vt.y,Wi=Ke[0]*_n+Ke[4]*Gi+Ke[12],Ki=Ke[1]*_n+Ke[5]*Gi+Ke[13],$i=Ke[2]*_n+Ke[6]*Gi+Ke[14],zn=Ke[3]*_n+Ke[7]*Gi+Ke[15],ln=Wi+rt,Wn=Ki+oi,cr=$i+Xt,Ir=Math.max(zn+Ut,1e-5),Dn=Wi+st,Vn=Ki+ii,xr=$i+Mi,vr=Math.max(zn+ai,1e-5);fi.push(new Pu(ln/Ir,Wn/Ir,cr/Ir)),zi.push(new Pu(Dn/vr,Vn/vr,xr/vr))}jt.push(fi),Lt.push(zi)}return[jt,Lt]}(ce,ae,fe,ve,Se)}(h,s,I,S,w,p,U,P,O,h.center.lat,t.tileID.canonical),te=t.queryGeometry;return function(ee,ce,ae){let fe=1/0;sa(ae,ce)&&(fe=Cb(ae,ce[0]));for(let ve=0;ve<ce.length;ve++){const Se=ce[ve],De=ee[ve];for(let Ee=0;Ee<Se.length-1;Ee++){const Ue=Se[Ee],Ye=[Ue,Se[Ee+1],De[Ee+1],De[Ee],Ue];Ns(ae,Ye)&&(fe=Math.min(fe,Cb(ae,Ye)))}}return fe!==1/0&&fe}($,J,te.isPointQuery()?te.screenBounds:te.screenGeometry)}},line:class extends Wr{constructor(t,e,i){super(t,Lb,e,i),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Vl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=Bb.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Kg(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){const i=Ob(this);return{config:new V(this,e),defines:i,overrideFog:!1}}queryRadius(t){const e=t,i=Nb(Eu("line-width",this,e),Eu("line-gap-width",this,e)),s=Eu("line-offset",this,e);return i/2+Math.abs(s)+Gp(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,s,c,h){if(t.queryGeometry.isAboveHorizon)return!1;const p=gx(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,t.pixelToTileUnitsFactor),y=t.pixelToTileUnitsFactor/2*Nb(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),b=this.paint.get("line-offset").evaluate(e,i);return b&&(s=function(w,S){const I=[],P=new le(0,0);for(let R=0;R<w.length;R++){const O=w[R],F=[];for(let U=0;U<O.length;U++){const $=O[U],J=O[U+1],te=U===0?P:$.sub(O[U-1])._unit()._perp(),ee=U===O.length-1?P:J.sub($)._unit()._perp(),ce=te._add(ee)._unit();ce._mult(1/(ce.x*ee.x+ce.y*ee.y)),F.push(ce._mult(S)._add($))}I.push(F)}return I}(s,b*t.pixelToTileUnitsFactor)),function(w,S,I){for(let P=0;P<S.length;P++){const R=S[P];if(w.length>=3){for(let O=0;O<R.length;O++)if(Ks(w,R[O]))return!0}if(fc(w,R,I))return!0}return!1}(p,s,y)}isTileClipped(){return!0}},symbol:Sm,background:class extends Wr{constructor(t,e,i){super(t,JI,e,i)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:M1,"raster-particle":S1,sky:class extends Wr{constructor(t,e,i){super(t,oC,e,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=kd({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const s=this.paint.get("sky-atmosphere-sun"),c=!s,h=t.style.light,p=h.properties.get("position");return c&&h.properties.get("anchor")==="viewport"&&we("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?fy(p.azimuthal,90-p.polar,e):fy(s[0],90-s[1],e)}const i=this.paint.get("sky-gradient-center");return fy(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends Wr{constructor(t,e,i){super(t,aC,e)}},model:class extends Wr{constructor(t,e,i){super(t,_C,e,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new my(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof Om?Pt-1:0}queryIntersectsFeature(t,e,i,s,c,h){if(!this.modelManager)return!1;const p=this.modelManager,y=t.tile.getBucket(this);if(!(y&&y instanceof my))return!1;const b=y;for(const w in b.instancesPerModel){const S=b.instancesPerModel[w];if(S.idToFeaturesIndex.hasOwnProperty(e.id)){const I=S.features[S.idToFeaturesIndex[e.id]],P=p.getModel(w,this.scope);if(!P)return!1;let R=r.a6.create();const O=new Me(0,0),F=b.canonical;let U=Number.MAX_VALUE;for(let $=0;$<I.instancedDataCount;++$){const J=16*(I.instancedDataOffset+$),te=S.instancedDataArray.float32,ee=[te[J+4],te[J+5],te[J+6]];tw(F,O,te[J],0|te[J+1]),R1(R,P,h,O,I.rotation,I.scale,ee,!1,!1,!1),h.projection.name==="globe"&&(R=py(R,h));const ce=r.a6.multiply([],h.projMatrix,R),ae=t.queryGeometry,fe=D1(ae.isPointQuery()?ae.screenBounds:ae.screenGeometry,h,ce,P.aabb);fe!=null&&(U=Math.min(fe,U))}return U!==Number.MAX_VALUE&&U}}return!1}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){const e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Wl}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,i,s){const c=t.tile,h=c.getBucket(this);let p=null,y=Number.MAX_VALUE;if(!(h&&h instanceof Om))return{queryFeature:p,intersectionZ:y};const b=h.getNodesInfo()[e];if(b.hiddenByReplacement||!b.node.meshes||!i.filter(new On(c.tileID.overscaledZ),b.feature,c.tileID.canonical))return{queryFeature:p,intersectionZ:y};const w=b.node,S=s.calculatePosMatrix(c.tileID.toUnwrapped(),s.worldSize),I=b.evaluatedScale;let P=0;s.elevation&&w.elevation&&(P=w.elevation*s.elevation.exaggeration()),r.a6.translate(S,S,[(w.anchor?w.anchor[0]:0)*(I[0]-1),(w.anchor?w.anchor[1]:0)*(I[1]-1),P]),r.a6.scale(S,S,I),r.a6.multiply(S,S,w.matrix);const R=t.queryGeometry,O=R.isPointQuery()?R.screenBounds:R.screenGeometry,F=function($){const J=r.a6.multiply([],S,$.matrix),te=r.a6.multiply(J,s.expandedFarZProjMatrix,J);for(let ee=0;ee<$.meshes.length;++ee){const ce=$.meshes[ee];if(ee===$.lightMeshIndex)continue;const ae=D1(O,s,te,ce.aabb);ae!=null&&(y=Math.min(ae,y))}if($.children)for(const ee of $.children)F(ee)};if(F(w),y===Number.MAX_VALUE)return{queryFeature:p,intersectionZ:y};const U=new Me(0,0);return tw(c.tileID.canonical,U,b.node.anchor[0],b.node.anchor[1]),p={type:"Feature",geometry:{type:"Point",coordinates:[U.lng,U.lat]},properties:b.feature.properties,id:b.feature.id,state:{},layer:this.serialize()},{queryFeature:p,intersectionZ:y}}}},yi={read:function(t,e){return t.readFields(yi._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(t,e,i){t===1?e.header_length=i.readFixed32():t===2?e.x=i.readVarint():t===3?e.y=i.readVarint():t===4?e.z=i.readVarint():t===5&&e.layers.push(yi.Layer.read(i,i.readVarint()+i.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};yi.Filter.read=function(t,e){return t.readFields(yi.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},yi.Filter._readField=function(t,e,i){t===1?(e.delta_filter=yi.Filter.Delta.read(i,i.readVarint()+i.pos),e.filter="delta_filter"):t===2?(e.zigzag_filter=yi.Filter.Zigzag.read(i,i.readVarint()+i.pos),e.filter="zigzag_filter"):t===3?(e.bitshuffle_filter=yi.Filter.BitShuffle.read(i,i.readVarint()+i.pos),e.filter="bitshuffle_filter"):t===4&&(e.byteshuffle_filter=yi.Filter.ByteShuffle.read(i,i.readVarint()+i.pos),e.filter="byteshuffle_filter")},yi.Filter.Delta={},yi.Filter.Delta.read=function(t,e){return t.readFields(yi.Filter.Delta._readField,{block_size:0},e)},yi.Filter.Delta._readField=function(t,e,i){t===1&&(e.block_size=i.readVarint())},yi.Filter.Zigzag={},yi.Filter.Zigzag.read=function(t,e){return t.readFields(yi.Filter.Zigzag._readField,{},e)},yi.Filter.Zigzag._readField=function(t,e,i){},yi.Filter.BitShuffle={},yi.Filter.BitShuffle.read=function(t,e){return t.readFields(yi.Filter.BitShuffle._readField,{},e)},yi.Filter.BitShuffle._readField=function(t,e,i){},yi.Filter.ByteShuffle={},yi.Filter.ByteShuffle.read=function(t,e){return t.readFields(yi.Filter.ByteShuffle._readField,{},e)},yi.Filter.ByteShuffle._readField=function(t,e,i){},yi.Codec={},yi.Codec.read=function(t,e){return t.readFields(yi.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},yi.Codec._readField=function(t,e,i){t===1?(e.gzip_data=yi.Codec.GzipData.read(i,i.readVarint()+i.pos),e.codec="gzip_data"):t===2?(e.jpeg_image=yi.Codec.JpegImage.read(i,i.readVarint()+i.pos),e.codec="jpeg_image"):t===3?(e.webp_image=yi.Codec.WebpImage.read(i,i.readVarint()+i.pos),e.codec="webp_image"):t===4&&(e.png_image=yi.Codec.PngImage.read(i,i.readVarint()+i.pos),e.codec="png_image")},yi.Codec.GzipData={},yi.Codec.GzipData.read=function(t,e){return t.readFields(yi.Codec.GzipData._readField,{},e)},yi.Codec.GzipData._readField=function(t,e,i){},yi.Codec.JpegImage={},yi.Codec.JpegImage.read=function(t,e){return t.readFields(yi.Codec.JpegImage._readField,{},e)},yi.Codec.JpegImage._readField=function(t,e,i){},yi.Codec.WebpImage={},yi.Codec.WebpImage.read=function(t,e){return t.readFields(yi.Codec.WebpImage._readField,{},e)},yi.Codec.WebpImage._readField=function(t,e,i){},yi.Codec.PngImage={},yi.Codec.PngImage.read=function(t,e){return t.readFields(yi.Codec.PngImage._readField,{},e)},yi.Codec.PngImage._readField=function(t,e,i){},yi.DataIndexEntry={},yi.DataIndexEntry.read=function(t,e){return t.readFields(yi.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},yi.DataIndexEntry._readField=function(t,e,i){t===1?e.first_byte=i.readFixed64():t===2?e.last_byte=i.readFixed64():t===3?e.filters.push(yi.Filter.read(i,i.readVarint()+i.pos)):t===4?e.codec=yi.Codec.read(i,i.readVarint()+i.pos):t===5?e.offset=i.readFloat():t===6?e.scale=i.readFloat():t===7&&e.bands.push(i.readString())},yi.Layer={},yi.Layer.read=function(t,e){return t.readFields(yi.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},yi.Layer._readField=function(t,e,i){t===1?e.version=i.readVarint():t===2?e.name=i.readString():t===3?e.units=i.readString():t===4?e.tilesize=i.readVarint():t===5?e.buffer=i.readVarint():t===6?e.pixel_format=i.readVarint():t===7&&e.data_index.push(yi.DataIndexEntry.read(i,i.readVarint()+i.pos))};const no={read:function(t,e){return t.readFields(no._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(t,e,i){t===2?(e.uint32_values=no.Uint32Values.read(i,i.readVarint()+i.pos),e.values="uint32_values"):t===3&&(e.fixed32_values=no.Fixed32Values.read(i,i.readVarint()+i.pos),e.values="fixed32_values")},Uint32Values:{}};no.Uint32Values.read=function(t,e){return t.readFields(no.Uint32Values._readField,{values:[]},e)},no.Uint32Values._readField=function(t,e,i){t===1&&(e.readValuesInto=function(s){if(s.type!==2)throw new Error(`Unsupported pbf type "${s.type}"`);const c=function(p){return p.type===2?p.readVarint()+p.pos:p.pos+1}(s),h=s.pos;return s.pos=c,function(p){s.pos=h;let y=0;for(;s.pos<c;){const b=s.readVarint();p[y++]=b}return p}}(i))},no.Fixed32Values={},no.Fixed32Values.read=function(t,e){return t.readFields(no.Fixed32Values._readField,{values:[]},e)},no.Fixed32Values._readField=function(t,e,i){throw new Error("Not implemented")};/**
 * tiny-lru
 *
 * @copyright 2023 Jason Mulligan <jason.mulligan@avoidwork.com>
 * @license BSD-3-Clause
 * @version 11.2.5
 */class FC{constructor(e=0,i=0,s=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=s,this.size=0,this.ttl=i}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){const i=this.items[e];delete this.items[e],this.size--,i.prev!==null&&(i.prev.next=i.next),i.next!==null&&(i.next.prev=i.prev),this.first===i&&(this.first=i.next),this.last===i&&(this.last=i.prev)}return this}entries(e=this.keys()){return e.map(i=>[i,this.get(i)])}evict(e=!1){if(e||this.size>0){const i=this.first;delete this.items[i.key],--this.size==0?(this.first=null,this.last=null):(this.first=i.next,this.first.prev=null)}return this}expiresAt(e){let i;return this.has(e)&&(i=this.items[e].expiry),i}get(e){let i;if(this.has(e)){const s=this.items[e];this.ttl>0&&s.expiry<=Date.now()?this.delete(e):(i=s.value,this.set(e,i,!0))}return i}has(e){return e in this.items}keys(){const e=[];let i=this.first;for(;i!==null;)e.push(i.key),i=i.next;return e}set(e,i,s=!1,c=this.resetTtl){let h;if(s||this.has(e)){if(h=this.items[e],h.value=i,s===!1&&c&&(h.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==h){const p=this.last,y=h.next,b=h.prev;this.first===h&&(this.first=h.next),h.next=null,h.prev=this.last,p.next=h,b!==null&&(b.next=y),y!==null&&(y.prev=b)}}else this.max>0&&this.size===this.max&&this.evict(!0),h=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:i},++this.size==1?this.first=h:this.last.next=h;return this.last=h,this}values(e=this.keys()){return e.map(i=>this.get(i))}}function BC(t,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let s=2;s>=1;s--){const c=s===1?1:0,h=s===2?1:0;for(let p=0;p<e[0];p++){const y=e[1]*p;for(let b=c;b<e[1];b++){const w=e[2]*(b+y);for(let S=h;S<e[2];S++){const I=e[3]*(S+w);for(let P=0;P<e[3];P++){const R=I+P;t[R]+=t[R-i]}}}}i*=e[s]}return t}function NC(t){for(let e=0,i=t.length;e<i;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function VC(t,e){switch(e){case"uint32":return t;case"uint16":for(let i=0;i<t.length;i+=2){const s=t[i],c=t[i+1];t[i]=(240&s)>>4|(61440&s)>>8|(240&c)<<4|61440&c,t[i+1]=15&s|(3840&s)>>4|(15&c)<<8|(3840&c)<<4}return t;case"uint8":for(let i=0;i<t.length;i+=4){const s=t[i],c=t[i+1],h=t[i+2],p=t[i+3];t[i+0]=(192&s)>>6|(192&c)>>4|(192&h)>>2|192&p,t[i+1]=(48&s)>>4|(48&c)>>2|48&h|(48&p)<<2,t[i+2]=(12&s)>>2|12&c|(12&h)<<2|(12&p)<<4,t[i+3]=3&s|(3&c)<<2|(3&h)<<4|(3&p)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class ll extends Error{constructor(e){super(e),this.name="MRTError"}}var Ds=Uint8Array,tf=Uint16Array,UC=Int32Array,iw=new Ds([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),nw=new Ds([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),jC=new Ds([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),rw=function(t,e){for(var i=new tf(31),s=0;s<31;++s)i[s]=e+=1<<t[s-1];var c=new UC(i[30]);for(s=1;s<30;++s)for(var h=i[s];h<i[s+1];++h)c[h]=h-i[s]<<5|s;return{b:i,r:c}},sw=rw(iw,2),ow=sw.b,GC=sw.r;ow[28]=258,GC[258]=28;for(var $C=rw(nw,0).b,aw=new tf(32768),Jn=0;Jn<32768;++Jn){var Gu=(43690&Jn)>>1|(21845&Jn)<<1;aw[Jn]=((65280&(Gu=(61680&(Gu=(52428&Gu)>>2|(13107&Gu)<<2))>>4|(3855&Gu)<<4))>>8|(255&Gu)<<8)>>1}var nf=function(t,e,i){for(var s=t.length,c=0,h=new tf(e);c<s;++c)t[c]&&++h[t[c]-1];var p,y=new tf(e);for(c=1;c<e;++c)y[c]=y[c-1]+h[c-1]<<1;{p=new tf(1<<e);var b=15-e;for(c=0;c<s;++c)if(t[c])for(var w=c<<4|t[c],S=e-t[c],I=y[t[c]-1]++<<S,P=I|(1<<S)-1;I<=P;++I)p[aw[I]>>b]=w}return p},rf=new Ds(288);for(Jn=0;Jn<144;++Jn)rf[Jn]=8;for(Jn=144;Jn<256;++Jn)rf[Jn]=9;for(Jn=256;Jn<280;++Jn)rf[Jn]=7;for(Jn=280;Jn<288;++Jn)rf[Jn]=8;var lw=new Ds(32);for(Jn=0;Jn<32;++Jn)lw[Jn]=5;var WC=nf(rf,9),HC=nf(lw,5),My=function(t){for(var e=t[0],i=1;i<t.length;++i)t[i]>e&&(e=t[i]);return e},ro=function(t,e,i){var s=e/8|0;return(t[s]|t[s+1]<<8)>>(7&e)&i},Sy=function(t,e){var i=e/8|0;return(t[i]|t[i+1]<<8|t[i+2]<<16)>>(7&e)},qC=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],so=function(t,e,i){var s=new Error(e||qC[t]);if(s.code=t,Error.captureStackTrace&&Error.captureStackTrace(s,so),!i)throw s;return s},ZC=new Ds(0),XC=typeof TextDecoder<"u"&&new TextDecoder;try{XC.decode(ZC,{stream:!0})}catch{}const YC={gzip_data:"gzip"},KC={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},JC={uint32:1,uint16:2,uint8:4},QC={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class cw{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){const i=new Uint8Array(e),s=new DataView(e);if(i[0]!==13)throw new ll("File is not a valid MRT.");return s.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),s=this.getHeaderLength(e);if(i.length<s)throw new ll(`Expected header with length >= ${s} but got buffer of length ${i.length}`);const c=new Ru(i.subarray(0,s)),h=yi.read(c);if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new ll(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(const p of h.layers)this.layers[p.name]=new eP(p,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],s=this.getLayer(e.layerName);for(let c=0;c<s.dataIndex.length;c++){const h=s.dataIndex[c],p=h.first_byte-e.firstByte,y=h.last_byte+1-e.firstByte;if(c<e.firstBlock||c>e.lastBlock||s._blocksInProgress.has(c))continue;const b={layerName:s.name,firstByte:p,lastByte:y,pixelFormat:s.pixelFormat,blockIndex:c,blockShape:[h.bands.length].concat(s.bandShape),buffer:s.buffer,codec:h.codec.codec,filters:h.filters.map(w=>w.filter)};s._blocksInProgress.add(c),i.push(b)}return new uw(i,()=>{i.forEach(c=>s._blocksInProgress.delete(c.blockIndex))},(c,h)=>{if(i.forEach(p=>s._blocksInProgress.delete(p.blockIndex)),c)throw c;h.forEach(p=>{this.getLayer(p.layerName).processDecodedData(p)})})}}class eP{constructor({version:e,name:i,units:s,tilesize:c,pixel_format:h,buffer:p,data_index:y},b){if(this.version=e,this.version!==1)throw new ll(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=s,this.tileSize=c,this.buffer=p,this.pixelFormat=KC[h],this.dataIndex=y,this.bandShape=[c+2*p,c+2*p,JC[this.pixelFormat]],this._decodedBlocks=function(w=1e3,S=0,I=!1){if(isNaN(w)||w<0)throw new TypeError("Invalid max value");if(isNaN(S)||S<0)throw new TypeError("Invalid ttl value");if(typeof I!="boolean")throw new TypeError("Invalid resetTtl value");return new FC(w,S,I)}(b?b.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.set(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[s,c]of this.dataIndex.entries()){for(const[h,p]of c.bands.entries())if(p===e)return{bandIndex:i+h,blockIndex:s,blockBandIndex:h};i+=c.bands.length}break;case"number":for(const[s,c]of this.dataIndex.entries()){if(e>=i&&e<i+c.bands.length)return{bandIndex:e,blockIndex:s,blockBandIndex:e-i};i+=c.bands.length}break;default:throw new ll(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new ll(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let i=1/0,s=-1/0,c=1/0,h=-1/0;for(const p of e){const{blockIndex:y}=this.getBlockForBand(p);if(y<0)throw new ll(`Invalid band: ${JSON.stringify(p)}`);const b=this.dataIndex[y];c=Math.min(c,y),h=Math.max(h,y),i=Math.min(i,b.first_byte),s=Math.max(s,b.last_byte)}return{layerName:this.name,firstByte:i,lastByte:s,firstBlock:c,lastBlock:h}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:s}=this.getBlockForBand(e),c=this._decodedBlocks.get(i.toString());if(!c)throw new ll(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const h=this.dataIndex[i],p=this.bandShape.reduce((w,S)=>w*S,1),y=s*p,b=c.subarray(y,y+p);return{data:b,bytes:new Uint8Array(b.buffer).subarray(b.byteOffset,b.byteOffset+b.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:h.offset,scale:h.scale}}}class uw{constructor(e,i,s){this.tasks=e,this._onCancel=i,this._onComplete=s,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}cw.performDecoding=function(t,e){return Promise.all(e.tasks.map(i=>{const{layerName:s,firstByte:c,lastByte:h,pixelFormat:p,blockShape:y,blockIndex:b,filters:w,codec:S}=i,I=new Uint8Array(t).subarray(c,h+1),P=new Uint32Array(y[0]*y[1]*y[2]);let R;if(S!=="gzip_data")throw new Error(`Unhandled codec: ${S}`);return R=function(O,F){if(!globalThis.DecompressionStream&&F==="gzip_data")return Promise.resolve(((te=function(ae){ae[0]==31&&ae[1]==139&&ae[2]==8||so(6,"invalid gzip data");var fe=ae[3],ve=10;4&fe&&(ve+=2+(ae[10]|ae[11]<<8));for(var Se=(fe>>3&1)+(fe>>4&1);Se>0;Se-=!ae[ve++]);return ve+(2&fe)}(J=O))+8>J.length&&so(6,"invalid gzip data"),function(ae,fe,ve,Se){var De=ae.length;if(!De||fe.f&&!fe.l)return ve||new Ds(0);var Ee=!ve,Ue=Ee||fe.i!=2,Ye=fe.i;Ee&&(ve=new Ds(3*De));var Fe=function(Xr){var fs=ve.length;if(Xr>fs){var Ls=new Ds(Math.max(2*fs,Xr));Ls.set(ve),ve=Ls}},Ze=fe.f||0,ze=fe.p||0,He=fe.b||0,vt=fe.l,Ke=fe.d,jt=fe.m,Lt=fe.n,rt=8*De;do{if(!vt){Ze=ro(ae,ze,1);var oi=ro(ae,ze+1,3);if(ze+=3,!oi){var Xt=ae[(Gi=4+((ze+7)/8|0))-4]|ae[Gi-3]<<8,Ut=Gi+Xt;if(Ut>De){Ye&&so(0);break}Ue&&Fe(He+Xt),ve.set(ae.subarray(Gi,Ut),He),fe.b=He+=Xt,fe.p=ze=8*Ut,fe.f=Ze;continue}if(oi==1)vt=WC,Ke=HC,jt=9,Lt=5;else if(oi==2){var st=ro(ae,ze,31)+257,ii=ro(ae,ze+10,15)+4,Mi=st+ro(ae,ze+5,31)+1;ze+=14;for(var ai=new Ds(Mi),Si=new Ds(19),fi=0;fi<ii;++fi)Si[jC[fi]]=ro(ae,ze+3*fi,7);ze+=3*ii;var zi=My(Si),_i=(1<<zi)-1,_n=nf(Si,zi);for(fi=0;fi<Mi;){var Gi,Wi=_n[ro(ae,ze,_i)];if(ze+=15&Wi,(Gi=Wi>>4)<16)ai[fi++]=Gi;else{var Ki=0,$i=0;for(Gi==16?($i=3+ro(ae,ze,3),ze+=2,Ki=ai[fi-1]):Gi==17?($i=3+ro(ae,ze,7),ze+=3):Gi==18&&($i=11+ro(ae,ze,127),ze+=7);$i--;)ai[fi++]=Ki}}var zn=ai.subarray(0,st),ln=ai.subarray(st);jt=My(zn),Lt=My(ln),vt=nf(zn,jt),Ke=nf(ln,Lt)}else so(1);if(ze>rt){Ye&&so(0);break}}Ue&&Fe(He+131072);for(var Wn=(1<<jt)-1,cr=(1<<Lt)-1,Ir=ze;;Ir=ze){var Dn=(Ki=vt[Sy(ae,ze)&Wn])>>4;if((ze+=15&Ki)>rt){Ye&&so(0);break}if(Ki||so(2),Dn<256)ve[He++]=Dn;else{if(Dn==256){Ir=ze,vt=null;break}var Vn=Dn-254;Dn>264&&(Vn=ro(ae,ze,(1<<(br=iw[fi=Dn-257]))-1)+ow[fi],ze+=br);var xr=Ke[Sy(ae,ze)&cr],vr=xr>>4;if(xr||so(3),ze+=15&xr,ln=$C[vr],vr>3){var br=nw[vr];ln+=Sy(ae,ze)&(1<<br)-1,ze+=br}if(ze>rt){Ye&&so(0);break}Ue&&Fe(He+131072);var Mn=He+Vn;if(He<ln){var ds=0-ln,cl=Math.min(ln,Mn);for(ds+He<0&&so(3);He<cl;++He)ve[He]=Se[ds+He]}for(;He<Mn;++He)ve[He]=ve[He-ln]}}fe.l=vt,fe.p=Ir,fe.b=He,fe.f=Ze,vt&&(Ze=1,fe.m=jt,fe.d=Ke,fe.n=Lt)}while(!Ze);return He!=ve.length&&Ee?function(Xr,fs,Ls){return(Ls==null||Ls>Xr.length)&&(Ls=Xr.length),new Ds(Xr.subarray(fs,Ls))}(ve,0,He):ve.subarray(0,He)}(J.subarray(te,-8),{i:2},new Ds(((U=J)[($=U.length)-4]|U[$-3]<<8|U[$-2]<<16|U[$-1]<<24)>>>0),void 0)));var U,$,J,te;const ee=YC[F];if(!ee)throw new Error(`Unhandled codec: ${F}`);const ce=new globalThis.DecompressionStream(ee);return new Response(new Blob([O]).stream().pipeThrough(ce)).arrayBuffer().then(ae=>new Uint8Array(ae))}(I,S).then(O=>{const F=no.read(new Ru(O));if(F.values==="uint32_values")return F.uint32_values.readValuesInto(P),new QC[p](P.buffer);throw new Error(`Unhandled numeric data "${F.values}"`)}),R.then(O=>{for(let F=w.length-1;F>=0;F--)switch(w[F]){case"delta_filter":BC(O,y);break;case"zigzag_filter":NC(O);break;case"bitshuffle_filter":VC(O,p);break;default:throw new Error(`Unhandled filter "${w[F]}"`)}return{layerName:s,blockIndex:b,data:O}}).catch(O=>{throw O})}))},Bt(uw,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const hw=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ey{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,s]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=s>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const h=hw[15&s];if(!h)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new Ey(y,p,h,e)}constructor(e,i=64,s=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const h=hw.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-y%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${s}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+y+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=i,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Ay(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:y}=this,b=[0,h.length-1,0],w=[];for(;b.length;){const S=b.pop()||0,I=b.pop()||0,P=b.pop()||0;if(I-P<=y){for(let U=P;U<=I;U++){const $=p[2*U],J=p[2*U+1];$>=e&&$<=s&&J>=i&&J<=c&&w.push(h[U])}continue}const R=P+I>>1,O=p[2*R],F=p[2*R+1];O>=e&&O<=s&&F>=i&&F<=c&&w.push(h[R]),(S===0?e<=O:i<=F)&&(b.push(P),b.push(R-1),b.push(1-S)),(S===0?s>=O:c>=F)&&(b.push(R+1),b.push(I),b.push(1-S))}return w}within(e,i,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:h,nodeSize:p}=this,y=[0,c.length-1,0],b=[],w=s*s;for(;y.length;){const S=y.pop()||0,I=y.pop()||0,P=y.pop()||0;if(I-P<=p){for(let U=P;U<=I;U++)fw(h[2*U],h[2*U+1],e,i)<=w&&b.push(c[U]);continue}const R=P+I>>1,O=h[2*R],F=h[2*R+1];fw(O,F,e,i)<=w&&b.push(c[R]),(S===0?e-s<=O:i-s<=F)&&(y.push(P),y.push(R-1),y.push(1-S)),(S===0?e+s>=O:i+s>=F)&&(y.push(R+1),y.push(I),y.push(1-S))}return b}}function Ay(t,e,i,s,c,h){if(c-s<=i)return;const p=s+c>>1;dw(t,e,p,s,c,h),Ay(t,e,i,s,p-1,1-h),Ay(t,e,i,p+1,c,1-h)}function dw(t,e,i,s,c,h){for(;c>s;){if(c-s>600){const w=c-s+1,S=i-s+1,I=Math.log(w),P=.5*Math.exp(2*I/3),R=.5*Math.sqrt(I*P*(w-P)/w)*(S-w/2<0?-1:1);dw(t,e,i,Math.max(s,Math.floor(i-S*P/w+R)),Math.min(c,Math.floor(i+(w-S)*P/w+R)),h)}const p=e[2*i+h];let y=s,b=c;for(sf(t,e,s,i),e[2*c+h]>p&&sf(t,e,s,c);y<b;){for(sf(t,e,y,b),y++,b--;e[2*y+h]<p;)y++;for(;e[2*b+h]>p;)b--}e[2*s+h]===p?sf(t,e,s,b):(b++,sf(t,e,b,c)),b<=i&&(s=b+1),i<=b&&(c=b-1)}}function sf(t,e,i,s){Iy(t,i,s),Iy(e,2*i,2*s),Iy(e,2*i+1,2*s+1)}function Iy(t,e,i){const s=t[e];t[e]=t[i],t[i]=s}function fw(t,e,i,s){const c=t-i,h=e-s;return c*c+h*h}r.$=m1,r.A=uu,r.B=Kh,r.C=Oi,r.D=Ie,r.E=Aa,r.F=Fn,r.G=gt,r.H=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return ft(t.expression.evaluate(e))}interpolate(t,e,i){return{x:Ri(t.x,e.x,i),y:Ri(t.y,e.y,i),z:Ri(t.z,e.z,i),azimuthal:Ri(t.azimuthal,e.azimuthal,i),polar:Ri(t.polar,e.polar,i)}}},r.I=ny,r.J=Zs,r.K=On,r.L=Ui,r.M=class{constructor(t,e,i,s){this.id=t,this.position=e!=null?new Me(e[0],e[1]):new Me(0,0),this.orientation=i??[0,0,0],this.nodes=s,this.uploaded=!1,this.aabb=new jn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(r.a6.multiply(t.matrix,e,t.matrix),t.meshes)for(const i of t.meshes){const s=jn.applyTransform(i.aabb,t.matrix);this.aabb.encapsulate(s)}if(t.children)for(const i of t.children)this._applyTransformations(i,t.matrix)}computeBoundsAndApplyParent(){const t=r.a6.identity([]);for(const e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,i,s,c,h,p=!1){R1(this.matrix,this,t.transform,this.position,e,i,s,c,h,p)}upload(t){if(!this.uploaded){for(const e of this.nodes)_y(e,t);for(const e of this.nodes)Dm(e);this.uploaded=!0}}destroy(){for(const t of this.nodes)gy(t)}},r.O=Qt,r.P=le,r.Q=Xl,r.R=Ur,r.S=Qa,r.T=dy,r.U=Ri,r.V=Pt,r.W=qf,r.X=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([i,s]){const c=ft([1,i,s]);return{x:c.x,y:c.y,z:c.z}}(t.expression.evaluate(e))}interpolate(t,e,i){return{x:Ri(t.x,e.x,i),y:Ri(t.y,e.y,i),z:Ri(t.z,e.z,i)}}},r.Y=function(t,e,i=0,s=!0){const c=new le(i,i),h=t.sub(c),p=e.add(c),y=[h,new le(p.x,h.y),p,new le(h.x,p.y)];return s&&y.push(h.clone()),y},r.Z=Wl,r._=function(t,e){const i=[];for(let s=0;s<t.length;s++){const c=bn(s-1,-1,t.length-1),h=bn(s+1,-1,t.length-1),p=t[s],y=t[h],b=t[c].sub(p).unit(),w=y.sub(p).unit(),S=w.angleWithSep(b.x,b.y),I=b.add(w).unit().mult(-1*e/Math.sin(S/2));i.push(p.add(I))}return i},r.a=rh,r.a$=function(t){const e=[];for(const i in t)e.push(t[i]);return e},r.a0=_x,r.a1=function(t,e,i=0){return r.N.fromValues(((e.x-i)*t.scale-t.x)*Pt,(e.y*t.scale-t.y)*Pt,gn(e.z,e.y))},r.a2=Lg,r.a3=kb,r.a4=function(t){let e=1/0,i=1/0,s=-1/0,c=-1/0;for(const h of t)e=Math.min(e,h.x),i=Math.min(i,h.y),s=Math.max(s,h.x),c=Math.max(c,h.y);return{min:new le(e,i),max:new le(s,c)}},r.a5=vi,r.a8=Ks,r.a9=qi,r.aA=hp,r.aB=$n,r.aC=xn,r.aD=Ap,r.aE=Mm,r.aF=function(){ns.isLoading()||ns.isLoaded()||Ao()!=="deferred"||cd()},r.aG=rs,r.aH=sr,r.aI=Z1,r.aJ=Gt,r.aK=Kg,r.aL=Zg,r.aM=fr,r.aN=Es,r.aO=Td,r.aP=zv,r.aQ=im,r.aR=hy,r.aS=function(t,e){const i=Qa(e.zoom);if(i===0)return zo(t);const s=Xp(t),c=Og(s),h=vi(s.getWest())*e.worldSize,p=vi(s.getEast())*e.worldSize,y=ui(s.getNorth())*e.worldSize,b=ui(s.getSouth())*e.worldSize,w=[h,y,0],S=[p,y,0],I=[h,b,0],P=[p,b,0],R=r.a6.invert([],e.globeMatrix);return r.N.transformMat4(w,w,R),r.N.transformMat4(S,S,R),r.N.transformMat4(I,I,R),r.N.transformMat4(P,P,R),c[0]=ua(c[0],I,i),c[1]=ua(c[1],P,i),c[2]=ua(c[2],S,i),c[3]=ua(c[3],w,i),jn.fromPoints(c)},r.aT=Kp,r.aU=Ld,r.aV=ua,r.aW=Br,r.aX=XE,r.aY=In,r.aZ=cw,r.a_=We,r.aa=wt,r.ab=Q,r.ac=function(t,e){const i={};for(let s=0;s<e.length;s++){const c=e[s];c in t&&(i[c]=t[c])}return i},r.ad=ke,r.ae=ui,r.af=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,i,s){const c=this.entries[t]=this.entries[t]||{callbacks:[]};if(c.result){const[h,p]=c.result;return this.scheduler?this.scheduler.add(()=>{s(h,p)},e):s(h,p),()=>{}}return c.callbacks.push(s),c.cancel||(c.cancel=i((h,p)=>{c.result=[h,p];for(const y of c.callbacks)this.scheduler?this.scheduler.add(()=>{y(h,p)},e):y(h,p);setTimeout(()=>delete this.entries[t],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(h=>h!==s),c.callbacks.length||(c.cancel(),delete this.entries[t]))}}},r.ag=md,r.ah=function(t,e,i){const s=JSON.stringify(t.request);return t.data&&(this.deduped.entries[s]={result:[null,t.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},c=>{const h=We(t.request,(p,y,b,w)=>{p?c(p):y&&c(null,{vectorTile:i?void 0:new Xg(new Ru(y)),rawData:y,cacheControl:b,expires:w})});return()=>{h.cancel(),c()}},e)},r.ai=function(t){tn++,tn>Vt&&(t.getActor().send("enforceCacheSizeLimit",Be),tn=0)},r.aj=ir,r.ak=Ve,r.al=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},r.am=ht,r.an=M1,r.ao=S1,r.ap=T1,r.aq=function(t,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let s=0;s<t.length;s++){const c=document.createElement("source");lt(t[s])||(i.crossOrigin="Anonymous"),c.src=t[s],i.appendChild(c)}return{cancel:()=>{}}},r.ar=Em,r.as=$d,r.at=pi,r.au=Fi,r.av=Xs,r.aw=hr,r.ax=Kn,r.ay=rn,r.az=ra,r.b=$o,r.b$=wp,r.b0=function(t,e){const i=[];for(const s in t)s in e||i.push(s);return i},r.b1=Ji,r.b2=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.b3=function(t,e){const{x:i,y:s}=t.point,c=Uv(i,s,t.worldSize/t._pixelsPerMercatorPixel,0,0);return r.a6.multiply(c,c,Fg(zo(e)))},r.b5=Du,r.b6=Ps,r.b7=um,r.b8=function(t,e,i,s,c){const h=5*e+2;t.float32[h+0]=i,t.float32[h+1]=s,t.float32[h+2]=c},r.b9=Tm,r.bA=Cm,r.bB=E1,r.bC=function(t){const e=E1(t,!0);return r.b4.invert([],[e[0],e[1],e[4],e[5]])},r.bD=kg,r.bE=function(t){const{x:e,y:i}=t.point,{lng:s,lat:c}=t._center;return Uv(e,i,t.worldSize,s,c)},r.bF=Zt,r.bG=se,r.bH=function(t){const e=Math.round((t+45+360)%360/90)%4;return xi[e]},r.bI=45,r.bJ=Yt,r.bK=f,r.bL=Do,r.bM=jp,r.bN=Lr,r.bO=Tu,r.bP=d,r.bQ=function(t,e,i){const s=Math.sqrt(t*t+e*e+i*i),c=s>0?Math.acos(i/s)*Mt:0;let h=t!==0||e!==0?Math.atan2(-e,-t)*Mt+90:0;return h<0&&(h+=360),[s,h,c]},r.bR=Di,r.bS=jn,r.bT=ft,r.bU=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},r.bV=function(t){return t({pluginStatus:$r,pluginURL:Eo}),ld.on("pluginStateChange",t),t},r.bW=Vu,r.bX=Lm,r.bY=Ou,r.bZ=ry,r.b_=Yn,r.ba=r1,r.bb=Ns,r.bc=Cr,r.bd=h1,r.be=oy,r.bf=iy,r.bg=Ey,r.bh=bn,r.bj=Qe,r.bk=ne,r.bl=mi,r.bm=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},r.bn=Me,r.bo=v1,r.bp=pt,r.bq=Rg,r.br=A1,r.bs=it,r.bt=Bv,r.bu=function(t,e,i,s,c,h,p,y,b){if(b.name==="globe")return Bv(t,e,new it(i,s,c),!1);const w=$d({z:i,x:s,y:c},b);return new jn([(h+w.x/w.scale)*e,e*(w.y/w.scale),p],[(h+w.x2/w.scale)*e,e*(w.y2/w.scale),y])},r.bv=function(t,e,i){let s=0;for(let c=0;c<2;++c){const h=i?i[c]:0;t[c]>h&&(s+=(t[c]-h)*(t[c]-h)),e[c]<h&&(s+=(h-e[c])*(h-e[c]))}return s},r.bw=Ci,r.bx=X,r.by=function(t){const e=r.a6.identity(new Float64Array(16));r.a6.multiply(e,t.pixelMatrix,t.globeMatrix);const i=[0,_e,0],s=[0,Pe,0];return r.N.transformMat4(i,i,e),r.N.transformMat4(s,s,e),[i[0]>0&&i[0]<=t.width&&i[1]>0&&i[1]<=t.height&&!Ng(t,new Me(t.center.lat,90)),s[0]>0&&s[0]<=t.width&&s[1]>0&&s[1]<=t.height&&!Ng(t,new Me(t.center.lat,-90))]},r.bz=function(t,e){const{scale:i}=t.tileTransform,s=i*Pt/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return r.b4.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[s,s])},r.c=H1,r.c$=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.c0=ie,r.c1=hn,r.c2=function(t,e,i){return t.type==="custom"?new rC(t,e):new OC[t.type](t,e,i)},r.c3=function(t){const e=t.indexOf(_u);return e>=0?t.slice(0,e):t},r.c4=function(t){return t.indexOf(_u)>=0},r.c5=function(t){const e=t.indexOf(_u);return e>=0?t.slice(e+1):""},r.c6=function(t){const e=[],i=t.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},r.c7=on,r.c8=ld,r.c9=je,r.cA=Ob,r.cB=(t,e,i,s,c,h)=>{const p=t.transform;return{u_matrix:zb(t,e,i,s),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:p.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:c,u_image:0,u_tile_units_to_pixels:Rb(e,p),u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:h}},r.cC=(t,e,i,s,c,h,p)=>{const y=t.transform,b=y.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:zb(t,e,i,s),u_pixels_to_tile_units:b,u_device_pixel_ratio:h,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:c,u_texsize:Fb(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Rb(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:p,u_emissive_strength:i.paint.get("line-emissive-strength")}},r.cD=en,r.cE=kd,r.cF=Ab,r.cG=Wt,r.cH=cm,r.cI=il,r.cJ=450,r.cK=7,r.cL=tC,r.cM=256,r.cN=Fg,r.cO=Po,r.cP=wd,r.cQ=function(t,e,i,s,c){return wt((t-e)/(i-e)*(c-s)+s,s,c)},r.cR=Pi,r.cS=py,r.cT=[1,1,1],r.cU=Cu,r.cV=Nu,r.cW=Fs,r.cX=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){const e=ob(new le(0,0),new le(Pt,Pt),t),i=[];for(const s of this._activeRegions){if(s.hiddenByOverlap||!sb(e,s))continue;const c=zA(s.min,s.max,t);i.push({min:c.min,max:c.max,sourceId:this._sourceIds[s.priority],footprint:s.footprint,footprintTileId:s.tileId})}return i}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const s of e.cache.getVisibleCoordinates()){const c=e.cache.getTile(s).buckets[e.layer];if(c)for(const h of c.getNodesInfo()){const p=h.node;p.footprint&&i.push({footprint:p.footprint,id:s.toUnwrapped()})}}return i}})))}_addSource(t){const e=t.getFootprints();if(e.length!==0){for(const i of e){if(!i.footprint)continue;const s=ob(i.footprint.min,i.footprint.max,i.id);this._activeRegions.push({min:s.min,max:s.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:i.id,footprint:i.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||om(e.min,i.min)||om(e.max,i.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0,i=0;for(;!t&&e!==this._activeRegions.length;){const s=this._activeRegions[e],c=this._prevRegions[i];t=s.priority!==c.priority||!rb(s,c),++e,++i}}if(t){++this._updateTime;const e=i=>{const s=this._activeRegions;if(i>=s.length)return i;const c=s[i].priority;for(;i<s.length&&s[i].priority===c;)++i;return i};if(this._sourceIds.length>1){let i=0,s=e(i);for(;i!==s;){let c=i;const h=i;for(;c!==s;){const p=this._activeRegions[c];p.hiddenByOverlap=!1;for(let y=0;y<h;y++){const b=this._activeRegions[y];if(!b.hiddenByOverlap&&sb(p,b)&&(p.hiddenByOverlap=lb(p.footprint,p.tileId,b.footprint,b.tileId),p.hiddenByOverlap))break}++c}i=s,s=e(i)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},r.cY=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){const i=new Es,s=new hr,c=[],h=t+1+2,p=e[0]+1,y=e[0]+1+(1+e.length),b=(w,S,I)=>{let P=w===h-1?w-2:w===0?w:w-1;return P+=I?24575:0,[P,S]};for(let w=0;w<h;++w)i.emplaceBack(...b(w,0,!0));for(let w=0;w<p;++w)for(let S=0;S<h;++S)i.emplaceBack(...b(S,w,(S===0||S===h-1)&&!0));for(let w=0;w<e.length;++w){const S=e[w];for(let I=0;I<h;++I)i.emplaceBack(...b(I,S,!0))}for(let w=0;w<e.length;++w){const S=s.length,I=e[w]+1+2,P=new hr;for(let F=0;F<I-1;F++){const U=F===I-2,$=U?h*(y-e.length+w-F):h;for(let J=0;J<h-1;J++){const te=F*h+J;F===0||U||J===0||J===h-2?(P.emplaceBack(te+1,te,te+$),P.emplaceBack(te+$,te+$+1,te+1)):(s.emplaceBack(te+1,te,te+$),s.emplaceBack(te+$,te+$+1,te+1))}}const R=$n.simpleSegment(0,S,i.length,s.length-S);for(let F=0;F<P.uint16.length;F+=3)s.emplaceBack(P.uint16[F],P.uint16[F+1],P.uint16[F+2]);const O=$n.simpleSegment(0,S,i.length,s.length-S);c.push({withoutSkirts:R,withSkirts:O})}return{vertices:i,indices:s,segments:c}}_createGrid(t){const e=this._fillGridMeshWithLods(ue,de);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,zv.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new hr;for(let p=0;p<=ue;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const i=new Po,s=new Po,c=new Po,h=new Po;this._poleSegments=[];for(let p=0,y=0;p<se;p++){const b=360/(1<<p);i.emplaceBack(0,-Q,0,.5,0),s.emplaceBack(0,-Q,0,.5,1),c.emplaceBack(0,-Q,0,.5,.5),h.emplaceBack(0,-Q,0,.5,.5);for(let w=0;w<=ue;w++){let S=w/ue,I=0;const P=Ri(0,b,S),[R,O,F]=be(JE,QE,P,Q);i.emplaceBack(R,O,F,S,I),s.emplaceBack(R,O,F,S,1-I);const U=Qe(P);S=.5+.5*Math.sin(U),I=.5+.5*Math.cos(U),c.emplaceBack(R,O,F,S,I),h.emplaceBack(R,O,F,S,1-I)}this._poleSegments.push($n.simpleSegment(y,0,66,64)),y+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,qp,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(s,qp,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(c,qp,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(h,qp,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},r.cZ=function(t){return fo.has(t)},r.c_=si,r.ca=n,r.cb=class extends Ys{constructor(t){super(t),this.current=g}set(t,e,i){if(this.fetchUniformLocation(t,e)){for(let s=0;s<9;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},r.cc=qe,r.cd=function(t,e,i){const s=Qa(i.zoom),c=t.style.map._antialias,h=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return s===0&&!c&&!h},r.ce=function(t){const e=t.pixelsPerMeter,i=e/mi(1,t.center.lat),s=r.a6.identity(new Float64Array(16));return r.a6.translate(s,s,[t.point.x,t.point.y,0]),r.a6.scale(s,s,[i,i,e]),Float32Array.from(s)},r.cf=Xp,r.cg=function(t){const e=Ci-5;t=wt(t,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(Qe(t))),3);return Math.round(i*(de.length-1))},r.ch=function(t,e,i,s){const c=e.getNorth(),h=e.getSouth(),p=e.getWest(),y=e.getEast(),b=1<<t.z,w=y-p,S=c-h,I=w/ue,P=-S/de[i],R=[0,I,0,P,0,0,c,p,0];if(t.z>0){const O=180/s;r.co.multiply(R,R,[O/w+1,0,0,0,O/S+1,0,-.5*O/I,.5*O/P,1])}return R[2]=b,R[5]=t.x,R[8]=t.y,R},r.ci=zo,r.cj=function(t,e,i){const s=r.a6.identity(new Float64Array(16)),c=(e/(1<<t)-.5)*Math.PI*2;return r.a6.rotateY(s,i.globeMatrix,c),Float32Array.from(s)},r.ck=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const i=e.getSource().maxzoom,s=1<<i,c=Math.floor(t.x),h=Math.floor((t.x-c)*s),p=Math.floor(t.y*s),y=this.findDEMTileFor(new ht(i,c,i,h,p));return!(!y||!y.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const s=this._source();if(!s||t.y<0||t.y>1)return e;const c=s.getSource().maxzoom,h=1<<c,p=Math.floor(t.x),y=t.x-p,b=new ht(c,p,c,Math.floor(y*h),Math.floor(t.y*h)),w=this.findDEMTileFor(b);if(!w||!w.dem)return e;const S=w.dem,I=1<<w.tileID.canonical.z,P=(y*I-w.tileID.canonical.x)*S.dim,R=(t.y*I-w.tileID.canonical.y)*S.dim,O=Math.floor(P),F=Math.floor(R);return(i?this.exaggeration():1)*Ri(Ri(S.get(O,F),S.get(O,F+1),R-F),Ri(S.get(O+1,F),S.get(O+1,F+1),R-F),P-O)}getAtTileOffset(t,e,i){const s=1<<t.canonical.z;return this.getAtPointOrZero(new Ui(t.wrap+(t.canonical.x+e/Pt)/s,(t.canonical.y+i/Pt)/s))}getAtTileOffsetFunc(t,e,i,s){return c=>{const h=this.getAtTileOffset(t,c.x,c.y),p=s.upVector(t.canonical,c.x,c.y),y=s.upVectorScale(t.canonical,e,i).metersToTile;return r.N.scale(p,p,h*y),p}}getForTilePoints(t,e,i,s){if(this.isUsingMockSource())return!1;const c=Cu.create(this,t,s);return!!c&&(e.forEach(h=>{h[2]=this.exaggeration()*c.getElevationAt(h[0],h[1],i)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const i=e.dem.tree,s=e.tileID,c=1<<t.canonical.z-s.canonical.z;let h=t.canonical.x/c-s.canonical.x,p=t.canonical.y/c-s.canonical.y,y=0;for(let b=0;b<t.canonical.z-s.canonical.z&&!i.leaves[y];b++){h*=2,p*=2;const w=2*Math.floor(p)+Math.floor(h);y=i.childOffsets[y]+w,h%=1,p%=1}return{min:this.exaggeration()*i.minimums[y],max:this.exaggeration()*i.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,i=Number.MAX_VALUE,s=Number.MIN_VALUE;for(const c of t){const h=this.getMinMaxForTile(c.tileID);h&&(i=Math.min(i,h.min),s=Math.max(s,h.max),e=!0)}return e?{min:i,max:s}:null}},r.cl=Zp,r.cm=Yv,r.cn=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},r.cp=Vv,r.cq=256,r.cr=function(t,e){const i=[0,0,0],s=Kp(zo(e.canonical));return r.N.transformMat4(i,i,s),r.N.transformMat4(i,i,t),i},r.cs=t=>({u_camera_to_center_distance:new Lr(t),u_extrude_scale:new T(t),u_device_pixel_ratio:new Lr(t),u_matrix:new f(t),u_inv_rot_matrix:new f(t),u_merc_center:new Do(t),u_tile_id:new jp(t),u_zoom_transition:new Lr(t),u_up_dir:new jp(t),u_emissive_strength:new Lr(t)}),r.ct=t=>({u_matrix:new f(t),u_pixels_to_tile_units:new T(t),u_device_pixel_ratio:new Lr(t),u_units_to_pixels:new Do(t),u_dash_image:new Tu(t),u_gradient_image:new Tu(t),u_image_height:new Lr(t),u_texsize:new Do(t),u_tile_units_to_pixels:new Lr(t),u_alpha_discard_threshold:new Lr(t),u_trim_offset:new Do(t),u_emissive_strength:new Lr(t)}),r.cu=t=>({u_matrix:new f(t),u_texsize:new Do(t),u_pixels_to_tile_units:new T(t),u_device_pixel_ratio:new Lr(t),u_image:new Tu(t),u_units_to_pixels:new Do(t),u_tile_units_to_pixels:new Lr(t),u_alpha_discard_threshold:new Lr(t),u_trim_offset:new Do(t)}),r.cv=xu,r.cw=uI,r.cx=hI,r.cy=$v,r.cz=(t,e,i,s,c,h)=>{const p=t.transform,y=p.projection.name==="globe";let b;if(h.paint.get("circle-pitch-alignment")==="map")if(y){const S=Vv(p.zoom,e.canonical)*p._pixelsPerMercatorPixel;b=Float32Array.from([S,0,0,S])}else b=p.calculatePixelsToTileUnitsMatrix(i);else b=new Float32Array([p.pixelsToGLUnits[0],0,0,p.pixelsToGLUnits[1]]);const w={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(p.projection),u_matrix:t.translatePosMatrix(e.projMatrix,i,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Xe.devicePixelRatio,u_extrude_scale:b,u_inv_rot_matrix:eA,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:h.paint.get("circle-emissive-strength")};if(y){w.u_inv_rot_matrix=s,w.u_merc_center=c,w.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],w.u_zoom_transition=Qa(p.zoom);const S=c[0]*Pt,I=c[1]*Pt;w.u_up_dir=p.projection.upVector(new it(0,0,0),S,I)}return w},r.d=It,r.d0=yt,r.d1=ji,r.d2=Ne,r.d3=function([t,e,i]){const s=Math.hypot(t,e,i),c=Math.atan2(t,i),h=.5*Math.PI-Math.acos(-e/s);return new Me(Zt(c),Zt(h))},r.d4=Oe,r.d5=G,r.d6=Ng,r.d7=jv,r.d8=function(t){const e=[0,0,0],i=r.a6.identity(new Float64Array(16));return r.a6.multiply(i,t.pixelMatrix,t.globeMatrix),r.N.transformMat4(e,e,i),new le(e[0],e[1])},r.d9=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!function(i){if(Ce==null){const s=i.navigator?i.navigator.userAgent:null;Ce=!!i.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Ce}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.dA=to,r.dB=q1,r.dC=X1,r.dD=Db,r.dE=Ei,r.dF=o1,r.dG=function(t,e,i,s,c,h,p,y,b,w,S){t.createArrays(),t.tilePixelRatio=Pt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const I=t.layers[0].layout,P=t.layers[0]._unevaluatedLayout._values,R={};if(t.textSizeData.kind==="composite"){const{minZoom:$,maxZoom:J}=t.textSizeData;R.compositeTextSizes=[P["text-size"].possiblyEvaluate(new On($),y),P["text-size"].possiblyEvaluate(new On(J),y)]}if(t.iconSizeData.kind==="composite"){const{minZoom:$,maxZoom:J}=t.iconSizeData;R.compositeIconSizes=[P["icon-size"].possiblyEvaluate(new On($),y),P["icon-size"].possiblyEvaluate(new On(J),y)]}R.layoutTextSize=P["text-size"].possiblyEvaluate(new On(b+1),y),R.layoutIconSize=P["icon-size"].possiblyEvaluate(new On(b+1),y),R.textMaxSize=P["text-size"].possiblyEvaluate(new On(18),y);const O=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",F=I.get("text-size");let U=!1;for(const $ of t.features)if($.icon&&$.icon.nameSecondary){U=!0;break}for(const $ of t.features){const J=I.get("text-font").evaluate($,{},y).join(","),te=F.evaluate($,{},y),ee=R.layoutTextSize.evaluate($,{},y),ce=(R.layoutIconSize.evaluate($,{},y),{horizontal:{},vertical:void 0}),ae=$.text;let fe,ve=[0,0];if(ae){const Ee=ae.toString(),Ue=I.get("text-letter-spacing").evaluate($,{},y)*Cr,Ye=I.get("text-line-height").evaluate($,{},y)*Cr,Fe=cg(Ee)?Ue:0,Ze=I.get("text-anchor").evaluate($,{},y),ze=I.get("text-variable-anchor");if(!ze){const Lt=I.get("text-radial-offset").evaluate($,{},y);ve=Lt?h1(Ze,[Lt*Cr,sy]):I.get("text-offset").evaluate($,{},y).map(rt=>rt*Cr)}let He=O?"center":I.get("text-justify").evaluate($,{},y);const vt=I.get("symbol-placement")==="point",Ke=vt?I.get("text-max-width").evaluate($,{},y)*Cr:1/0,jt=Lt=>{t.allowVerticalPlacement&&So(Ee)&&(ce.vertical=ty(ae,e,i,c,J,Ke,Ye,Ze,Lt,Fe,ve,Ps.vertical,!0,ee,te))};if(!O&&ze){const Lt=He==="auto"?ze.map(oi=>oy(oi)):[He];let rt=!1;for(let oi=0;oi<Lt.length;oi++){const Xt=Lt[oi];if(!ce.horizontal[Xt])if(rt)ce.horizontal[Xt]=ce.horizontal[0];else{const Ut=ty(ae,e,i,c,J,Ke,Ye,"center",Xt,Fe,ve,Ps.horizontal,!1,ee,te);Ut&&(ce.horizontal[Xt]=Ut,rt=Ut.positionedLines.length===1)}}jt("left")}else{if(He==="auto"&&(He=oy(Ze)),vt||I.get("text-writing-mode").indexOf("horizontal")>=0||!So(Ee)){const Lt=ty(ae,e,i,c,J,Ke,Ye,Ze,He,Fe,ve,Ps.horizontal,!1,ee,te);Lt&&(ce.horizontal[He]=Lt)}jt(vt?"left":He)}}let Se=!1;if($.icon&&$.icon.namePrimary){const Ee=s[$.icon.namePrimary];Ee&&(fe=PI(c[$.icon.namePrimary],$.icon.nameSecondary?c[$.icon.nameSecondary]:void 0,I.get("icon-offset").evaluate($,{},y),I.get("icon-anchor").evaluate($,{},y)),Se=Ee.sdf,t.sdfIcons===void 0?t.sdfIcons=Ee.sdf:t.sdfIcons!==Ee.sdf&&we("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ee.pixelRatio!==t.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const De=f1(ce.horizontal)||ce.vertical;t.iconsInText||(t.iconsInText=!!De&&De.iconsInText),(De||fe)&&FI(t,$,ce,fe,s,R,ee,0,ve,Se,p,y,w,S,U)}h&&t.generateCollisionDebugBuffers(b,t.collisionBoxArray)},r.dH=Xg,r.dI=Ru,r.dJ=am,r.dK=tt,r.dL=rm,r.dM=nm,r.dN=dt,r.dO=Ub,r.dP=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==N1){const i=new Uint32Array(t,0,7),[,,s,c,h,p]=i;e=i.byteLength+c+h+p+h,(s!==t.byteLength||e>=t.byteLength)&&we("Invalid b3dm header information.")}return G1(t,e)},r.dQ=function(t,e){const i=H1(t);for(const s of i){for(const c of s.meshes)PC(c);s.lights&&(s.lightMeshIndex=s.meshes.length,s.meshes.push(DC(s.lights,e)))}return i},r.dR=Om,r.dS=z1,r.dT=ns,r.dU=function(t){dn(),Tt&&Tt.then(e=>{e.keys().then(i=>{for(let s=0;s<i.length-t;s++)e.delete(i[s])})})},r.da=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",xt,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!ie(t))return t;const i=ci(t);return i.params.push(`sdk=js-${k}`),i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!ie(t))return t;const i=ci(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeModelURL(t,e){if(!ie(t))return t;const i=ci(t);return i.path=`/models/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e,i,s){if(!ie(t))return t;const c=ci(t);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),i&&c.params.push(`language=${i}`),s&&c.params.push(`worldview=${s}`),this._makeAPIURL(c,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,s){const c=ci(t);return ie(t)?(c.path=`/styles/v1${c.path}/sprite${e}${i}`,this._makeAPIURL(c,this._customAccessToken||s)):(c.path+=`${e}${i}`,ki(c))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!ie(t))return t;const s=ci(t);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&s.authority!=="raster"&&i===512?"@2x":""}${Zi.supported?".webp":"$1"}`),s.authority==="raster"?s.path=`/${G.RASTER_URL_PREFIX}${s.path}`:s.authority==="rasterarrays"?s.path=`/${G.RASTERARRAYS_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${G.TILE_URL_VERSION}${s.path}`);const c=this._customAccessToken||function(h){for(const p of h){const y=p.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(s.params)||G.ACCESS_TOKEN;return G.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,c)}canonicalizeTileURL(t,e){const i=ci(t);if(!i.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let s="mapbox://";i.path.match(/^\/raster\/v1\//)?s+=`raster/${i.path.replace(`/${G.RASTER_URL_PREFIX}/`,"")}`:i.path.match(/^\/rasterarrays\/v1\//)?s+=`rasterarrays/${i.path.replace(`/${G.RASTERARRAYS_URL_PREFIX}/`,"")}`:s+=`tiles/${i.path.replace(`/${G.TILE_URL_VERSION}/`,"")}`;let c=i.params;return e&&(c=c.filter(h=>!h.match(/^access_token=/))),c.length&&(s+=`?${c.join("&")}`),s}canonicalizeTileset(t,e){const i=!!e&&ie(e),s=[];for(const c of t.tiles||[])K(c)?s.push(this.canonicalizeTileURL(c,i)):s.push(c);return s}_makeAPIURL(t,e){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",s=ci(G.API_URL);if(t.protocol=s.protocol,t.authority=s.authority,t.protocol==="http"){const c=t.params.indexOf("secure");c>=0&&t.params.splice(c,1)}if(s.path!=="/"&&(t.path=`${s.path}${t.path}`),!G.REQUIRE_ACCESS_TOKEN)return ki(t);if(e=e||G.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter(c=>c.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),ki(t)}},r.db=function(t,e){e?fo.add(t):fo.delete(t)},r.dc=Zi,r.dd=vs,r.de=Il,r.df=Dt,r.dg=Hi,r.dh=function(t){fo.delete(t)},r.di=Mr,r.dj=Tr,r.dk=k,r.dl=function(t,e){Be=t,Vt=e},r.dm=function(t,e,i=!1){if($r===nd||$r===rd||$r===sd)throw new Error("setRTLTextPlugin cannot be called multiple times.");Eo=Xe.resolveURL(t),$r=nd,od=e,ad(),i||cd()},r.dn=Ao,r.dp=function(){Lm().acquire(yy)},r.dq=function(){const t=Jd;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(yy),Jd=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.dr=Kd,r.ds=function(t){const e=wi();if(!e)return;const i=e.delete(Ot);t&&i.catch(t).then(()=>t())},r.dt=Yd,r.du=O1,r.dv=function(t){xy=Xe.resolveURL(t),ju||(ju=new Vu(Lm(),new Aa)),ju.broadcast("setDracoUrl",xy)},r.dw=F1,r.dx=function(t){Uu=Xe.resolveURL(t),ju||(ju=new Vu(Lm(),new Aa)),ju.broadcast("setMeshoptUrl",Uu)},r.dy=Bt,r.dz=el,r.e=Nt,r.f=Xe,r.g=function(t,e){return je(Nt(t,{type:"json"}),e)},r.h=Cs,r.i=ka,r.j=ah,r.k=cu,r.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>G1(e,0,t))},r.m=pp,r.n=$l,r.o=Kl,r.p=s1,r.q=fu,r.r=du,r.s=Jh,r.t=Bl,r.u=Yl,r.v=Er,r.w=we,r.x=Ba,r.z=dd}),M(["./shared"],function(r){function k(Ce){const Z=Ce?Ce.url.toString():void 0;return Z?performance.getEntriesByName(Z):[]}function N(Ce){if(typeof Ce=="number"||typeof Ce=="boolean"||typeof Ce=="string"||Ce==null)return JSON.stringify(Ce);if(Array.isArray(Ce)){let ne="[";for(const he of Ce)ne+=`${N(he)},`;return`${ne}]`}let Z="{";for(const ne of Object.keys(Ce).sort())Z+=`${ne}:${N(Ce[ne])},`;return`${Z}}`}function G(Ce){let Z="";for(const ne of r.b2)Z+=`/${N(Ce[ne])}`;return Z}class K{constructor(Z){this.keyCache={},this._layers={},this._layerConfigs={},Z&&this.replace(Z)}replace(Z,ne){this._layerConfigs={},this._layers={},this.update(Z,[],ne)}update(Z,ne,he){this._options=he;for(const Ve of Z)this._layerConfigs[Ve.id]=Ve,(this._layers[Ve.id]=r.c2(Ve,this.scope,this._options)).compileFilter(),this.keyCache[Ve.id]&&delete this.keyCache[Ve.id];for(const Ve of ne)delete this.keyCache[Ve],delete this._layerConfigs[Ve],delete this._layers[Ve];this.familiesBySource={};const Le=function(Ve,Xe){const Ot={};for(let Vt=0;Vt<Ve.length;Vt++){const Tt=Xe&&Xe[Ve[Vt].id]||G(Ve[Vt]);Xe&&(Xe[Ve[Vt].id]=Tt);let Ft=Ot[Tt];Ft||(Ft=Ot[Tt]=[]),Ft.push(Ve[Vt])}const Be=[];for(const Vt in Ot)Be.push(Ot[Vt]);return Be}(r.a$(this._layerConfigs),this.keyCache);for(const Ve of Le){const Xe=Ve.map(wi=>this._layers[wi.id]),Ot=Xe[0];if(Ot.visibility==="none")continue;const Be=Ot.source||"";let Vt=this.familiesBySource[Be];Vt||(Vt=this.familiesBySource[Be]={});const Tt=Ot.sourceLayer||"_geojsonTileLayer";let Ft=Vt[Tt];Ft||(Ft=Vt[Tt]=[]),Ft.push(Xe)}}}const ie=1*r.dA;class pe{constructor(Z){const ne={},he=[];for(const Ot in Z){const Be=Z[Ot],Vt=ne[Ot]={};for(const Tt in Be.glyphs){const Ft=Be.glyphs[+Tt];if(!Ft||Ft.bitmap.width===0||Ft.bitmap.height===0)continue;const wi=Ft.metrics.localGlyph?ie:1,dn={x:0,y:0,w:Ft.bitmap.width+2*wi,h:Ft.bitmap.height+2*wi};he.push(dn),Vt[Tt]=dn}}const{w:Le,h:Ve}=r.p(he),Xe=new r.dz({width:Le||1,height:Ve||1});for(const Ot in Z){const Be=Z[Ot];for(const Vt in Be.glyphs){const Tt=Be.glyphs[+Vt];if(!Tt||Tt.bitmap.width===0||Tt.bitmap.height===0)continue;const Ft=ne[Ot][Vt],wi=Tt.metrics.localGlyph?ie:1;r.dz.copy(Tt.bitmap,Xe,{x:0,y:0},{x:Ft.x+wi,y:Ft.y+wi},Tt.bitmap)}}this.image=Xe,this.positions=ne}}r.dy(pe,"GlyphAtlas");class ge{constructor(Z){this.tileID=new r.am(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.tileZoom=Z.tileZoom,this.uid=Z.uid,this.zoom=Z.zoom,this.canonical=Z.tileID.canonical,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.scope=Z.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Z.showCollisionBoxes,this.collectResourceTiming=!!Z.collectResourceTiming,this.promoteId=Z.promoteId,this.isSymbolTile=Z.isSymbolTile,this.tileTransform=r.as(Z.tileID.canonical,Z.projection),this.projection=Z.projection,this.brightness=Z.brightness,this.extraShadowCaster=!!Z.extraShadowCaster}parse(Z,ne,he,Le,Ve){this.status="parsing",this.data=Z,this.collisionBoxArray=new r.aD;const Xe=new r.dB(Object.keys(Z.layers).sort()),Ot=new r.dC(this.tileID,this.promoteId);Ot.bucketLayerIDs=[];const Be={},Vt=new r.dD(256,256),Tt={featureIndex:Ot,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Vt,availableImages:he,brightness:this.brightness},Ft=ne.familiesBySource[this.source];for(const an in Ft){const wn=Z.layers[an];if(!wn)continue;let ur=!1,Sn=!1,Or=!1;for(const tr of Ft[an])tr[0].type==="symbol"?ur=!0:Sn=!0,tr[0].is3D()&&tr[0].type!=="model"&&(Or=!0);if(this.extraShadowCaster&&!Or||this.isSymbolTile===!0&&!ur||this.isSymbolTile===!1&&!Sn)continue;wn.version===1&&r.w(`Vector tile source "${this.source}" layer "${an}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Dr=Xe.encode(an),Ur=[];for(let tr=0;tr<wn.length;tr++){const Yn=wn.feature(tr),je=Ot.getId(Yn,an);Ur.push({feature:Yn,id:je,index:tr,sourceLayerIndex:Dr})}for(const tr of Ft[an]){const Yn=tr[0];(!this.extraShadowCaster||Yn.is3D()&&Yn.type!=="model")&&(this.isSymbolTile!==void 0&&Yn.type==="symbol"!==this.isSymbolTile||Yn.minzoom&&this.zoom<Math.floor(Yn.minzoom)||Yn.maxzoom&&this.zoom>=Yn.maxzoom||Yn.visibility!=="none"&&(Te(tr,this.zoom,Tt.brightness,he),(Be[Yn.id]=Yn.createBucket({index:Ot.bucketLayerIDs.length,layers:tr,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Dr,sourceID:this.source,projection:this.projection.spec})).populate(Ur,Tt,this.tileID.canonical,this.tileTransform),Ot.bucketLayerIDs.push(tr.map(je=>je.id))))}}let wi,dn,Cn,fn;Vt.trim();const tn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Zi=()=>{if(wi)return this.status="done",Ve(wi);if(this.extraShadowCaster)this.status="done",Ve(null,{buckets:r.a$(Be).filter(an=>!an.isEmpty()),featureIndex:Ot,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Tt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(dn&&Cn&&fn){const an=new pe(dn),wn=new r.dF(Cn,fn);for(const ur in Be){const Sn=Be[ur];Sn instanceof r.aE?(Te(Sn.layers,this.zoom,Tt.brightness,he),r.dG(Sn,dn,an.positions,Cn,wn.iconPositions,this.showCollisionBoxes,he,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):Sn.hasPattern&&(Sn instanceof r.aK||Sn instanceof r.aL||Sn instanceof r.cH)&&(Te(Sn.layers,this.zoom,Tt.brightness,he),Sn.addFeatures(Tt,this.tileID.canonical,wn.patternPositions,he,this.tileTransform,this.brightness))}this.status="done",Ve(null,{buckets:r.a$(Be).filter(ur=>!ur.isEmpty()),featureIndex:Ot,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:an.image,lineAtlas:Vt,imageAtlas:wn,brightness:Tt.brightness})}};if(!this.extraShadowCaster){const an=r.dE(Tt.glyphDependencies,Sn=>Object.keys(Sn).map(Number));Object.keys(an).length?Le.send("getGlyphs",{uid:this.uid,stacks:an,scope:this.scope},(Sn,Or)=>{wi||(wi=Sn,dn=Or,Zi())},void 0,!1,tn):dn={};const wn=Object.keys(Tt.iconDependencies);wn.length?Le.send("getImages",{icons:wn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Sn,Or)=>{wi||(wi=Sn,Cn=Or,Zi())},void 0,!1,tn):Cn={};const ur=Object.keys(Tt.patternDependencies);ur.length?Le.send("getImages",{icons:ur,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Sn,Or)=>{wi||(wi=Sn,fn=Or,Zi())},void 0,!1,tn):fn={}}Zi()}}function Te(Ce,Z,ne,he){const Le=new r.K(Z,{brightness:ne});for(const Ve of Ce)Ve.recalculate(Le,he)}class Re extends r.E{constructor(Z,ne,he,Le,Ve,Xe){super(),this.actor=Z,this.layerIndex=ne,this.availableImages=he,this.loadVectorData=Ve||r.ah,this.loading={},this.loaded={},this.deduped=new r.af(Z.scheduler),this.isSpriteLoaded=Le,this.scheduler=Z.scheduler,this.brightness=Xe}loadTile(Z,ne){const he=Z.uid,Le=Z&&Z.request,Ve=Le&&Le.collectResourceTiming,Xe=this.loading[he]=new ge(Z);Xe.abort=this.loadVectorData(Z,(Ot,Be)=>{const Vt=!this.loading[he];if(delete this.loading[he],Vt||Ot||!Be)return Xe.status="done",Vt||(this.loaded[he]=Xe),ne(Ot);const Tt=Be.rawData,Ft={};Be.expires&&(Ft.expires=Be.expires),Be.cacheControl&&(Ft.cacheControl=Be.cacheControl),Xe.vectorTile=Be.vectorTile||new r.dH(new r.dI(Tt));const wi=()=>{Xe.parse(Xe.vectorTile,this.layerIndex,this.availableImages,this.actor,(dn,Cn)=>{if(dn||!Cn)return ne(dn);const fn={};if(Ve){const tn=k(Le);tn.length>0&&(fn.resourceTiming=JSON.parse(JSON.stringify(tn)))}ne(null,r.e({rawTileData:Tt.slice(0)},Cn,Ft,fn))})};this.isSpriteLoaded?wi():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(wi,{type:"parseTile",isSymbolTile:Z.isSymbolTile,zoom:Z.tileZoom}):wi()}),this.loaded=this.loaded||{},this.loaded[he]=Xe})}reloadTile(Z,ne){const he=this.loaded,Le=Z.uid,Ve=this;if(he&&he[Le]){const Xe=he[Le];Xe.showCollisionBoxes=Z.showCollisionBoxes,Xe.projection=Z.projection,Xe.brightness=Z.brightness,Xe.tileTransform=r.as(Z.tileID.canonical,Z.projection),Xe.extraShadowCaster=Z.extraShadowCaster;const Ot=(Be,Vt)=>{const Tt=Xe.reloadCallback;Tt&&(delete Xe.reloadCallback,Xe.parse(Xe.vectorTile,Ve.layerIndex,this.availableImages,Ve.actor,Tt)),ne(Be,Vt)};Xe.status==="parsing"?Xe.reloadCallback=Ot:Xe.status==="done"&&(Xe.vectorTile?Xe.parse(Xe.vectorTile,this.layerIndex,this.availableImages,this.actor,Ot):Ot())}else ne(null,void 0)}abortTile(Z,ne){const he=Z.uid,Le=this.loading[he];Le&&(Le.abort&&Le.abort(),delete this.loading[he]),ne()}removeTile(Z,ne){const he=this.loaded,Le=Z.uid;he&&he[Le]&&delete he[Le],ne()}}class $e{loadTile(Z,ne){const{uid:he,encoding:Le,rawImageData:Ve,padding:Xe}=Z,Ot=ImageBitmap&&Ve instanceof ImageBitmap?this.getImageData(Ve,Xe):Ve;ne(null,new r.dJ(he,Ot,Le,Xe<1))}getImageData(Z,ne){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Z.width,Z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Z.width,this.offscreenCanvas.height=Z.height,this.offscreenCanvasContext.drawImage(Z,0,0,Z.width,Z.height);const he=this.offscreenCanvasContext.getImageData(-ne,-ne,Z.width+2*ne,Z.height+2*ne);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),he}}class tt{decodeRasterArray({task:Z,buffer:ne},he){r.aZ.performDecoding(ne,Z).then(Le=>{he(null,Le)},Le=>{he(Le)})}}function ut(Ce,Z){if(Ce.length!==0){ot(Ce[0],Z);for(var ne=1;ne<Ce.length;ne++)ot(Ce[ne],!Z)}}function ot(Ce,Z){for(var ne=0,he=0,Le=0,Ve=Ce.length,Xe=Ve-1;Le<Ve;Xe=Le++){var Ot=(Ce[Le][0]-Ce[Xe][0])*(Ce[Xe][1]+Ce[Le][1]),Be=ne+Ot;he+=Math.abs(ne)>=Math.abs(Ot)?ne-Be+Ot:Ot-Be+ne,ne=Be}ne+he>=0!=!!Z&&Ce.reverse()}var at=r.dK(function Ce(Z,ne){var he,Le=Z&&Z.type;if(Le==="FeatureCollection")for(he=0;he<Z.features.length;he++)Ce(Z.features[he],ne);else if(Le==="GeometryCollection")for(he=0;he<Z.geometries.length;he++)Ce(Z.geometries[he],ne);else if(Le==="Feature")Ce(Z.geometry,ne);else if(Le==="Polygon")ut(Z.coordinates,ne);else if(Le==="MultiPolygon")for(he=0;he<Z.coordinates.length;he++)ut(Z.coordinates[he],ne);return Z});const dt=r.dL.prototype.toGeoJSON;let xe=class{constructor(Ce){this._feature=Ce,this.extent=r.V,this.type=Ce.type,this.properties=Ce.tags,"id"in Ce&&!isNaN(Ce.id)&&(this.id=parseInt(Ce.id,10))}loadGeometry(){if(this._feature.type===1){const Ce=[];for(const Z of this._feature.geometry)Ce.push([new r.P(Z[0],Z[1])]);return Ce}{const Ce=[];for(const Z of this._feature.geometry){const ne=[];for(const he of Z)ne.push(new r.P(he[0],he[1]));Ce.push(ne)}return Ce}}toGeoJSON(Ce,Z,ne){return dt.call(this,Ce,Z,ne)}},le=class{constructor(Ce){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.V,this.length=Ce.length,this._features=Ce}feature(Ce){return new xe(this._features[Ce])}};var Je={exports:{}},Mt=r.dN,Qe=r.dM.VectorTileFeature,Zt=xi;function xi(Ce,Z){this.options=Z||{},this.features=Ce,this.length=Ce.length}function qe(Ce,Z){this.id=typeof Ce.id=="number"?Ce.id:void 0,this.type=Ce.type,this.rawGeometry=Ce.type===1?[Ce.geometry]:Ce.geometry,this.properties=Ce.tags,this.extent=Z||4096}xi.prototype.feature=function(Ce){return new qe(this.features[Ce],this.options.extent)},qe.prototype.loadGeometry=function(){var Ce=this.rawGeometry;this.geometry=[];for(var Z=0;Z<Ce.length;Z++){for(var ne=Ce[Z],he=[],Le=0;Le<ne.length;Le++)he.push(new Mt(ne[Le][0],ne[Le][1]));this.geometry.push(he)}return this.geometry},qe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ce=this.geometry,Z=1/0,ne=-1/0,he=1/0,Le=-1/0,Ve=0;Ve<Ce.length;Ve++)for(var Xe=Ce[Ve],Ot=0;Ot<Xe.length;Ot++){var Be=Xe[Ot];Z=Math.min(Z,Be.x),ne=Math.max(ne,Be.x),he=Math.min(he,Be.y),Le=Math.max(Le,Be.y)}return[Z,he,ne,Le]},qe.prototype.toGeoJSON=Qe.prototype.toGeoJSON;var si=r.dO,yt=Zt;function wt(Ce){var Z=new si;return function(ne,he){for(var Le in ne.layers)he.writeMessage(3,Qt,ne.layers[Le])}(Ce,Z),Z.finish()}function Qt(Ce,Z){var ne;Z.writeVarintField(15,Ce.version||1),Z.writeStringField(1,Ce.name||""),Z.writeVarintField(5,Ce.extent||4096);var he={keys:[],values:[],keycache:{},valuecache:{}};for(ne=0;ne<Ce.length;ne++)he.feature=Ce.feature(ne),Z.writeMessage(2,bn,he);var Le=he.keys;for(ne=0;ne<Le.length;ne++)Z.writeStringField(3,Le[ne]);var Ve=he.values;for(ne=0;ne<Ve.length;ne++)Z.writeMessage(4,un,Ve[ne])}function bn(Ce,Z){var ne=Ce.feature;ne.id!==void 0&&Z.writeVarintField(1,ne.id),Z.writeMessage(2,Ji,Ce),Z.writeVarintField(3,ne.type),Z.writeMessage(4,xn,ne)}function Ji(Ce,Z){var ne=Ce.feature,he=Ce.keys,Le=Ce.values,Ve=Ce.keycache,Xe=Ce.valuecache;for(var Ot in ne.properties){var Be=ne.properties[Ot],Vt=Ve[Ot];if(Be!==null){Vt===void 0&&(he.push(Ot),Ve[Ot]=Vt=he.length-1),Z.writeVarint(Vt);var Tt=typeof Be;Tt!=="string"&&Tt!=="boolean"&&Tt!=="number"&&(Be=JSON.stringify(Be));var Ft=Tt+":"+Be,wi=Xe[Ft];wi===void 0&&(Le.push(Be),Xe[Ft]=wi=Le.length-1),Z.writeVarint(wi)}}}function Nt(Ce,Z){return(Z<<3)+(7&Ce)}function Qi(Ce){return Ce<<1^Ce>>31}function xn(Ce,Z){for(var ne=Ce.loadGeometry(),he=Ce.type,Le=0,Ve=0,Xe=ne.length,Ot=0;Ot<Xe;Ot++){var Be=ne[Ot],Vt=1;he===1&&(Vt=Be.length),Z.writeVarint(Nt(1,Vt));for(var Tt=he===3?Be.length-1:Be.length,Ft=0;Ft<Tt;Ft++){Ft===1&&he!==1&&Z.writeVarint(Nt(2,Tt-1));var wi=Be[Ft].x-Le,dn=Be[Ft].y-Ve;Z.writeVarint(Qi(wi)),Z.writeVarint(Qi(dn)),Le+=wi,Ve+=dn}he===3&&Z.writeVarint(Nt(7,1))}}function un(Ce,Z){var ne=typeof Ce;ne==="string"?Z.writeStringField(1,Ce):ne==="boolean"?Z.writeBooleanField(7,Ce):ne==="number"&&(Ce%1!=0?Z.writeDoubleField(3,Ce):Ce<0?Z.writeSVarintField(6,Ce):Z.writeVarintField(5,Ce))}Je.exports=wt,Je.exports.fromVectorTileJs=wt,Je.exports.fromGeojsonVt=function(Ce,Z){Z=Z||{};var ne={};for(var he in Ce)ne[he]=new yt(Ce[he].features,Z),ne[he].name=he,ne[he].version=Z.version,ne[he].extent=Z.extent;return wt({layers:ne})},Je.exports.GeoJSONWrapper=yt;var en=r.dK(Je.exports);const Ln={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ce=>Ce},In=Math.fround||(hi=new Float32Array(1),Ce=>(hi[0]=+Ce,hi[0]));var hi;const Ei=3,on=5,hn=6;class ye{constructor(Z){this.options=Object.assign(Object.create(Ln),Z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Z){const{log:ne,minZoom:he,maxZoom:Le}=this.options;ne&&console.time("total time");const Ve=`prepare ${Z.length} points`;ne&&console.time(Ve),this.points=Z;const Xe=[];for(let Be=0;Be<Z.length;Be++){const Vt=Z[Be];if(!Vt.geometry)continue;const[Tt,Ft]=Vt.geometry.coordinates,wi=In(nt(Tt)),dn=In(ft(Ft));Xe.push(wi,dn,1/0,Be,-1,1),this.options.reduce&&Xe.push(0)}let Ot=this.trees[Le+1]=this._createTree(Xe);ne&&console.timeEnd(Ve);for(let Be=Le;Be>=he;Be--){const Vt=+Date.now();Ot=this.trees[Be]=this._createTree(this._cluster(Ot,Be)),ne&&console.log("z%d: %d clusters in %dms",Be,Ot.numItems,+Date.now()-Vt)}return ne&&console.timeEnd("total time"),this}getClusters(Z,ne){let he=((Z[0]+180)%360+360)%360-180;const Le=Math.max(-90,Math.min(90,Z[1]));let Ve=Z[2]===180?180:((Z[2]+180)%360+360)%360-180;const Xe=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)he=-180,Ve=180;else if(he>Ve){const Ft=this.getClusters([he,Le,180,Xe],ne),wi=this.getClusters([-180,Le,Ve,Xe],ne);return Ft.concat(wi)}const Ot=this.trees[this._limitZoom(ne)],Be=Ot.range(nt(he),ft(Xe),nt(Ve),ft(Le)),Vt=Ot.data,Tt=[];for(const Ft of Be){const wi=this.stride*Ft;Tt.push(Vt[wi+on]>1?we(Vt,wi,this.clusterProps):this.points[Vt[wi+Ei]])}return Tt}getChildren(Z){const ne=this._getOriginId(Z),he=this._getOriginZoom(Z),Le="No cluster with the specified id.",Ve=this.trees[he];if(!Ve)throw new Error(Le);const Xe=Ve.data;if(ne*this.stride>=Xe.length)throw new Error(Le);const Ot=this.options.radius/(this.options.extent*Math.pow(2,he-1)),Be=Ve.within(Xe[ne*this.stride],Xe[ne*this.stride+1],Ot),Vt=[];for(const Tt of Be){const Ft=Tt*this.stride;Xe[Ft+4]===Z&&Vt.push(Xe[Ft+on]>1?we(Xe,Ft,this.clusterProps):this.points[Xe[Ft+Ei]])}if(Vt.length===0)throw new Error(Le);return Vt}getLeaves(Z,ne,he){const Le=[];return this._appendLeaves(Le,Z,ne=ne||10,he=he||0,0),Le}getTile(Z,ne,he){const Le=this.trees[this._limitZoom(Z)],Ve=Math.pow(2,Z),{extent:Xe,radius:Ot}=this.options,Be=Ot/Xe,Vt=(he-Be)/Ve,Tt=(he+1+Be)/Ve,Ft={features:[]};return this._addTileFeatures(Le.range((ne-Be)/Ve,Vt,(ne+1+Be)/Ve,Tt),Le.data,ne,he,Ve,Ft),ne===0&&this._addTileFeatures(Le.range(1-Be/Ve,Vt,1,Tt),Le.data,Ve,he,Ve,Ft),ne===Ve-1&&this._addTileFeatures(Le.range(0,Vt,Be/Ve,Tt),Le.data,-1,he,Ve,Ft),Ft.features.length?Ft:null}getClusterExpansionZoom(Z){let ne=this._getOriginZoom(Z)-1;for(;ne<=this.options.maxZoom;){const he=this.getChildren(Z);if(ne++,he.length!==1)break;Z=he[0].properties.cluster_id}return ne}_appendLeaves(Z,ne,he,Le,Ve){const Xe=this.getChildren(ne);for(const Ot of Xe){const Be=Ot.properties;if(Be&&Be.cluster?Ve+Be.point_count<=Le?Ve+=Be.point_count:Ve=this._appendLeaves(Z,Be.cluster_id,he,Le,Ve):Ve<Le?Ve++:Z.push(Ot),Z.length===he)break}return Ve}_createTree(Z){const ne=new r.bg(Z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let he=0;he<Z.length;he+=this.stride)ne.add(Z[he],Z[he+1]);return ne.finish(),ne.data=Z,ne}_addTileFeatures(Z,ne,he,Le,Ve,Xe){for(const Ot of Z){const Be=Ot*this.stride,Vt=ne[Be+on]>1;let Tt,Ft,wi;if(Vt)Tt=Ge(ne,Be,this.clusterProps),Ft=ne[Be],wi=ne[Be+1];else{const fn=this.points[ne[Be+Ei]];Tt=fn.properties;const[tn,Zi]=fn.geometry.coordinates;Ft=nt(tn),wi=ft(Zi)}const dn={type:1,geometry:[[Math.round(this.options.extent*(Ft*Ve-he)),Math.round(this.options.extent*(wi*Ve-Le))]],tags:Tt};let Cn;Cn=Vt||this.options.generateId?ne[Be+Ei]:this.points[ne[Be+Ei]].id,Cn!==void 0&&(dn.id=Cn),Xe.features.push(dn)}}_limitZoom(Z){return Math.max(this.options.minZoom,Math.min(Math.floor(+Z),this.options.maxZoom+1))}_cluster(Z,ne){const{radius:he,extent:Le,reduce:Ve,minPoints:Xe}=this.options,Ot=he/(Le*Math.pow(2,ne)),Be=Z.data,Vt=[],Tt=this.stride;for(let Ft=0;Ft<Be.length;Ft+=Tt){if(Be[Ft+2]<=ne)continue;Be[Ft+2]=ne;const wi=Be[Ft],dn=Be[Ft+1],Cn=Z.within(Be[Ft],Be[Ft+1],Ot),fn=Be[Ft+on];let tn=fn;for(const Zi of Cn){const an=Zi*Tt;Be[an+2]>ne&&(tn+=Be[an+on])}if(tn>fn&&tn>=Xe){let Zi,an=wi*fn,wn=dn*fn,ur=-1;const Sn=(Ft/Tt<<5)+(ne+1)+this.points.length;for(const Or of Cn){const Dr=Or*Tt;if(Be[Dr+2]<=ne)continue;Be[Dr+2]=ne;const Ur=Be[Dr+on];an+=Be[Dr]*Ur,wn+=Be[Dr+1]*Ur,Be[Dr+4]=Sn,Ve&&(Zi||(Zi=this._map(Be,Ft,!0),ur=this.clusterProps.length,this.clusterProps.push(Zi)),Ve(Zi,this._map(Be,Dr)))}Be[Ft+4]=Sn,Vt.push(an/tn,wn/tn,1/0,Sn,-1,tn),Ve&&Vt.push(ur)}else{for(let Zi=0;Zi<Tt;Zi++)Vt.push(Be[Ft+Zi]);if(tn>1)for(const Zi of Cn){const an=Zi*Tt;if(!(Be[an+2]<=ne)){Be[an+2]=ne;for(let wn=0;wn<Tt;wn++)Vt.push(Be[an+wn])}}}}return Vt}_getOriginId(Z){return Z-this.points.length>>5}_getOriginZoom(Z){return(Z-this.points.length)%32}_map(Z,ne,he){if(Z[ne+on]>1){const Xe=this.clusterProps[Z[ne+hn]];return he?Object.assign({},Xe):Xe}const Le=this.points[Z[ne+Ei]].properties,Ve=this.options.map(Le);return he&&Ve===Le?Object.assign({},Ve):Ve}}function we(Ce,Z,ne){return{type:"Feature",id:Ce[Z+Ei],properties:Ge(Ce,Z,ne),geometry:{type:"Point",coordinates:[(he=Ce[Z],360*(he-.5)),Ct(Ce[Z+1])]}};var he}function Ge(Ce,Z,ne){const he=Ce[Z+on],Le=he>=1e4?`${Math.round(he/1e3)}k`:he>=1e3?Math.round(he/100)/10+"k":he,Ve=Ce[Z+hn],Xe=Ve===-1?{}:Object.assign({},ne[Ve]);return Object.assign(Xe,{cluster:!0,cluster_id:Ce[Z+Ei],point_count:he,point_count_abbreviated:Le})}function nt(Ce){return Ce/360+.5}function ft(Ce){const Z=Math.sin(Ce*Math.PI/180),ne=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return ne<0?0:ne>1?1:ne}function Ct(Ce){const Z=(180-360*Ce)*Math.PI/180;return 360*Math.atan(Math.exp(Z))/Math.PI-90}var Gt={exports:{}};Gt.exports=function(){function Ce(je,We,lt,bt){for(var _t,At=bt,It=lt-We>>1,xt=lt-We,Dt=je[We],St=je[We+1],ci=je[lt],ki=je[lt+1],Kt=We+3;Kt<lt;Kt+=3){var pn=Z(je[Kt],je[Kt+1],Dt,St,ci,ki);if(pn>At)_t=Kt,At=pn;else if(pn===At){var kn=Math.abs(Kt-It);kn<xt&&(_t=Kt,xt=kn)}}At>bt&&(_t-We>3&&Ce(je,We,_t,bt),je[_t+2]=At,lt-_t>3&&Ce(je,_t,lt,bt))}function Z(je,We,lt,bt,_t,At){var It=_t-lt,xt=At-bt;if(It!==0||xt!==0){var Dt=((je-lt)*It+(We-bt)*xt)/(It*It+xt*xt);Dt>1?(lt=_t,bt=At):Dt>0&&(lt+=It*Dt,bt+=xt*Dt)}return(It=je-lt)*It+(xt=We-bt)*xt}function ne(je,We,lt,bt){var _t={id:je===void 0?null:je,type:We,geometry:lt,tags:bt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(At){var It=At.geometry,xt=At.type;if(xt==="Point"||xt==="MultiPoint"||xt==="LineString")he(At,It);else if(xt==="Polygon"||xt==="MultiLineString")for(var Dt=0;Dt<It.length;Dt++)he(At,It[Dt]);else if(xt==="MultiPolygon")for(Dt=0;Dt<It.length;Dt++)for(var St=0;St<It[Dt].length;St++)he(At,It[Dt][St])}(_t),_t}function he(je,We){for(var lt=0;lt<We.length;lt+=3)je.minX=Math.min(je.minX,We[lt]),je.minY=Math.min(je.minY,We[lt+1]),je.maxX=Math.max(je.maxX,We[lt]),je.maxY=Math.max(je.maxY,We[lt+1])}function Le(je,We,lt,bt){if(We.geometry){var _t=We.geometry.coordinates,At=We.geometry.type,It=Math.pow(lt.tolerance/((1<<lt.maxZoom)*lt.extent),2),xt=[],Dt=We.id;if(lt.promoteId?Dt=We.properties[lt.promoteId]:lt.generateId&&(Dt=bt||0),At==="Point")Ve(_t,xt);else if(At==="MultiPoint")for(var St=0;St<_t.length;St++)Ve(_t[St],xt);else if(At==="LineString")Xe(_t,xt,It,!1);else if(At==="MultiLineString"){if(lt.lineMetrics){for(St=0;St<_t.length;St++)Xe(_t[St],xt=[],It,!1),je.push(ne(Dt,"LineString",xt,We.properties));return}Ot(_t,xt,It,!1)}else if(At==="Polygon")Ot(_t,xt,It,!0);else{if(At!=="MultiPolygon"){if(At==="GeometryCollection"){for(St=0;St<We.geometry.geometries.length;St++)Le(je,{id:Dt,geometry:We.geometry.geometries[St],properties:We.properties},lt,bt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(St=0;St<_t.length;St++){var ci=[];Ot(_t[St],ci,It,!0),xt.push(ci)}}je.push(ne(Dt,At,xt,We.properties))}}function Ve(je,We){We.push(Be(je[0])),We.push(Vt(je[1])),We.push(0)}function Xe(je,We,lt,bt){for(var _t,At,It=0,xt=0;xt<je.length;xt++){var Dt=Be(je[xt][0]),St=Vt(je[xt][1]);We.push(Dt),We.push(St),We.push(0),xt>0&&(It+=bt?(_t*St-Dt*At)/2:Math.sqrt(Math.pow(Dt-_t,2)+Math.pow(St-At,2))),_t=Dt,At=St}var ci=We.length-3;We[2]=1,Ce(We,0,ci,lt),We[ci+2]=1,We.size=Math.abs(It),We.start=0,We.end=We.size}function Ot(je,We,lt,bt){for(var _t=0;_t<je.length;_t++){var At=[];Xe(je[_t],At,lt,bt),We.push(At)}}function Be(je){return je/360+.5}function Vt(je){var We=Math.sin(je*Math.PI/180),lt=.5-.25*Math.log((1+We)/(1-We))/Math.PI;return lt<0?0:lt>1?1:lt}function Tt(je,We,lt,bt,_t,At,It,xt){if(bt/=We,At>=(lt/=We)&&It<bt)return je;if(It<lt||At>=bt)return null;for(var Dt=[],St=0;St<je.length;St++){var ci=je[St],ki=ci.geometry,Kt=ci.type,pn=_t===0?ci.minX:ci.minY,kn=_t===0?ci.maxX:ci.maxY;if(pn>=lt&&kn<bt)Dt.push(ci);else if(!(kn<lt||pn>=bt)){var vn=[];if(Kt==="Point"||Kt==="MultiPoint")Ft(ki,vn,lt,bt,_t);else if(Kt==="LineString")wi(ki,vn,lt,bt,_t,!1,xt.lineMetrics);else if(Kt==="MultiLineString")Cn(ki,vn,lt,bt,_t,!1);else if(Kt==="Polygon")Cn(ki,vn,lt,bt,_t,!0);else if(Kt==="MultiPolygon")for(var ir=0;ir<ki.length;ir++){var Tr=[];Cn(ki[ir],Tr,lt,bt,_t,!0),Tr.length&&vn.push(Tr)}if(vn.length){if(xt.lineMetrics&&Kt==="LineString"){for(ir=0;ir<vn.length;ir++)Dt.push(ne(ci.id,Kt,vn[ir],ci.tags));continue}Kt!=="LineString"&&Kt!=="MultiLineString"||(vn.length===1?(Kt="LineString",vn=vn[0]):Kt="MultiLineString"),Kt!=="Point"&&Kt!=="MultiPoint"||(Kt=vn.length===3?"Point":"MultiPoint"),Dt.push(ne(ci.id,Kt,vn,ci.tags))}}}return Dt.length?Dt:null}function Ft(je,We,lt,bt,_t){for(var At=0;At<je.length;At+=3){var It=je[At+_t];It>=lt&&It<=bt&&(We.push(je[At]),We.push(je[At+1]),We.push(je[At+2]))}}function wi(je,We,lt,bt,_t,At,It){for(var xt,Dt,St=dn(je),ci=_t===0?tn:Zi,ki=je.start,Kt=0;Kt<je.length-3;Kt+=3){var pn=je[Kt],kn=je[Kt+1],vn=je[Kt+2],ir=je[Kt+3],Tr=je[Kt+4],Hi=_t===0?pn:kn,ts=_t===0?ir:Tr,vs=!1;It&&(xt=Math.sqrt(Math.pow(pn-ir,2)+Math.pow(kn-Tr,2))),Hi<lt?ts>lt&&(Dt=ci(St,pn,kn,ir,Tr,lt),It&&(St.start=ki+xt*Dt)):Hi>bt?ts<bt&&(Dt=ci(St,pn,kn,ir,Tr,bt),It&&(St.start=ki+xt*Dt)):fn(St,pn,kn,vn),ts<lt&&Hi>=lt&&(Dt=ci(St,pn,kn,ir,Tr,lt),vs=!0),ts>bt&&Hi<=bt&&(Dt=ci(St,pn,kn,ir,Tr,bt),vs=!0),!At&&vs&&(It&&(St.end=ki+xt*Dt),We.push(St),St=dn(je)),It&&(ki+=xt)}var Mr=je.length-3;pn=je[Mr],kn=je[Mr+1],vn=je[Mr+2],(Hi=_t===0?pn:kn)>=lt&&Hi<=bt&&fn(St,pn,kn,vn),Mr=St.length-3,At&&Mr>=3&&(St[Mr]!==St[0]||St[Mr+1]!==St[1])&&fn(St,St[0],St[1],St[2]),St.length&&We.push(St)}function dn(je){var We=[];return We.size=je.size,We.start=je.start,We.end=je.end,We}function Cn(je,We,lt,bt,_t,At){for(var It=0;It<je.length;It++)wi(je[It],We,lt,bt,_t,At,!1)}function fn(je,We,lt,bt){je.push(We),je.push(lt),je.push(bt)}function tn(je,We,lt,bt,_t,At){var It=(At-We)/(bt-We);return je.push(At),je.push(lt+(_t-lt)*It),je.push(1),It}function Zi(je,We,lt,bt,_t,At){var It=(At-lt)/(_t-lt);return je.push(We+(bt-We)*It),je.push(At),je.push(1),It}function an(je,We){for(var lt=[],bt=0;bt<je.length;bt++){var _t,At=je[bt],It=At.type;if(It==="Point"||It==="MultiPoint"||It==="LineString")_t=wn(At.geometry,We);else if(It==="MultiLineString"||It==="Polygon"){_t=[];for(var xt=0;xt<At.geometry.length;xt++)_t.push(wn(At.geometry[xt],We))}else if(It==="MultiPolygon")for(_t=[],xt=0;xt<At.geometry.length;xt++){for(var Dt=[],St=0;St<At.geometry[xt].length;St++)Dt.push(wn(At.geometry[xt][St],We));_t.push(Dt)}lt.push(ne(At.id,It,_t,At.tags))}return lt}function wn(je,We){var lt=[];lt.size=je.size,je.start!==void 0&&(lt.start=je.start,lt.end=je.end);for(var bt=0;bt<je.length;bt+=3)lt.push(je[bt]+We,je[bt+1],je[bt+2]);return lt}function ur(je,We){if(je.transformed)return je;var lt,bt,_t,At=1<<je.z,It=je.x,xt=je.y;for(lt=0;lt<je.features.length;lt++){var Dt=je.features[lt],St=Dt.geometry,ci=Dt.type;if(Dt.geometry=[],ci===1)for(bt=0;bt<St.length;bt+=2)Dt.geometry.push(Sn(St[bt],St[bt+1],We,At,It,xt));else for(bt=0;bt<St.length;bt++){var ki=[];for(_t=0;_t<St[bt].length;_t+=2)ki.push(Sn(St[bt][_t],St[bt][_t+1],We,At,It,xt));Dt.geometry.push(ki)}}return je.transformed=!0,je}function Sn(je,We,lt,bt,_t,At){return[Math.round(lt*(je*bt-_t)),Math.round(lt*(We*bt-At))]}function Or(je,We,lt,bt,_t){for(var At=We===_t.maxZoom?0:_t.tolerance/((1<<We)*_t.extent),It={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:lt,y:bt,z:We,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},xt=0;xt<je.length;xt++){It.numFeatures++,Dr(It,je[xt],At,_t);var Dt=je[xt].minX,St=je[xt].minY,ci=je[xt].maxX,ki=je[xt].maxY;Dt<It.minX&&(It.minX=Dt),St<It.minY&&(It.minY=St),ci>It.maxX&&(It.maxX=ci),ki>It.maxY&&(It.maxY=ki)}return It}function Dr(je,We,lt,bt){var _t=We.geometry,At=We.type,It=[];if(At==="Point"||At==="MultiPoint")for(var xt=0;xt<_t.length;xt+=3)It.push(_t[xt]),It.push(_t[xt+1]),je.numPoints++,je.numSimplified++;else if(At==="LineString")Ur(It,_t,je,lt,!1,!1);else if(At==="MultiLineString"||At==="Polygon")for(xt=0;xt<_t.length;xt++)Ur(It,_t[xt],je,lt,At==="Polygon",xt===0);else if(At==="MultiPolygon")for(var Dt=0;Dt<_t.length;Dt++){var St=_t[Dt];for(xt=0;xt<St.length;xt++)Ur(It,St[xt],je,lt,!0,xt===0)}if(It.length){var ci=We.tags||null;if(At==="LineString"&&bt.lineMetrics){for(var ki in ci={},We.tags)ci[ki]=We.tags[ki];ci.mapbox_clip_start=_t.start/_t.size,ci.mapbox_clip_end=_t.end/_t.size}var Kt={geometry:It,type:At==="Polygon"||At==="MultiPolygon"?3:At==="LineString"||At==="MultiLineString"?2:1,tags:ci};We.id!==null&&(Kt.id=We.id),je.features.push(Kt)}}function Ur(je,We,lt,bt,_t,At){var It=bt*bt;if(bt>0&&We.size<(_t?It:bt))lt.numPoints+=We.length/3;else{for(var xt=[],Dt=0;Dt<We.length;Dt+=3)(bt===0||We[Dt+2]>It)&&(lt.numSimplified++,xt.push(We[Dt]),xt.push(We[Dt+1])),lt.numPoints++;_t&&function(St,ci){for(var ki=0,Kt=0,pn=St.length,kn=pn-2;Kt<pn;kn=Kt,Kt+=2)ki+=(St[Kt]-St[kn])*(St[Kt+1]+St[kn+1]);if(ki>0===ci)for(Kt=0,pn=St.length;Kt<pn/2;Kt+=2){var vn=St[Kt],ir=St[Kt+1];St[Kt]=St[pn-2-Kt],St[Kt+1]=St[pn-1-Kt],St[pn-2-Kt]=vn,St[pn-1-Kt]=ir}}(xt,At),je.push(xt)}}function tr(je,We){var lt=(We=this.options=function(_t,At){for(var It in At)_t[It]=At[It];return _t}(Object.create(this.options),We)).debug;if(lt&&console.time("preprocess data"),We.maxZoom<0||We.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(We.promoteId&&We.generateId)throw new Error("promoteId and generateId cannot be used together.");var bt=function(_t,At){var It=[];if(_t.type==="FeatureCollection")for(var xt=0;xt<_t.features.length;xt++)Le(It,_t.features[xt],At,xt);else Le(It,_t.type==="Feature"?_t:{geometry:_t},At);return It}(je,We);this.tiles={},this.tileCoords=[],lt&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",We.indexMaxZoom,We.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(bt=function(_t,At){var It=At.buffer/At.extent,xt=_t,Dt=Tt(_t,1,-1-It,It,0,-1,2,At),St=Tt(_t,1,1-It,2+It,0,-1,2,At);return(Dt||St)&&(xt=Tt(_t,1,-It,1+It,0,-1,2,At)||[],Dt&&(xt=an(Dt,1).concat(xt)),St&&(xt=xt.concat(an(St,-1)))),xt}(bt,We)).length&&this.splitTile(bt,0,0,0),lt&&(bt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Yn(je,We,lt){return 32*((1<<je)*lt+We)+je}return tr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},tr.prototype.splitTile=function(je,We,lt,bt,_t,At,It){for(var xt=[je,We,lt,bt],Dt=this.options,St=Dt.debug;xt.length;){bt=xt.pop(),lt=xt.pop(),We=xt.pop(),je=xt.pop();var ci=1<<We,ki=Yn(We,lt,bt),Kt=this.tiles[ki];if(!Kt&&(St>1&&console.time("creation"),Kt=this.tiles[ki]=Or(je,We,lt,bt,Dt),this.tileCoords.push({z:We,x:lt,y:bt}),St)){St>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",We,lt,bt,Kt.numFeatures,Kt.numPoints,Kt.numSimplified),console.timeEnd("creation"));var pn="z"+We;this.stats[pn]=(this.stats[pn]||0)+1,this.total++}if(Kt.source=je,_t){if(We===Dt.maxZoom||We===_t)continue;var kn=1<<_t-We;if(lt!==Math.floor(At/kn)||bt!==Math.floor(It/kn))continue}else if(We===Dt.indexMaxZoom||Kt.numPoints<=Dt.indexMaxPoints)continue;if(Kt.source=null,je.length!==0){St>1&&console.time("clipping");var vn,ir,Tr,Hi,ts,vs,Mr=.5*Dt.buffer/Dt.extent,Il=.5-Mr,fo=.5+Mr,Ea=1+Mr;vn=ir=Tr=Hi=null,ts=Tt(je,ci,lt-Mr,lt+fo,0,Kt.minX,Kt.maxX,Dt),vs=Tt(je,ci,lt+Il,lt+Ea,0,Kt.minX,Kt.maxX,Dt),je=null,ts&&(vn=Tt(ts,ci,bt-Mr,bt+fo,1,Kt.minY,Kt.maxY,Dt),ir=Tt(ts,ci,bt+Il,bt+Ea,1,Kt.minY,Kt.maxY,Dt),ts=null),vs&&(Tr=Tt(vs,ci,bt-Mr,bt+fo,1,Kt.minY,Kt.maxY,Dt),Hi=Tt(vs,ci,bt+Il,bt+Ea,1,Kt.minY,Kt.maxY,Dt),vs=null),St>1&&console.timeEnd("clipping"),xt.push(vn||[],We+1,2*lt,2*bt),xt.push(ir||[],We+1,2*lt,2*bt+1),xt.push(Tr||[],We+1,2*lt+1,2*bt),xt.push(Hi||[],We+1,2*lt+1,2*bt+1)}}},tr.prototype.getTile=function(je,We,lt){var bt=this.options,_t=bt.extent,At=bt.debug;if(je<0||je>24)return null;var It=1<<je,xt=Yn(je,We=(We%It+It)%It,lt);if(this.tiles[xt])return ur(this.tiles[xt],_t);At>1&&console.log("drilling down to z%d-%d-%d",je,We,lt);for(var Dt,St=je,ci=We,ki=lt;!Dt&&St>0;)St--,ci=Math.floor(ci/2),ki=Math.floor(ki/2),Dt=this.tiles[Yn(St,ci,ki)];return Dt&&Dt.source?(At>1&&console.log("found parent tile z%d-%d-%d",St,ci,ki),At>1&&console.time("drilling down"),this.splitTile(Dt.source,St,ci,ki,je,We,lt),At>1&&console.timeEnd("drilling down"),this.tiles[xt]?ur(this.tiles[xt],_t):null):null},function(je,We){return new tr(je,We)}}();var mt=r.dK(Gt.exports);function zt(Ce,Z){const ne=Ce.tileID.canonical;if(!this._geoJSONIndex)return Z(null,null);const he=this._geoJSONIndex.getTile(ne.z,ne.x,ne.y);if(!he)return Z(null,null);const Le=new le(he.features);let Ve=en(Le);Ve.byteOffset===0&&Ve.byteLength===Ve.buffer.byteLength||(Ve=new Uint8Array(Ve)),Z(null,{vectorTile:Le,rawData:Ve.buffer})}class ct extends Re{constructor(Z,ne,he,Le,Ve,Xe){super(Z,ne,he,Le,zt,Xe),Ve&&(this.loadGeoJSON=Ve)}loadData(Z,ne){const he=Z&&Z.request,Le=he&&he.collectResourceTiming;this.loadGeoJSON(Z,(Ve,Xe)=>{if(Ve||!Xe)return ne(Ve);if(typeof Xe!="object")return ne(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));{at(Xe,!0);try{if(Z.filter){const Be=r.r(Z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Be.result==="error")throw new Error(Be.value.map(Tt=>`${Tt.key}: ${Tt.message}`).join(", "));Xe={type:"FeatureCollection",features:Xe.features.filter(Tt=>Be.value.evaluate({zoom:0},Tt))}}this._geoJSONIndex=Z.cluster?new ye(function({superclusterOptions:Be,clusterProperties:Vt}){if(!Vt||!Be)return Be;const Tt={},Ft={},wi={accumulated:null,zoom:0},dn={properties:null},Cn=Object.keys(Vt);for(const fn of Cn){const[tn,Zi]=Vt[fn],an=r.r(Zi),wn=r.r(typeof tn=="string"?[tn,["accumulated"],["get",fn]]:tn);Tt[fn]=an.value,Ft[fn]=wn.value}return Be.map=fn=>{dn.properties=fn;const tn={};for(const Zi of Cn)tn[Zi]=Tt[Zi].evaluate(wi,dn);return tn},Be.reduce=(fn,tn)=>{dn.properties=tn;for(const Zi of Cn)wi.accumulated=fn[Zi],fn[Zi]=Ft[Zi].evaluate(wi,dn)},Be}(Z)).load(Xe.features):mt(Xe,Z.geojsonVtOptions)}catch(Be){return ne(Be)}this.loaded={};const Ot={};if(Le){const Be=k(he);Be&&(Ot.resourceTiming={},Ot.resourceTiming[Z.source]=JSON.parse(JSON.stringify(Be)))}ne(null,Ot)}})}reloadTile(Z,ne){const he=this.loaded;return he&&he[Z.uid]?super.reloadTile(Z,ne):this.loadTile(Z,ne)}loadGeoJSON(Z,ne){if(Z.request)r.g(Z.request,ne);else{if(typeof Z.data!="string")return ne(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));try{return ne(null,JSON.parse(Z.data))}catch{return ne(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Z,ne){try{ne(null,this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId))}catch(he){ne(he)}}getClusterChildren(Z,ne){try{ne(null,this._geoJSONIndex.getChildren(Z.clusterId))}catch(he){ne(he)}}getClusterLeaves(Z,ne){try{ne(null,this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset))}catch(he){ne(he)}}}class kt{constructor(Z,ne){this.tileID=new r.am(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.tileZoom=Z.tileZoom,this.uid=Z.uid,this.zoom=Z.zoom,this.canonical=Z.tileID.canonical,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Z.projection,this.brightness=ne}parse(Z,ne,he,Le){this.status="parsing";const Ve=new r.am(he.tileID.overscaledZ,he.tileID.wrap,he.tileID.canonical.z,he.tileID.canonical.x,he.tileID.canonical.y),Xe={},Ot=ne.familiesBySource[he.source],Be=new r.dC(Ve,he.promoteId);return Be.bucketLayerIDs=[],Be.is3DTile=!0,r.dP(Z).then(Vt=>{if(!Vt)return Le(new Error("Could not parse tile"));const Tt=r.dQ(Vt,1/r.bR(he.tileID.canonical)),Ft=Vt.json.extensionsUsed&&Vt.json.extensionsUsed.includes("MAPBOX_mesh_features")||Vt.json.asset.extras&&Vt.json.asset.extras.MAPBOX_mesh_features,wi=Vt.json.extensionsUsed&&Vt.json.extensionsUsed.includes("EXT_meshopt_compression"),dn=new r.K(this.zoom,{brightness:this.brightness});for(const Cn in Ot)for(const fn of Ot[Cn]){const tn=fn[0];Be.bucketLayerIDs.push(fn.map(an=>an.id)),tn.recalculate(dn,[]);const Zi=new r.dR(Tt,Ve,Ft,wi,this.brightness,Be);Ft||(Zi.needsUpload=!0),Xe[tn.fqid]=Zi,Zi.evaluate(tn)}this.status="done",Le(null,{buckets:Xe,featureIndex:Be})}).catch(Vt=>Le(new Error(Vt.message)))}}class li{constructor(Z,ne,he,Le,Ve,Xe){this.actor=Z,this.layerIndex=ne,this.brightness=Xe,this.loading={},this.loaded={}}loadTile(Z,ne){const he=Z.uid,Le=this.loading[he]=new kt(Z,this.brightness);r.a_(Z.request,(Ve,Xe)=>{const Ot=!this.loading[he];return delete this.loading[he],Ot||Ve?(Le.status="done",Ot||(this.loaded[he]=Le),ne(Ve)):Xe&&Xe.byteLength!==0?void Le.parse(Xe,this.layerIndex,Z,(Be,Vt)=>{Le.status="done",this.loaded=this.loaded||{},this.loaded[he]=Le,Be||!Vt?ne(Be):ne(null,Vt)}):(Le.status="done",this.loaded[he]=Le,ne())})}reloadTile(Z,ne){const he=this.loaded,Le=Z.uid;if(he&&he[Le]){const Ve=he[Le];Ve.projection=Z.projection,Ve.brightness=Z.brightness;const Xe=(Ot,Be)=>{Ve.reloadCallback&&(delete Ve.reloadCallback,this.loadTile(Z,ne)),ne(Ot,Be)};Ve.status==="parsing"?Ve.reloadCallback=Xe:Ve.status==="done"&&this.loadTile(Z,ne)}}abortTile(Z,ne){const he=Z.uid;this.loading[he]&&delete this.loading[he],ne()}removeTile(Z,ne){const he=this.loaded,Le=Z.uid;he&&he[Le]&&delete he[Le],ne()}}class $t{constructor(Z){this.self=Z,this.actor=new r.dS(Z,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=r.bo({name:"mercator"}),this.workerSourceTypes={vector:Re,geojson:ct,"batched-model":li},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ne,he)=>{if(this.workerSourceTypes[ne])throw new Error(`Worker source with name "${ne}" already registered.`);this.workerSourceTypes[ne]=he},this.self.registerRTLTextPlugin=ne=>{if(r.dT.isParsed())throw new Error("RTL text plugin already registered.");r.dT.applyArabicShaping=ne.applyArabicShaping,r.dT.processBidirectionalText=ne.processBidirectionalText,r.dT.processStyledBidirectionalText=ne.processStyledBidirectionalText}}clearCaches(Z,ne,he){delete this.layerIndexes[Z],delete this.availableImages[Z],delete this.workerSources[Z],delete this.demWorkerSources[Z],delete this.rasterArrayWorkerSource,he()}checkIfReady(Z,ne,he){he()}setReferrer(Z,ne){this.referrer=ne}spriteLoaded(Z,{scope:ne,isLoaded:he}){if(this.isSpriteLoaded[Z]||(this.isSpriteLoaded[Z]={}),this.isSpriteLoaded[Z][ne]=he,this.workerSources[Z]&&this.workerSources[Z][ne])for(const Le in this.workerSources[Z][ne]){const Ve=this.workerSources[Z][ne][Le];for(const Xe in Ve)Ve[Xe]instanceof Re&&(Ve[Xe].isSpriteLoaded=he,Ve[Xe].fire(new r.b("isSpriteLoaded")))}}setImages(Z,{scope:ne,images:he},Le){if(this.availableImages[Z]||(this.availableImages[Z]={}),this.availableImages[Z][ne]=he,this.workerSources[Z]&&this.workerSources[Z][ne]){for(const Ve in this.workerSources[Z][ne]){const Xe=this.workerSources[Z][ne][Ve];for(const Ot in Xe)Xe[Ot].availableImages=he}Le()}else Le()}setProjection(Z,ne){this.projections[Z]=r.bo(ne)}setBrightness(Z,ne,he){this.brightness=ne,he()}setLayers(Z,ne,he){this.getLayerIndex(Z,ne.scope).replace(ne.layers,ne.options),he()}updateLayers(Z,ne,he){this.getLayerIndex(Z,ne.scope).update(ne.layers,ne.removedIds,ne.options),he()}loadTile(Z,ne,he){ne.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,ne.type,ne.source,ne.scope).loadTile(ne,he)}loadDEMTile(Z,ne,he){this.getDEMWorkerSource(Z,ne.source,ne.scope).loadTile(ne,he)}decodeRasterArray(Z,ne,he){this.getRasterArrayWorkerSource().decodeRasterArray(ne,he)}reloadTile(Z,ne,he){ne.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,ne.type,ne.source,ne.scope).reloadTile(ne,he)}abortTile(Z,ne,he){this.getWorkerSource(Z,ne.type,ne.source,ne.scope).abortTile(ne,he)}removeTile(Z,ne,he){this.getWorkerSource(Z,ne.type,ne.source,ne.scope).removeTile(ne,he)}removeSource(Z,ne,he){if(!(this.workerSources[Z]&&this.workerSources[Z][ne.scope]&&this.workerSources[Z][ne.scope][ne.type]&&this.workerSources[Z][ne.scope][ne.type][ne.source]))return;const Le=this.workerSources[Z][ne.scope][ne.type][ne.source];delete this.workerSources[Z][ne.scope][ne.type][ne.source],Le.removeSource!==void 0?Le.removeSource(ne,he):he()}loadWorkerSource(Z,ne,he){try{this.self.importScripts(ne.url),he()}catch(Le){he(Le.toString())}}syncRTLPluginState(Z,ne,he){try{r.dT.setState(ne);const Le=r.dT.getPluginURL();if(r.dT.isLoaded()&&!r.dT.isParsed()&&Le!=null){this.self.importScripts(Le);const Ve=r.dT.isParsed();he(Ve?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Le}`),Ve)}}catch(Le){he(Le.toString())}}setDracoUrl(Z,ne){this.dracoUrl=ne}getAvailableImages(Z,ne){this.availableImages[Z]||(this.availableImages[Z]={});let he=this.availableImages[Z][ne];return he||(he=[]),he}getLayerIndex(Z,ne){this.layerIndexes[Z]||(this.layerIndexes[Z]={});let he=this.layerIndexes[Z][ne];return he||(he=this.layerIndexes[Z][ne]=new K,he.scope=ne),he}getWorkerSource(Z,ne,he,Le){if(this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][Le]||(this.workerSources[Z][Le]={}),this.workerSources[Z][Le][ne]||(this.workerSources[Z][Le][ne]={}),this.isSpriteLoaded[Z]||(this.isSpriteLoaded[Z]={}),!this.workerSources[Z][Le][ne][he]){const Ve={send:(Xe,Ot,Be,Vt,Tt,Ft)=>{this.actor.send(Xe,Ot,Be,Z,Tt,Ft)},scheduler:this.actor.scheduler};this.workerSources[Z][Le][ne][he]=new this.workerSourceTypes[ne](Ve,this.getLayerIndex(Z,Le),this.getAvailableImages(Z,Le),this.isSpriteLoaded[Z][Le],void 0,this.brightness)}return this.workerSources[Z][Le][ne][he]}getDEMWorkerSource(Z,ne,he){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][he]||(this.demWorkerSources[Z][he]={}),this.demWorkerSources[Z][he][ne]||(this.demWorkerSources[Z][he][ne]=new $e),this.demWorkerSources[Z][he][ne]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new tt),this.rasterArrayWorkerSource}enforceCacheSizeLimit(Z,ne){r.dU(ne)}getWorkerPerformanceMetrics(Z,ne,he){he(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new $t(self)),$t}),M(["./shared"],function(r){function k(d,n){if(Array.isArray(d)){if(!Array.isArray(n)||d.length!==n.length)return!1;for(let a=0;a<d.length;a++)if(!k(d[a],n[a]))return!1;return!0}if(typeof d=="object"&&d!==null&&n!==null){if(typeof n!="object"||Object.keys(d).length!==Object.keys(n).length)return!1;for(const a in d)if(!k(d[a],n[a]))return!1;return!0}return d===n}var N=G;function G(d){return!function(n){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var f,g,x=new Blob([""],{type:"text/javascript"}),T=URL.createObjectURL(x);try{g=new Worker(T),f=!0}catch{f=!1}return g&&g.terminate(),URL.revokeObjectURL(T),f}()?function(){var f=document.createElement("canvas");f.width=f.height=1;var g=f.getContext("2d");if(!g)return!1;var x=g.getImageData(0,0,1,1);return x&&x.width===f.width}()?(K[a=n&&n.failIfMajorPerformanceCaveat]===void 0&&(K[a]=function(f){var g,x=function(T){var E=document.createElement("canvas"),C=Object.create(G.webGLContextAttributes);return C.failIfMajorPerformanceCaveat=T,E.getContext("webgl2",C)}(f);if(!x)return!1;try{g=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!g||x.isContextLost())&&(x.shaderSource(g,"void main() {}"),x.compileShader(g),x.getShaderParameter(g,x.COMPILE_STATUS)===!0)}(a)),K[a]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var a}(d)}var K={};function ie(d,n,a){const f=document.createElement(d);return n!=null&&(f.className=n),a&&a.appendChild(f),f}function pe(d,n,a){const f=document.createElementNS("http://www.w3.org/2000/svg",d);for(const g of Object.keys(n))f.setAttributeNS(null,g,String(n[g]));return a&&a.appendChild(f),f}G.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ge=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Te=ge&&ge.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Re;function $e(){ge&&Te&&(Re=ge[Te],ge[Te]="none")}function tt(){ge&&Te&&(ge[Te]=Re)}function ut(d){d.preventDefault(),d.stopPropagation(),window.removeEventListener("click",ut,!0)}function ot(){window.addEventListener("click",ut,!0),window.setTimeout(()=>{window.removeEventListener("click",ut,!0)},0)}function at(d,n){const a=d.getBoundingClientRect();return le(d,a,n)}function dt(d,n){const a=d.getBoundingClientRect(),f=[];for(let g=0;g<n.length;g++)f.push(le(d,a,n[g]));return f}function xe(d){return window.InstallTrigger!==void 0&&d.button===2&&d.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button}function le(d,n,a){const f=d.offsetWidth===n.width?1:d.offsetWidth/n.width;return new r.P((a.clientX-n.left)*f,(a.clientY-n.top)*f)}class Je{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(n,a){this._updatedSourceCaches[n]=a,this.setDirty()}discardSourceCacheUpdate(n){delete this._updatedSourceCaches[n]}updateLayer(n){const a=n.scope;this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._updatedLayers[a].add(n.id),this.setDirty()}removeLayer(n){const a=n.scope;this._removedLayers[a]=this._removedLayers[a]||{},this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._removedLayers[a][n.id]=n,this._updatedLayers[a].delete(n.id),this._updatedPaintProps.delete(n.fqid),this.setDirty()}getRemovedLayer(n){return this._removedLayers[n.scope]?this._removedLayers[n.scope][n.id]:null}discardLayerRemoval(n){this._removedLayers[n.scope]&&delete this._removedLayers[n.scope][n.id]}getLayerUpdatesByScope(){const n={};for(const a in this._updatedLayers)n[a]=n[a]||{},n[a].updatedIds=Array.from(this._updatedLayers[a].values());for(const a in this._removedLayers)n[a]=n[a]||{},n[a].removedIds=Object.keys(this._removedLayers[a]);return n}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(n){this._updatedPaintProps.add(n.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(n){this._updatedImages.add(n),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}class Mt extends r.E{constructor(n){super(),this.requestManager=n,this.models={"":{}},this.numModelsLoading={}}loadModel(n,a){return r.l(this.requestManager.transformRequest(a,r.R.Model).url).then(f=>{if(!f)return;const g=r.c(f),x=new r.M(n,void 0,void 0,g);return x.computeBoundsAndApplyParent(),x}).catch(f=>{this.fire(new r.a(new Error(`Could not load model ${n} from ${a}: ${f.message}`)))})}load(n,a){this.models[a]||(this.models[a]={});const f=Object.keys(n);this.numModelsLoading[a]=(this.numModelsLoading[a]||0)+f.length;const g=[];for(const x of f)g.push(this.loadModel(x,n[x]));Promise.allSettled(g).then(x=>{for(let T=0;T<x.length;T++){const{status:E,value:C}=x[T];E==="fulfilled"&&C&&(this.models[a][f[T]]=C)}this.numModelsLoading[a]-=f.length,this.fire(new r.b("data",{dataType:"style"}))}).catch(x=>{this.fire(new r.a(new Error(`Could not load models: ${x.message}`)))})}isLoaded(){for(const n in this.numModelsLoading)if(this.numModelsLoading[n]>0)return!1;return!0}hasModel(n,a){return!!this.getModel(n,a)}getModel(n,a){return this.models[a]||(this.models[a]={}),this.models[a][n]}addModel(n,a,f){this.models[f]||(this.models[f]={}),this.hasModel(n,f)&&this.removeModel(n,f),this.load({[n]:this.requestManager.normalizeModelURL(a)},f)}addModels(n,a){const f={};for(const g in n)f[g]=this.requestManager.normalizeModelURL(n[g]);this.load(f,a)}removeModel(n,a){this.models[a]||(this.models[a]={});const f=this.models[a][n];delete this.models[a][n],f.destroy()}listModels(n){return this.models[n]||(this.models[n]={}),Object.keys(this.models[n])}upload(n,a){this.models[a]||(this.models[a]={});for(const f in this.models[a])this.models[a][f].upload(n.context)}}class Qe{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,a,f){const g=String(a);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][g]=this.stateChanges[n][g]||{},r.e(this.stateChanges[n][g],f),this.deletedStates[n]===null){this.deletedStates[n]={};for(const x in this.state[n])x!==g&&(this.deletedStates[n][x]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][g]===null){this.deletedStates[n][g]={};for(const x in this.state[n][g])f[x]||(this.deletedStates[n][g][x]=null)}else for(const x in f)this.deletedStates[n]&&this.deletedStates[n][g]&&this.deletedStates[n][g][x]===null&&delete this.deletedStates[n][g][x]}removeFeatureState(n,a,f){if(this.deletedStates[n]===null)return;const g=String(a);if(this.deletedStates[n]=this.deletedStates[n]||{},f&&a!==void 0)this.deletedStates[n][g]!==null&&(this.deletedStates[n][g]=this.deletedStates[n][g]||{},this.deletedStates[n][g][f]=null);else if(a!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][g])for(f in this.deletedStates[n][g]={},this.stateChanges[n][g])this.deletedStates[n][g][f]=null;else this.deletedStates[n][g]=null;else this.deletedStates[n]=null}getState(n,a){const f=String(a),g=r.e({},(this.state[n]||{})[f],(this.stateChanges[n]||{})[f]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){const x=this.deletedStates[n][a];if(x===null)return{};for(const T in x)delete g[T]}return g}initializeTileState(n,a){n.setFeatureState(this.state,a)}coalesceChanges(n,a){const f={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const x={};for(const T in this.stateChanges[g])this.state[g][T]||(this.state[g][T]={}),r.e(this.state[g][T],this.stateChanges[g][T]),x[T]=this.state[g][T];f[g]=x}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const x={};if(this.deletedStates[g]===null)for(const T in this.state[g])x[T]={},this.state[g][T]={};else for(const T in this.deletedStates[g]){if(this.deletedStates[g][T]===null)this.state[g][T]={};else if(this.state[g][T])for(const E of Object.keys(this.deletedStates[g][T]))delete this.state[g][T][E];x[T]=this.state[g][T]}f[g]=f[g]||{},r.e(f[g],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const g in n)n[g].setFeatureState(f,a)}}function Zt(d){const{userImage:n}=d;return!!(n&&n.render&&n.render())&&(d.data.replace(new Uint8Array(n.data.buffer)),!0)}class xi extends r.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(n){this.images[n]={},this.loaded[n]=!1,this.updatedImages[n]={},this.patterns[n]={},this.callbackDispatchedThisFrame[n]={},this.atlasImage[n]=new r.h({width:1,height:1})}isLoaded(){for(const n in this.loaded)if(!this.loaded[n])return!1;return!0}setLoaded(n,a){if(this.loaded[a]!==n&&(this.loaded[a]=n,n)){for(const{ids:f,callback:g}of this.requestors)this._notify(f,a,g);this.requestors=[]}}hasImage(n,a){return!!this.getImage(n,a)}getImage(n,a){return this.images[a][n]}addImage(n,a,f){this._validate(n,f)&&(this.images[a][n]=f)}_validate(n,a){let f=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new r.a(new Error(`Image "${n}" has invalid "stretchX" value`))),f=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new r.a(new Error(`Image "${n}" has invalid "stretchY" value`))),f=!1),this._validateContent(a.content,a)||(this.fire(new r.a(new Error(`Image "${n}" has invalid "content" value`))),f=!1),f}_validateStretch(n,a){if(!n)return!0;let f=0;for(const g of n){if(g[0]<f||g[1]<g[0]||a<g[1])return!1;f=g[1]}return!0}_validateContent(n,a){return!(n&&(n.length!==4||n[0]<0||a.data.width<n[0]||n[1]<0||a.data.height<n[1]||n[2]<0||a.data.width<n[2]||n[3]<0||a.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,a,f){f.version=this.images[a][n].version+1,this.images[a][n]=f,this.updatedImages[a][n]=!0}removeImage(n,a){const f=this.images[a][n];delete this.images[a][n],delete this.patterns[a][n],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(n){return Object.keys(this.images[n])}getImages(n,a,f){let g=!0;const x=!!this.loaded[a];if(!x)for(const T of n)this.images[a][T]||(g=!1);x||g?this._notify(n,a,f):this.requestors.push({ids:n,scope:a,callback:f})}getUpdatedImages(n){return this.updatedImages[n]}_notify(n,a,f){const g={};for(const x of n){this.images[a][x]||this.fire(new r.b("styleimagemissing",{id:x}));const T=this.images[a][x];T?g[x]={data:T.data.clone(),pixelRatio:T.pixelRatio,sdf:T.sdf,version:T.version,stretchX:T.stretchX,stretchY:T.stretchY,content:T.content,hasRenderCallback:!!(T.userImage&&T.userImage.render)}:r.w(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}f(null,g)}getPixelSize(n){const{width:a,height:f}=this.atlasImage[n];return{width:a,height:f}}getPattern(n,a){const f=this.patterns[a][n],g=this.getImage(n,a);if(!g)return null;if(f&&f.position.version===g.version)return f.position;if(f)f.position.version=g.version;else{const x={w:g.data.width+2,h:g.data.height+2,x:0,y:0},T=new r.I(x,g);this.patterns[a][n]={bin:x,position:T}}return this._updatePatternAtlas(a),this.patterns[a][n].position}bind(n,a){const f=n.gl;let g=this.atlasTexture[a];g?this.dirty&&(g.update(this.atlasImage[a]),this.dirty=!1):(g=new r.T(n,this.atlasImage[a],f.RGBA),this.atlasTexture[a]=g),g.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(n){const a=[];for(const T in this.patterns[n])a.push(this.patterns[n][T].bin);const{w:f,h:g}=r.p(a),x=this.atlasImage[n];x.resize({width:f||1,height:g||1});for(const T in this.patterns[n]){const{bin:E}=this.patterns[n][T],C=E.x+1,D=E.y+1,L=this.images[n][T].data,z=L.width,B=L.height;r.h.copy(L,x,{x:0,y:0},{x:C,y:D},{width:z,height:B}),r.h.copy(L,x,{x:0,y:B-1},{x:C,y:D-1},{width:z,height:1}),r.h.copy(L,x,{x:0,y:0},{x:C,y:D+B},{width:z,height:1}),r.h.copy(L,x,{x:z-1,y:0},{x:C-1,y:D},{width:1,height:B}),r.h.copy(L,x,{x:0,y:0},{x:C+z,y:D},{width:1,height:B})}this.dirty=!0}beginFrame(){for(const n in this.images)this.callbackDispatchedThisFrame[n]={}}dispatchRenderCallbacks(n,a){for(const f of n){if(this.callbackDispatchedThisFrame[a][f])continue;this.callbackDispatchedThisFrame[a][f]=!0;const g=this.images[a][f];Zt(g)&&this.updateImage(f,a,g)}}}class qe{constructor(n,a,f,g){this.message=(n?`${n}: `:"")+f,g&&(this.identifier=g),a!=null&&a.__line__&&(this.line=a.__line__)}}class si extends qe{}function yt(d){const n=d.key,a=d.value,f=d.valueSpec||{},g=d.objectElementValidators||{},x=d.style,T=d.styleSpec;let E=[];const C=r.i(a);if(C!=="object")return[new qe(n,a,`object expected, ${C} found`)];for(const D in a){const L=D.split(".")[0];let z;g[L]?z=g[L]:f[L]?z=mt:g["*"]?z=g["*"]:f["*"]&&(z=mt),z?E=E.concat(z({key:(n&&`${n}.`)+D,value:a[D],valueSpec:f[L]||f["*"],style:x,styleSpec:T,object:a,objectKey:D},a)):E.push(new si(n,a[D],`unknown property "${D}"`))}for(const D in f)g[D]||f[D].required&&f[D].default===void 0&&a[D]===void 0&&E.push(new qe(n,a,`missing required property "${D}"`));return E}function wt(d){const n=d.value,a=d.valueSpec,f=d.style,g=d.styleSpec,x=d.key,T=d.arrayElementValidator||mt;if(r.i(n)!=="array")return[new qe(x,n,`array expected, ${r.i(n)} found`)];if(a.length&&n.length!==a.length)return[new qe(x,n,`array length ${a.length} expected, length ${n.length} found`)];if(a["min-length"]&&n.length<a["min-length"])return[new qe(x,n,`array length at least ${a["min-length"]} expected, length ${n.length} found`)];let E={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};g.$version<7&&(E.function=a.function),r.i(a.value)==="object"&&(E=a.value);let C=[];for(let D=0;D<n.length;D++)C=C.concat(T({array:n,arrayIndex:D,value:n[D],valueSpec:E,style:f,styleSpec:g,key:`${x}[${D}]`},!0));return C}function Qt(d){const n=d.key,a=d.value,f=d.valueSpec;let g=r.i(a);if(g==="number"&&a!=a&&(g="NaN"),g!=="number")return[new qe(n,a,`number expected, ${g} found`)];if("minimum"in f){let x=f.minimum;if(r.i(f.minimum)==="array"&&(x=f.minimum[d.arrayIndex]),a<x)return[new qe(n,a,`${a} is less than the minimum value ${x}`)]}if("maximum"in f){let x=f.maximum;if(r.i(f.maximum)==="array"&&(x=f.maximum[d.arrayIndex]),a>x)return[new qe(n,a,`${a} is greater than the maximum value ${x}`)]}return[]}function bn(d){const n=d.valueSpec,a=r.u(d.value.type);let f,g,x,T={};const E=a!=="categorical"&&d.value.property===void 0,C=!E,D=r.i(d.value.stops)==="array"&&r.i(d.value.stops[0])==="array"&&r.i(d.value.stops[0][0])==="object",L=yt({key:d.key,value:d.value,valueSpec:d.styleSpec.function,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{stops:function(V){if(a==="identity")return[new qe(V.key,V.value,'identity function may not have a "stops" property')];let H=[];const W=V.value;return H=H.concat(wt({key:V.key,value:W,valueSpec:V.valueSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:z})),r.i(W)==="array"&&W.length===0&&H.push(new qe(V.key,W,"array must have at least one stop")),H},default:function(V){return mt({key:V.key,value:V.value,valueSpec:n,style:V.style,styleSpec:V.styleSpec})}}});return a==="identity"&&E&&L.push(new qe(d.key,d.value,'missing required property "property"')),a==="identity"||d.value.stops||L.push(new qe(d.key,d.value,'missing required property "stops"')),a==="exponential"&&d.valueSpec.expression&&!r.s(d.valueSpec)&&L.push(new qe(d.key,d.value,"exponential functions not supported")),d.styleSpec.$version>=8&&(C&&!r.k(d.valueSpec)?L.push(new qe(d.key,d.value,"property functions not supported")):E&&!r.m(d.valueSpec)&&L.push(new qe(d.key,d.value,"zoom functions not supported"))),a!=="categorical"&&!D||d.value.property!==void 0||L.push(new qe(d.key,d.value,'"property" property is required')),L;function z(V){let H=[];const W=V.value,q=V.key;if(r.i(W)!=="array")return[new qe(q,W,`array expected, ${r.i(W)} found`)];if(W.length!==2)return[new qe(q,W,`array length 2 expected, length ${W.length} found`)];if(D){if(r.i(W[0])!=="object")return[new qe(q,W,`object expected, ${r.i(W[0])} found`)];if(W[0].zoom===void 0)return[new qe(q,W,"object stop key must have zoom")];if(W[0].value===void 0)return[new qe(q,W,"object stop key must have value")];const j=r.u(W[0].zoom);if(typeof j!="number")return[new qe(q,W[0].zoom,"stop zoom values must be numbers")];if(x&&x>j)return[new qe(q,W[0].zoom,"stop zoom values must appear in ascending order")];j!==x&&(x=j,g=void 0,T={}),H=H.concat(yt({key:`${q}[0]`,value:W[0],valueSpec:{zoom:{}},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:Qt,value:B}}))}else H=H.concat(B({key:`${q}[0]`,value:W[0],valueSpec:{},style:V.style,styleSpec:V.styleSpec},W));return r.n(r.o(W[1]))?H.concat([new qe(`${q}[1]`,W[1],"expressions are not allowed in function stops.")]):H.concat(mt({key:`${q}[1]`,value:W[1],valueSpec:n,style:V.style,styleSpec:V.styleSpec}))}function B(V,H){const W=r.i(V.value),q=r.u(V.value),j=V.value!==null?V.value:H;if(f){if(W!==f)return[new qe(V.key,j,`${W} stop domain type must match previous stop domain type ${f}`)]}else f=W;if(W!=="number"&&W!=="string"&&W!=="boolean"&&typeof q!="number"&&typeof q!="string"&&typeof q!="boolean")return[new qe(V.key,j,"stop domain value must be a number, string, or boolean")];if(W!=="number"&&a!=="categorical"){let Y=`number expected, ${W} found`;return r.k(n)&&a===void 0&&(Y+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new qe(V.key,j,Y)]}return a!=="categorical"||W!=="number"||typeof q=="number"&&isFinite(q)&&Math.floor(q)===q?a!=="categorical"&&W==="number"&&typeof q=="number"&&typeof g=="number"&&g!==void 0&&q<g?[new qe(V.key,j,"stop domain values must appear in ascending order")]:(g=q,a==="categorical"&&q in T?[new qe(V.key,j,"stop domain values must be unique")]:(T[q]=!0,[])):[new qe(V.key,j,`integer expected, found ${String(q)}`)]}}function Ji(d){const n=(d.expressionContext==="property"?r.q:r.r)(r.o(d.value),d.valueSpec);if(n.result==="error")return n.value.map(f=>new qe(`${d.key}${f.key}`,d.value,f.message));const a=n.value.expression||n.value._styleExpression.expression;if(d.expressionContext==="property"&&d.propertyKey==="text-font"&&!a.outputDefined())return[new qe(d.key,d.value,`Invalid data expression for "${d.propertyKey}". Output values must be contained as literals within the expression.`)];if(d.expressionContext==="property"&&d.propertyType==="layout"&&!r.t(a))return[new qe(d.key,d.value,'"feature-state" data expressions are not supported with layout properties.')];if(d.expressionContext==="filter")return Nt(a,d);if(d.expressionContext&&d.expressionContext.indexOf("cluster")===0){if(!r.v(a,["zoom","feature-state"]))return[new qe(d.key,d.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(d.expressionContext==="cluster-initial"&&!r.x(a))return[new qe(d.key,d.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Nt(d,n){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const g of n.valueSpec.expression.parameters)a.delete(g);if(a.size===0)return[];const f=[];return d instanceof r.C&&a.has(d.name)?[new qe(n.key,n.value,`["${d.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(d.eachChild(g=>{f.push(...Nt(g,n))}),f)}function Qi(d){const n=d.key,a=d.value,f=d.valueSpec,g=[];return Array.isArray(f.values)?f.values.indexOf(r.u(a))===-1&&g.push(new qe(n,a,`expected one of [${f.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(f.values).indexOf(r.u(a))===-1&&g.push(new qe(n,a,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(a)} found`)),g}function xn(d){return r.z(r.o(d.value))?Ji(r.j({},d,{expressionContext:"filter",valueSpec:d.styleSpec[`filter_${d.layerType||"fill"}`]})):un(d)}function un(d){const n=d.value,a=d.key;if(r.i(n)!=="array")return[new qe(a,n,`array expected, ${r.i(n)} found`)];const f=d.styleSpec;let g,x=[];if(n.length<1)return[new qe(a,n,"filter array must have at least 1 element")];switch(x=x.concat(Qi({key:`${a}[0]`,value:n[0],valueSpec:f.filter_operator,style:d.style,styleSpec:d.styleSpec})),r.u(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&r.u(n[1])==="$type"&&x.push(new qe(a,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&x.push(new qe(a,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(g=r.i(n[1]),g!=="string"&&x.push(new qe(`${a}[1]`,n[1],`string expected, ${g} found`)));for(let T=2;T<n.length;T++)g=r.i(n[T]),r.u(n[1])==="$type"?x=x.concat(Qi({key:`${a}[${T}]`,value:n[T],valueSpec:f.geometry_type,style:d.style,styleSpec:d.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&x.push(new qe(`${a}[${T}]`,n[T],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let T=1;T<n.length;T++)x=x.concat(un({key:`${a}[${T}]`,value:n[T],style:d.style,styleSpec:d.styleSpec}));break;case"has":case"!has":g=r.i(n[1]),n.length!==2?x.push(new qe(a,n,`filter array for "${n[0]}" operator must have 2 elements`)):g!=="string"&&x.push(new qe(`${a}[1]`,n[1],`string expected, ${g} found`))}return x}function en(d,n){const a=d.key,f=d.style,g=d.layer,x=d.styleSpec,T=d.value,E=d.objectKey,C=x[`${n}_${d.layerType}`];if(!C)return[];const D=E.match(/^(.*)-transition$/);if(n==="paint"&&D&&C[D[1]]&&C[D[1]].transition)return mt({key:a,value:T,valueSpec:x.transition,style:f,styleSpec:x});const L=d.valueSpec||C[E];if(!L)return[new si(a,T,`unknown property "${E}"`)];let z;if(r.i(T)==="string"&&r.k(L)&&!L.tokens&&(z=/^{([^}]+)}$/.exec(T))){const V=`\`{ "type": "identity", "property": ${z?JSON.stringify(z[1]):'"_"'} }\``;return[new qe(a,T,`"${E}" does not support interpolation syntax
Use an identity property function instead: ${V}.`)]}const B=[];if(d.layerType==="symbol")E!=="text-field"||!f||f.glyphs||f.imports||B.push(new qe(a,T,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&r.A(r.o(T))&&r.u(T.type)==="identity"&&B.push(new qe(a,T,'"text-font" does not support identity functions'));else if(d.layerType==="model"&&n==="paint"&&g&&g.layout&&g.layout.hasOwnProperty("model-id")&&r.k(L)&&(r.B(L)||r.m(L))){const V=r.q(r.o(T),L),H=V.value.expression||V.value._styleExpression.expression;H&&!r.v(H,["measure-light"])&&(E==="model-emissive-strength"&&r.x(H)&&r.t(H)||B.push(new qe(a,T,`${E} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return B.concat(mt({key:d.key,value:T,valueSpec:L,style:f,styleSpec:x,expressionContext:"property",propertyType:n,propertyKey:E}))}function Ln(d){return en(d,"paint")}function In(d){return en(d,"layout")}function hi(d){let n=[];const a=d.value,f=d.key,g=d.style,x=d.styleSpec;a.type||a.ref||n.push(new qe(f,a,'either "type" or "ref" is required'));let T=r.u(a.type);const E=r.u(a.ref);if(a.id){const C=r.u(a.id);for(let D=0;D<d.arrayIndex;D++){const L=g.layers[D];r.u(L.id)===C&&n.push(new qe(f,a.id,`duplicate layer id "${a.id}", previously used at line ${L.id.__line__}`))}}if("ref"in a){let C;["type","source","source-layer","filter","layout"].forEach(D=>{D in a&&n.push(new qe(f,a[D],`"${D}" is prohibited for ref layers`))}),g.layers.forEach(D=>{r.u(D.id)===E&&(C=D)}),C?C.ref?n.push(new qe(f,a.ref,"ref cannot reference another ref layer")):T=r.u(C.type):typeof E=="string"&&n.push(new qe(f,a.ref,`ref layer "${E}" not found`))}else if(T!=="background"&&T!=="sky"&&T!=="slot")if(a.source){const C=g.sources&&g.sources[a.source],D=C&&r.u(C.type);C?D==="vector"&&T==="raster"?n.push(new qe(f,a.source,`layer "${a.id}" requires a raster source`)):D==="raster"&&T!=="raster"?n.push(new qe(f,a.source,`layer "${a.id}" requires a vector source`)):D!=="vector"||a["source-layer"]?D==="raster-dem"&&T!=="hillshade"?n.push(new qe(f,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):D!=="raster-array"||["raster","raster-particle"].includes(T)?T!=="line"||!a.paint||!a.paint["line-gradient"]&&!a.paint["line-trim-offset"]||D==="geojson"&&C.lineMetrics?T==="raster-particle"&&D!=="raster-array"&&n.push(new qe(f,a.source,`layer "${a.id}" requires a 'raster-array' source.`)):n.push(new qe(f,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new qe(f,a.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new qe(f,a,`layer "${a.id}" must specify a "source-layer"`)):n.push(new qe(f,a.source,`source "${a.source}" not found`))}else n.push(new qe(f,a,'missing required property "source"'));return n=n.concat(yt({key:f,value:a,valueSpec:x.layer,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{"*":()=>[],type:()=>mt({key:`${f}.type`,value:a.type,valueSpec:x.layer.type,style:d.style,styleSpec:d.styleSpec,object:a,objectKey:"type"}),filter:C=>xn(r.j({layerType:T},C)),layout:C=>yt({layer:a,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":D=>In(r.j({layerType:T},D))}}),paint:C=>yt({layer:a,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":D=>Ln(r.j({layerType:T,layer:a},D))}})}})),n}function Ei(d){const n=d.value,a=d.key,f=r.i(n);return f!=="string"?[new qe(a,n,`string expected, ${f} found`)]:[]}const on={promoteId:function({key:d,value:n}){if(r.i(n)==="string")return Ei({key:d,value:n});{const a=[];for(const f in n)a.push(...Ei({key:`${d}.${f}`,value:n[f]}));return a}}};function hn(d){const n=d.value,a=d.key,f=d.styleSpec,g=d.style;if(!n.type)return[new qe(a,n,'"type" is required')];const x=r.u(n.type);let T=[];switch(["vector","raster","raster-dem","raster-array"].includes(x)&&(n.url||n.tiles||T.push(new si(a,n,'Either "url" or "tiles" is required.'))),x){case"vector":case"raster":case"raster-dem":case"raster-array":return T=T.concat(yt({key:a,value:n,valueSpec:f[`source_${x.replace("-","_")}`],style:d.style,styleSpec:f,objectElementValidators:on})),T;case"geojson":if(T=yt({key:a,value:n,valueSpec:f.source_geojson,style:g,styleSpec:f,objectElementValidators:on}),n.cluster)for(const E in n.clusterProperties){const[C,D]=n.clusterProperties[E],L=typeof C=="string"?[C,["accumulated"],["get",E]]:C;T.push(...Ji({key:`${a}.${E}.map`,value:D,expressionContext:"cluster-map"})),T.push(...Ji({key:`${a}.${E}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return T;case"video":return yt({key:a,value:n,valueSpec:f.source_video,style:g,styleSpec:f});case"image":return yt({key:a,value:n,valueSpec:f.source_image,style:g,styleSpec:f});case"canvas":return[new qe(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Qi({key:`${a}.type`,value:n.type,valueSpec:{values:ye(f)},style:g,styleSpec:f})}}function ye(d){return d.source.reduce((n,a)=>{const f=d[a];return f.type.type==="enum"&&(n=n.concat(Object.keys(f.type.values))),n},[])}function we(d){const n=d.value;let a=[];if(!n)return a;const f=r.i(n);return f!=="string"?(a=a.concat([new qe(d.key,n,`string expected, "${f}" found`)]),a):(function(g){const x=g.indexOf("://")===-1;try{return new URL(g,x?"http://example.com":void 0),!0}catch{return!1}}(n)||(a=a.concat([new qe(d.key,n,`invalid url "${n}"`)])),a)}function Ge(d){const n=d.value,a=d.styleSpec,f=a.light,g=d.style;let x=[];const T=r.i(n);if(n===void 0)return x;if(T!=="object")return x=x.concat([new qe("light",n,`object expected, ${T} found`)]),x;for(const E in n){const C=E.match(/^(.*)-transition$/);x=x.concat(C&&f[C[1]]&&f[C[1]].transition?mt({key:E,value:n[E],valueSpec:a.transition,style:g,styleSpec:a}):f[E]?mt({key:E,value:n[E],valueSpec:f[E],style:g,styleSpec:a}):[new qe(E,n[E],`unknown property "${E}"`)])}return x}function nt(d){const n=d.value;let a=[];if(!n)return a;const f=r.i(n);if(f!=="object")return a=a.concat([new qe("light-3d",n,`object expected, ${f} found`)]),a;const g=d.styleSpec,x=g["light-3d"],T=d.key,E=d.style,C=d.style.lights;for(const z of["type","id"])if(!(z in n))return a=a.concat([new qe("light-3d",n,`missing property ${z} on light`)]),a;if(n.type&&C)for(let z=0;z<d.arrayIndex;z++){const B=r.u(n.type),V=C[z];r.u(V.type)===B&&a.push(new qe(T,n.id,`duplicate light type "${n.type}", previously defined at line ${V.id.__line__}`))}const D=`properties_light_${n.type}`;if(!(D in g))return a=a.concat([new qe("light-3d",n,`Invalid light type ${n.type}`)]),a;const L=g[D];for(const z in n)if(z==="properties"){const B=n[z],V=r.i(B);if(V!=="object")return a=a.concat([new qe("properties",B,`object expected, ${V} found`)]),a;for(const H in B)a=a.concat(L[H]?mt({key:H,value:B[H],valueSpec:L[H],style:E,styleSpec:g}):[new si(d.key,B[H],`unknown property "${H}"`)])}else{const B=z.match(/^(.*)-transition$/);a=a.concat(B&&x[B[1]]&&x[B[1]].transition?mt({key:z,value:n[z],valueSpec:g.transition,style:E,styleSpec:g}):x[z]?mt({key:z,value:n[z],valueSpec:x[z],style:E,styleSpec:g}):[new si(z,n[z],`unknown property "${z}"`)])}return a}function ft(d){const n=d.value,a=d.key,f=d.style,g=d.styleSpec,x=g.terrain;let T=[];const E=r.i(n);if(n===void 0||E==="null")return T;if(E!=="object")return T=T.concat([new qe("terrain",n,`object expected, ${E} found`)]),T;for(const C in n){const D=C.match(/^(.*)-transition$/);T=T.concat(D&&x[D[1]]&&x[D[1]].transition?mt({key:C,value:n[C],valueSpec:g.transition,style:f,styleSpec:g}):x[C]?mt({key:C,value:n[C],valueSpec:x[C],style:f,styleSpec:g}):[new si(C,n[C],`unknown property "${C}"`)])}if(n.source){const C=f.sources&&f.sources[n.source],D=C&&r.u(C.type);C?D!=="raster-dem"&&T.push(new qe(a,n.source,`terrain cannot be used with a source of type ${String(D)}, it only be used with a "raster-dem" source type`)):T.push(new qe(a,n.source,`source "${n.source}" not found`))}else T.push(new qe(a,n,'terrain is missing required property "source"'));return T}function Ct(d){const n=d.value,a=d.style,f=d.styleSpec,g=f.fog;let x=[];const T=r.i(n);if(n===void 0)return x;if(T!=="object")return x=x.concat([new qe("fog",n,`object expected, ${T} found`)]),x;for(const E in n){const C=E.match(/^(.*)-transition$/);x=x.concat(C&&g[C[1]]&&g[C[1]].transition?mt({key:E,value:n[E],valueSpec:f.transition,style:a,styleSpec:f}):g[E]?mt({key:E,value:n[E],valueSpec:g[E],style:a,styleSpec:f}):[new si(E,n[E],`unknown property "${E}"`)])}return x}const Gt={"*":()=>[],array:wt,boolean:function(d){const n=d.value,a=d.key,f=r.i(n);return f!=="boolean"?[new qe(a,n,`boolean expected, ${f} found`)]:[]},number:Qt,color:function(d){const n=d.key,a=d.value,f=r.i(a);return f!=="string"?[new qe(n,a,`color expected, ${f} found`)]:r.y(a)===null?[new qe(n,a,`color expected, "${a}" found`)]:[]},enum:Qi,filter:xn,function:bn,layer:hi,object:yt,source:hn,model:we,light:Ge,"light-3d":nt,terrain:ft,fog:Ct,string:Ei,formatted:function(d){return Ei(d).length===0?[]:Ji(d)},resolvedImage:function(d){return Ei(d).length===0?[]:Ji(d)},projection:function(d){const n=d.value,a=d.styleSpec,f=a.projection,g=d.style;let x=[];const T=r.i(n);if(T==="object")for(const E in n)x=x.concat(mt({key:E,value:n[E],valueSpec:f[E],style:g,styleSpec:a}));else T!=="string"&&(x=x.concat([new qe("projection",n,`object or string expected, ${T} found`)]));return x},import:function(d){const{value:n,styleSpec:a}=d,{data:f,...g}=n;Object.defineProperty(g,"__line__",{value:n.__line__,enumerable:!1});let x=yt(r.j({},d,{value:g,valueSpec:a.import}));return r.u(g.id)===""&&x.push(new qe(`${d.key}.id`,g,"import id can't be an empty string")),f&&(x=x.concat(ct(f,a,{key:`${d.key}.data`}))),x}};function mt(d,n=!1){const a=d.value,f=d.valueSpec,g=d.styleSpec;if(f.expression&&r.A(r.u(a)))return bn(d);if(f.expression&&r.n(r.o(a)))return Ji(d);if(f.type&&Gt[f.type]){const x=Gt[f.type](d);return n===!0&&x.length>0&&r.i(d.value)==="array"?Ji(d):x}return yt(r.j({},d,{valueSpec:f.type?g[f.type]:f}))}function zt(d){const n=d.value,a=d.key,f=Ei(d);return f.length||(n.indexOf("{fontstack}")===-1&&f.push(new qe(a,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&f.push(new qe(a,n,'"glyphs" url must include a "{range}" token'))),f}function ct(d,n=r.D,a={}){return mt({key:a.key||"",value:d,valueSpec:n.$root,styleSpec:n,style:d,objectElementValidators:{glyphs:zt,"*":()=>[]}})}function kt(d,n=r.D){return Be(ct(d,n))}const li=d=>Be(hn(d)),$t=d=>Be(Ge(d)),Ce=d=>Be(nt(d)),Z=d=>Be(ft(d)),ne=d=>Be(Ct(d)),he=d=>Be(hi(d)),Le=d=>Be(xn(d)),Ve=d=>Be(Ln(d)),Xe=d=>Be(In(d)),Ot=d=>Be(we(d));function Be(d){return d.slice().sort((n,a)=>n.line&&a.line?n.line-a.line:0)}function Vt(d,n){let a=!1;if(n&&n.length)for(const f of n)f instanceof si?r.w(f.message):(d.fire(new r.a(new Error(f.message))),a=!0);return a}const Tt=new r.F({anchor:new r.G(r.D.light.anchor),position:new r.H(r.D.light.position),color:new r.G(r.D.light.color),intensity:new r.G(r.D.light.intensity)});class Ft extends r.E{constructor(n,a="flat"){super(),this._transitionable=new r.J(Tt),this.setLight(n,a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,a,f={}){this._validate($t,n,f)||(this._transitionable.setTransitionOrValue(n),this.id=a)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,f){return(!f||f.validate!==!1)&&Vt(this,n.call(kt,r.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:r.D})))}}const wi=new r.F({source:new r.G(r.D.terrain.source),exaggeration:new r.G(r.D.terrain.exaggeration)});let dn=class extends r.E{constructor(d,n,a,f){super(),this.scope=a,this._transitionable=new r.J(wi,a,f),this._transitionable.setTransitionOrValue(d,f),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n}get(){return this._transitionable.serialize()}set(d,n){this._transitionable.setTransitionOrValue(d,n)}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}getExaggeration(d){return this._transitioning.possiblyEvaluate(new r.K(d)).get("exaggeration")}isZoomDependent(){const d=this._transitionable._values.exaggeration;return d!=null&&d.value!=null&&d.value.expression!=null&&d.value.expression instanceof r.Z}};const Cn=45,fn=65,tn=.05;function Zi(d,n,a,f){const g=r.O(Cn,fn,a),[x,T]=an(d,f);let E=1-Math.min(1,Math.exp((n-x)/(T-x)*-6));return E*=E*E,E=Math.min(1,1.00747*E),E*g*d.alpha}function an(d,n){const a=.5/Math.tan(.5*n);return[d.range[0]+a,d.range[1]+a]}function wn(d,n,a,f,g){const x=r.N.transformMat4([],[n,a,f],g.mercatorFogMatrix);return Zi(d,r.N.length(x),g.pitch,g._fov)}function ur(d,n,a,f,g,x,T){const E=[[a,f,0],[g,f,0],[g,x,0],[a,x,0]];let C=Number.MAX_VALUE,D=-Number.MAX_VALUE;for(const L of E){const z=r.N.transformMat4([],L,n),B=r.N.length(z);C=Math.min(C,B),D=Math.max(D,B)}return[Zi(d,C,T.pitch,T._fov),Zi(d,D,T.pitch,T._fov)]}const Sn=new r.F({range:new r.G(r.D.fog.range),color:new r.G(r.D.fog.color),"high-color":new r.G(r.D.fog["high-color"]),"space-color":new r.G(r.D.fog["space-color"]),"horizon-blend":new r.G(r.D.fog["horizon-blend"]),"star-intensity":new r.G(r.D.fog["star-intensity"]),"vertical-range":new r.G(r.D.fog["vertical-range"])});class Or extends r.E{constructor(n,a,f,g){super(),this._transitionable=new r.J(Sn,f,new Map(g)),this.set(n,g),this._transitioning=this._transitionable.untransitioned(),this._transform=a,this.properties=new r.Q(Sn)}get state(){const n=this._transform,a=n.projection.name==="globe",f=r.S(n.zoom),g=this.properties.get("range"),x=[.5,3];return{range:a?[r.U(x[0],g[0],f),r.U(x[1],g[1],f)]:g,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,a,f={}){if(this._validate(ne,n,f))return;const g=r.e({},n);for(const x of Object.keys(r.D.fog))g[x]===void 0&&(g[x]=r.D.fog[x].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,a)}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.O(Cn,fn,n))*a.a}getOpacityAtLatLng(n,a){return this._transform.projection.supportsFog?function(f,g,x){const T=r.L.fromLngLat(g),E=x.elevation?x.elevation.getAtPointOrZero(T):0;return wn(f,T.x,T.y,E,x)}(this.state,n,a):0}getOpacityForTile(n){if(!this._transform.projection.supportsFog)return[1,1];const a=this._transform.calculateFogTileMatrix(n.toUnwrapped());return ur(this.state,a,0,0,r.V,r.V,this._transform)}getOpacityForBounds(n,a,f,g,x){return this._transform.projection.supportsFog?ur(this.state,n,a,f,g,x,this._transform):[1,1]}getFovAdjustedRange(n){return this._transform.projection.supportsFog?an(this.state,n):[0,1]}isVisibleOnFrustum(n){if(!this._transform.projection.supportsFog)return!1;const a=[4,5,6,7];for(const f of a){const g=n.points[f];let x;if(g[2]>=0)x=g;else{const T=n.points[f-4];x=r.W(T,g,T[2]/(T[2]-g[2]))}if(wn(this.state,x[0],x[1],0,this._transform)>=tn)return!0}return!1}updateConfig(n){this._transitionable.setTransitionOrValue(this._options,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,f){return(!f||f.validate!==!1)&&Vt(this,n.call(kt,r.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:r.D})))}}class Dr extends r.E{constructor(n,a,f,g){super(),this.scope=f,this._options=n,this.properties=new r.Q(a),this._transitionable=new r.J(a,f,new Map(g)),this._transitionable.setTransitionOrValue(n.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(n){this._transitionable.setTransitionOrValue(this._options.properties,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(n,a){this._options=n,this._transitionable.setTransitionOrValue(n.properties,a)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const Ur=new r.F({color:new r.G(r.D.properties_light_ambient.color),intensity:new r.G(r.D.properties_light_ambient.intensity)}),tr=new r.F({direction:new r.X(r.D.properties_light_directional.direction),color:new r.G(r.D.properties_light_directional.color),intensity:new r.G(r.D.properties_light_directional.intensity),"cast-shadows":new r.G(r.D.properties_light_directional["cast-shadows"]),"shadow-intensity":new r.G(r.D.properties_light_directional["shadow-intensity"])});class Yn{constructor(n,a,f,g){this.screenBounds=n,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=f,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,g)}static createFromScreenPoints(n,a){let f,g;if(n instanceof r.P||typeof n[0]=="number"){const x=r.P.convert(n);f=[x],g=a.isPointAboveHorizon(x)}else{const x=r.P.convert(n[0]),T=r.P.convert(n[1]);f=[x,T],g=r.Y(x,T).every(E=>a.isPointAboveHorizon(E))}return new Yn(f,a.getCameraPoint(),g,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return r.Y(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const a=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],g=r.Y(a,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<f.x?g.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?g[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(g[3]=this.cameraPoint)),r._(g,n)}bufferedCameraGeometryGlobe(n){const a=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],g=r.Y(a,f,n),x=this.cameraPoint.clone();switch(3*((x.y>a.y)+(x.y>f.y))+((x.x>a.x)+(x.x>f.x))){case 0:g[0]=x,g[4]=x.clone();break;case 1:g.splice(1,0,x);break;case 2:g[1]=x;break;case 3:g.splice(4,0,x);break;case 5:g.splice(2,0,x);break;case 6:g[3]=x;break;case 7:g.splice(3,0,x);break;case 8:g[2]=x}return g}containsTile(n,a,f,g=0){const x=n.queryPadding/a._pixelsPerMercatorPixel+1,T=f?this._bufferedCameraMercator(x,a):this._bufferedScreenMercator(x,a);let E=n.tileID.wrap+(T.unwrapped?g:0);const C=T.polygon.map(q=>r.$(n.tileTransform,q,E));if(!r.a0(C,0,0,r.V,r.V))return;E=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?g:0);const D=this.screenGeometryMercator.polygon.map(q=>r.a1(n.tileTransform,q,E)),L=D.map(q=>new r.P(q[0],q[1])),z=a.getFreeCameraOptions().position||new r.L(0,0,0),B=r.a1(n.tileTransform,z,E),V=D.map(q=>{const j=r.N.sub(q,q,B);return r.N.normalize(j,j),new r.a2(B,j)}),H=r.a3(n,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:V,bufferedTilespaceGeometry:C,bufferedTilespaceBounds:(W=r.a4(C),W.min.x=r.aa(W.min.x,0,r.V),W.min.y=r.aa(W.min.y,0,r.V),W.max.x=r.aa(W.max.x,0,r.V),W.max.y=r.aa(W.max.y,0,r.V),W),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:H};var W}_bufferedScreenMercator(n,a){const f=lt(n);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{let g;return g=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),a):{polygon:this.bufferedScreenGeometry(n).map(x=>a.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[f]=g,g}}_bufferedCameraMercator(n,a){const f=lt(n);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{let g;return g=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),a):{polygon:this.bufferedCameraGeometry(n).map(x=>a.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[f]=g,g}}_projectAndResample(n,a){const f=function(x,T){const E=r.a6.multiply([],T.pixelMatrix,T.globeMatrix),C=[0,-r.ab,0,1],D=[0,r.ab,0,1],L=[0,0,0,1];r.a7.transformMat4(C,C,E),r.a7.transformMat4(D,D,E),r.a7.transformMat4(L,L,E);const z=new r.P(C[0]/C[3],C[1]/C[3]),B=new r.P(D[0]/D[3],D[1]/D[3]),V=r.a8(x,z)&&C[3]<L[3],H=r.a8(x,B)&&D[3]<L[3];if(!V&&!H)return null;const W=function(oe,ue,de){for(let _e=1;_e<oe.length;_e++){const Pe=We(ue.pointCoordinate3D(oe[_e-1]).x),be=We(ue.pointCoordinate3D(oe[_e]).x);if(de<0){if(Pe<be)return{idx:_e,t:-Pe/(be-1-Pe)}}else if(be<Pe)return{idx:_e,t:(1-Pe)/(be+1-Pe)}}return null}(x,T,V?-1:1);if(!W)return null;const{idx:q,t:j}=W;let Y=q>1?je(x.slice(0,q),T):[],re=q<x.length?je(x.slice(q),T):[];Y=Y.map(oe=>new r.P(We(oe.x),oe.y)),re=re.map(oe=>new r.P(We(oe.x),oe.y));const Q=[...Y];Q.length===0&&Q.push(re[re.length-1]);const se=r.U(Q[Q.length-1].y,(re.length===0?Y[0]:re[0]).y,j);let X;return X=V?[new r.P(0,se),new r.P(0,0),new r.P(1,0),new r.P(1,se)]:[new r.P(1,se),new r.P(1,1),new r.P(0,1),new r.P(0,se)],Q.push(...X),re.length===0?Q.push(Y[0]):Q.push(...re),{polygon:Q.map(oe=>new r.L(oe.x,oe.y)),unwrapped:!1}}(n,a);if(f)return f;const g=function(x,T){let E=!1,C=-1/0,D=0;for(let z=0;z<x.length-1;z++)x[z].x>C&&(C=x[z].x,D=z);for(let z=0;z<x.length-1;z++){const B=(D+z)%(x.length-1),V=x[B],H=x[B+1];Math.abs(V.x-H.x)>.5&&(V.x<H.x?(V.x+=1,B===0&&(x[x.length-1].x+=1)):(H.x+=1,B+1===x.length-1&&(x[0].x+=1)),E=!0)}const L=r.a5(T.center.lng);return E&&L<Math.abs(L-1)&&x.forEach(z=>{z.x-=1}),{polygon:x,unwrapped:E}}(je(n,a).map(x=>new r.P(We(x.x),x.y)),a);return{polygon:g.polygon.map(x=>new r.L(x.x,x.y)),unwrapped:g.unwrapped}}}function je(d,n){return r.a9(d,a=>{const f=n.pointCoordinate3D(a);a.x=f.x,a.y=f.y},1/256)}function We(d){return d<0?1+d%1:d%1}function lt(d){return 100*d|0}function bt(d,n,a,f,g){const x=function(T,E){if(T)return g(T);if(E){d.url&&E.tiles&&d.tiles&&delete d.tiles;const C=r.ac(r.e(E,d),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);E.vector_layers&&(C.vectorLayers=E.vector_layers,C.vectorLayerIds=C.vectorLayers.map(D=>D.id)),E.raster_layers&&(C.rasterLayers=E.raster_layers,C.rasterLayerIds=C.rasterLayers.map(D=>D.id)),C.tiles=n.canonicalizeTileset(C,d.url),g(null,C)}};return d.url?r.g(n.transformRequest(n.normalizeSourceURL(d.url,null,a,f),r.R.Source),x):r.f.frame(()=>x(null,d))}class _t{constructor(n,a,f){this.bounds=r.ad.convert(this.validateBounds(n)),this.minzoom=a||0,this.maxzoom=f||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const a=Math.pow(2,n.z),f=Math.floor(r.a5(this.bounds.getWest())*a),g=Math.floor(r.ae(this.bounds.getNorth())*a),x=Math.ceil(r.a5(this.bounds.getEast())*a),T=Math.ceil(r.ae(this.bounds.getSouth())*a);return n.x>=f&&n.x<x&&n.y>=g&&n.y<T}}class At extends r.E{constructor(n,a,f,g){if(super(),this.id=n,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.e(this,r.ac(a,["url","scheme","tileSize","promoteId"])),this._options=r.e({type:"vector"},a),this._collectResourceTiming=!!a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new r.af}load(n){this._loaded=!1,this.fire(new r.b("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map._worldview;this._tileJSONRequest=bt(this._options,this.map._requestManager,a,f,(g,x)=>{this._tileJSONRequest=null,this._loaded=!0,g?(a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),f&&f.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new r.a(g))):x&&(r.e(this,x),x.bounds&&(this.tileBounds=new _t(x.bounds,this.minzoom,this.maxzoom)),r.aj(x.tiles,this.map._requestManager._customAccessToken),this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))),n&&n(g)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=r.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return r.e({},this._options)}loadTile(n,a){const f=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(f,r.R.Tile),data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:n.isExtraShadowCaster};if(g.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=a:n.request=n.actor.send("reloadTile",g,x.bind(this));else if(n.actor=this._tileWorkers[f]=this._tileWorkers[f]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",g,x.bind(this),void 0,!0);else{const T=r.ah.call({deduped:this._deduped},g,(E,C)=>{E||!C?x.call(this,E):(g.data={cacheControl:C.cacheControl,expires:C.expires,rawData:C.rawData.slice(0)},n.actor&&n.actor.send("loadTile",g,x.bind(this),void 0,!0))},!0);n.request={cancel:T}}function x(T,E){return delete n.request,n.aborted?a(null):T&&T.status!==404?a(T):(E&&E.resourceTiming&&(n.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&E&&n.setExpiryData(E),n.loadVectorData(E,this.map.painter),r.ai(this.dispatcher),a(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n){n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope}),n.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class It extends r.E{constructor(n,a,f,g){super(),this.id=n,this.dispatcher=f,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.e({type:"raster"},a),r.e(this,r.ac(a,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new r.b("dataloading",{dataType:"source"})),this._tileJSONRequest=bt(this._options,this.map._requestManager,null,null,(a,f)=>{this._tileJSONRequest=null,this._loaded=!0,a?this.fire(new r.a(a)):f&&(r.e(this,f),f.bounds&&(this.tileBounds=new _t(f.bounds,this.minzoom,this.maxzoom)),r.aj(f.tiles),this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))),n&&n(a)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=r.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return r.e({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,a){const f=r.f.devicePixelRatio>=2,g=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);n.request=r.d(this.map._requestManager.transformRequest(g,r.R.Tile),(x,T,E,C)=>(delete n.request,n.aborted?(n.state="unloaded",a(null)):x?(n.state="errored",a(x)):T?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:E,expires:C}),n.setTexture(T,this.map.painter),n.state="loaded",r.ai(this.dispatcher),void a(null)):a(null)))}abortTile(n,a){n.request&&(n.request.cancel(),delete n.request),a()}unloadTile(n,a){n.texture&&n.texture instanceof r.T?(n.destroy(!0),n.texture&&n.texture instanceof r.T&&this.map.painter.saveTileTexture(n.texture)):n.destroy(),a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class xt extends It{constructor(n,a,f,g){super(n,a,f,g),this.type="raster-array",this.maxzoom=22,this._options=r.e({type:"raster-array"},a)}triggerRepaint(n){const a=this.map.painter._terrain,f=this.map.style.getSourceCache(this.id);a&&a.enabled&&f&&a._clearRenderCacheForTile(f.id,n.tileID),this.map.triggerRepaint()}loadTile(n,a){const f=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),g=this.map._requestManager.transformRequest(f,r.R.Tile);n.requestParams=g,n.actor||(n.actor=this.dispatcher.getActor()),n.request=n.fetchHeader(void 0,(x,T,E,C)=>{if(delete n.request,n.aborted)return n.state="unloaded",a(null);if(x)return x.code===20?void 0:(n.state="errored",a(x));this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:E,expires:C}),n.state="empty",a(null)})}unloadTile(n){const a=n.texture;a&&a instanceof r.T?(n.destroy(!0),this.map.painter.saveTileTexture(a)):(n.destroy(),n.flushQueues(),n._isHeaderLoaded=!1,delete n._mrt,delete n.textureDescriptor),n.fbo&&(n.fbo.destroy(),delete n.fbo),delete n.request,delete n.requestParams,delete n.neighboringTiles,n.state="unloaded"}prepareTile(n,a,f){n._isHeaderLoaded&&(n.state!=="empty"&&(n.state="reloading"),n.fetchBand(a,f,(g,x)=>{if(g)return n.state="errored",this.fire(new r.a(g)),void this.triggerRepaint(n);x&&(n.setTexture(x,this.map.painter),n.state="loaded",this.triggerRepaint(n))}))}getInitialBand(n){if(!this.rasterLayers)return 0;const a=this.rasterLayers.find(({id:x})=>x===n),f=a&&a.fields,g=f&&f.bands&&f.bands;return g?g[0]:0}getTextureDescriptor(n,a,f){if(!n)return;const g=a.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!g)return;let x=null;a instanceof r.an?x=a.paint.get("raster-array-band"):a instanceof r.ao&&(x=a.paint.get("raster-particle-array-band"));const T=x||this.getInitialBand(g);if(T!=null)if(n.textureDescriptor){if(!n.updateNeeded(g,T)||f)return Object.assign({},n.textureDescriptor,{texture:n.texture})}else this.prepareTile(n,g,T)}}const Dt=32,St=33,ci=new Uint16Array(8184);for(let d=0;d<2046;d++){let n=d+2,a=0,f=0,g=0,x=0,T=0,E=0;for(1&n?g=x=T=Dt:a=f=E=Dt;(n>>=1)>1;){const D=a+g>>1,L=f+x>>1;1&n?(g=a,x=f,a=T,f=E):(a=g,f=x,g=T,x=E),T=D,E=L}const C=4*d;ci[C+0]=a,ci[C+1]=f,ci[C+2]=g,ci[C+3]=x}const ki=new Uint16Array(2178),Kt=new Uint8Array(1089),pn=new Uint16Array(1089);function kn(d){return d===0?-.03125:d===32?.03125:0}class vn{constructor(n,a,f,g){this.id=vn.uniqueIdxCounter,vn.uniqueIdxCounter++,this.context=n;const x=n.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||g||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=vn.uniqueIdxCounter,vn.uniqueIdxCounter++;const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}vn.uniqueIdxCounter=0;const ir={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Tr{constructor(n,a,f,g,x,T){this.length=a.length,this.attributes=f,this.itemSize=a.bytesPerElement,this.dynamicDraw=g,this.instanceCount=T,this.context=n;const E=n.gl;this.buffer=E.createBuffer(),n.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||x||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,a){for(let f=0;f<this.attributes.length;f++){const g=a.attributes[this.attributes[f].name];g!==void 0&&n.enableVertexAttribArray(g)}}setVertexAttribPointers(n,a,f){for(let g=0;g<this.attributes.length;g++){const x=this.attributes[g],T=a.attributes[x.name];T!==void 0&&n.vertexAttribPointer(T,x.components,n[ir[x.type]],!1,this.itemSize,x.offset+this.itemSize*(f||0))}}setVertexAttribDivisor(n,a,f){for(let g=0;g<this.attributes.length;g++){const x=a.attributes[this.attributes[g].name];x!==void 0&&this.instanceCount&&this.instanceCount>0&&n.vertexAttribDivisor(x,f)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Hi{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ts extends Hi{getDefault(){return r.ax.transparent}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class vs extends Hi{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class Mr extends Hi{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Il extends Hi{getDefault(){return[!0,!0,!0,!0]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class fo extends Hi{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Ea extends Hi{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class nh extends Hi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const a=this.current;(n.func!==a.func||n.ref!==a.ref||n.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class $o extends Hi{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class rh extends Hi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=n,this.dirty=!1}}class Aa extends Hi{getDefault(){return[0,1]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class Hf extends Hi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=n,this.dirty=!1}}class Gc extends Hi{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class sh extends Hi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.BLEND):a.disable(a.BLEND),this.current=n,this.dirty=!1}}class $c extends Hi{getDefault(){const n=this.gl;return[n.ONE,n.ZERO,n.ONE,n.ZERO]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.blendFuncSeparate(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class oh extends Hi{getDefault(){return r.ax.transparent}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class jr extends Hi{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(n,n),this.current=n,this.dirty=!1)}}class Kn extends Hi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=n,this.dirty=!1}}class Ri extends Hi{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class qf extends Hi{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let Wc=class extends Hi{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class ah extends Hi{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class W_ extends Hi{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Os extends Hi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class lh extends Hi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class H_ extends Hi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Ia extends Hi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Rt extends Hi{getDefault(){return null}set(n){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Xi extends Hi{getDefault(){return null}set(n){this.gl&&(n!==this.current||this.dirty)&&(this.gl.bindVertexArray(n),this.current=n,this.dirty=!1)}}class Yi extends Hi{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class as extends Hi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class Ca extends Hi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Ni extends Hi{constructor(n,a){super(n),this.context=n,this.parent=a}getDefault(){return null}}class Hc extends Ni{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Pa extends Ni{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Cl extends Ni{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,this.attachment(),a.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Gr extends Pa{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Zn{constructor(n,a,f,g,x){this.context=n,this.width=a,this.height=f;const T=this.framebuffer=n.gl.createFramebuffer();g&&(this.colorAttachment=new Hc(n,T)),x&&(this.depthAttachmentType=x,this.depthAttachment=x==="renderbuffer"?new Pa(n,T):new Cl(n,T))}destroy(){const n=this.context.gl;if(this.colorAttachment){const a=this.colorAttachment.get();a&&n.deleteTexture(a)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const a=this.depthAttachment.get();a&&n.deleteRenderbuffer(a)}else{const a=this.depthAttachment.get();a&&n.deleteTexture(a)}n.deleteFramebuffer(this.framebuffer)}}class ni{constructor(n,a,f){this.func=n,this.mask=a,this.range=f}}ni.ReadOnly=!1,ni.ReadWrite=!0,ni.disabled=new ni(519,ni.ReadOnly,[0,1]);const Wo=7680;class di{constructor(n,a,f,g,x,T){this.test=n,this.ref=a,this.mask=f,this.fail=g,this.depthFail=x,this.pass=T}}di.disabled=new di({func:519,mask:0},0,0,Wo,Wo,Wo);const po=771;class Ai{constructor(n,a,f,g){this.blendFunction=n,this.blendColor=a,this.mask=f,this.blendEquation=g}}Ai.Replace=[1,0,1,0],Ai.disabled=new Ai(Ai.Replace,r.ax.transparent,[!1,!1,!1,!1]),Ai.unblended=new Ai(Ai.Replace,r.ax.transparent,[!0,!0,!0,!0]),Ai.alphaBlended=new Ai([1,po,1,po],r.ax.transparent,[!0,!0,!0,!0]),Ai.multiply=new Ai([774,0,774,0],r.ax.transparent,[!0,!0,!0,!0]);const Da=1029,Sr=2305;class ri{constructor(n,a,f){this.enable=n,this.mode=a,this.frontFace=f}}ri.disabled=new ri(!1,Da,Sr),ri.backCCW=new ri(!0,Da,Sr),ri.backCW=new ri(!0,Da,2304),ri.frontCW=new ri(!0,1028,2304),ri.frontCCW=new ri(!0,1028,Sr);class Zf{constructor(n,a){this.gl=n,this.clearColor=new ts(this),this.clearDepth=new vs(this),this.clearStencil=new Mr(this),this.colorMask=new Il(this),this.depthMask=new fo(this),this.stencilMask=new Ea(this),this.stencilFunc=new nh(this),this.stencilOp=new $o(this),this.stencilTest=new rh(this),this.depthRange=new Aa(this),this.depthTest=new Hf(this),this.depthFunc=new Gc(this),this.blend=new sh(this),this.blendFunc=new $c(this),this.blendColor=new oh(this),this.blendEquation=new jr(this),this.cullFace=new Kn(this),this.cullFaceSide=new Ri(this),this.frontFace=new qf(this),this.program=new Wc(this),this.activeTexture=new ah(this),this.viewport=new W_(this),this.bindFramebuffer=new Os(this),this.bindRenderbuffer=new lh(this),this.bindTexture=new H_(this),this.bindVertexBuffer=new Ia(this),this.bindElementBuffer=new Rt(this),this.bindVertexArrayOES=new Xi(this),this.pixelStoreUnpack=new Yi(this),this.pixelStoreUnpackPremultiplyAlpha=new as(this),this.pixelStoreUnpackFlipY=new Ca(this),this.options=a?{...a}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=n.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this.maxPointSize=n.getParameter(n.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,a,f){return new vn(this,n,a,f)}createVertexBuffer(n,a,f,g,x){return new Tr(this,n,a,f,g,x)}createRenderbuffer(n,a,f){const g=this.gl,x=g.createRenderbuffer();return this.bindRenderbuffer.set(x),g.renderbufferStorage(g.RENDERBUFFER,n,a,f),this.bindRenderbuffer.set(null),x}createFramebuffer(n,a,f,g){return new Zn(this,n,a,f,g)}clear({color:n,depth:a,stencil:f,colorMask:g}){const x=this.gl;let T=0;n&&(T|=x.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set(g||[!0,!0,!0,!0])),a!==void 0&&(T|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),f!==void 0&&(T|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),x.clear(T)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){k(n.blendFunction,Ai.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor),n.blendEquation?this.blendEquation.set(n.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(n.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}var Ho=r.ay([{name:"a_pos",type:"Float32",components:3}]);class nr{constructor(n,a,f,g){const x={width:f[0],height:f[1],data:null},T=n.gl;this.targetColorTexture=new r.T(n,x,T.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new r.T(n,x,T.RGBA,{useMipmap:!1}),this.context=n,this.setNumParticles(a,g),this.lastInvalidatedAt=0}setNumParticles(n,a){if(this.numParticles===a)return;(this.particleVertices0||this.particleVertices1||this.particleSegment)&&(this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy());const f=new r.az;f.reserve(Math.round(a));const g=r.aA(n.key);for(let x=0;x<a;x++)f.emplaceBack(g(),g(),g());this.particleVertices0=this.context.createVertexBuffer(f,Ho.members,!0),this.particleVertices1=this.context.createVertexBuffer(f,Ho.members,!0),this.particleSegment=r.aB.simpleSegment(0,0,this.particleVertices0.length,0),this.numParticles=a}update(n){return!(this.lastInvalidatedAt<n&&(this.lastInvalidatedAt=r.f.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy()}}const ls={type:2,extent:r.V,loadGeometry:()=>[[new r.P(0,0),new r.P(r.V+1,0),new r.P(r.V+1,r.V+1),new r.P(0,r.V+1),new r.P(0,0)]]};class mo{constructor(n,a,f,g,x){this.tileID=n,this.uid=r.aC(),this.uses=0,this.tileSize=a,this.tileZoom=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=x,g&&g.style&&(this._lastUpdatedBrightness=g.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",g&&g.transform&&(this.projection=g.transform.projection)}registerFadeDuration(n){const a=n+this.timeAdded;a<r.f.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.as(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,a,f){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(g,x){const T={};if(!x)return T;for(const E of g){const C=E.layerIds.map(D=>x.getLayer(D)).filter(Boolean);if(C.length!==0){E.layers=C,E.stateDependentLayerIds&&(E.stateDependentLayers=E.stateDependentLayerIds.map(D=>C.filter(L=>L.id===D)[0]));for(const D of C)T[D.fqid]=E}}return T}(n.buckets,a.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const x=this.buckets[g];if(x instanceof r.aE){if(this.hasSymbolBuckets=!0,!f)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const x=this.buckets[g];if(x instanceof r.aE&&x.hasRTLText){this.hasRTLText=!0,r.aF();break}}this.queryPadding=0;for(const g in this.buckets){const x=this.buckets[g],T=a.style.getOwnLayer(g);if(!T)continue;const E=T.queryRadius(x);this.queryPadding=Math.max(this.queryPadding,E)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new r.aD}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(n){return this.buckets[n.fqid]}upload(n){for(const g in this.buckets){const x=this.buckets[g];x.uploadPending()&&x.upload(n)}const a=n.gl,f=this.imageAtlas;if(f&&!f.uploaded){const g=!!Object.keys(f.patternPositions).length;this.imageAtlasTexture=new r.T(n,f.image,a.RGBA,{useMipmap:g}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(n,this.glyphAtlasImage,a.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(n,this.lineAtlas.image,a.R8),this.lineAtlas.uploaded=!0)}prepare(n,a,f){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,f),!a||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const g=a.style.getBrightness();(this._lastUpdatedBrightness||g)&&(this._lastUpdatedBrightness&&g&&Math.abs(this._lastUpdatedBrightness-g)<.001||(this._lastUpdatedBrightness=g,this.updateBuckets(void 0,a)))}queryRenderedFeatures(n,a,f,g,x,T,E,C){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:g,pixelPosMatrix:E,transform:T,params:x,tileTransform:this.tileTransform},n,a,f):{}}querySourceFeatures(n,a){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const g=f.loadVTLayers(),x=a?a.sourceLayer:"",T=g._geojsonTileLayer||g[x];if(!T)return;const E=r.aG(a&&a.filter),{z:C,x:D,y:L}=this.tileID.canonical,z={z:C,x:D,y:L};for(let B=0;B<T.length;B++){const V=T.feature(B);if(E.needGeometry){const q=r.aH(V,!0);if(!E.filter(new r.K(this.tileID.overscaledZ),q,this.tileID.canonical))continue}else if(!E.filter(new r.K(this.tileID.overscaledZ),V))continue;const H=f.getId(V,x),W=new r.aI(V,C,D,L,H);W.tile=z,n.push(W)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(const n in this.buckets)if(this.buckets[n].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const a=this.expirationTime;if(n.cacheControl){const f=r.aJ(n.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const f=Date.now();let g=!1;if(this.expirationTime>f)g=!1;else if(a)if(this.expirationTime<a)g=!0;else{const x=this.expirationTime-a;x?this.expirationTime=f+Math.max(x,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,a){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(n).length!==0&&a&&this.updateBuckets(n,a)}updateBuckets(n,a){if(!this.latestFeatureIndex)return;const f=this.latestFeatureIndex.loadVTLayers(),g=a.style.listImages(),x=a.style.getBrightness();for(const T in this.buckets){if(!a.style.hasLayer(T))continue;const E=this.buckets[T],C=E.layers[0].sourceLayer||"_geojsonTileLayer",D=f[C];let L={};if(n&&(L=n[C],!D||!L||Object.keys(L).length===0))continue;if(E.update(L,D,g,this.imageAtlas&&this.imageAtlas.patternPositions||{},x),E instanceof r.aK||E instanceof r.aL){const B=a.style.getOwnSourceCache(E.layers[0].source);a._terrain&&a._terrain.enabled&&B&&E.programConfigurations.needsUpload&&a._terrain._clearRenderCacheForTile(B.id,this.tileID)}const z=a&&a.style&&a.style.getOwnLayer(T);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(E)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.f.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=r.f.now()+n}setTexture(n,a){const f=a.context,g=f.gl;this.texture=this.texture||a.getTileTexture(n.width),this.texture&&this.texture instanceof r.T?this.texture.update(n,{useMipmap:!0}):(this.texture=new r.T(f,n,g.RGBA,{useMipmap:!0}),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE))}setDependencies(n,a){const f={};for(const g of a)f[g]=!0;this.dependencies[n]=f}hasDependency(n,a){for(const f of n){const g=this.dependencies[f];if(g){for(const x of a)if(g[x])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,a){if(!a||a.name==="mercator"||this._tileDebugBuffer)return;const f=r.aM(ls,this.tileID.canonical,this.tileTransform)[0],g=new r.aN,x=new r.aO;for(let T=0;T<f.length;T++){const{x:E,y:C}=f[T];g.emplaceBack(E,C),x.emplaceBack(T)}x.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(x),this._tileDebugBuffer=n.createVertexBuffer(g,r.aP.members),this._tileDebugSegments=r.aB.simpleSegment(0,0,g.length,x.length)}_makeTileBoundsBuffers(n,a){if(this._tileBoundsBuffer||!a||a.name==="mercator")return;const f=r.aM(ls,this.tileID.canonical,this.tileTransform)[0];let g,x;if(this.isRaster){const T=function(E,C){const D=r.as(E,C),L=Math.pow(2,E.z);for(let q=0;q<St;q++)for(let j=0;j<St;j++){const Y=r.at((E.x+(j+kn(j))/Dt)/L),re=r.au((E.y+(q+kn(q))/Dt)/L),Q=C.project(Y,re),se=q*St+j;ki[2*se+0]=Math.round((Q.x*D.scale-D.x)*r.V),ki[2*se+1]=Math.round((Q.y*D.scale-D.y)*r.V)}Kt.fill(0),pn.fill(0);for(let q=2045;q>=0;q--){const j=4*q,Y=ci[j+0],re=ci[j+1],Q=ci[j+2],se=ci[j+3],X=Y+Q>>1,oe=re+se>>1,ue=X+oe-re,de=oe+Y-X,_e=re*St+Y,Pe=se*St+Q,be=oe*St+X,Ne=Math.hypot((ki[2*_e+0]+ki[2*Pe+0])/2-ki[2*be+0],(ki[2*_e+1]+ki[2*Pe+1])/2-ki[2*be+1])>=16;Kt[be]=Kt[be]||(Ne?1:0),q<1022&&(Kt[be]=Kt[be]||Kt[(re+de>>1)*St+(Y+ue>>1)]||Kt[(se+de>>1)*St+(Q+ue>>1)])}const z=new r.av,B=new r.aw;let V=0;function H(q,j){const Y=j*St+q;return pn[Y]===0&&(z.emplaceBack(ki[2*Y+0],ki[2*Y+1],q*r.V/Dt,j*r.V/Dt),pn[Y]=++V),pn[Y]-1}function W(q,j,Y,re,Q,se){const X=q+Y>>1,oe=j+re>>1;if(Math.abs(q-Q)+Math.abs(j-se)>1&&Kt[oe*St+X])W(Q,se,q,j,X,oe),W(Y,re,Q,se,X,oe);else{const ue=H(q,j),de=H(Y,re),_e=H(Q,se);B.emplaceBack(ue,de,_e)}}return W(0,0,Dt,Dt,Dt,0),W(Dt,Dt,0,0,0,Dt),{vertices:z,indices:B}}(this.tileID.canonical,a);g=T.vertices,x=T.indices}else{g=new r.av,x=new r.aw;for(const{x:E,y:C}of f)g.emplaceBack(E,C,0,0);const T=r.aQ(g.int16,void 0,4);for(let E=0;E<T.length;E+=3)x.emplaceBack(T[E],T[E+1],T[E+2])}this._tileBoundsBuffer=n.createVertexBuffer(g,r.aR.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(x),this._tileBoundsSegments=r.aB.simpleSegment(0,0,g.length,x.length)}_makeGlobeTileDebugBuffers(n,a){const f=a.projection;if(!f||f.name!=="globe"||a.freezeTileCoverage)return;const g=this.tileID.canonical,x=r.aS(g,a),T=r.aT(x),E=r.S(a.zoom);let C;E>0&&(C=r.a6.invert(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,g,a,T,C,E),this._makeGlobeTileDebugTextBuffer(n,g,a,T,C,E)}_globePoint(n,a,f,g,x,T,E){let C=r.aU(n,a,f);if(T){const D=1<<f.z,L=r.a5(g.center.lng),z=r.ae(g.center.lat),B=(f.x+.5)/D-L;let V=0;B>.5?V=-1:B<-.5&&(V=1);let H=(n/r.V+f.x)/D+V,W=(a/r.V+f.y)/D;H=(H-L)*g._pixelsPerMercatorPixel+L,W=(W-z)*g._pixelsPerMercatorPixel+z;const q=[H*g.worldSize,W*g.worldSize,0];r.N.transformMat4(q,q,T),C=r.aV(C,q,E)}return r.N.transformMat4(C,C,x)}_makeGlobeTileDebugBorderBuffer(n,a,f,g,x,T){const E=new r.aN,C=new r.aO,D=new r.aW,L=(B,V,H,W,q)=>{const j=(H-B)/(q-1),Y=(W-V)/(q-1),re=E.length;for(let Q=0;Q<q;Q++){const se=B+Q*j,X=V+Q*Y;E.emplaceBack(se,X);const oe=this._globePoint(se,X,a,f,g,x,T);D.emplaceBack(oe[0],oe[1],oe[2]),C.emplaceBack(re+Q)}},z=r.V;L(0,0,z,0,16),L(z,0,z,z,16),L(z,z,0,z,16),L(0,z,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(C),this._tileDebugBuffer=n.createVertexBuffer(E,r.aP.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(D,r.aX.members),this._tileDebugSegments=r.aB.simpleSegment(0,0,E.length,C.length)}_makeGlobeTileDebugTextBuffer(n,a,f,g,x,T){const E=r.V/4,C=new r.aN,D=new r.aw,L=new r.aW,z=25;D.reserve(32),C.reserve(z),L.reserve(z);const B=(V,H)=>z*V+H;for(let V=0;V<z;V++){const H=V*E;for(let W=0;W<z;W++){const q=W*E;C.emplaceBack(q,H);const j=this._globePoint(q,H,a,f,g,x,T);L.emplaceBack(j[0],j[1],j[2])}}for(let V=0;V<4;V++)for(let H=0;H<4;H++){const W=B(V,H),q=B(V,H+1),j=B(V+1,H),Y=B(V+1,H+1);D.emplaceBack(W,q,j),D.emplaceBack(j,q,Y)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(D),this._tileDebugTextBuffer=n.createVertexBuffer(C,r.aP.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(L,r.aX.members),this._tileDebugTextSegments=r.aB.simpleSegment(0,0,z,32)}destroy(n=!1){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!n&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}const Gs={vector:At,raster:It,"raster-dem":class extends It{constructor(d,n,a,f){super(d,n,a,f),this.type="raster-dem",this.maxzoom=22,this._options=r.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(d,n){const a=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(g,x){g&&(d.state="errored",n(g)),x&&(d.dem=x,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",n(null))}d.request=r.d(this.map._requestManager.transformRequest(a,r.R.Tile),(function(g,x,T,E){if(delete d.request,d.aborted)d.state="unloaded",n(null);else if(g)d.state="errored",n(g);else if(x){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:T,expires:E});const C=ImageBitmap&&x instanceof ImageBitmap&&r.ak(),D=1-(x.width-r.al(x.width))/2;D<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const L=C?x:r.f.getImageData(x,D),z={uid:d.uid,coord:d.tileID,source:this.id,scope:this.scope,rawImageData:L,encoding:this.encoding,padding:D};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",z,f.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(d){const n=d.canonical,a=Math.pow(2,n.z),f=(n.x-1+a)%a,g=n.x===0?d.wrap-1:d.wrap,x=(n.x+1+a)%a,T=n.x+1===a?d.wrap+1:d.wrap,E={};return E[new r.am(d.overscaledZ,g,n.z,f,n.y).key]={backfilled:!1},E[new r.am(d.overscaledZ,T,n.z,x,n.y).key]={backfilled:!1},n.y>0&&(E[new r.am(d.overscaledZ,g,n.z,f,n.y-1).key]={backfilled:!1},E[new r.am(d.overscaledZ,d.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},E[new r.am(d.overscaledZ,T,n.z,x,n.y-1).key]={backfilled:!1}),n.y+1<a&&(E[new r.am(d.overscaledZ,g,n.z,f,n.y+1).key]={backfilled:!1},E[new r.am(d.overscaledZ,d.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},E[new r.am(d.overscaledZ,T,n.z,x,n.y+1).key]={backfilled:!1}),E}},"raster-array":xt,geojson:class extends r.E{constructor(d,n,a,f){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(f),this._data=n.data,this._options=r.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const g=r.V/this.tileSize;this.workerOptions=r.e({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*g,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*g,extent:r.V,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:r.V,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*g,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}getClusterExpansionZoom(d,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id,scope:this.scope},n),this}getClusterChildren(d,n){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id,scope:this.scope},n),this}getClusterLeaves(d,n,a,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:d,limit:n,offset:a},f),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.b("dataloading",{dataType:"source"})),this._loaded=!1;const d=r.e({},this.workerOptions);d.scope=this.scope;const n=this._data;typeof n=="string"?(d.request=this.map._requestManager.transformRequest(r.f.resolveURL(n),r.R.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,d,(a,f)=>{if(this._loaded=!0,this._pendingLoad=null,a)this.fire(new r.a(a));else{const g={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&f&&f.resourceTiming&&f.resourceTiming[this.id]&&(g.resourceTiming=f.resourceTiming[this.id]),this.fire(new r.b("data",g)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,n){const a=d.actor?"reloadTile":"loadTile";d.actor=this.actor;const f={type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:r.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};d.request=this.actor.send(a,f,(g,x)=>(delete d.request,d.destroy(),d.aborted?n(null):g?n(g):(d.loadVectorData(x,this.map.painter,a==="reloadTile"),n(null))),void 0,a==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d){this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope}),d.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.ap{constructor(d,n,a,f){super(d,n,a,f),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const n of d.urls)this.urls.push(this.map._requestManager.transformRequest(n,r.R.Source).url);r.aq(this.urls,(n,a)=>{this._loaded=!0,n?this.fire(new r.a(n)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const n=this.video.seekable;d<n.start(0)||d>n.end(0)?this.fire(new r.a(new qe(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,n=d.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(d,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.ap,model:class extends r.E{constructor(d,n,a,f){super(),this.id=d,this.type="model",this.models=[],this._loaded=!1,this._options=n}load(){const d=[];for(const n in this._options.models){const a=this._options.models[n],f=r.l(this.map._requestManager.transformRequest(a.uri,r.R.Model).url).then(g=>{if(!g)return;const x=r.c(g),T=new r.M(n,a.position,a.orientation,x);T.computeBoundsAndApplyParent(),this.models.push(T)}).catch(g=>{this.fire(new r.a(new Error(`Could not load model ${n} from ${a.uri}: ${g.message}`)))});d.push(f)}return Promise.allSettled(d).then(()=>{this._loaded=!0,this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(n=>{this.fire(new r.a(new Error(`Could not load models: ${n.message}`)))})}onAdd(d){this.map=d,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(d,n){}serialize(){return{type:"model"}}},"batched-model":class extends r.E{constructor(d,n,a,f){super(),this.type="batched-model",this.id=d,this.tileSize=512,this._options=n,this.tiles=this._options.tiles,this.maxzoom=n.maxzoom||19,this.minzoom=n.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=a,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(f)}onAdd(d){this.map=d,this.load()}load(d){this._loaded=!1,this.fire(new r.b("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map._worldview;this._tileJSONRequest=bt(this._options,this.map._requestManager,n,a,(f,g)=>{this._tileJSONRequest=null,this._loaded=!0,f?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new r.a(f))):g&&(r.e(this,g),g.bounds&&(this.tileBounds=new _t(g.bounds,this.minzoom,this.maxzoom)),r.aj(g.tiles,this.map._requestManager._customAccessToken),this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))),d&&d(f)})}hasTransition(){return!1}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}loaded(){return this._loaded}loadTile(d,n){const a=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(a,r.R.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:d.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(d.actor&&d.state!=="expired")if(d.state==="loading")d.reloadCallback=n;else{if(d.buckets){const x=Object.values(d.buckets);for(const T of x)T.dirty=!0;return void(d.state="loaded")}d.request=d.actor.send("reloadTile",f,g.bind(this))}else d.actor=this.dispatcher.getActor(),d.request=d.actor.send("loadTile",f,g.bind(this),void 0,!0);function g(x,T){return d.aborted?n(null):x&&x.status!==404?n(x):(T&&(T.resourceTiming&&(d.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&d.setExpiryData(T),d.buckets={...d.buckets,...T.buckets},T.featureIndex&&(d.latestFeatureIndex=T.featureIndex)),d.state="loaded",void n(null))}}serialize(){return r.e({},this._options)}},canvas:class extends r.ap{constructor(d,n,a,f){super(d,n,a,f),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(x=>typeof x!="number"))||this.fire(new r.a(new qe(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.a(new qe(`sources.${d}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new r.a(new qe(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new r.a(new qe(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.a(new qe(`sources.${d}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.a(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?!d&&!this._playing||this.texture instanceof r.ar||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends r.E{constructor(d,n,a,f){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=n,this.setEventedParent(f),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.a(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.a(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new _t(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),r.e(this,r.ac(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.ac(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this._map=d,this._loaded=!1,this.fire(new r.b("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){const{x:n,y:a,z:f}=d.canonical;return this._implementation.hasTile({x:n,y:a,z:f})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,n){const{x:a,y:f,z:g}=d.tileID.canonical,x=new AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:a,y:f,z:g},{signal:x.signal})).then((function(T){return delete d.request,d.aborted?(d.state="unloaded",n(null)):T===void 0?(d.state="errored",n(null)):T===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",n(null)):function(E){return E instanceof ImageData||E instanceof HTMLCanvasElement||E instanceof ImageBitmap||E instanceof HTMLImageElement}(T)?(this.loadTileData(d,T),d.state="loaded",void n(null)):(d.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(T=>{T.code!==20&&(d.state="errored",n(T))}),d.request.cancel=()=>x.abort()}loadTileData(d,n){d.setTexture(n,this._map.painter)}unloadTile(d,n){if(d.texture&&d.texture instanceof r.T?(d.destroy(!0),d.texture&&d.texture instanceof r.T&&this._map.painter.saveTileTexture(d.texture)):d.destroy(),this._implementation.unloadTile){const{x:a,y:f,z:g}=d.tileID.canonical;this._implementation.unloadTile({x:a,y:f,z:g})}n()}abortTile(d,n){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){const d=r.ag(this.id,this.scope);this._map.style.clearSource(d)}_update(){this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))}}},rr=function(d,n,a,f){const g=new Gs[n.type](d,n,a,f);if(g.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${g.id}`);return r.aY(["load","abort","unload","serialize","prepare"],g),g};function ch(d,n){const a=r.a6.identity([]);return r.a6.scale(a,a,[.5*d.width,.5*-d.height,1]),r.a6.translate(a,a,[1,-1,0]),r.a6.multiply(a,a,d.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(a)}function uh(d,n,a,f,g,x,T,E=!1){const C=d.tilesIn(f,T,E);C.sort(La);const D=[];for(const z of C)D.push({wrappedTileID:z.tile.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(n,a,d._state,z,g,x,ch(d.transform,z.tile.tileID),E)});const L=function(z){const B={},V={};for(const H of z){const W=H.queryResults,q=H.wrappedTileID,j=V[q]=V[q]||{};for(const Y in W){const re=W[Y],Q=j[Y]=j[Y]||{},se=B[Y]=B[Y]||[];for(const X of re)Q[X.featureIndex]||(Q[X.featureIndex]=!0,se.push(X))}}return B}(D);for(const z in L)L[z].forEach(B=>{const V=B.feature,H=V.layer;H&&H.type!=="background"&&H.type!=="sky"&&H.type!=="slot"&&(V.source=H.source,H["source-layer"]&&(V.sourceLayer=H["source-layer"]),V.state=V.id!==void 0?d.getFeatureState(H["source-layer"],V.id):{})});return L}function $s(d,n){const a=d.getRenderableIds().map(x=>d.getTileByID(x)),f=[],g={};for(let x=0;x<a.length;x++){const T=a[x],E=T.tileID.canonical.key;g[E]||(g[E]=!0,T.querySourceFeatures(f,n))}return f}function La(d,n){const a=d.tileID,f=n.tileID;return a.overscaledZ-f.overscaledZ||a.canonical.y-f.canonical.y||a.wrap-f.wrap||a.canonical.x-f.canonical.x}class qo extends mo{constructor(n,a,f,g,x){super(n,a,f,g,x),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(n,a){const f=a.context,g=f.gl;this.texture=this.texture||a.getTileTexture(n.width),this.texture&&this.texture instanceof r.T?this.texture.update(n,{useMipmap:!1,premultiply:!1}):this.texture=new r.T(f,n,g.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(n=16384,a){const f=this._mrt=new r.aZ(30),g=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=r.a_(g,(x,T,E,C)=>{if(x)a(x);else try{const D=f.getHeaderLength(T);if(D>n)return void(this.request=this.fetchHeader(D,a));f.parseHeader(T),this._isHeaderLoaded=!0;let L=0;for(const z of Object.values(f.layers))L=Math.max(L,z.dataIndex[z.dataIndex.length-1].last_byte);T.byteLength>=L&&(this.entireBuffer=T),a(null,this.entireBuffer||T,E,C)}catch(D){a(D)}}),this.request}fetchBand(n,a,f){const g=this._mrt;if(!this._isHeaderLoaded||!g)return void f(new Error("Tile header is not ready"));const x=this.actor;if(!x)return void f(new Error("Can't fetch tile band without an actor"));let T;const E=(z,B)=>{T.complete(z,B),z?f(z):(this.updateTextureDescriptor(n,a),f(null,this.textureDescriptor&&this.textureDescriptor.img))},C=(z,B)=>{if(z)return f(z);const V=x.send("decodeRasterArray",{buffer:B,task:T},E,void 0,!0);this._workQueue.push(()=>{V&&V.cancel(),T.cancel()})},D=g.getLayer(n);if(!D)return void f(new Error(`Unknown sourceLayer "${n}"`));if(D.hasDataForBand(a))return this.updateTextureDescriptor(n,a),void f(null,this.textureDescriptor?this.textureDescriptor.img:null);const L=D.getDataRange([a]);if(T=g.createDecodingTask(L),!T||T.tasks.length)if(this.flushQueues(),this.entireBuffer)C(null,this.entireBuffer.slice(L.firstByte,L.lastByte+1));else{const z=Object.assign({},this.requestParams,{headers:{Range:`bytes=${L.firstByte}-${L.lastByte}`}}),B=r.a_(z,C);this._fetchQueue.push(()=>{B.cancel(),T.cancel()})}else f(null)}updateNeeded(n,a){return(!this.textureDescriptor||this.textureDescriptor.band!==a||this.textureDescriptor.layer!==n)&&this.state!=="errored"}updateTextureDescriptor(n,a){if(!this._mrt)return;const f=this._mrt.getLayer(n);if(!f||!f.hasBand(a)||!f.hasDataForBand(a))return;const{bytes:g,tileSize:x,buffer:T,offset:E,scale:C}=f.getBandView(a),D=x+2*T,L={data:g,width:D,height:D},z=this.texture;z&&z instanceof r.T&&z.update(L,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:n,band:a,img:L,buffer:T,offset:E,tileSize:x,format:f.pixelFormat,mix:[C,256*C,65536*C,16777216*C]}}}class ka{constructor(n,a){this.max=n,this.onRemove=a,this.reset()}reset(){for(const n in this.data)for(const a of this.data[n])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(n,a,f){const g=n.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const x={value:a,timeout:void 0};if(f!==void 0&&(x.timeout=setTimeout(()=>{this.remove(n,x)},f)),this.data[g].push(x),this.order.push(g),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const a=this.data[n].shift();return a.timeout&&clearTimeout(a.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),a.value}getByKey(n){const a=this.data[n];return a?a[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,a){if(!this.has(n))return this;const f=n.wrapped().key,g=a===void 0?0:this.data[f].indexOf(a),x=this.data[f][g];return this.data[f].splice(g,1),x.timeout&&clearTimeout(x.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(x.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(n){const a=[];for(const f in this.data)for(const g of this.data[f])n(g.value)||a.push(g);for(const f of a)this.remove(f.value.tileID,f)}}class bs extends r.E{constructor(n,a,f){super(),this.id=n,this._onlySymbols=f,a.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new ka(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Qe,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles){const a=this._tiles[n];if(a.state!=="errored"&&(a.state!=="loaded"||!a.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,a){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,a)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n,()=>{})}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n,()=>{})}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const f=this._tiles[a];f.upload(n),f.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return r.a$(this._tiles).map(n=>n.tileID).sort(qc).map(n=>n.key)}getRenderableIds(n,a){const f=[];for(const g in this._tiles)this._isIdRenderable(+g,n,a)&&f.push(this._tiles[g]);return n?f.sort((g,x)=>{const T=g.tileID,E=x.tileID,C=new r.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle),D=new r.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return T.overscaledZ-E.overscaledZ||D.y-C.y||D.x-C.x}).map(g=>g.tileID.key):f.map(g=>g.tileID).sort(qc).map(g=>g.key)}hasRenderableParent(n){const a=this.findLoadedParent(n,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(n,a,f){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(a||!this._tiles[n].holdingForFade())&&(f||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,a){const f=this._tiles[n];f&&(f.state!=="loading"&&(f.state=a),this._loadTile(f,this._tileLoaded.bind(this,f,n,a)))}_tileLoaded(n,a,f,g){if(g)if(n.state="errored",g.status!==404)this._source.fire(new r.a(g,{tile:n}));else{if(!(n.tileID.key in this._loadedParentTiles))return void this._source.fire(new r.b("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const x=this.map.painter.terrain;this.update(this.transform,x.getScaledDemTileSize(),!0),x.resetTileLookupCache(this.id)}else this.update(this.transform)}else n.timeAdded=r.f.now(),f==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(a,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new r.b("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const a=this.getRenderableIds();for(let g=0;g<a.length;g++){const x=a[g];if(n.neighboringTiles&&n.neighboringTiles[x]){const T=this.getTileByID(x);f(n,T),f(T,n)}}function f(g,x){if(!g.dem||g.dem.borderReady)return;g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0;let T=x.tileID.canonical.x-g.tileID.canonical.x;const E=x.tileID.canonical.y-g.tileID.canonical.y,C=Math.pow(2,g.tileID.canonical.z),D=x.tileID.key;T===0&&E===0||Math.abs(E)>1||(Math.abs(T)>1&&(Math.abs(T+C)===1?T+=C:Math.abs(T-C)===1&&(T-=C)),x.dem&&g.dem&&(g.dem.backfillBorder(x.dem,T,E),g.neighboringTiles&&g.neighboringTiles[D]&&(g.neighboringTiles[D].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,a,f,g){for(const x in this._tiles){let T=this._tiles[x];if(g[x]||!T.hasData()||T.tileID.overscaledZ<=a||T.tileID.overscaledZ>f)continue;let E=T.tileID;for(;T&&T.tileID.overscaledZ>a+1;){const D=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[D.key],T&&T.hasData()&&(E=D)}let C=E;for(;C.overscaledZ>a;)if(C=C.scaledTo(C.overscaledZ-1),n[C.key]){g[E.key]=E;break}}}findLoadedParent(n,a){if(n.key in this._loadedParentTiles){const f=this._loadedParentTiles[n.key];return f&&f.tileID.overscaledZ>=a?f:null}for(let f=n.overscaledZ-1;f>=a;f--){const g=n.scaledTo(f),x=this._getLoadedTile(g);if(x)return x}}_getLoadedTile(n){const a=this._tiles[n.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,a){a=a||this._source.tileSize;const f=Math.ceil(n.width/a)+1,g=Math.ceil(n.height/a)+1,x=Math.floor(f*g*5),T=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,x):x,E=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._cache.setMaxSize(E)}handleWrapJump(n){const a=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,a){const f={};for(const g in this._tiles){const x=this._tiles[g];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+a),f[x.tileID.key]=x}this._tiles=f;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(+g,this._tiles[g])}}update(n,a,f,g){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!f)return;let x;if(this.updateCacheSize(n,a),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain)if(this._source.tileID)x=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(C=>new r.am(C.canonical.z,C.wrap,C.canonical.z,C.canonical.x,C.canonical.y));else if(this.tileCoverLift!==0){const C=n.clone();C.tileCoverLift=this.tileCoverLift,x=C.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&n.projection.name==="globe"&&(x.push(new r.am(1,0,1,0,0)),x.push(new r.am(1,0,1,1,0)),x.push(new r.am(1,0,1,0,1)),x.push(new r.am(1,0,1,1,1)))}else x=n.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(x=x.filter(C=>this._source.hasTile(C)));else x=[];if(x.length>0&&this.castsShadows&&g&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Ws(this._source.type)){const C=n.coveringZoomLevel({tileSize:a||this._source.tileSize,roundZoom:this._source.roundZoom&&!f}),D=Math.min(C,this._source.maxzoom),L=n.extendTileCoverForShadows(x,g,D);for(const z of L)this._shadowCasterTiles[z.key]=!0,x.push(z)}const T=this._updateRetainedTiles(x);if(Ws(this._source.type)&&x.length!==0){const C={},D={},L=Object.keys(T);for(const B of L){const V=T[B],H=this._tiles[B];if(!H||H.fadeEndTime&&H.fadeEndTime<=r.f.now())continue;const W=this.findLoadedParent(V,Math.max(V.overscaledZ-bs.maxOverzooming,this._source.minzoom));W&&(this._addTile(W.tileID),C[W.tileID.key]=W.tileID),D[B]=V}const z=x[x.length-1].overscaledZ;for(const B in this._tiles){const V=this._tiles[B];if(T[B]||!V.hasData())continue;let H=V.tileID;for(;H.overscaledZ>z;){H=H.scaledTo(H.overscaledZ-1);const W=this._tiles[H.key];if(W&&W.hasData()&&D[H.key]){T[B]=V.tileID;break}}}for(const B in C)T[B]||(this._coveredTiles[B]=!0,T[B]=C[B])}for(const C in T)this._tiles[C].clearFadeHold();const E=r.b0(this._tiles,T);for(const C of E){const D=this._tiles[C];D.hasSymbolBuckets&&!D.holdingForFade()?D.setHoldDuration(this.map._fadeDuration):D.hasSymbolBuckets&&!D.symbolFadeFinished()||this._removeTile(+C)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const a={};if(n.length===0)return a;const f={},g=n.reduce((D,L)=>Math.min(D,L.overscaledZ),1/0),x=n[0].overscaledZ,T=Math.max(x-bs.maxOverzooming,this._source.minzoom),E=Math.max(x+bs.maxUnderzooming,this._source.minzoom),C={};for(const D of n){const L=this._addTile(D);a[D.key]=D,L.hasData()||g<this._source.maxzoom&&(C[D.key]=D)}this._retainLoadedChildren(C,g,E,a);for(const D of n){let L=this._tiles[D.key];if(L.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const B=D.children(this._source.maxzoom)[0],V=this.getTile(B);if(V&&V.hasData()){a[B.key]=B;continue}}else{const B=D.children(this._source.maxzoom);if(a[B[0].key]&&a[B[1].key]&&a[B[2].key]&&a[B[3].key])continue}let z=L.wasRequested();for(let B=D.overscaledZ-1;B>=T;--B){const V=D.scaledTo(B);if(f[V.key]||(f[V.key]=!0,L=this.getTile(V),!L&&z&&(L=this._addTile(V)),L&&(a[V.key]=V,z=L.wasRequested(),L.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const a=[];let f,g=this._tiles[n].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){f=this._loadedParentTiles[g.key];break}a.push(g.key);const x=g.scaledTo(g.overscaledZ-1);if(f=this._getLoadedTile(x),f)break;g=x}for(const x of a)this._loadedParentTiles[x]=f}}_addTile(n){let a=this._tiles[n.key];if(a)return a.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),a;a=this._cache.getAndRemove(n),a&&(this._setTileReloadTimer(n.key,a),a.tileID=n,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,a)));const f=!!a;if(!f){const g=this.map?this.map.painter:null,x=this._source.tileSize*n.overscaleFactor();a=this._source.type==="raster-array"?new qo(n,x,this.transform.tileZoom,g,this._isRaster):new mo(n,x,this.transform.tileZoom,g,this._isRaster),this._loadTile(a,this._tileLoaded.bind(this,a,n.key,a.state))}return a?(a.uses++,this._tiles[n.key]=a,f||this._source.fire(new r.b("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(n,a){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const f=a.getExpiryTimeout();f&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},f))}_removeTile(n){const a=this._tiles[n];a&&(a.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),a.uses>0||(a.hasData()&&a.state!=="reloading"||a.state==="empty"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,a,f){const g=[],x=this.transform;if(!x)return g;const T=x.projection.name==="globe",E=r.a5(x.center.lng);for(const C in this._tiles){const D=this._tiles[C];if(f&&D.clearQueryDebugViz(),D.holdingForFade())continue;let L;if(T){const z=D.tileID.canonical;if(z.z===0){const B=[Math.abs(r.aa(E,...Pl(z,-1))-E),Math.abs(r.aa(E,...Pl(z,1))-E)];L=[0,2*B.indexOf(Math.min(...B))-1]}else{const B=[Math.abs(r.aa(E,...Pl(z,-1))-E),Math.abs(r.aa(E,...Pl(z,0))-E),Math.abs(r.aa(E,...Pl(z,1))-E)];L=[B.indexOf(Math.min(...B))-1]}}else L=[0];for(const z of L){const B=n.containsTile(D,x,a,z);B&&g.push(B)}}return g}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,a){const f=this.getRenderableIds(n,a).map(x=>this._tiles[x].tileID),g=this.transform.projection.name==="globe";for(const x of f)x.projMatrix=this.transform.calculateProjMatrix(x.toUnwrapped()),x.expandedProjMatrix=g?this.transform.calculateProjMatrix(x.toUnwrapped(),!1,!0):x.projMatrix;return f}sortCoordinatesByDistance(n){const a=n.slice(),f=this.transform._camera.position,g=this.transform._camera.forward(),x={};for(const T of a){const E=1/(1<<T.canonical.z);x[T.key]=((T.canonical.x+.5)*E+T.wrap-f[0])*g[0]+((T.canonical.y+.5)*E-f[1])*g[1]-f[2]*g[2]}return a.sort((T,E)=>x[T.key]-x[E.key]),a}hasTransition(){if(this._source.hasTransition())return!0;if(Ws(this._source.type))for(const n in this._tiles){const a=this._tiles[n];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=r.f.now())return!0}return!1}setFeatureState(n,a,f){this._state.updateState(n=n||"_geojsonTileLayer",a,f)}removeFeatureState(n,a,f){this._state.removeFeatureState(n=n||"_geojsonTileLayer",a,f)}getFeatureState(n,a){return this._state.getState(n=n||"_geojsonTileLayer",a)}setDependencies(n,a,f){const g=this._tiles[n];g&&g.setDependencies(a,f)}reloadTilesForDependencies(n,a){for(const f in this._tiles)this._tiles[f].hasDependency(n,a)&&this._reloadTile(+f,"reloading");this._cache.filter(f=>!f.hasDependency(n,a))}_preloadTiles(n,a){if(!this._sourceLoaded){const C=()=>{this._sourceLoaded&&(this._source.off("data",C),this._preloadTiles(n,a))};return void this._source.on("data",C)}const f=new Map,g=Array.isArray(n)?n:[n],x=this.map.painter.terrain,T=this.usedForTerrain&&x?x.getScaledDemTileSize():this._source.tileSize;for(const C of g){const D=C.coveringTiles({tileSize:T,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const L of D)f.set(L.key,L);this.usedForTerrain&&C.updateElevation(!1)}const E=Array.from(f.values());r.b1(E,(C,D)=>{const L=new mo(C,this._source.tileSize*C.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(L,z=>{this._source.type==="raster-dem"&&L.dem&&this._backfillDEM(L),D(z,L)})},a)}}function qc(d,n){const a=Math.abs(2*d.wrap)-+(d.wrap<0),f=Math.abs(2*n.wrap)-+(n.wrap<0);return d.overscaledZ-n.overscaledZ||f-a||n.canonical.y-d.canonical.y||n.canonical.x-d.canonical.x}function Ws(d){return d==="raster"||d==="image"||d==="video"||d==="custom"}function Pl(d,n){const a=1<<d.z;return[d.x/a+n,(d.x+1)/a+n]}bs.maxOverzooming=10,bs.maxUnderzooming=3;class Xf{constructor(n){this.style=n,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const n=!1,a=!1;for(const f in this.style._mergedLayers){const g=this.style._mergedLayers[f];if(g.type==="fill-extrusion")this.layers.push({layer:g,visible:n,visibilityChanged:a});else if(g.type==="model"){const x=this.style.getLayerSource(g);x&&x.type==="batched-model"&&this.layers.push({layer:g,visible:n,visibilityChanged:a})}}}onNewFrame(n){this.layersGotHidden=!1;for(const a of this.layers){const f=a.layer;let g=!1;f.type==="fill-extrusion"?g=!f.isHidden(n)&&f.paint.get("fill-extrusion-opacity")>0:f.type==="model"&&(g=!f.isHidden(n)&&f.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!g&&a.visible,a.visible=g}}updateZOffset(n,a){this.currentBuildingBuckets=[];for(const g of this.layers){const x=g.layer,T=this.style.getLayerSourceCache(x);let E=1;x.type==="fill-extrusion"&&(E=g.visible?x.paint.get("fill-extrusion-vertical-scale"):0);let C=T?T.getTile(a):null;if(!C&&T&&a.canonical.z>T.getSource().minzoom){let D=a.scaledTo(Math.min(T.getSource().maxzoom,a.overscaledZ-1));for(;D.overscaledZ>=T.getSource().minzoom&&(C=T.getTile(D),!C&&D.overscaledZ!==0);)D=D.scaledTo(D.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:C?C.getBucket(x):null,tileID:C?C.tileID:a,verticalScale:E})}n.hasAnyZOffset=!1;let f=!1;for(let g=0;g<n.symbolInstances.length;g++){const x=n.symbolInstances.get(g),T=x.zOffset,E=this._getHeightAtTileOffset(a,x.tileAnchorX,x.tileAnchorY);x.zOffset=E!==Number.NEGATIVE_INFINITY?E:T,f||T===x.zOffset||(f=!0),n.hasAnyZOffset||x.zOffset===0||(n.hasAnyZOffset=!0)}f&&(n.zOffsetBuffersNeedUpload=!0,n.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(n,a,f,g){let x=a,T=f;if(n.canonical.z!==g.canonical.z){const E=g.canonical,C=1/(1<<n.canonical.z-E.z);x=(a+n.canonical.x*r.V)*C-E.x*r.V|0,T=(f+n.canonical.y*r.V)*C-E.y*r.V|0}return{tileX:x,tileY:T}}_getHeightAtTileOffset(n,a,f){let g,x;for(let T=0;T<this.layers.length;++T){if(this.layers[T].layer.type!=="fill-extrusion")continue;const{bucket:E,tileID:C,verticalScale:D}=this.currentBuildingBuckets[T];if(!E)continue;const{tileX:L,tileY:z}=this._mapCoordToOverlappingTile(n,a,f,C),B=E.getHeightAtTileCoord(L,z);B&&B.height!==void 0&&(B.hidden?g=B.height:x=Math.max(B.height*D,x||0))}if(x!==void 0)return x;for(let T=0;T<this.layers.length;++T){const E=this.layers[T];if(E.layer.type!=="model"||!E.visible)continue;const{bucket:C,tileID:D}=this.currentBuildingBuckets[T];if(!C)continue;const{tileX:L,tileY:z}=this._mapCoordToOverlappingTile(n,a,f,D),B=C.getHeightAtTileCoord(L,z);if(B&&!B.hidden)return B.height===void 0&&g!==void 0?Math.min(B.maxHeight,g)*B.verticalScale:(B.height||0)*B.verticalScale}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Zo(d,n){const a={};for(const f in d)f!=="ref"&&(a[f]=d[f]);return r.b2.forEach(f=>{f in n&&(a[f]=n[f])}),a}function Yf(d){d=d.slice();const n=Object.create(null);for(let a=0;a<d.length;a++)n[d[a].id]=d[a];for(let a=0;a<d.length;a++)"ref"in d[a]&&(d[a]=Zo(d[a],n[d[a].ref]));return d}const Oi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Dl(d,n,a){a.push({command:Oi.addSource,args:[d,n[d]]})}function hh(d,n,a){n.push({command:Oi.removeSource,args:[d]}),a[d]=!0}function q_(d,n,a,f){hh(d,a,f),Dl(d,n,a)}function Z_(d,n,a){let f;for(f in d[a])if(d[a].hasOwnProperty(f)&&f!=="data"&&!k(d[a][f],n[a][f]))return!1;for(f in n[a])if(n[a].hasOwnProperty(f)&&f!=="data"&&!k(d[a][f],n[a][f]))return!1;return!0}function _o(d,n,a,f,g,x){let T;for(T in n=n||{},d=d||{})d.hasOwnProperty(T)&&(k(d[T],n[T])||a.push({command:x,args:[f,T,n[T],g]}));for(T in n)n.hasOwnProperty(T)&&!d.hasOwnProperty(T)&&(k(d[T],n[T])||a.push({command:x,args:[f,T,n[T],g]}))}function go(d){return d.id}function Zc(d,n){return d[n.id]=n,d}class Ra{constructor(n,a){this.reset(n,a)}reset(n,a){this.points=n||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=r.aa(n,0,1);let a=1,f=this._distances[a];const g=n*this.paddedLength+this.padding;for(;f<g&&a<this._distances.length;)f=this._distances[++a];const x=a-1,T=this._distances[x],E=f-T,C=E>0?(g-T)/E:0;return this.points[x].mult(1-C).add(this.points[a].mult(C))}}class dh{constructor(n,a,f){const g=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(n/f),this.yCellCount=Math.ceil(a/f);for(let T=0;T<this.xCellCount*this.yCellCount;T++)g.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=a,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,a,f,g,x){this._forEachCell(a,f,g,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(a),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(x)}insertCircle(n,a,f,g){this._forEachCell(a-g,f-g,a+g,f+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(a),this.circles.push(f),this.circles.push(g)}_insertBoxCell(n,a,f,g,x,T){this.boxCells[x].push(T)}_insertCircleCell(n,a,f,g,x,T){this.circleCells[x].push(T)}_query(n,a,f,g,x,T){if(f<0||n>this.width||g<0||a>this.height)return!x&&[];const E=[];if(n<=0&&a<=0&&this.width<=f&&this.height<=g){if(x)return!0;for(let C=0;C<this.boxKeys.length;C++)E.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const D=this.circles[3*C],L=this.circles[3*C+1],z=this.circles[3*C+2];E.push({key:this.circleKeys[C],x1:D-z,y1:L-z,x2:D+z,y2:L+z})}return T?E.filter(T):E}return this._forEachCell(n,a,f,g,this._queryCell,E,{hitTest:x,seenUids:{box:{},circle:{}}},T),x?E.length>0:E}_queryCircle(n,a,f,g,x){const T=n-f,E=n+f,C=a-f,D=a+f;if(E<0||T>this.width||D<0||C>this.height)return!g&&[];const L=[];return this._forEachCell(T,C,E,D,this._queryCellCircle,L,{hitTest:g,circle:{x:n,y:a,radius:f},seenUids:{box:{},circle:{}}},x),g?L.length>0:L}query(n,a,f,g,x){return this._query(n,a,f,g,!1,x)}hitTest(n,a,f,g,x){return this._query(n,a,f,g,!0,x)}hitTestCircle(n,a,f,g){return this._queryCircle(n,a,f,!0,g)}_queryCell(n,a,f,g,x,T,E,C){const D=E.seenUids,L=this.boxCells[x];if(L!==null){const B=this.bboxes;for(const V of L)if(!D.box[V]){D.box[V]=!0;const H=4*V;if(n<=B[H+2]&&a<=B[H+3]&&f>=B[H+0]&&g>=B[H+1]&&(!C||C(this.boxKeys[V]))){if(E.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[V],x1:B[H],y1:B[H+1],x2:B[H+2],y2:B[H+3]})}}}const z=this.circleCells[x];if(z!==null){const B=this.circles;for(const V of z)if(!D.circle[V]){D.circle[V]=!0;const H=3*V;if(this._circleAndRectCollide(B[H],B[H+1],B[H+2],n,a,f,g)&&(!C||C(this.circleKeys[V]))){if(E.hitTest)return T.push(!0),!0;{const W=B[H],q=B[H+1],j=B[H+2];T.push({key:this.circleKeys[V],x1:W-j,y1:q-j,x2:W+j,y2:q+j})}}}}}_queryCellCircle(n,a,f,g,x,T,E,C){const D=E.circle,L=E.seenUids,z=this.boxCells[x];if(z!==null){const V=this.bboxes;for(const H of z)if(!L.box[H]){L.box[H]=!0;const W=4*H;if(this._circleAndRectCollide(D.x,D.y,D.radius,V[W+0],V[W+1],V[W+2],V[W+3])&&(!C||C(this.boxKeys[H])))return T.push(!0),!0}}const B=this.circleCells[x];if(B!==null){const V=this.circles;for(const H of B)if(!L.circle[H]){L.circle[H]=!0;const W=3*H;if(this._circlesCollide(V[W],V[W+1],V[W+2],D.x,D.y,D.radius)&&(!C||C(this.circleKeys[H])))return T.push(!0),!0}}}_forEachCell(n,a,f,g,x,T,E,C){const D=this._convertToXCellCoord(n),L=this._convertToYCellCoord(a),z=this._convertToXCellCoord(f),B=this._convertToYCellCoord(g);for(let V=D;V<=z;V++)for(let H=L;H<=B;H++)if(x.call(this,n,a,f,g,this.xCellCount*H+V,T,E,C))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,a,f,g,x,T){const E=g-n,C=x-a,D=f+T;return D*D>E*E+C*C}_circleAndRectCollide(n,a,f,g,x,T,E){const C=(T-g)/2,D=Math.abs(n-(g+C));if(D>C+f)return!1;const L=(E-x)/2,z=Math.abs(a-(x+L));if(z>L+f)return!1;if(D<=C||z<=L)return!0;const B=D-C,V=z-L;return B*B+V*V<=f*f}}const Hs={unknown:0,flipRequired:1,flipNotRequired:2},yo=Math.tan(85*Math.PI/180);function Ll(d,n,a,f,g,x,T){const E=r.a6.create();if(a)if(x.name==="globe"){const C=r.b3(g,n);r.a6.multiply(E,E,C)}else{const C=r.b4.invert([],T);E[0]=C[0],E[1]=C[1],E[4]=C[2],E[5]=C[3],f||r.a6.rotateZ(E,E,g.angle)}else r.a6.multiply(E,g.labelPlaneMatrix,d);return E}function fh(d,n,a,f,g,x,T){const E=Ll(d,n,a,f,g,x,T);return x.name==="globe"&&a||(E[2]=E[6]=E[10]=E[14]=0),E}function ph(d,n,a,f,g,x,T){if(a){if(x.name==="globe"){const E=Ll(d,n,a,f,g,x,T);return r.a6.invert(E,E),r.a6.multiply(E,d,E),E}{const E=r.a6.clone(d),C=r.a6.identity([]);return C[0]=T[0],C[1]=T[1],C[4]=T[2],C[5]=T[3],r.a6.multiply(E,E,C),f||r.a6.rotateZ(E,E,-g.angle),E}}return g.glCoordMatrix}function cs(d,n,a,f){const g=[d,n,a,1];a?r.a7.transformMat4(g,g,f):vh(g,g,f);const x=g[3];return g[0]/=x,g[1]/=x,g[2]/=x,g}function Kf(d,n){return Math.min(.5+d/n*.5,1.5)}function mh(d,n){const a=d[0]/d[3],f=d[1]/d[3];return a>=-n[0]&&a<=n[0]&&f>=-n[1]&&f<=n[1]}function _h(d,n,a,f,g,x,T,E,C,D){const L=a.transform,z=f?d.textSizeData:d.iconSizeData,B=r.b5(z,a.transform.zoom),V=L.projection.name==="globe",H=[256/a.width*2+1,256/a.height*2+1],W=f?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;W.clear();let q=null;V&&(q=f?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);const j=d.lineVertexArray,Y=f?d.text.placedSymbolArray:d.icon.placedSymbolArray,re=a.transform.width/a.transform.height;let Q,se=!1;for(let X=0;X<Y.length;X++){const oe=Y.get(X),{numGlyphs:ue,writingMode:de}=oe;if(de!==r.b6.vertical||se||Q===r.b6.horizontal||(se=!0),Q=de,(oe.hidden||de===r.b6.vertical)&&!se){xo(ue,W);continue}se=!1;const _e=new r.P(oe.tileAnchorX,oe.tileAnchorY);let{x:Pe,y:be,z:Ne}=L.projection.projectTilePoint(_e.x,_e.y,D.canonical);if(C){const[Et,Wt,Jt]=C(_e);Pe+=Et,be+=Wt,Ne+=Jt}const Oe=[Pe,be,Ne,1];if(r.a7.transformMat4(Oe,Oe,n),!mh(Oe,H)){xo(ue,W);continue}const et=Oe[3],Me=Kf(a.transform.getCameraToCenterDistance(L.projection),et),ke=r.b7(z,B,oe),me=T?ke/Me:ke*Me,Ae=cs(Pe,be,Ne,g);if(Ae[3]<=0){xo(ue,W);continue}let it={};const pt=T?null:C,ht=xh(oe,me,!1,E,n,g,x,d.glyphOffsetArray,j,W,q,Ae,_e,it,re,pt,L.projection,D,T);se=ht.useVertical,pt&&ht.needsFlipping&&(it={}),(ht.notEnoughRoom||se||ht.needsFlipping&&xh(oe,me,!0,E,n,g,x,d.glyphOffsetArray,j,W,q,Ae,_e,it,re,pt,L.projection,D,T).notEnoughRoom)&&xo(ue,W)}f?(d.text.dynamicLayoutVertexBuffer.updateData(W),q&&d.text.globeExtVertexBuffer&&d.text.globeExtVertexBuffer.updateData(q)):(d.icon.dynamicLayoutVertexBuffer.updateData(W),q&&d.icon.globeExtVertexBuffer&&d.icon.globeExtVertexBuffer.updateData(q))}function gh(d,n,a,f,g,x,T,E,C,D,L,z,B,V,H,W){const{lineStartIndex:q,glyphStartIndex:j,segment:Y}=E,re=j+E.numGlyphs,Q=q+E.lineLength,se=n.getoffsetX(j),X=n.getoffsetX(re-1),oe=kl(d*se,a,f,g,x,T,Y,q,Q,C,D,L,z,B,!0,V,H,W);if(!oe)return null;const ue=kl(d*X,a,f,g,x,T,Y,q,Q,C,D,L,z,B,!0,V,H,W);return ue?{first:oe,last:ue}:null}function yh(d,n,a,f){return d===r.b6.horizontal&&Math.abs(f)>Math.abs(a)?{useVertical:!0}:d===r.b6.vertical?f>0?{needsFlipping:!0}:null:n!==Hs.unknown&&function(g,x){return g===0||Math.abs(x/g)>yo}(a,f)?n===Hs.flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null}function xh(d,n,a,f,g,x,T,E,C,D,L,z,B,V,H,W,q,j,Y){const re=n/24,Q=d.lineOffsetX*re,se=d.lineOffsetY*re,{lineStartIndex:X,glyphStartIndex:oe,numGlyphs:ue,segment:de,writingMode:_e,flipState:Pe}=d,be=X+d.lineLength,Ne=Oe=>{if(L){const[me,Ae,it]=Oe.up,pt=D.length;r.b8(L,pt+0,me,Ae,it),r.b8(L,pt+1,me,Ae,it),r.b8(L,pt+2,me,Ae,it),r.b8(L,pt+3,me,Ae,it)}const[et,Me,ke]=Oe.point;r.b9(D,et,Me,ke,Oe.angle)};if(ue>1){const Oe=gh(re,E,Q,se,a,z,B,d,C,x,V,W,!1,q,j,Y);if(!Oe)return{notEnoughRoom:!0};if(f&&!a){let[et,Me,ke]=Oe.first.point,[me,Ae,it]=Oe.last.point;[et,Me]=cs(et,Me,ke,T),[me,Ae]=cs(me,Ae,it,T);const pt=yh(_e,Pe,(me-et)*H,Ae-Me);if(d.flipState=pt&&pt.needsFlipping?Hs.flipRequired:Hs.flipNotRequired,pt)return pt}Ne(Oe.first);for(let et=oe+1;et<oe+ue-1;et++){const Me=kl(re*E.getoffsetX(et),Q,se,a,z,B,de,X,be,C,x,V,W,!1,!1,q,j,Y);if(!Me)return D.length-=4*(et-oe),{notEnoughRoom:!0};Ne(Me)}Ne(Oe.last)}else{if(f&&!a){const et=cs(B.x,B.y,0,g),Me=X+de+1,ke=new r.P(C.getx(Me),C.gety(Me)),me=cs(ke.x,ke.y,0,g),Ae=me[3]>0?me:Xc(B,ke,et,1,g,void 0,q,j.canonical),it=yh(_e,Pe,(Ae[0]-et[0])*H,Ae[1]-et[1]);if(d.flipState=it&&it.needsFlipping?Hs.flipRequired:Hs.flipNotRequired,it)return it}const Oe=kl(re*E.getoffsetX(oe),Q,se,a,z,B,de,X,be,C,x,V,W,!1,!1,q,j,Y);if(!Oe)return{notEnoughRoom:!0};Ne(Oe)}return{}}function za(d,n,a,f,g){const{x,y:T,z:E}=f.projectTilePoint(d.x,d.y,n);if(!g)return cs(x,T,E,a);const[C,D,L]=g(d);return cs(x+C,T+D,E+L,a)}function Xc(d,n,a,f,g,x,T,E){const C=za(d.sub(n)._unit()._add(d),E,g,T,x);return r.N.sub(C,a,C),r.N.normalize(C,C),r.N.scaleAndAdd(C,a,C,f)}function kl(d,n,a,f,g,x,T,E,C,D,L,z,B,V,H,W,q,j){const Y=f?d-n:d+n;let re=Y>0?1:-1,Q=0;f&&(re*=-1,Q=Math.PI),re<0&&(Q+=Math.PI);let se=E+T+(re>0?0:1)|0,X=g,oe=g,ue=0,de=0;const _e=Math.abs(Y),Pe=[],be=[];let Ne=x,Oe=Ne;const et=()=>Xc(Oe,Ne,oe,_e-ue+1,L,B,W,q.canonical);for(;ue+de<=_e;){if(se+=re,se<E||se>=C)return null;if(oe=X,Oe=Ne,Pe.push(oe),V&&be.push(Oe),Ne=new r.P(D.getx(se),D.gety(se)),X=z[se],!X){const Wt=za(Ne,q.canonical,L,W,B);X=Wt[3]>0?z[se]=Wt:et()}ue+=de,de=r.N.distance(oe,X)}H&&B&&(z[se]&&(X=et(),de=r.N.distance(oe,X)),z[se]=X);const Me=(_e-ue)/de,ke=Ne.sub(Oe)._mult(Me)._add(Oe),me=r.N.sub([],X,oe),Ae=r.N.scaleAndAdd([],oe,me,Me);let it=[0,0,1],pt=me[0],ht=me[1];if(j&&(it=W.upVector(q.canonical,ke.x,ke.y),it[0]!==0||it[1]!==0||it[2]!==1)){const Wt=[it[2],0,-it[0]],Jt=r.N.cross([],it,Wt);r.N.normalize(Wt,Wt),r.N.normalize(Jt,Jt),pt=r.N.dot(me,Wt),ht=r.N.dot(me,Jt)}if(a){const Wt=r.N.cross([],it,me);r.N.normalize(Wt,Wt),r.N.scaleAndAdd(Ae,Ae,Wt,a*re)}const Et=Q+Math.atan2(ht,pt);return Pe.push(Ae),V&&be.push(ke),{point:Ae,angle:Et,path:Pe,tilePath:be,up:it}}function xo(d,n){const a=n.length,f=a+4*d;n.resize(f),n.float32.fill(-1/0,4*a,4*f)}function vh(d,n,a){const f=n[0],g=n[1];return d[0]=a[0]*f+a[4]*g+a[12],d[1]=a[1]*f+a[5]*g+a[13],d[3]=a[3]*f+a[7]*g+a[15],d}const us=100;class Pt{constructor(n,a,f=new dh(n.width+200,n.height+200,25),g=new dh(n.width+200,n.height+200,25)){this.transform=n,this.grid=f,this.ignoredGrid=g,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+us,this.screenBottomBoundary=n.height+us,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=a}placeCollisionBox(n,a,f,g,x,T,E,C){let D=f.projectedAnchorX,L=f.projectedAnchorY,z=f.projectedAnchorZ;const B=f.elevation,V=f.tileID,H=n.getProjection();if(B&&V){const[X,oe,ue]=H.upVector(V.canonical,f.tileAnchorX,f.tileAnchorY),de=H.upVectorScale(V.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;D+=X*B*de,L+=oe*B*de,z+=ue*B*de}const W=this.projectAndGetPerspectiveRatio(E,D,L,z,f.tileID,H.name==="globe"||!!B||this.transform.pitch>0,H),q=T*W.perspectiveRatio,j=(f.x1*a+g.x-f.padding)*q+W.point.x,Y=(f.y1*a+g.y-f.padding)*q+W.point.y,re=(f.x2*a+g.x+f.padding)*q+W.point.x,Q=(f.y2*a+g.y+f.padding)*q+W.point.y,se=W.perspectiveRatio<=.55||W.occluded;return!this.isInsideGrid(j,Y,re,Q)||!x&&this.grid.hitTest(j,Y,re,Q,C)||se?{box:[],offscreen:!1,occluded:W.occluded}:{box:[j,Y,re,Q],offscreen:this.isOffscreen(j,Y,re,Q),occluded:!1}}placeCollisionCircles(n,a,f,g,x,T,E,C,D,L,z,B,V,H,W){const q=[],j=this.transform.elevation,Y=n.getProjection(),re=j?j.getAtTileOffsetFunc(W,this.transform.center.lat,this.transform.worldSize,Y):null,Q=new r.P(f.tileAnchorX,f.tileAnchorY);let{x:se,y:X,z:oe}=Y.projectTilePoint(Q.x,Q.y,W.canonical);if(re){const[ke,me,Ae]=re(Q);se+=ke,X+=me,oe+=Ae}const ue=Y.name==="globe",de=this.projectAndGetPerspectiveRatio(E,se,X,oe,W,ue||!!j||this.transform.pitch>0,Y),{perspectiveRatio:_e}=de,Pe=(z?T/_e:T*_e)/r.bc,be=cs(se,X,oe,C),Ne=de.signedDistanceFromCamera>0?gh(Pe,x,f.lineOffsetX*Pe,f.lineOffsetY*Pe,!1,be,Q,f,g,C,{},j&&!z?re:null,z&&!!j,Y,W,z):null;let Oe=!1,et=!1,Me=!0;if(Ne&&!de.occluded){const ke=.5*V*_e+H,me=new r.P(-100,-100),Ae=new r.P(this.screenRightBoundary,this.screenBottomBoundary),it=new Ra,{first:pt,last:ht}=Ne,Et=pt.path.length;let Wt=[];for(let Yt=Et-1;Yt>=1;Yt--)Wt.push(pt.path[Yt]);for(let Yt=1;Yt<ht.path.length;Yt++)Wt.push(ht.path[Yt]);const Jt=2.5*ke;D&&(Wt=Wt.map(([Yt,vi,ui],mi)=>(re&&!ue&&(ui=re(mi<Et-1?pt.tilePath[Et-1-mi]:ht.tilePath[mi-Et+2])[2]),cs(Yt,vi,ui,D))),Wt.some(Yt=>Yt[3]<=0)&&(Wt=[]));let qt=[];if(Wt.length>0){let Yt=1/0,vi=-1/0,ui=1/0,mi=-1/0;for(const pi of Wt)Yt=Math.min(Yt,pi[0]),ui=Math.min(ui,pi[1]),vi=Math.max(vi,pi[0]),mi=Math.max(mi,pi[1]);vi>=me.x&&Yt<=Ae.x&&mi>=me.y&&ui<=Ae.y&&(qt=[Wt.map(pi=>new r.P(pi[0],pi[1]))],(Yt<me.x||vi>Ae.x||ui<me.y||mi>Ae.y)&&(qt=r.ba(qt,me.x,me.y,Ae.x,Ae.y)))}for(const Yt of qt){it.reset(Yt,.25*ke);let vi=0;vi=it.length<=.5*ke?1:Math.ceil(it.paddedLength/Jt)+1;for(let ui=0;ui<vi;ui++){const mi=ui/Math.max(vi-1,1),pi=it.lerp(mi),Fi=pi.x+us,gn=pi.y+us;q.push(Fi,gn,ke,0);const Ci=Fi-ke,Bn=gn-ke,Pi=Fi+ke,ji=gn+ke;if(Me=Me&&this.isOffscreen(Ci,Bn,Pi,ji),et=et||this.isInsideGrid(Ci,Bn,Pi,ji),!a&&this.grid.hitTestCircle(Fi,gn,ke,B)&&(Oe=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Oe,occluded:!1}}}}return{circles:!L&&Oe||!et?[]:q,offscreen:Me,collisionDetected:Oe,occluded:de.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let f=1/0,g=1/0,x=-1/0,T=-1/0;for(const L of n){const z=new r.P(L.x+us,L.y+us);f=Math.min(f,z.x),g=Math.min(g,z.y),x=Math.max(x,z.x),T=Math.max(T,z.y),a.push(z)}const E=this.grid.query(f,g,x,T).concat(this.ignoredGrid.query(f,g,x,T)),C={},D={};for(const L of E){const z=L.key;if(C[z.bucketInstanceId]===void 0&&(C[z.bucketInstanceId]={}),C[z.bucketInstanceId][z.featureIndex])continue;const B=[new r.P(L.x1,L.y1),new r.P(L.x2,L.y1),new r.P(L.x2,L.y2),new r.P(L.x1,L.y2)];r.bb(a,B)&&(C[z.bucketInstanceId][z.featureIndex]=!0,D[z.bucketInstanceId]===void 0&&(D[z.bucketInstanceId]=[]),D[z.bucketInstanceId].push(z.featureIndex))}return D}insertCollisionBox(n,a,f,g,x){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:g,collisionGroupID:x},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,a,f,g,x){const T=a?this.ignoredGrid:this.grid,E={bucketInstanceId:f,featureIndex:g,collisionGroupID:x};for(let C=0;C<n.length;C+=4)T.insertCircle(E,n[C],n[C+1],n[C+2])}projectAndGetPerspectiveRatio(n,a,f,g,x,T,E){const C=[a,f,g,1];let D=!1;g||this.transform.pitch>0?(r.a7.transformMat4(C,C,n),this.fogState&&x&&E.name!=="globe"&&(D=function(B,V,H,W,q,j){const Y=j.calculateFogTileMatrix(q),re=[V,H,W];return r.N.transformMat4(re,re,Y),Zi(B,r.N.length(re),j.pitch,j._fov)}(this.fogState,a,f,g,x.toUnwrapped(),this.transform)>.9)):vh(C,C,n);const L=C[3];return{point:new r.P((C[0]/L+1)/2*this.transform.width+us,(-C[1]/L+1)/2*this.transform.height+us),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(E)/L*.5,1.5),signedDistanceFromCamera:L,occluded:T&&C[2]>L||D}}isOffscreen(n,a,f,g){return f<us||n>=this.screenRightBoundary||g<us||a>this.screenBottomBoundary}isInsideGrid(n,a,f,g){return f>=0&&n<this.gridRightBoundary&&g>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const n=r.a6.identity([]);return r.a6.translate(n,n,[-100,-100,0]),n}}function Yc(d,n,a){const f=n.createTileMatrix(d,d.worldSize,a.toUnwrapped());return r.a6.multiply(new Float32Array(16),d.projMatrix,f)}function bh(d,n,a){if(n.projection.name===a.projection.name)return d.projMatrix;const f=a.clone();return f.setProjection(n.projection),Yc(f,n.getProjection(),d)}function Rl(d,n,a){return n.name===a.projection.name?d.projMatrix:Yc(a,n,d)}class wh{constructor(n,a,f,g){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?a:-a))):g&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class vo{constructor(n,a,f,g,x,T=!1){this.text=new wh(n?n.text:null,a,f,x),this.icon=new wh(n?n.icon:null,a,g,x),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ws{constructor(n,a,f,g=!1){this.text=n,this.icon=a,this.skipFade=f,this.clipped=g}}class Th{constructor(){this.invProjMatrix=r.a6.create(),this.viewportMatrix=r.a6.create(),this.circles=[]}}class Xo{constructor(n,a,f,g,x){this.bucketInstanceId=n,this.featureIndex=a,this.sourceLayerIndex=f,this.bucketIndex=g,this.tileID=x}}class Kc{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const a=++this.maxGroupID;this.collisionGroups[n]={ID:a,predicate:f=>f.collisionGroupID===a}}return this.collisionGroups[n]}}function Yo(d,n,a,f,g){const{horizontalAlign:x,verticalAlign:T}=r.bf(d),E=-(x-.5)*n,C=-(T-.5)*a,D=r.bd(d,f);return new r.P(E+D[0]*g,C+D[1]*g)}function Mh(d,n,a,f,g){const x=new r.P(d,n);return a&&x._rotate(f?g:-g),x}class X_{constructor(n,a,f,g,x,T){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new Pt(this.transform,x),this.buildingIndex=T,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new Kc(f),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,a,f,g){const x=f.getBucket(a),T=f.latestFeatureIndex;if(!x||!T||a.fqid!==x.layerIds[0])return;const E=x.layers[0].layout,C=f.collisionBoxArray,D=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),L=f.tileSize/r.V,z=f.tileID.toUnwrapped();this.transform.setProjection(x.projection);const B=(V=f.tileID,H=x.getProjection(),W=this.transform,H.name===this.projection?W.calculateProjMatrix(V.toUnwrapped()):Yc(W,H,V));var V,H,W;const q=E.get("text-pitch-alignment")==="map",j=E.get("text-rotation-alignment")==="map";a.compileFilter();const Y=a.dynamicFilter(),re=a.dynamicFilterNeedsFeature(),Q=this.transform.calculatePixelsToTileUnitsMatrix(f),se=fh(B,f.tileID.canonical,q,j,this.transform,x.getProjection(),Q);let X=null;if(q){const de=ph(B,f.tileID.canonical,q,j,this.transform,x.getProjection(),Q);X=r.a6.multiply([],this.transform.labelPlaneMatrix,de)}let oe=null;Y&&f.latestFeatureIndex&&(oe={unwrappedTileID:z,dynamicFilter:Y,dynamicFilterNeedsFeature:re,featureIndex:f.latestFeatureIndex}),this.retainedQueryData[x.bucketInstanceId]=new Xo(x.bucketInstanceId,T,x.sourceLayerIndex,x.index,f.tileID);const ue={bucket:x,layout:E,posMatrix:B,textLabelPlaneMatrix:se,labelToScreenMatrix:X,clippingData:oe,scale:D,textPixelRatio:L,holdingForFade:f.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:r.b5(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:r.b5(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(g)for(const de of x.sortKeyRanges){const{sortKey:_e,symbolInstanceStart:Pe,symbolInstanceEnd:be}=de;n.push({sortKey:_e,symbolInstanceStart:Pe,symbolInstanceEnd:be,parameters:ue})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:ue})}attemptAnchorPlacement(n,a,f,g,x,T,E,C,D,L,z,B,V,H,W,q,j,Y){const{textOffset0:re,textOffset1:Q,crossTileID:se}=B,X=[re,Q],oe=Yo(n,f,g,X,x),ue=this.collisionIndex.placeCollisionBox(H,x,a,Mh(oe.x,oe.y,T,E,this.transform.angle),z,C,D,L.predicate);if(q){const de=H.getSymbolInstanceIconSize(Y,this.transform.zoom,B.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(H,de,q,Mh(oe.x,oe.y,T,E,this.transform.angle),z,C,D,L.predicate).box.length===0)return}if(ue.box.length>0){let de;return this.prevPlacement&&this.prevPlacement.variableOffsets[se]&&this.prevPlacement.placements[se]&&this.prevPlacement.placements[se].text&&(de=this.prevPlacement.variableOffsets[se].anchor),this.variableOffsets[se]={textOffset:X,width:f,height:g,anchor:n,textScale:x,prevAnchor:de},this.markUsedJustification(H,n,B,W),H.allowVerticalPlacement&&(this.markUsedOrientation(H,W,B),this.placedOrientations[se]=W),{shift:oe,placedGlyphBoxes:ue}}}placeLayerBucketPart(n,a,f,g){const{bucket:x,layout:T,posMatrix:E,textLabelPlaneMatrix:C,labelToScreenMatrix:D,clippingData:L,textPixelRatio:z,holdingForFade:B,collisionBoxArray:V,partiallyEvaluatedTextSize:H,partiallyEvaluatedIconSize:W,collisionGroup:q}=n.parameters,j=T.get("text-optional"),Y=T.get("icon-optional"),re=T.get("text-allow-overlap"),Q=T.get("icon-allow-overlap"),se=T.get("text-rotation-alignment")==="map",X=T.get("text-pitch-alignment")==="map",oe=T.get("symbol-z-order")==="viewport-y",ue=T.get("symbol-z-elevate");this.transform.setProjection(x.projection);let de=re&&(Q||!x.hasIconData()||Y),_e=Q&&(re||!x.hasTextData()||j);!x.collisionArrays&&V&&x.deserializeCollisionBoxes(V),f&&g&&x.updateCollisionDebugBuffers(this.transform.zoom,V);const Pe=(be,Ne,Oe)=>{const{crossTileID:et,numVerticalGlyphVertices:Me}=be;if(L){const Pi={zoom:this.transform.zoom,pitch:this.transform.pitch};let ji=null;if(L.dynamicFilterNeedsFeature){const Di=this.retainedQueryData[x.bucketInstanceId];ji=L.featureIndex.loadFeature({featureIndex:be.featureIndex,bucketIndex:Di.bucketIndex,sourceLayerIndex:Di.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,L.dynamicFilter)(Pi,ji,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new r.P(be.tileAnchorX,be.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[et]=new ws(!1,!1,!1,!0),void a.add(et)}if(a.has(et))return;if(B)return void(this.placements[et]=new ws(!1,!1,!1));let ke=!1,me=!1,Ae=!0,it=!1,pt=!1,ht=null,Et={box:null,offscreen:null,occluded:null},Wt={box:null,offscreen:null,occluded:null},Jt=null,qt=null,Yt=null,vi=0,ui=0,mi=0;Oe.textFeatureIndex?vi=Oe.textFeatureIndex:be.useRuntimeCollisionCircles&&(vi=be.featureIndex),Oe.verticalTextFeatureIndex&&(ui=Oe.verticalTextFeatureIndex);const pi=Pi=>{Pi.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;const ji=this.transform.elevation;Pi.elevation=be.zOffset+(ji?ji.getAtTileOffset(Pi.tileID,Pi.tileAnchorX,Pi.tileAnchorY):0)},Fi=Oe.textBox;if(Fi){pi(Fi);const Pi=Di=>{let Ui=r.b6.horizontal;if(x.allowVerticalPlacement&&!Di&&this.prevPlacement){const Tn=this.prevPlacement.placedOrientations[et];Tn&&(this.placedOrientations[et]=Tn,Ui=Tn,this.markUsedOrientation(x,Ui,be))}return Ui},ji=(Di,Ui)=>{if(x.allowVerticalPlacement&&Me>0&&Oe.verticalTextBox){for(const Tn of x.writingModes)if(Tn===r.b6.vertical?(Et=Ui(),Wt=Et):Et=Di(),Et&&Et.box&&Et.box.length)break}else Et=Di()};if(T.get("text-variable-anchor")){let Di=T.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[et]){const qi=this.prevPlacement.variableOffsets[et];Di.indexOf(qi.anchor)>0&&(Di=Di.filter(dr=>dr!==qi.anchor),Di.unshift(qi.anchor))}const Ui=(qi,dr,Ar)=>{const Hr=x.getSymbolInstanceTextSize(H,be,this.transform.zoom,Ne),Bs=(qi.x2-qi.x1)*Hr+2*qi.padding,qr=(qi.y2-qi.y1)*Hr+2*qi.padding,fr=be.hasIconTextFit&&!Q?dr:null;fr&&pi(fr);let sr={box:[],offscreen:!1,occluded:!1};const kr=re?2*Di.length:Di.length;for(let Nr=0;Nr<kr;++Nr){const Zr=this.attemptAnchorPlacement(Di[Nr%Di.length],qi,Bs,qr,Hr,se,X,z,E,q,Nr>=Di.length,be,Ne,x,Ar,fr,H,W);if(Zr&&(sr=Zr.placedGlyphBoxes,sr&&sr.box&&sr.box.length)){ke=!0,ht=Zr.shift;break}}return sr};ji(()=>Ui(Fi,Oe.iconBox,r.b6.horizontal),()=>{const qi=Oe.verticalTextBox;return qi&&pi(qi),x.allowVerticalPlacement&&!(Et&&Et.box&&Et.box.length)&&Me>0&&qi?Ui(qi,Oe.verticalIconBox,r.b6.vertical):{box:null,offscreen:null,occluded:null}}),Et&&(ke=Et.box,Ae=Et.offscreen,it=Et.occluded);const Tn=Pi(!(!Et||!Et.box));if(!ke&&this.prevPlacement){const qi=this.prevPlacement.variableOffsets[et];qi&&(this.variableOffsets[et]=qi,this.markUsedJustification(x,qi.anchor,be,Tn))}}else{const Di=(Ui,Tn)=>{const qi=x.getSymbolInstanceTextSize(H,be,this.transform.zoom,Ne),dr=this.collisionIndex.placeCollisionBox(x,qi,Ui,new r.P(0,0),re,z,E,q.predicate);return dr&&dr.box&&dr.box.length&&(this.markUsedOrientation(x,Tn,be),this.placedOrientations[et]=Tn),dr};ji(()=>Di(Fi,r.b6.horizontal),()=>{const Ui=Oe.verticalTextBox;return x.allowVerticalPlacement&&Me>0&&Ui?(pi(Ui),Di(Ui,r.b6.vertical)):{box:null,offscreen:null,occluded:null}}),Pi(!!(Et&&Et.box&&Et.box.length))}}if(Jt=Et,ke=Jt&&Jt.box&&Jt.box.length>0,Ae=Jt&&Jt.offscreen,it=Jt&&Jt.occluded,be.useRuntimeCollisionCircles){const Pi=x.text.placedSymbolArray.get(be.centerJustifiedTextSymbolIndex>=0?be.centerJustifiedTextSymbolIndex:be.verticalPlacedTextSymbolIndex),ji=r.b7(x.textSizeData,H,Pi),Di=T.get("text-padding");qt=this.collisionIndex.placeCollisionCircles(x,re,Pi,x.lineVertexArray,x.glyphOffsetArray,ji,E,C,D,f,X,q.predicate,be.collisionCircleDiameter*ji/r.bc,Di,this.retainedQueryData[x.bucketInstanceId].tileID),ke=re||qt.circles.length>0&&!qt.collisionDetected,Ae=Ae&&qt.offscreen,it=qt.occluded}if(Oe.iconFeatureIndex&&(mi=Oe.iconFeatureIndex),Oe.iconBox){const Pi=ji=>{pi(ji);const Di=be.hasIconTextFit&&ht?Mh(ht.x,ht.y,se,X,this.transform.angle):new r.P(0,0),Ui=x.getSymbolInstanceIconSize(W,this.transform.zoom,be.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,Ui,ji,Di,Q,z,E,q.predicate)};Wt&&Wt.box&&Wt.box.length&&Oe.verticalIconBox?(Yt=Pi(Oe.verticalIconBox),me=Yt.box.length>0):(Yt=Pi(Oe.iconBox),me=Yt.box.length>0),Ae=Ae&&Yt.offscreen,pt=Yt.occluded}const gn=j||be.numHorizontalGlyphVertices===0&&Me===0,Ci=Y||be.numIconVertices===0;if(gn||Ci?Ci?gn||(me=me&&ke):ke=me&&ke:me=ke=me&&ke,ke&&Jt&&Jt.box&&this.collisionIndex.insertCollisionBox(Jt.box,T.get("text-ignore-placement"),x.bucketInstanceId,Wt&&Wt.box&&ui?ui:vi,q.ID),me&&Yt&&this.collisionIndex.insertCollisionBox(Yt.box,T.get("icon-ignore-placement"),x.bucketInstanceId,mi,q.ID),qt&&(ke&&this.collisionIndex.insertCollisionCircles(qt.circles,T.get("text-ignore-placement"),x.bucketInstanceId,vi,q.ID),f)){const Pi=x.bucketInstanceId;let ji=this.collisionCircleArrays[Pi];ji===void 0&&(ji=this.collisionCircleArrays[Pi]=new Th);for(let Di=0;Di<qt.circles.length;Di+=4)ji.circles.push(qt.circles[Di+0]),ji.circles.push(qt.circles[Di+1]),ji.circles.push(qt.circles[Di+2]),ji.circles.push(qt.collisionDetected?1:0)}const Bn=x.projection.name!=="globe";de=de&&(Bn||!it),_e=_e&&(Bn||!pt),this.placements[et]=new ws(ke||de,me||_e,Ae||x.justReloaded),a.add(et)};if(ue&&this.buildingIndex&&(this.buildingIndex.updateZOffset(x,this.retainedQueryData[x.bucketInstanceId].tileID),x.updateZOffset()),oe){const be=x.getSortedSymbolIndexes(this.transform.angle);for(let Ne=be.length-1;Ne>=0;--Ne){const Oe=be[Ne];Pe(x.symbolInstances.get(Oe),Oe,x.collisionArrays[Oe])}x.hasAnyZOffset&&r.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){const be=x.getSortedIndexesByZOffset();for(let Ne=0;Ne<be.length;++Ne){const Oe=be[Ne];Pe(x.symbolInstances.get(Oe),Oe,x.collisionArrays[Oe])}}else for(let be=n.symbolInstanceStart;be<n.symbolInstanceEnd;be++)Pe(x.symbolInstances.get(be),be,x.collisionArrays[be]);if(f&&x.bucketInstanceId in this.collisionCircleArrays){const be=this.collisionCircleArrays[x.bucketInstanceId];r.a6.invert(be.invProjMatrix,E),be.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(n,a,f,g){const{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:E,verticalPlacedTextSymbolIndex:C,crossTileID:D}=f,L=r.be(a),z=g===r.b6.vertical?C:L==="left"?x:L==="center"?T:L==="right"?E:-1;x>=0&&(n.text.placedSymbolArray.get(x).crossTileID=z>=0&&x!==z?0:D),T>=0&&(n.text.placedSymbolArray.get(T).crossTileID=z>=0&&T!==z?0:D),E>=0&&(n.text.placedSymbolArray.get(E).crossTileID=z>=0&&E!==z?0:D),C>=0&&(n.text.placedSymbolArray.get(C).crossTileID=z>=0&&C!==z?0:D)}markUsedOrientation(n,a,f){const g=a===r.b6.horizontal||a===r.b6.horizontalOnly?a:0,x=a===r.b6.vertical?a:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:D}=f,L=n.text.placedSymbolArray;T>=0&&(L.get(T).placedOrientation=g),E>=0&&(L.get(E).placedOrientation=g),C>=0&&(L.get(C).placedOrientation=g),D>=0&&(L.get(D).placedOrientation=x)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let f=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const g=a?a.symbolFadeChange(n):1,x=a?a.opacities:{},T=a?a.variableOffsets:{},E=a?a.placedOrientations:{};for(const C in this.placements){const D=this.placements[C],L=x[C];L?(this.opacities[C]=new vo(L,g,D.text,D.icon,null,D.clipped),f=f||D.text!==L.text.placed||D.icon!==L.icon.placed):(this.opacities[C]=new vo(null,g,D.text,D.icon,D.skipFade,D.clipped),f=f||D.text||D.icon)}for(const C in x){const D=x[C];if(!this.opacities[C]){const L=new vo(D,g,!1,!1);L.isHidden()||(this.opacities[C]=L,f=f||D.text.placed||D.icon.placed)}}for(const C in T)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=T[C]);for(const C in E)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=E[C]);f?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:n)}updateLayerOpacities(n,a){const f=new Set;for(const g of a){const x=g.getBucket(n);x&&g.latestFeatureIndex&&n.fqid===x.layerIds[0]&&(this.updateBucketOpacities(x,f,g.collisionBoxArray),x.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(x,g.tileID),x.updateZOffset()))}}updateBucketOpacities(n,a,f){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const g=n.layers[0].layout,x=!!n.layers[0].dynamicFilter(),T=new vo(null,0,!1,!1,!0),E=g.get("text-allow-overlap"),C=g.get("icon-allow-overlap"),D=g.get("text-variable-anchor"),L=g.get("text-rotation-alignment")==="map",z=g.get("text-pitch-alignment")==="map",B=new vo(null,0,E&&(C||!n.hasIconData()||g.get("icon-optional")),C&&(E||!n.hasTextData()||g.get("text-optional")),!0);!n.collisionArrays&&f&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(f);const V=(W,q,j)=>{for(let Y=0;Y<q/4;Y++)W.opacityVertexArray.emplaceBack(j)};let H=0;for(let W=0;W<n.symbolInstances.length;W++){const q=n.symbolInstances.get(W),{numHorizontalGlyphVertices:j,numVerticalGlyphVertices:Y,crossTileID:re,numIconVertices:Q}=q,se=a.has(re);let X=this.opacities[re];se?X=T:X||(X=B,this.opacities[re]=X),a.add(re);const oe=j>0||Y>0,ue=Q>0,de=this.placedOrientations[re],_e=de===r.b6.vertical,Pe=de===r.b6.horizontal||de===r.b6.horizontalOnly;if(!oe&&!ue||X.isHidden()||H++,oe){const be=ep(X.text);V(n.text,j,_e?zl:be),V(n.text,Y,Pe?zl:be);const Ne=X.text.isHidden(),{leftJustifiedTextSymbolIndex:Oe,centerJustifiedTextSymbolIndex:et,rightJustifiedTextSymbolIndex:Me,verticalPlacedTextSymbolIndex:ke}=q,me=n.text.placedSymbolArray,Ae=Ne||_e?1:0;Oe>=0&&(me.get(Oe).hidden=Ae),et>=0&&(me.get(et).hidden=Ae),Me>=0&&(me.get(Me).hidden=Ae),ke>=0&&(me.get(ke).hidden=Ne||Pe?1:0);const it=this.variableOffsets[re];it&&this.markUsedJustification(n,it.anchor,q,de);const pt=this.placedOrientations[re];pt&&(this.markUsedJustification(n,"left",q,pt),this.markUsedOrientation(n,pt,q))}if(ue){const be=ep(X.icon),{placedIconSymbolIndex:Ne,verticalPlacedIconSymbolIndex:Oe}=q,et=n.icon.placedSymbolArray,Me=X.icon.isHidden()?1:0;Ne>=0&&(V(n.icon,Q,_e?zl:be),et.get(Ne).hidden=Me),Oe>=0&&(V(n.icon,q.numVerticalIconVertices,Pe?zl:be),et.get(Oe).hidden=Me)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const be=n.collisionArrays[W];if(be){let Ne=new r.P(0,0),Oe=!0;if(be.textBox||be.verticalTextBox){if(D){const Me=this.variableOffsets[re];Me?(Ne=Yo(Me.anchor,Me.width,Me.height,Me.textOffset,Me.textScale),L&&Ne._rotate(z?this.transform.angle:-this.transform.angle)):Oe=!1}x&&(Oe=!X.clipped),be.textBox&&Oa(n.textCollisionBox.collisionVertexArray,X.text.placed,!Oe||_e,Ne.x,Ne.y),be.verticalTextBox&&Oa(n.textCollisionBox.collisionVertexArray,X.text.placed,!Oe||Pe,Ne.x,Ne.y)}const et=Oe&&!!(!Pe&&be.verticalIconBox);be.iconBox&&Oa(n.iconCollisionBox.collisionVertexArray,X.icon.placed,et,q.hasIconTextFit?Ne.x:0,q.hasIconTextFit?Ne.y:0),be.verticalIconBox&&Oa(n.iconCollisionBox.collisionVertexArray,X.icon.placed,!et,q.hasIconTextFit?Ne.x:0,q.hasIconTextFit?Ne.y:0)}}}if(n.fullyClipped=H===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const W=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=W.invProjMatrix,n.placementViewportMatrix=W.viewportMatrix,n.collisionCircleArray=W.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,a){const f=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*f>n}setStale(){this.stale=!0}}function Oa(d,n,a,f,g){d.emplaceBack(n?1:0,a?1:0,f||0,g||0),d.emplaceBack(n?1:0,a?1:0,f||0,g||0),d.emplaceBack(n?1:0,a?1:0,f||0,g||0),d.emplaceBack(n?1:0,a?1:0,f||0,g||0)}const Y_=Math.pow(2,25),Jf=Math.pow(2,24),Qf=Math.pow(2,17),Sh=Math.pow(2,16),K_=Math.pow(2,9),J_=Math.pow(2,8),Q_=Math.pow(2,1);function ep(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const n=d.placed?1:0,a=Math.floor(127*d.opacity);return a*Y_+n*Jf+a*Qf+n*Sh+a*K_+n*J_+a*Q_+n}const zl=0;class eg{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,a,f,g,x){const T=this._bucketParts;for(;this._currentTileIndex<n.length;)if(a.getBucketParts(T,g,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((E,C)=>E.sortKey-C.sortKey));this._currentPartIndex<T.length;){const E=T[this._currentPartIndex];if(a.placeLayerBucketPart(E,this._seenCrossTileIDs,f,E.symbolInstanceStart===0),this._currentPartIndex++,x())return!0}return!1}}class Jc{constructor(n,a,f,g,x,T,E,C,D){this.placement=new X_(n,x,T,E,C,D),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(n,a,f,g){const x=r.f.now(),T=()=>{const E=r.f.now()-x;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=a[n[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=C)&&(!E.maxzoom||E.maxzoom>C)){const D=E,L=D.layout.get("symbol-z-elevate"),z=this._inProgressLayer=this._inProgressLayer||new eg(D),B=r.ag(E.source,E.scope);if(z.continuePlacement(L?g[B]:f[B],this.placement,this._showCollisionBoxes,E,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Eh=512/r.V/2;class tp{constructor(n,a,f){this.tileID=n,this.bucketInstanceId=f,this.index=new r.bg(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const g=n.canonical.x*r.V,x=n.canonical.y*r.V;for(let T=0;T<a.length;T++){const{key:E,crossTileID:C,tileAnchorX:D,tileAnchorY:L}=a.get(T),z=Math.floor((g+D)*Eh),B=Math.floor((x+L)*Eh);this.index.add(z,B),this.keys.push(E),this.crossTileIDs.push(C)}this.index.finish()}findMatches(n,a,f){const g=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),x=Eh/Math.pow(2,a.canonical.z-this.tileID.canonical.z),T=a.canonical.x*r.V,E=a.canonical.y*r.V;for(let C=0;C<n.length;C++){const D=n.get(C);if(D.crossTileID)continue;const{key:L,tileAnchorX:z,tileAnchorY:B}=D,V=Math.floor((T+z)*x),H=Math.floor((E+B)*x),W=this.index.range(V-g,H-g,V+g,H+g);for(const q of W){const j=this.crossTileIDs[q];if(this.keys[q]===L&&!f.has(j)){f.add(j),D.crossTileID=j;break}}}}}class Ah{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Qc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const a=Math.round((n-this.lng)/360);if(a!==0)for(const f in this.indexes){const g=this.indexes[f],x={};for(const T in g){const E=g[T];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+a),x[E.tileID.key]=E}this.indexes[f]=x}this.lng=n}addBucket(n,a,f){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let x=0;x<a.symbolInstances.length;x++)a.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const g=this.usedCrossTileIDs[n.overscaledZ];for(const x in this.indexes){const T=this.indexes[x];if(Number(x)>n.overscaledZ)for(const E in T){const C=T[E];C.tileID.isChildOf(n)&&C.findMatches(a.symbolInstances,n,g)}else{const E=T[n.scaledTo(Number(x)).key];E&&E.findMatches(a.symbolInstances,n,g)}}for(let x=0;x<a.symbolInstances.length;x++){const T=a.symbolInstances.get(x);T.crossTileID||(T.crossTileID=f.generate(),g.add(T.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new tp(n,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(n,a){for(const f of a.crossTileIDs)this.usedCrossTileIDs[n].delete(f)}removeStaleBuckets(n){let a=!1;for(const f in this.indexes){const g=this.indexes[f];for(const x in g)n[g[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,g[x]),delete g[x],a=!0)}return a}}class Ih{constructor(){this.layerIndexes={},this.crossTileIDs=new Ah,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,a,f,g){let x=this.layerIndexes[n.fqid];x===void 0&&(x=this.layerIndexes[n.fqid]=new Qc);let T=!1;const E={};g.name!=="globe"&&x.handleWrapJump(f);for(const C of a){const D=C.getBucket(n);D&&n.fqid===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(C.tileID,D,this.crossTileIDs)&&(T=!0),E[D.bucketInstanceId]=!0)}return x.removeStaleBuckets(E)&&(T=!0),T}pruneUnusedLayers(n){const a={};n.forEach(f=>{a[f]=!0});for(const f in this.layerIndexes)a[f]||delete this.layerIndexes[f]}}class Ko{constructor(n=0,a=0,f=0,g=0){if(isNaN(n)||n<0||isNaN(a)||a<0||isNaN(f)||f<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=a,this.left=f,this.right=g}interpolate(n,a,f){return a.top!=null&&n.top!=null&&(this.top=r.U(n.top,a.top,f)),a.bottom!=null&&n.bottom!=null&&(this.bottom=r.U(n.bottom,a.bottom,f)),a.left!=null&&n.left!=null&&(this.left=r.U(n.left,a.left,f)),a.right!=null&&n.right!=null&&(this.right=r.U(n.right,a.right,f)),this}getCenter(n,a){const f=r.aa((this.left+n-this.right)/2,0,n),g=r.aa((this.top+a-this.bottom)/2,0,a);return new r.P(f,g)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new Ko(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function eu(d,n){const a=r.bk(d,3);r.a6.fromQuat(d,n),r.bm(d,3,a)}function Ol(d,n){const a=r.bi.identity([]);return r.bi.rotateZ(a,a,-n),r.bi.rotateX(a,a,-d),a}function Ch(d,n){const a=[d[0],d[1],0],f=[n[0],n[1],0];if(r.N.length(a)>=1e-15){const T=r.N.normalize([],a);r.N.scale(f,T,r.N.dot(f,T)),n[0]=f[0],n[1]=f[1]}const g=r.N.cross([],n,d);if(r.N.len(g)<1e-15)return null;const x=Math.atan2(-g[1],g[0]);return Ol(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),x)}class Fl{constructor(n,a){this.position=n,this.orientation=a}get position(){return this._position}set position(n){if(n){const a=n instanceof r.L?n:new r.L(n[0],n[1],n[2]);this._renderWorldCopies&&(a.x=r.bh(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(n,a){if(this.orientation=null,!this.position)return;const f=this.position,g=this._elevation?this._elevation.getAtPointOrZero(r.L.fromLngLat(n)):0,x=r.L.fromLngLat(n,g),T=[x.x-f.x,x.y-f.y,x.z-f.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=Ch(T,a)}setPitchBearing(n,a){this.orientation=Ol(r.bj(n),r.bj(-a))}}class Fa{constructor(n,a){this._transform=r.a6.identity([]),this.orientation=a,this.position=n}get mercatorPosition(){const n=this.position;return new r.L(n[0],n[1],n[2])}get position(){const n=r.bk(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var a;n&&r.bm(this._transform,3,[(a=n)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||r.bi.identity([]),n&&eu(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,a){this._orientation=Ol(n,a),eu(this._transform,this._orientation)}forward(){const n=r.bk(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=r.bk(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=r.bk(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,a){const f=new Float64Array(16);return r.a6.invert(f,this.getWorldToCamera(n,a)),f}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(n,a,f){const g=this.position;r.N.scale(g,g,-n);const x=new Float64Array(16);return r.a6.fromScaling(x,[f,f,f]),r.a6.translate(x,x,g),x[10]*=a,x}getWorldToCamera(n,a){const f=new Float64Array(16),g=new Float64Array(4),x=this.position;return r.bi.conjugate(g,this._orientation),r.N.scale(x,x,-n),r.a6.fromQuat(f,g),r.a6.translate(f,f,x),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=a,f[9]*=a,f[10]*=a,f[11]*=a,f}getCameraToClipPerspective(n,a,f,g){const x=new Float64Array(16);return r.a6.perspective(x,n,a,f,g),x}getCameraToClipOrthographic(n,a,f,g,x,T){const E=new Float64Array(16);return r.a6.ortho(E,n,a,f,g,x,T),E}getDistanceToElevation(n,a=!1){const f=n===0?0:r.bl(n,a?r.au(this.position[1]):this.position[1]),g=this.forward();return(f-this.position[2])/g[2]}clone(){return new Fa([...this.position],[...this.orientation])}}const Ba=(d,n,a)=>(1-a)*d+a*n,Bl=d=>d*d*d*d*d;class Nl{constructor(n,a,f,g,x,T,E){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=n||0,this._maxZoom=a||22,this._minPitch=f??0,this._maxPitch=g??60,this.setProjection(T),this.setMaxBounds(E),this.width=0,this.height=0,this._center=new r.bn(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ko,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Fa,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const n=new Nl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(n,a=!1){const f=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||f)&&this._updateCameraOnTerrain(),(n||f)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return r.ac(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=r.bo(this.projectionOptions);const f=!k(a,this.getProjection());return f&&this._calcMatrices(),this.mercatorFromTransition=!1,f}setOrthographicProjectionAtLowPitch(n){return this._orthographicProjectionAtLowPitch!==n&&(this._orthographicProjectionAtLowPitch=n,this._calcMatrices(),!0)}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.bo({name:"mercator"});const a=n!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.bl(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bh(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const a=-n*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=r.b4.create(),r.b4.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const a=r.aa(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=r.bj(n),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const a=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(n){this._tileCoverLift!==n&&(this._tileCoverLift=n)}_updateCameraOnTerrain(){const n=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,a=this.elevation&&n===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||n===Number.NEGATIVE_INFINITY&&(!a||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const f=this._elevation;a||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&f.exaggeration()&&this._centerAltitudeValidForExaggeration!==f.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*f.exaggeration(),this._centerAltitudeValidForExaggeration=f.exaggeration()):(this._centerAltitude=n||0,this._centerAltitudeValidForExaggeration=f.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop();let g=0,x=0;for(let T=0;T<a.length;T++){const E=new r.P(a[T][0]*this.width,f+a[T][1]*(this.height-f)),C=n.pointCoordinate(E);if(!C)continue;const D=1/Math.hypot(C[0]-this._camera.position[0],C[1]-this._camera.position[1]);g+=C[3]*D,x+=D}return x===0?NaN:g/x}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*a,g=this._mercatorZfromZoom(n),x=this._mercatorZfromZoom(this._maxZoom),T=Math.max(g-f,x);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let f;f=n.z<this._camera.position[2]?[a.x,a.y,a.z]:[n.x,n.y,n.z];const g=r.N.length(r.N.sub([],this._camera.position,f));return r.aa(this._zoomFromMercatorZ(g),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let a=!1;if(n.orientation&&!r.bi.exactEquals(n.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(n.orientation)),n.position){const f=[n.position.x,n.position.y,n.position.z];r.N.exactEquals(f,this._camera.position)||(this._setCameraPosition(f),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,a=new Fl;return a.position=new r.L(n[0],n[1],n[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(n){if(!r.bi.length(n))return!1;r.bi.normalize(n,n);const a=r.N.transformQuat([],[0,0,-1],n),f=r.N.transformQuat([],[0,-1,0],n);if(f[2]<0)return!1;const g=Ch(a,f);return!!g&&(this._camera.orientation=g,!0)}_setCameraPosition(n){const a=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,g=this.cameraToCenterDistance;n[2]=r.aa(n[2],g/f,g/a),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,a,f){this._unmodified=!1,this._edgeInsets.interpolate(n,a,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const a=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(n){const a=[new r.bp(0,n)];if(this.renderWorldCopies){const f=this.pointCoordinate(new r.P(0,0)),g=this.pointCoordinate(new r.P(this.width,0)),x=this.pointCoordinate(new r.P(this.width,this.height)),T=this.pointCoordinate(new r.P(0,this.height)),E=Math.floor(Math.min(f.x,g.x,x.x,T.x)),C=Math.floor(Math.max(f.x,g.x,x.x,T.x)),D=1;for(let L=E-D;L<=C+D;L++)L!==0&&a.push(new r.bp(L,n))}return a}isLODDisabled(n){return(!n||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(n,a,f){let g=[];if(a[0]===0&&a[1]===0)return g;for(const T of n){const E=T.canonical,C=T.overscaledZ,D=T.wrap,L=1<<E.z,z=E.x+1<L,B=E.x>0,V=E.y+1<L,H=E.y>0,W=T.wrap-(B?0:1),q=T.wrap+(z?0:1),j=B?E.x-1:L-1,Y=z?E.x+1:0;a[0]<0?(g.push(new r.am(C,q,E.z,Y,E.y)),a[1]<0&&V&&(g.push(new r.am(C,D,E.z,E.x,E.y+1)),g.push(new r.am(C,q,E.z,Y,E.y+1))),a[1]>0&&H&&(g.push(new r.am(C,D,E.z,E.x,E.y-1)),g.push(new r.am(C,q,E.z,Y,E.y-1)))):a[0]>0?(g.push(new r.am(C,W,E.z,j,E.y)),a[1]<0&&V&&(g.push(new r.am(C,D,E.z,E.x,E.y+1)),g.push(new r.am(C,W,E.z,j,E.y+1))),a[1]>0&&H&&(g.push(new r.am(C,D,E.z,E.x,E.y-1)),g.push(new r.am(C,W,E.z,j,E.y-1)))):a[1]<0&&V?g.push(new r.am(C,D,E.z,E.x,E.y+1)):H&&g.push(new r.am(C,D,E.z,E.x,E.y-1))}if(g.length>1){g.sort((C,D)=>C.overscaledZ-D.overscaledZ||C.wrap-D.wrap||C.canonical.z-D.canonical.z||C.canonical.x-D.canonical.x||C.canonical.y-D.canonical.y);let T=0,E=0;for(;E<g.length;)g[E].equals(g[T])?++E:g[++T]=g[E++];g.length=T+1}const x=[];for(const T of g)g.some(E=>T.isChildOf(E))||x.push(T);return g=x.filter(T=>!n.some(E=>!!(T.overscaledZ<f&&E.isChildOf(T))||T.equals(E)||T.isChildOf(E))),g}coveringTiles(n){let a=this.coveringZoomLevel(n);const f=a,g=this.elevation&&this.elevation.exaggeration(),x=g&&!n.isTerrainDEM,T=this.projection.name==="mercator";if(n.minzoom!==void 0&&a<n.minzoom)return[];n.maxzoom!==void 0&&a>n.maxzoom&&(a=n.maxzoom);const E=this.locationCoordinate(this.center),C=this.center.lat,D=1<<a,L=[D*E.x,D*E.y,0],z=this.projection.name==="globe",B=!z,V=r.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,B),H=z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),W=D*r.bl(1,this.center.lat),q=this._camera.position[2]/r.bl(1,this.center.lat),j=[D*H.x,D*H.y,q*(B?1:W)],Y=z||g,re=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),Q=this.isLODDisabled(!0)?a:0;let se;if(this._elevation&&n.isTerrainDEM)se=1e4*this._elevation.exaggeration();else if(this._elevation){const me=this._elevation.getMinMaxForVisibleTiles();se=me?me.max:this._centerAltitude}else se=this._centerAltitude;const X=n.isTerrainDEM?-se:this._elevation?this._elevation.getMinElevationBelowMSL():0,oe=this.projection.isReprojectedInTileSpace?r.br(this):1,ue=me=>{const it=new r.L(me.x+25e-6,me.y,me.z),pt=new r.L(me.x,me.y+25e-6,me.z),ht=me.toLngLat(),Et=it.toLngLat(),Wt=pt.toLngLat(),Jt=this.locationCoordinate(ht),qt=this.locationCoordinate(Et),Yt=this.locationCoordinate(Wt),vi=Math.hypot(qt.x-Jt.x,qt.y-Jt.y),ui=Math.hypot(Yt.x-Jt.x,Yt.y-Jt.y);return Math.sqrt(vi*ui)*oe/25e-6},de=me=>{const Ae=se,it=X;return{aabb:r.bu(this,D,0,0,0,me,it,Ae,this.projection),zoom:0,x:0,y:0,minZ:it,maxZ:Ae,wrap:me,fullyVisible:!1}},_e=[];let Pe=[];const be=a,Ne=n.reparseOverscaled?f:a,Oe=me=>me*me,et=Oe((q-this._centerAltitude)*W),Me=me=>{if(!this._elevation||!me.tileID||!T)return;const Ae=this._elevation.getMinMaxForTile(me.tileID),it=me.aabb;Ae?(it.min[2]=Ae.min,it.max[2]=Ae.max,it.center[2]=(it.min[2]+it.max[2])/2):(me.shouldSplit=ke(me),me.shouldSplit||(it.min[2]=it.max[2]=it.center[2]=this._centerAltitude))},ke=me=>{if(me.zoom<Q)return!0;if(me.zoom===be)return!1;if(me.shouldSplit!=null)return me.shouldSplit;const Ae=me.aabb.distanceX(j),it=me.aabb.distanceY(j);let pt=et,ht=1;if(z){pt=Oe(me.aabb.distanceZ(j));const Jt=Math.pow(2,me.zoom),qt=r.au((me.y+1)/Jt),Yt=r.au(me.y/Jt),vi=Math.min(Math.max(C,qt),Yt),ui=r.bJ(vi)/r.bJ(C);if(ht=vi===C?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ui/this._mercatorScaleRatio),this.zoom<=r.bG&&me.zoom===be-1&&ui>=.9)return!0}else if(x&&(pt=Oe(me.aabb.distanceZ(j)*W)),this.projection.isReprojectedInTileSpace&&f<=5){const Jt=Math.pow(2,me.zoom),qt=ue(new r.L((me.x+.5)/Jt,(me.y+.5)/Jt));ht=qt>.85?1:qt}const Et=Ae*Ae+it*it+pt,Wt=Oe((1<<be-me.zoom)*re*ht*((Jt,qt)=>{if(qt*Oe(.707)<Jt)return 1;const Yt=Math.sqrt(qt/Jt);return Yt/(1.4144271570014144+(Math.pow(1.1,Yt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(pt,et),Et));return Et<Wt};if(this.renderWorldCopies)for(let me=1;me<=3;me++)_e.push(de(-me)),_e.push(de(me));for(_e.push(de(0));_e.length>0;){const me=_e.pop(),Ae=me.x,it=me.y;let pt=me.fullyVisible;const ht=()=>this.projection.name==="globe"&&(me.y===0||me.y===(1<<me.zoom)-1);if(!pt){let Et=Y?me.aabb.intersects(V):me.aabb.intersectsFlat(V);if(Et===0&&ht()){const Wt=new r.bs(me.zoom,Ae,it);Et=r.bt(this,D,Wt,!0).intersects(V)}if(Et===0)continue;pt=Et===2}if(me.zoom!==be&&ke(me))for(let Et=0;Et<4;Et++){const Wt=(Ae<<1)+Et%2,Jt=(it<<1)+(Et>>1),qt={aabb:T?me.aabb.quadrant(Et):r.bu(this,D,me.zoom+1,Wt,Jt,me.wrap,me.minZ,me.maxZ,this.projection),zoom:me.zoom+1,x:Wt,y:Jt,wrap:me.wrap,fullyVisible:pt,tileID:void 0,shouldSplit:void 0,minZ:me.minZ,maxZ:me.maxZ};x&&!z&&(qt.tileID=new r.am(me.zoom+1===be?Ne:me.zoom+1,me.wrap,me.zoom+1,Wt,Jt),Me(qt)),_e.push(qt)}else{const Et=me.zoom===be?Ne:me.zoom;if(n.minzoom&&n.minzoom>Et)continue;if(!pt){let Yt=Y?me.aabb.intersectsPrecise(V):me.aabb.intersectsPreciseFlat(V);if(Yt===0&&ht()){const vi=new r.bs(me.zoom,Ae,it);Yt=r.bt(this,D,vi,!0).intersectsPrecise(V)}if(Yt===0)continue}const Wt=L[0]-(.5+Ae+(me.wrap<<me.zoom))*(1<<a-me.zoom),Jt=L[1]-.5-it,qt=me.tileID?me.tileID:new r.am(Et,me.wrap,me.zoom,Ae,it);Pe.push({tileID:qt,distanceSq:Wt*Wt+Jt*Jt})}}if(this.fogCullDistSq){const me=this.fogCullDistSq,Ae=this.horizonLineFromTop();Pe=Pe.filter(it=>{const pt=[0,0,0,1],ht=[r.V,r.V,0,1],Et=this.calculateFogTileMatrix(it.tileID.toUnwrapped());r.a7.transformMat4(pt,pt,Et),r.a7.transformMat4(ht,ht,Et);const Wt=r.a7.min([],pt,ht),Jt=r.a7.max([],pt,ht),qt=r.bv(Wt,Jt);if(qt===0)return!0;let Yt=!1;const vi=this._elevation;if(vi&&qt>me&&Ae!==0){const ui=this.calculateProjMatrix(it.tileID.toUnwrapped());let mi;n.isTerrainDEM||(mi=vi.getMinMaxForTile(it.tileID)),mi||(mi={min:X,max:se});const pi=r.bH(this.rotation),Fi=[pi[0]*r.V,pi[1]*r.V,mi.max];r.N.transformMat4(Fi,Fi,ui),Yt=(1-Fi[1])*this.height*.5<Ae}return qt<me||Yt})}return Pe.sort((me,Ae)=>me.distanceSq-Ae.distanceSq).map(me=>me.tileID)}resize(n,a){this.width=n,this.height=a,this.pixelsToGLUnits=[2/n,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const a=r.aa(n.lat,-r.bw,r.bw),f=this.projection.project(n.lng,a);return new r.P(f.x*this.worldSize,f.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.bl(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,a){let f,g;const x=this.centerPoint;if(this.projection.name==="globe"){const E=this.worldSize;f=(a.x-x.x)/E,g=(a.y-x.y)/E}else{const E=this.pointCoordinate(a),C=this.pointCoordinate(x);f=E.x-C.x,g=E.y-C.y}const T=this.locationCoordinate(n);this.setLocation(new r.L(T.x-f,T.y-g))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,a){const f=a?r.bl(a,n.lat):void 0,g=this.projection.project(n.lng,n.lat);return new r.L(g.x,g.y,f)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,a){const f=a??this._centerAltitude,g=[n.x,n.y,0,1],x=[n.x,n.y,1,1];r.a7.transformMat4(g,g,this.pixelMatrixInverse),r.a7.transformMat4(x,x,this.pixelMatrixInverse);const T=x[3];r.a7.scale(g,g,1/g[3]),r.a7.scale(x,x,1/T);const E=g[2],C=x[2];return{p0:g,p1:x,t:E===C?0:(f-E)/(C-E)}}screenPointToMercatorRay(n){const a=[n.x,n.y,0,1],f=[n.x,n.y,1,1];return r.a7.transformMat4(a,a,this.pixelMatrixInverse),r.a7.transformMat4(f,f,this.pixelMatrixInverse),r.a7.scale(a,a,1/a[3]),r.a7.scale(f,f,1/f[3]),a[2]=r.bl(a[2],this._center.lat)*this.worldSize,f[2]=r.bl(f[2],this._center.lat)*this.worldSize,r.a7.scale(a,a,1/this.worldSize),r.a7.scale(f,f,1/this.worldSize),new r.a2([a[0],a[1],a[2]],r.N.normalize([],r.N.sub([],f,a)))}rayIntersectionCoordinate(n){const{p0:a,p1:f,t:g}=n,x=r.bl(a[2],this._center.lat),T=r.bl(f[2],this._center.lat);return new r.L(r.U(a[0],f[0],g)/this.worldSize,r.U(a[1],f[1],g)/this.worldSize,r.U(x,T,g))}pointCoordinate(n,a=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,a)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let a=this.projection.pointCoordinate3D(this,n.x,n.y);if(a)return new r.L(a[0],a[1],a[2]);let f=0,g=this.horizonLineFromTop();if(n.y>g)return this.pointCoordinate(n);const x=.02*g,T=n.clone();for(let E=0;E<10&&g-f>x;E++){T.y=r.U(f,g,.66);const C=this.projection.pointCoordinate3D(this,T.x,T.y);C?(g=T.y,a=C):f=T.y}return a?new r.L(a[0],a[1],a[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=r.bx)return!this.isPointAboveHorizon(n);const a=this.pointCoordinate(n);return a.y>=0&&a.y<=1}_coordinatePoint(n,a){const f=a&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,g=[n.x*this.worldSize,n.y*this.worldSize,f+n.toAltitude(),1];return r.a7.transformMat4(g,g,this.pixelMatrix),g[3]>0?new r.P(g[0]/g[3],g[1]/g[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:a}=this._edgeInsets,f=this.height-this._edgeInsets.bottom,g=this.width-this._edgeInsets.right,x=this.pointLocation3D(new r.P(a,n)),T=this.pointLocation3D(new r.P(g,n)),E=this.pointLocation3D(new r.P(g,f)),C=this.pointLocation3D(new r.P(a,f));let D=Math.min(x.lng,T.lng,E.lng,C.lng),L=Math.max(x.lng,T.lng,E.lng,C.lng),z=Math.min(x.lat,T.lat,E.lat,C.lat),B=Math.max(x.lat,T.lat,E.lat,C.lat);const V=Math.pow(2,-this.zoom)/16*270,H=this.projection.name==="globe"?1:4,W=(q,j,Y,re,Q)=>{const se=(q+Y)/2,X=(j+re)/2,oe=new r.P(se,X),{lng:ue,lat:de}=this.pointLocation3D(oe),_e=Math.max(0,D-ue,z-de,ue-L,de-B);D=Math.min(D,ue),L=Math.max(L,ue),z=Math.min(z,de),B=Math.max(B,de),(Q<H||_e>V)&&(W(q,j,se,X,Q+1),W(se,X,Y,re,Q+1))};if(W(a,n,g,n,1),W(g,n,g,f,1),W(g,f,a,f,1),W(a,f,a,n,1),this.projection.name==="globe"){const[q,j]=r.by(this);q?(B=90,L=180,D=-180):j&&(z=-90,L=180,D=-180)}return new r.ad(new r.bn(D,z),new r.bn(L,B))}_getBoundsRectangular(n,a){const{top:f,left:g}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,E=new r.P(g,f),C=new r.P(T,f),D=new r.P(T,x),L=new r.P(g,x);let z=this.pointCoordinate(E,n),B=this.pointCoordinate(C,n);const V=this.pointCoordinate(D,a),H=this.pointCoordinate(L,a),W=(q,j)=>(j.y-q.y)/(j.x-q.x);return z.y>1&&B.y>=0?z=new r.L((1-H.y)/W(H,z)+H.x,1):z.y<0&&B.y<=1&&(z=new r.L(-H.y/W(H,z)+H.x,0)),B.y>1&&z.y>=0?B=new r.L((1-V.y)/W(V,B)+V.x,1):B.y<0&&z.y<=1&&(B=new r.L(-V.y/W(V,B)+V.x,0)),new r.ad().extend(this.coordinateLocation(z)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(H)).extend(this.coordinateLocation(V))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const a=n.visibleDemTiles.reduce((f,g)=>{if(g.dem){const x=g.dem.tree;f.min=Math.min(f.min,x.minimums[0]),f.max=Math.max(f.max,x.maximums[0])}return f},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*n.exaggeration(),a.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,f=this.height/2-a*(1-this._horizonShift);return n?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-r.bw,this.maxLat=r.bw,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.a5(this.minLng)*this.tileSize,this.worldMaxX=r.a5(this.maxLng)*this.tileSize,this.worldMinY=r.ae(this.maxLat)*this.tileSize,this.worldMaxY=r.ae(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,a){return this.projection.createTileMatrix(this,a,n)}calculateDistanceTileData(n){const a=n.key,f=this._distanceTileDataCache;if(f[a])return f[a];const g=n.canonical,x=1/this.height,T=this.cameraWorldSize,E=T/this.zoomScale(g.z),C=(g.x+Math.pow(2,g.z)*n.wrap)*E,D=g.y*E,L=this.point;L.x*=T/this.worldSize,L.y*=T/this.worldSize;const z=this.angle,B=Math.sin(-z),V=-Math.cos(-z);return f[a]={bearing:[B,V],center:[(L.x-C)*x,(L.y-D)*x],scale:E/r.V*x},f[a]}calculateFogTileMatrix(n){const a=n.key,f=this._fogTileMatrixCache;if(f[a])return f[a];const g=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return r.a6.multiply(g,this.worldToFogMatrix,g),f[a]=new Float32Array(g),f[a]}calculateProjMatrix(n,a=!1,f=!1){const g=n.key;let x;if(x=f?this._expandedProjMatrixCache:a?this._alignedProjMatrixCache:this._projMatrixCache,x[g])return x[g];const T=this.calculatePosMatrix(n,this.worldSize);let E;return E=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.expandedFarZProjMatrix:a?this.alignedProjMatrix:this.projMatrix,r.a6.multiply(T,E,T),x[g]=new Float32Array(T),x[g]}calculatePixelsToTileUnitsMatrix(n){const a=n.tileID.key,f=this._pixelsToTileUnitsCache;if(f[a])return f[a];const g=r.bz(n,this);return f[a]=g,f[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,a=r.a6.fromScaling([],[n,n,n]);return r.a6.multiply(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const a=r.bl(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(a),g=this._camera.forward(),x=r.bl(1,this._center.lat);f[2]/=x,g[2]/=x,r.N.normalize(g,g);const T=n.raycast(f,g,n.exaggeration());if(T){const E=r.N.scaleAndAdd([],f,g,T),C=new r.L(E[0],E[1],r.bl(E[2],r.au(E[1]))),D=(C.z+r.N.length([C.x-f[0],C.y-f[1],C.z-f[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(D),this._centerAltitude=C.toAltitude(),this._center=this.coordinateLocation(C),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const a=this._elevation,f=r.bl(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(f),x=a.getAtPointOrZero(new r.L(...g)),T=this.pixelsPerMeter/this.worldSize*x,E=this._minimumHeightOverTerrain(),C=g[2]-T;if(C<=E)if(C<0||n){const D=this.locationCoordinate(this._center,this._centerAltitude),L=[g[0],g[1],D.z-g[2]],z=r.N.length(L);L[2]-=(E-C)/this._pixelsPerMercatorPixel;const B=r.N.length(L);if(B===0)return;r.N.scale(L,L,z/B*this._pixelsPerMercatorPixel),this._camera.position=[g[0],g[1],D.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const B=this.center;return B.lat=r.aa(B.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(B.lng=r.aa(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}const a=this._unmodified,{x:f,y:g}=this.point;let x=0,T=f,E=g;const C=this.width/2,D=this.height/2,L=this.worldMinY*this.scale,z=this.worldMaxY*this.scale;if(g-D<L&&(E=L+D),g+D>z&&(E=z-D),z-L<this.height&&(x=Math.max(x,this.height/(z-L)),E=(z+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const B=this.worldMinX*this.scale,V=this.worldMaxX*this.scale,H=this.worldSize/2-(B+V)/2;T=(f+H+this.worldSize)%this.worldSize-H,T-C<B&&(T=B+C),T+C>V&&(T=V-C),V-B<this.width&&(x=Math.max(x,this.width/(V-B)),T=(V+B)/2)}T===f&&E===g||(this.center=this.unproject(new r.P(T,E))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,a=this.projection.name==="globe",f=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.bl(1,this.center.lat)/r.bl(1,r.bI));const g=r.bA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this.projection.zAxisUnit==="meters"?f:1,T=this._camera.getWorldToCamera(this.worldSize,x);let E;const C=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(C[8]=2*-n.x/this.width,C[9]=2*n.y/this.height,this.isOrthographic){let de=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),_e=de*this.aspect,Pe=-_e,be=-de;_e-=n.x,Pe-=n.x,de+=n.y,be+=n.y,E=this._camera.getCameraToClipOrthographic(Pe,_e,be,de,this._nearZ,this._farZ),((Ne,Oe,et,Me)=>{for(let ke=0;ke<16;ke++)Ne[ke]=Ba(Oe[ke],et[ke],Me)})(E,E,C,Bl(this.pitch>=15?1:this.pitch/15))}else E=C;const D=r.a6.mul([],C,T);let L=r.a6.mul([],E,T);if(this.projection.isReprojectedInTileSpace){const de=this.locationCoordinate(this.center),_e=r.a6.identity([]);r.a6.translate(_e,_e,[de.x*this.worldSize,de.y*this.worldSize,0]),r.a6.multiply(_e,_e,r.bB(this)),r.a6.translate(_e,_e,[-de.x*this.worldSize,-de.y*this.worldSize,0]),r.a6.multiply(L,L,_e),r.a6.multiply(D,D,_e),this.inverseAdjustmentMatrix=r.bC(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.a6.scale([],L,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=L,this.invProjMatrix=r.a6.invert(new Float64Array(16),this.projMatrix),a){const de=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);de[8]=2*-n.x/this.width,de[9]=2*n.y/this.height,this.expandedFarZProjMatrix=r.a6.mul([],de,T)}else this.expandedFarZProjMatrix=this.projMatrix;const z=r.a6.invert([],E);this.frustumCorners=r.bD.fromInvProjectionMatrix(z,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!a);const B=new Float32Array(16);r.a6.identity(B),r.a6.scale(B,B,[1,-1,1]),r.a6.rotateX(B,B,this._pitch),r.a6.rotateZ(B,B,this.angle);const V=r.a6.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.a6.clone(V);const H=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;V[8]=2*-n.x/this.width,V[9]=2*(n.y+H)/this.height,this.skyboxMatrix=r.a6.multiply(B,V,B);const W=this.point,q=W.x,j=W.y,Y=this.width%2/2,re=this.height%2/2,Q=Math.cos(this.angle),se=Math.sin(this.angle),X=q-Math.round(q)+Q*Y+se*re,oe=j-Math.round(j)+Q*re+se*Y,ue=new Float64Array(L);if(r.a6.translate(ue,ue,[X>.5?X-1:X,oe>.5?oe-1:oe,0]),this.alignedProjMatrix=ue,L=r.a6.create(),r.a6.scale(L,L,[this.width/2,-this.height/2,1]),r.a6.translate(L,L,[1,-1,0]),this.labelPlaneMatrix=L,L=r.a6.create(),r.a6.scale(L,L,[1,-1,1]),r.a6.translate(L,L,[-1,-1,0]),r.a6.scale(L,L,[2/this.width,2/this.height,1]),this.glCoordMatrix=L,this.pixelMatrix=r.a6.multiply(new Float64Array(16),this.labelPlaneMatrix,D),this._calcFogMatrices(),this._distanceTileDataCache={},L=r.a6.invert(new Float64Array(16),this.pixelMatrix),!L)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=L,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.bE(this);const de=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.N.transformMat4(de,de,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=L;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,f=this._camera.position,g=1/this.height/this._pixelsPerMercatorPixel,x=[n,n,a];r.N.scale(x,x,g),r.N.scale(f,f,-1),r.N.multiply(f,f,x);const T=r.a6.create();r.a6.translate(T,T,f),r.a6.scale(T,T,x),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,a,g)}_computeCameraPosition(n){const a=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),g=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-n/this.worldSize*this._centerAltitude;return[g.x/this.worldSize-f[0]*x,g.y/this.worldSize-f[1]*x,n/this.worldSize*this._centerAltitude-f[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=this._camera.position[2],g=n[2];let x=1;this.projection.wrap&&(this.center=this.center.wrap()),g>0&&(x=Math.min((a-f)/g,1)),this._camera.position=r.N.scaleAndAdd([],this._camera.position,n,x),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,a=this._camera.forward(),{pitch:f,bearing:g}=this._camera.getPitchBearing(),x=r.bl(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.bj(this._maxPitch)),E=Math.max((n[2]-x)/Math.cos(f),T),C=this._zoomFromMercatorZ(E);r.N.scaleAndAdd(n,n,a,E),this._pitch=r.aa(f,r.bj(this.minPitch),r.bj(this.maxPitch)),this.angle=r.bh(g,-Math.PI,Math.PI),this._setZoom(r.aa(C,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.L(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){let a=0,f=r.bx,g=0,x=1/0;for(;f-a>1e-6&&f>a;){const T=a+.5*(f-a),E=this.tileSize*Math.pow(2,T),C=this.getCameraToCenterDistance(this.projection,T,E),D=this.scaleZoom(C/(n*this.tileSize)),L=Math.abs(T-D);L<x&&(x=L,g=T),T<D?a=T:f=T}return g}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,a){const f=Math.min(n.x,a.x),g=Math.max(n.x,a.x),x=Math.min(n.y,a.y),T=Math.max(n.y,a.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const E=[new r.P(f,x),new r.P(g,T),new r.P(f,T),new r.P(g,x)],C=this.renderWorldCopies?-3:0,D=this.renderWorldCopies?4:1;for(const L of E){const z=this.pointRayIntersection(L);if(z.t<0)return!0;const B=this.rayIntersectionCoordinate(z);if(B.x<C||B.y<0||B.x>D||B.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.bF(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(n,a){const f=r.N.length(r.N.sub([],this._camera.position,n)),g=this._zoomFromMercatorZ(f)+a;return f-this._mercatorZfromZoom(g)}getCameraPoint(){if(this.projection.name==="globe"){const n=function([a,f,g],x){const T=[a,f,g,1];r.a7.transformMat4(T,T,x);const E=T[3]=Math.max(T[3],1e-6);return T[0]/=E,T[1]/=E,T[2]/=E,T}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,n))}}getCameraToCenterDistance(n,a=this.zoom,f=this.worldSize){const g=r.bA(n,a,this.width,this.height,1024),x=n.pixelSpaceConversion(this.center.lat,f,g);let T=.5/Math.tan(.5*this._fov)*this.height*x;return this.isOrthographic&&(T=Ba(1,T,Bl(this.pitch>=15?1:this.pitch/15))),T}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.a6.multiply(n,n,this.globeMatrix),n}getFrustum(n){return r.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,this.projection.zAxisUnit==="meters")}}const Er={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},bo=(d,n)=>{if(n>0&&d.terrain&&r.w("Cutoff is currently disabled on terrain"),n<=0||d.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const a=d.transform,f=Math.max(Math.abs(a._zoom-(d.minCutoffZoom-1)),1),g=a.isLODDisabled(!1)?r.O(60,45,a.pitch):r.O(30,15,a.pitch),x=a._farZ-a._nearZ,T=n*a.height,E=((1-(C=g))*a.cameraToCenterDistance+C*(a._farZ+T))*f;var C;return{shouldRenderCutoff:g<1,uniformValues:{u_cutoff_params:[a._nearZ,a._farZ,(E-a._nearZ)/x,(E-T-a._nearZ)/x]}}},Fr={cascadeCount:2,shadowMapResolution:2048};class Ph{constructor(n,a){this.aabb=n,this.lastCascade=a}}class ip{add(n,a){const f=this.receivers[n.key];f!==void 0?(f.aabb.min[0]=Math.min(f.aabb.min[0],a.min[0]),f.aabb.min[1]=Math.min(f.aabb.min[1],a.min[1]),f.aabb.min[2]=Math.min(f.aabb.min[2],a.min[2]),f.aabb.max[0]=Math.max(f.aabb.max[0],a.max[0]),f.aabb.max[1]=Math.max(f.aabb.max[1],a.max[1]),f.aabb.max[2]=Math.max(f.aabb.max[2],a.max[2])):this.receivers[n.key]=new Ph(a,null)}clear(){this.receivers={}}get(n){return this.receivers[n.key]}computeRequiredCascades(n,a,f){const g=r.bS.fromPoints(n.points);let x=0;for(const T in this.receivers){const E=this.receivers[T];if(!E||!g.intersectsAabb(E.aabb))continue;E.aabb.min=g.closestPoint(E.aabb.min),E.aabb.max=g.closestPoint(E.aabb.max);const C=E.aabb.getCorners();for(let D=0;D<f.length;D++){let L=!0;for(const z of C){const B=[z[0]*a,z[1]*a,z[2]];if(r.N.transformMat4(B,B,f[D].matrix),B[0]<-1||B[0]>1||B[1]<-1||B[1]>1){L=!1;break}}if(E.lastCascade=D,x=Math.max(x,D),L)break}}return x+1}}class Dh{constructor(n){this.painter=n,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new ip,this._depthMode=new ni(n.context.gl.LEQUAL,ni.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1,n.tp.registerParameter(Fr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),n.tp.registerParameter(Fr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32})}destroy(){for(const n of this._cascades)n.texture.destroy(),n.framebuffer.destroy();this._cascades=[]}updateShadowParameters(n,a){const f=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!a||!a.properties)return;const g=a.properties.get("shadow-intensity");if(!a.shadowsEnabled()||g<=0||(this._shadowLayerCount=f.style.order.reduce((H,W)=>{const q=f.style._mergedLayers[W];return H+(q.hasShadowPass()&&!q.isHidden(n.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;const x=f.context,T=Fr.shadowMapResolution,E=Fr.shadowMapResolution;if(this._cascades.length===0||Fr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let H=0;H<Fr.cascadeCount;++H){const W=f._shadowMapDebug,q=x.gl,j=x.createFramebuffer(T,E,W,"texture"),Y=new r.T(x,{width:T,height:E,data:null},q.DEPTH_COMPONENT);if(j.depthAttachment.set(Y.texture),W){const re=new r.T(x,{width:T,height:E,data:null},q.RGBA);j.colorAttachment.set(re.texture)}this._cascades.push({framebuffer:j,texture:Y,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.bq,scale:0})}}this.shadowDirection=tu(a);let C=0;if(n.elevation){const H=n.elevation,W=[1e4,-1e4];H.visibleDemTiles.filter(q=>q.dem).forEach(q=>{const j=q.dem.tree;W[0]=Math.min(W[0],j.minimums[0]),W[1]=Math.max(W[1],j.maximums[0])}),W[0]!==1e4&&(C=(W[1]-W[0])*H.exaggeration())}const D=1.5*n.cameraToCenterDistance,L=3*D,z=new Float64Array(16);for(let H=0;H<this._cascades.length;++H){const W=this._cascades[H];let q=n.height/50,j=1;Fr.cascadeCount===1?j=L:H===0?j=D:(q=D,j=L);const[Y,re]=np(n,this.shadowDirection,q,j,Fr.shadowMapResolution,C);W.scale=n.scale,W.matrix=Y,W.boundingSphereRadius=re,r.a6.invert(z,W.matrix),W.frustum=r.bq.fromInvProjectionMatrix(z,1,0,!0),W.far=j}const B=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[B].far,this._cascades[B].far],this._uniformValues.u_shadow_intensity=g,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Fr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Fr.shadowMapResolution,this._uniformValues.u_shadowmap_0=Er.ShadowMap0,this._uniformValues.u_shadowmap_1=Er.ShadowMap0+1,this._groundShadowTiles=f.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const V=f.transform.elevation;for(const H of this._groundShadowTiles){let W={min:0,max:0};if(V){const q=V.getMinMaxForTile(H);q&&(W=q)}this.addShadowReceiver(H.toUnwrapped(),W.min,W.max)}}get enabled(){return this._enabled}set enabled(n){this._enabled=n}drawShadowPass(n,a){if(!this._enabled)return;const f=this.painter,g=f.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(f.transform.getFrustum(0),f.transform.worldSize,this._cascades),g.viewport.set([0,0,Fr.shadowMapResolution,Fr.shadowMapResolution]);for(let x=0;x<this._numCascadesToRender;++x){f.currentShadowCascade=x,g.bindFramebuffer.set(this._cascades[x].framebuffer.framebuffer),g.clear({color:r.ax.white,depth:1});for(const T of n.order){const E=n._mergedLayers[T];if(!E.hasShadowPass()||E.isHidden(f.transform.zoom))continue;const C=n.getLayerSourceCache(E),D=C?a[C.id]:void 0;(E.type==="model"||D&&D.length)&&f.renderLayer(f,C,E,D)}}f.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const n=this.painter,a=n.style,f=n.context,g=a.directionalLight,x=a.ambientLight;if(!g||!x)return;const T=[],E=bo(n,n.longestCutoffRange);E.shouldRenderCutoff&&T.push("RENDER_CUTOFF");const C=Vl(g,x),D=new ni(f.gl.LEQUAL,ni.ReadOnly,n.depthRangeFor3D);for(const L of this._groundShadowTiles){const z=L.toUnwrapped(),B=n.isTileAffectedByFog(L),V=n.getOrCreateProgram("groundShadow",{defines:T,overrideFog:B});this.setupShadows(z,V),n.uploadCommonUniforms(f,V,z,null,E);const H={u_matrix:n.transform.calculateProjMatrix(z),u_ground_shadow_factor:C};V.draw(n,f.gl.TRIANGLES,D,di.disabled,Ai.multiply,ri.disabled,H,"ground_shadow",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments,{},n.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Ai.unblended:Ai.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(n){const a=this.painter.transform,f=a.calculatePosMatrix(n,a.worldSize);return r.a6.multiply(f,this._cascades[this.painter.currentShadowCascade].matrix,f),Float32Array.from(f)}calculateShadowPassMatrixFromMatrix(n){return r.a6.multiply(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}setupShadows(n,a,f,g=0){if(!this._enabled)return;const x=this.painter.transform,T=this.painter.context,E=T.gl,C=this._uniformValues,D=new Float64Array(16),L=x.calculatePosMatrix(n,x.worldSize);for(let z=0;z<this._cascades.length;z++)r.a6.multiply(D,this._cascades[z].matrix,L),C[z===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(D),T.activeTexture.set(E.TEXTURE0+Er.ShadowMap0+z),this._cascades[z].texture.bind(E.NEAREST,E.CLAMP_TO_EDGE);if(this.useNormalOffset=!!f,this.useNormalOffset){const z=r.bR(n.canonical),B=2/x.tileSize*r.V/Fr.shadowMapResolution,V=B*this._cascades[0].boundingSphereRadius,H=B*this._cascades[this._cascades.length-1].boundingSphereRadius,W=(f==="vector-tile"?1:3)/Math.pow(2,g-n.canonical.z-(1-x.zoom+Math.floor(x.zoom)));C.u_shadow_normal_offset=[z,V*W,H*W],C.u_shadow_bias=[6e-5,.0012,.012]}else C.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(T,C)}setupShadowsFromMatrix(n,a,f=!1){if(!this._enabled)return;const g=this.painter.context,x=g.gl,T=this._uniformValues,E=new Float64Array(16);for(let C=0;C<Fr.cascadeCount;C++)r.a6.multiply(E,this._cascades[C].matrix,n),T[C===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(E),g.activeTexture.set(x.TEXTURE0+Er.ShadowMap0+C),this._cascades[C].texture.bind(x.NEAREST,x.CLAMP_TO_EDGE);this.useNormalOffset=f,f?(T.u_shadow_normal_offset=[1,5,5],T.u_shadow_bias=[6e-5,.0012,.012]):T.u_shadow_bias=[36e-5,.0012,.012],a.setShadowUniformValues(g,T)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(n,a,f,g){if(g[2]>=0)return{};const x=function(C,D,L){const z=L/(1<<C.canonical.z);return new r.bS([C.canonical.x*z+C.wrap*L,C.canonical.y*z+C.wrap*L,0],[(C.canonical.x+1)*z+C.wrap*L,(C.canonical.y+1)*z+C.wrap*L,D])}(n,a,f).getCorners(),T=a/-g[2];g[0]<0?(r.N.add(x[0],x[0],[g[0]*T,0,0]),r.N.add(x[3],x[3],[g[0]*T,0,0])):g[0]>0&&(r.N.add(x[1],x[1],[g[0]*T,0,0]),r.N.add(x[2],x[2],[g[0]*T,0,0])),g[1]<0?(r.N.add(x[0],x[0],[0,g[1]*T,0]),r.N.add(x[1],x[1],[0,g[1]*T,0])):g[1]>0&&(r.N.add(x[2],x[2],[0,g[1]*T,0]),r.N.add(x[3],x[3],[0,g[1]*T,0]));const E={};return E.vertices=x,E.planes=[Jo(x[1],x[0],x[4]),Jo(x[2],x[1],x[5]),Jo(x[3],x[2],x[6]),Jo(x[0],x[3],x[7])],E}addShadowReceiver(n,a,f){this._receivers.add(n,r.bS.fromTileIdAndHeight(n,a,f))}getMaxCascadeForTile(n){const a=this._receivers.get(n);return a&&a.lastCascade?a.lastCascade:0}}function Jo(d,n,a){const f=r.N.sub([],a,n),g=r.N.sub([],d,n),x=r.N.cross([],f,g),T=r.N.length(x);return T===0?[0,0,1,0]:(r.N.scale(x,x,1/T),[x[0],x[1],x[2],-r.N.dot(x,n)])}function tu(d){const n=d.properties.get("direction"),a=r.bQ(n.x,n.y,n.z);a[2]=r.aa(a[2],0,75);const f=r.bT([a[0],a[1],a[2]]);return r.N.fromValues(f.x,f.y,f.z)}function Vl(d,n){const a=d.properties.get("color"),f=d.properties.get("intensity"),g=d.properties.get("direction"),x=[g.x,g.y,g.z],T=n.properties.get("color"),E=n.properties.get("intensity"),C=Math.max(r.N.dot([0,0,1],x),0),D=[0,0,0];r.N.scale(D,T.toArray01Linear().slice(0,3),E);const L=[0,0,0];return r.N.scale(L,a.toArray01Linear().slice(0,3),C*f),r.bU([D[0]>0?D[0]/(D[0]+L[0]):0,D[1]>0?D[1]/(D[1]+L[1]):0,D[2]>0?D[2]/(D[2]+L[2]):0])}function np(d,n,a,f,g,x){const T=d.zoom,E=d.scale,C=d.worldSize,D=1/C,L=d.aspect,z=Math.sqrt(1+L*L)*Math.tan(.5*d.fovX),B=z*z,V=f-a,H=f+a;let W,q;B>V/H?(W=f,q=f*z):(W=.5*H*(1+B),q=.5*Math.sqrt(V*V+2*(f*f+a*a)*B+H*H*B*B));const j=d.projection.pixelsPerMeter(d.center.lat,C),Y=d._camera.getCameraToWorldMercator(),re=[0,0,-W*D];r.N.transformMat4(re,re,Y);let Q=q*D;const se=d._edgeInsets;if(!(se.left===0&&se.top===0&&se.right===0&&se.bottom===0||se.left===se.right&&se.top===se.bottom)){const pt=d._camera.getWorldToCamera(d.worldSize,d.projection.zAxisUnit==="meters"?j:1),ht=d._camera.getCameraToClipPerspective(d._fov,d.width/d.height,a,f);ht[8]=2*-d.centerOffset.x/d.width,ht[9]=2*d.centerOffset.y/d.height;const Et=new Float64Array(16);r.a6.mul(Et,ht,pt);const Wt=new Float64Array(16);r.a6.invert(Wt,Et);const Jt=r.bq.fromInvProjectionMatrix(Wt,C,T,!0);for(const qt of Jt.points){const Yt=((X=qt)[0]/=E,X[1]/=E,X[2]=r.bl(X[2],d._center.lat),X);Q=Math.max(Q,r.N.len(r.N.subtract([],re,Yt)))}}var X;Q*=g/(g-1);const oe=Math.acos(n[2]),ue=Math.atan2(-n[0],-n[1]),de=new Fa;de.position=re,de.setPitchBearing(oe,ue);const _e=de.getWorldToCamera(C,j),Pe=Q*C,be=Math.min(d._mercatorZfromZoom(17)*C*-2,-2*Pe),Ne=de.getCameraToClipOrthographic(-Pe,Pe,-Pe,Pe,be,(Pe+x*j)/n[2]),Oe=new Float64Array(16);r.a6.multiply(Oe,Ne,_e);const et=r.N.fromValues(Math.floor(1e6*re[0])/1e6*C,Math.floor(1e6*re[1])/1e6*C,0),Me=.5*g,ke=[0,0,0];r.N.transformMat4(ke,et,Oe),r.N.scale(ke,ke,Me);const me=[Math.floor(ke[0]),Math.floor(ke[1]),Math.floor(ke[2])],Ae=[0,0,0];r.N.sub(Ae,ke,me),r.N.scale(Ae,Ae,-1/Me);const it=new Float64Array(16);return r.a6.identity(it),r.a6.translate(it,it,Ae),r.a6.multiply(Oe,it,Oe),[Oe,Pe]}const wo=(d,n)=>Vt(d,n&&n.filter(a=>a.identifier!=="source.canvas")),rp=r.ac(Oi,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Na=r.ac(Oi,["setCenter","setZoom","setBearing","setPitch"]),Lh={version:8,layers:[],sources:{}},sp={duration:300,delay:0},tg=new Set(["fill","line","background","hillshade","raster"]);class Ts extends r.E{constructor(n,a={}){super(),this.map=n,this.scope=a.scope||"",this.fragments=[],this.importDepth=a.importDepth||0,this.importsCache=a.importsCache||new Map,this.resolvedImports=a.resolvedImports||new Set,this.transition=r.e({},sp),this._buildingIndex=new Xf(this),this.crossTileSymbolIndex=new Ih,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=a.styleChanges||new Je,this.dispatcher=a.dispatcher?a.dispatcher:new r.bW(r.bX(),this),a.imageManager?this.imageManager=a.imageManager:(this.imageManager=new xi,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=a.glyphManager?a.glyphManager:new r.bY(n._requestManager,a.localFontFamily?r.bZ.all:a.localIdeographFontFamily?r.bZ.ideographs:r.bZ.none,a.localFontFamily||a.localIdeographFontFamily),a.modelManager?this.modelManager=a.modelManager:(this.modelManager=new Mt(n._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=a.configOptions?a.configOptions:new Map,this._configDependentLayers=a.configDependentLayers?a.configDependentLayers:new Set,this._config=a.config,this.dispatcher.broadcast("setReferrer",r.b_());const f=this;this._rtlTextPluginCallback=Ts.registerForPluginStateChange(g=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(x,T)=>{if(r.b$(x),T&&T.every(E=>E))for(const E in f._sourceCaches){const C=f._sourceCaches[E],D=C.getSource().type;D!=="vector"&&D!=="geojson"||C.reload()}})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const x=this.getOwnSource(g.sourceId);if(x&&x.vectorLayerIds)for(const T in this._layers){const E=this._layers[T];E.source===x.id&&this._validateLayer(E)}})}loadURL(n,a={}){this.fire(new r.b("dataloading",{dataType:"style"}));const f=typeof a.validate=="boolean"?a.validate:!r.c0(n);n=this.map._requestManager.normalizeStyleURL(n,a.accessToken),this.resolvedImports.add(n);const g=this.importsCache.get(n);if(g)return this._load(g,f);const x=this.map._requestManager.transformRequest(n,r.R.Style);this._request=r.g(x,(T,E)=>{if(this._request=null,T)this.fire(new r.a(T));else if(E)return this.importsCache.set(n,E),this._load(E,f)})}loadJSON(n,a={}){this.fire(new r.b("dataloading",{dataType:"style"})),this._request=r.f.frame(()=>{this._request=null,this._load(n,a.validate!==!1)})}loadEmpty(){this.fire(new r.b("dataloading",{dataType:"style"})),this._load(Lh,!1)}_loadImports(n,a,f){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const g=[];for(const x of n){const T=this._createFragmentStyle(x),E=new Promise(L=>{T.once("style.import.load",L),T.once("error",L)}).then(()=>this.mergeAll());if(g.push(E),this.resolvedImports.has(x.url)){T.loadEmpty();continue}const C=x.data||this.importsCache.get(x.url);C?T.loadJSON(C,{validate:a}):x.url?T.loadURL(x.url,{validate:a}):T.loadEmpty();const D={style:T,id:x.id,config:x.config};if(f){const L=this.fragments.findIndex(({id:z})=>z===f);this.fragments=this.fragments.slice(0,L).concat(D).concat(this.fragments.slice(L))}else this.fragments.push(D)}return Promise.allSettled(g)}_createFragmentStyle(n){const a=this.scope?r.ag(n.id,this.scope):n.id,f=new Ts(this.map,{scope:a,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:n.config,configOptions:this.options,configDependentLayers:this._configDependentLayers});return f.setEventedParent(this.map,{style:f}),f}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const n=this.isRootStyle();this._shouldPrecompile=n,this.fire(new r.b(n?"style.load":"style.import.load"))}_load(n,a){const f=n.schema;if(this.isRootStyle()&&(n.fragment||f&&n.fragment!==!1)){const T=r.e({},Lh,{imports:[{id:"basemap",data:n,url:""}]});return void this._load(T,a)}if(this.setConfig(this._config,f),a&&wo(this,kt(n)))return;this._loaded=!0,this.stylesheet=r.c1(n);for(const T in n.sources)this.addSource(T,n.sources[T],{validate:!1,isInitialLoad:!0});n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(n.glyphs,this.scope);const g=Yf(this.stylesheet.layers);if(this._order=g.map(T=>T.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const T=this.stylesheet.lights[0];this.light=new Ft(T.properties,T.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Ft(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const T of g){const E=r.c2(T,this.scope,this.options);E.isConfigDependent&&this._configDependentLayers.add(E.fqid),E.setEventedParent(this,{layer:{id:E.id}}),this._layers[E.id]=E,this._serializedLayers[E.id]=E.serialize();const C=this.getOwnLayerSourceCache(E),D=!!this.directionalLight&&this.directionalLight.shadowsEnabled();C&&E.canCastShadows()&&D&&(C.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const x=this.stylesheet.terrain;x&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.f.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(x,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.b("data",{dataType:"style"})),n.imports?this._loadImports(n.imports,a).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return this.importDepth===0}mergeAll(){let n,a,f,g,x,T,E,C;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(D=>{if(D.stylesheet){if(D.light!=null&&(n=D.light),D.stylesheet.lights)for(const L of D.stylesheet.lights)L.type==="ambient"&&D.ambientLight!=null&&(a=D.ambientLight),L.type==="directional"&&D.directionalLight!=null&&(f=D.directionalLight);g=this._prioritizeTerrain(g,D.terrain,D.stylesheet.terrain),D.stylesheet.fog&&D.fog!=null&&(x=D.fog),D.stylesheet.camera!=null&&(C=D.stylesheet.camera),D.stylesheet.projection!=null&&(T=D.stylesheet.projection),D.stylesheet.transition!=null&&(E=D.stylesheet.transition)}}),this.light=n,this.ambientLight=a,this.directionalLight=f,this.fog=x,g===null?delete this.terrain:this.terrain=g,this.camera=C||{"camera-projection":"perspective"},this.projection=T||{name:"mercator"},this.transition=r.e({},sp,E),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(n){const a=f=>{for(const g of f.fragments)a(g.style);n(f)};a(this)}_prioritizeTerrain(n,a,f){const g=n&&n.drapeRenderMode===0;return f===null?a&&a.drapeRenderMode===0?a:g?n:null:a!=null&&(!n||g||a&&a.drapeRenderMode===1)?a:n}mergeTerrain(){let n;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(a=>{n=this._prioritizeTerrain(n,a.terrain,a.stylesheet.terrain)}),n===null?delete this.terrain:this.terrain=n}mergeProjection(){let n;this.forEachFragmentStyle(a=>{a.stylesheet.projection!=null&&(n=a.stylesheet.projection)}),this.projection=n||{name:"mercator"}}mergeSources(){const n={},a={},f={};this.forEachFragmentStyle(g=>{for(const x in g._sourceCaches){const T=r.ag(x,g.scope);n[T]=g._sourceCaches[x]}for(const x in g._otherSourceCaches){const T=r.ag(x,g.scope);a[T]=g._otherSourceCaches[x]}for(const x in g._symbolSourceCaches){const T=r.ag(x,g.scope);f[T]=g._symbolSourceCaches[x]}}),this._mergedSourceCaches=n,this._mergedOtherSourceCaches=a,this._mergedSymbolSourceCaches=f}mergeLayers(){const n={},a=[],f={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(x=>{for(const T of x._order){const E=x._layers[T];if(E.type==="slot"){const C=r.c3(T);if(n[C])continue;n[C]=[]}E.slot&&n[E.slot]?n[E.slot].push(E):a.push(E)}}),this._mergedOrder=[];const g=(x=[])=>{for(const T of x)if(T.type==="slot"){const E=r.c3(T.id);n[E]&&g(n[E])}else{const E=r.ag(T.id,T.scope);this._mergedOrder.push(E),f[E]=T,T.is3D()&&(this._has3DLayers=!0),T.type==="circle"&&(this._hasCircleLayers=!0),T.type==="symbol"&&(this._hasSymbolLayers=!0)}};g(a),this._mergedLayers=f,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(n){return this.stylesheet.camera=r.e({},this.stylesheet.camera,n),this.camera=this.stylesheet.camera,this}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(n){this._spriteRequest=function(a,f,g){let x,T,E;const C=r.f.devicePixelRatio>1?"@2x":"";let D=r.g(f.transformRequest(f.normalizeSpriteURL(a,C,".json"),r.R.SpriteJSON),(B,V)=>{D=null,E||(E=B,x=V,z())}),L=r.d(f.transformRequest(f.normalizeSpriteURL(a,C,".png"),r.R.SpriteImage),(B,V)=>{L=null,E||(E=B,T=V,z())});function z(){if(E)g(E);else if(x&&T){const B=r.f.getImageData(T),V={};for(const H in x){const{width:W,height:q,x:j,y:Y,sdf:re,pixelRatio:Q,stretchX:se,stretchY:X,content:oe}=x[H],ue=new r.h({width:W,height:q});r.h.copy(B,ue,{x:j,y:Y},{x:0,y:0},{width:W,height:q}),V[H]={data:ue,pixelRatio:Q,sdf:re,stretchX:se,stretchY:X,content:oe}}g(null,V)}}return{cancel(){D&&(D.cancel(),D=null),L&&(L.cancel(),L=null)}}}(n,this.map._requestManager,(a,f)=>{if(this._spriteRequest=null,a)this.fire(new r.a(a));else if(f)for(const g in f)this.imageManager.addImage(g,this.scope,f[g]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.b("data",{dataType:"style"}))})}_validateLayer(n){const a=this.getOwnSource(n.source);if(!a)return;const f=n.sourceLayer;f&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(f)===-1)&&this.fire(new r.a(new Error(`Source layer "${f}" does not exist on source "${a.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:n}of this.fragments)if(!n.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((n,a)=>{const f=this.fragments[a];return f&&f.style&&(n.data=f.style.serialize()),n})}_serializeSources(){const n={};for(const a in this._sourceCaches){const f=this._sourceCaches[a].getSource();n[f.id]||(n[f.id]=f.serialize())}return n}_serializeLayers(n){const a=[];for(const f of n){const g=this._layers[f];g&&g.type!=="custom"&&a.push(g.serialize())}return a}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(n){return!!this.terrain&&(typeof n.isLayerDraped=="function"?n.isLayerDraped(this.getLayerSourceCache(n)):tg.has(n.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(n){const a=this.getOwnLayer(n);if(a)return a;this.fire(new r.a(new Error(`The layer '${n}' does not exist in the map's style.`)))}_checkSource(n){const a=this.getOwnSource(n);if(a)return a;this.fire(new r.a(new Error(`The source '${n}' does not exist in the map's style.`)))}update(n){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n);const a=this.calculateLightsBrightness();n.brightness=a||0,a!==this._brightness&&(this._brightness=a,this.dispatcher.broadcast("setBrightness",a));const f=this._changes.isDirty();if(this._changes.isDirty()){const x=this._changes.getLayerUpdatesByScope();for(const T in x){const{updatedIds:E,removedIds:C}=x[T];(E||C)&&this._updateWorkerLayers(T,E,C)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(n),this.light&&this.light.updateTransitions(n),this.ambientLight&&this.ambientLight.updateTransitions(n),this.directionalLight&&this.directionalLight.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._changes.reset()}const g={};for(const x in this._mergedSourceCaches){const T=this._mergedSourceCaches[x];g[x]=T.used,T.used=!1,T.tileCoverLift=0}for(const x of this._mergedOrder){const T=this._mergedLayers[x];if(T.recalculate(n,this._availableImages),!T.isHidden(n.zoom)){const E=this.getLayerSourceCache(T);E&&(E.used=!0,E.tileCoverLift=Math.max(E.tileCoverLift,T.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let E=T.minzoom||0;E<(T.maxzoom||25.5);E++){const C=this.map.painter;if(C){const D=T.getProgramIds();if(!D)continue;for(const L of D){const z=T.getDefaultProgramParams(L,n.zoom);z&&(C.style=this,this.fog&&(C._fogVisible=!0,z.overrideFog=!0,C.getOrCreateProgram(L,z)),C._fogVisible=!1,z.overrideFog=!1,C.getOrCreateProgram(L,z),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(z.overrideRtt=!0,C.getOrCreateProgram(L,z)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const x in g){const T=this._mergedSourceCaches[x];g[x]!==T.used&&T.getSource().fire(new r.b("data",{sourceDataType:"visibility",dataType:"source",sourceId:T.getSource().id}))}this.light&&this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),f&&this.fire(new r.b("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=this._changes.getUpdatedImages();if(n.length){for(const a in this._sourceCaches)this._sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],n);this._changes.resetUpdatedImages()}}_updateWorkerLayers(n,a,f){const g=this.getFragmentStyle(n);g&&this.dispatcher.broadcast("updateLayers",{layers:a?g._serializeLayers(a):[],scope:n,removedIds:f||[],options:g.options})}setState(n){if(this._checkLoaded(),wo(this,kt(n)))return!1;(n=r.c1(n)).layers=Yf(n.layers);const a=function(g,x){if(!g)return[{command:Oi.setStyle,args:[x]}];let T=[];try{if(!k(g.version,x.version))return[{command:Oi.setStyle,args:[x]}];k(g.center,x.center)||T.push({command:Oi.setCenter,args:[x.center]}),k(g.zoom,x.zoom)||T.push({command:Oi.setZoom,args:[x.zoom]}),k(g.bearing,x.bearing)||T.push({command:Oi.setBearing,args:[x.bearing]}),k(g.pitch,x.pitch)||T.push({command:Oi.setPitch,args:[x.pitch]}),k(g.sprite,x.sprite)||T.push({command:Oi.setSprite,args:[x.sprite]}),k(g.glyphs,x.glyphs)||T.push({command:Oi.setGlyphs,args:[x.glyphs]}),k(g.imports,x.imports)||function(z=[],B=[],V){B=B||[];const H=(z=z||[]).map(go),W=B.map(go),q=z.reduce(Zc,{}),j=B.reduce(Zc,{}),Y=H.slice();let re,Q,se,X;for(re=0,Q=0;re<H.length;re++)se=H[re],j.hasOwnProperty(se)?Q++:(V.push({command:Oi.removeImport,args:[se]}),Y.splice(Y.indexOf(se,Q),1));for(re=0,Q=0;re<W.length;re++)se=W[W.length-1-re],Y[Y.length-1-re]!==se&&(q.hasOwnProperty(se)?(V.push({command:Oi.removeImport,args:[se]}),Y.splice(Y.lastIndexOf(se,Y.length-Q),1)):Q++,X=Y[Y.length-re],V.push({command:Oi.addImport,args:[j[se],X]}),Y.splice(Y.length-re,0,se));for(const oe of B){const ue=q[oe.id];ue&&!k(ue,oe)&&V.push({command:Oi.updateImport,args:[oe.id,oe]})}}(g.imports,x.imports,T),k(g.transition,x.transition)||T.push({command:Oi.setTransition,args:[x.transition]}),k(g.light,x.light)||T.push({command:Oi.setLight,args:[x.light]}),k(g.fog,x.fog)||T.push({command:Oi.setFog,args:[x.fog]}),k(g.projection,x.projection)||T.push({command:Oi.setProjection,args:[x.projection]}),k(g.lights,x.lights)||T.push({command:Oi.setLights,args:[x.lights]}),k(g.camera,x.camera)||T.push({command:Oi.setCamera,args:[x.camera]});const E={},C=[];(function(z,B,V,H){let W;for(W in B=B||{},z=z||{})z.hasOwnProperty(W)&&(B.hasOwnProperty(W)||hh(W,V,H));for(W in B){if(!B.hasOwnProperty(W))continue;const q=B[W];z.hasOwnProperty(W)?k(z[W],q)||(z[W].type==="geojson"&&q.type==="geojson"&&Z_(z,B,W)?V.push({command:Oi.setGeoJSONSourceData,args:[W,q.data]}):q_(W,B,V,H)):Dl(W,B,V)}})(g.sources,x.sources,C,E);const D=[];g.layers&&g.layers.forEach(z=>{z.source&&E[z.source]?T.push({command:Oi.removeLayer,args:[z.id]}):D.push(z)});let L=g.terrain;L&&E[L.source]&&(T.push({command:Oi.setTerrain,args:[void 0]}),L=void 0),T=T.concat(C),k(L,x.terrain)||T.push({command:Oi.setTerrain,args:[x.terrain]}),function(z,B,V){B=B||[];const H=(z=z||[]).map(go),W=B.map(go),q=z.reduce(Zc,{}),j=B.reduce(Zc,{}),Y=H.slice(),re=Object.create(null);let Q,se,X,oe,ue,de,_e;for(Q=0,se=0;Q<H.length;Q++)X=H[Q],j.hasOwnProperty(X)?se++:(V.push({command:Oi.removeLayer,args:[X]}),Y.splice(Y.indexOf(X,se),1));for(Q=0,se=0;Q<W.length;Q++)X=W[W.length-1-Q],Y[Y.length-1-Q]!==X&&(q.hasOwnProperty(X)?(V.push({command:Oi.removeLayer,args:[X]}),Y.splice(Y.lastIndexOf(X,Y.length-se),1)):se++,de=Y[Y.length-Q],V.push({command:Oi.addLayer,args:[j[X],de]}),Y.splice(Y.length-Q,0,X),re[X]=!0);for(Q=0;Q<W.length;Q++)if(X=W[Q],oe=q[X],ue=j[X],!re[X]&&!k(oe,ue))if(k(oe.source,ue.source)&&k(oe["source-layer"],ue["source-layer"])&&k(oe.type,ue.type)){for(_e in _o(oe.layout,ue.layout,V,X,null,Oi.setLayoutProperty),_o(oe.paint,ue.paint,V,X,null,Oi.setPaintProperty),k(oe.slot,ue.slot)||V.push({command:Oi.setSlot,args:[X,ue.slot]}),k(oe.filter,ue.filter)||V.push({command:Oi.setFilter,args:[X,ue.filter]}),k(oe.minzoom,ue.minzoom)&&k(oe.maxzoom,ue.maxzoom)||V.push({command:Oi.setLayerZoomRange,args:[X,ue.minzoom,ue.maxzoom]}),oe)oe.hasOwnProperty(_e)&&_e!=="layout"&&_e!=="paint"&&_e!=="filter"&&_e!=="metadata"&&_e!=="minzoom"&&_e!=="maxzoom"&&_e!=="slot"&&(_e.indexOf("paint.")===0?_o(oe[_e],ue[_e],V,X,_e.slice(6),Oi.setPaintProperty):k(oe[_e],ue[_e])||V.push({command:Oi.setLayerProperty,args:[X,_e,ue[_e]]}));for(_e in ue)ue.hasOwnProperty(_e)&&!oe.hasOwnProperty(_e)&&_e!=="layout"&&_e!=="paint"&&_e!=="filter"&&_e!=="metadata"&&_e!=="minzoom"&&_e!=="maxzoom"&&_e!=="slot"&&(_e.indexOf("paint.")===0?_o(oe[_e],ue[_e],V,X,_e.slice(6),Oi.setPaintProperty):k(oe[_e],ue[_e])||V.push({command:Oi.setLayerProperty,args:[X,_e,ue[_e]]}))}else V.push({command:Oi.removeLayer,args:[X]}),de=Y[Y.lastIndexOf(X)+1],V.push({command:Oi.addLayer,args:[ue,de]})}(D,x.layers,T)}catch(E){console.warn("Unable to compute style diff:",E),T=[{command:Oi.setStyle,args:[x]}]}return T}(this.serialize(),n).filter(g=>!(g.command in Na));if(a.length===0)return!1;const f=a.filter(g=>!(g.command in rp));if(f.length>0)throw new Error(`Unimplemented: ${f.map(g=>g.command).join(", ")}.`);return a.forEach(g=>{this[g.command].apply(this,g.args)}),this.stylesheet=n,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(n,a){return this.getImage(n)?this.fire(new r.a(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,this.scope,a),this._afterImageUpdated(n),this)}updateImage(n,a){this.imageManager.updateImage(n,this.scope,a)}getImage(n){return this.imageManager.getImage(n,this.scope)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n,this.scope),this._afterImageUpdated(n),this):this.fire(new r.a(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(n),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new r.b("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(n,a,f={}){return this._checkLoaded(),this._validate(Ot,`models.${n}`,a,null,f)||(this.modelManager.addModel(n,a,this.scope),this._changes.setDirty()),this}hasModel(n){return this.modelManager.hasModel(n,this.scope)}removeModel(n){return this.hasModel(n)?(this.modelManager.removeModel(n,this.scope),this):this.fire(new r.a(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(n,a,f={}){if(this._checkLoaded(),this.getOwnSource(n)!==void 0)throw new Error(`There is already a source with ID "${n}".`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(li,`sources.${n}`,a,null,f))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const g=rr(n,a,this.dispatcher,this);g.scope=this.scope,g.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(g.id),source:g.serialize(),sourceId:g.id}));const x=T=>{const E=(T?"symbol:":"other:")+g.id,C=r.ag(E,this.scope),D=this._sourceCaches[E]=new bs(C,g,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[g.id]=D,D.onAdd(this.map)};x(!1),a.type!=="vector"&&a.type!=="geojson"||x(!0),g.onAdd&&g.onAdd(this.map),f.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(n){this._checkLoaded();const a=this.getOwnSource(n);if(!a)throw new Error("There is no source with this ID");for(const g in this._layers)if(this._layers[g].source===n)return this.fire(new r.a(new Error(`Source "${n}" cannot be removed while layer "${g}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===n)return this.fire(new r.a(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const f=this.getOwnSourceCaches(n);for(const g of f){const x=r.c3(g.id);delete this._sourceCaches[x],this._changes.discardSourceCacheUpdate(g.id),g.fire(new r.b("data",{sourceDataType:"metadata",dataType:"source",sourceId:g.getSource().id})),g.setEventedParent(null),g.clearTiles()}return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],this.mergeSources(),a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(n,a){this._checkLoaded(),this.getOwnSource(n).setData(a),this._changes.setDirty()}getOwnSource(n){const a=this.getOwnSourceCache(n);return a&&a.getSource()}getOwnSources(){const n=[];for(const a in this._otherSourceCaches){const f=this.getOwnSourceCache(a);f&&n.push(f.getSource())}return n}areTilesLoaded(){const n=this._mergedSourceCaches;for(const a in n){const f=n[a]._tiles;for(const g in f){const x=f[g];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}setLights(n){if(this._checkLoaded(),!n)return delete this.ambientLight,void delete this.directionalLight;const a=this._getTransitionParameters();for(const g of n){if(this._validate(Ce,"lights",g))return;switch(g.type){case"ambient":if(this.ambientLight){const x=this.ambientLight;x.set(g),x.updateTransitions(a)}else this.ambientLight=new Dr(g,Ur,this.scope,this.options);break;case"directional":if(this.directionalLight){const x=this.directionalLight;x.set(g),x.updateTransitions(a)}else this.directionalLight=new Dr(g,tr,this.scope,this.options)}}const f=new r.K(this.z||0,a);this.ambientLight&&this.ambientLight.recalculate(f),this.directionalLight&&this.directionalLight.recalculate(f),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const n=this.directionalLight,a=this.ambientLight;if(!n||!a)return;const f=z=>.2126*(z[0]<=.03928?z[0]/12.92:Math.pow((z[0]+.055)/1.055,2.4))+.7152*(z[1]<=.03928?z[1]/12.92:Math.pow((z[1]+.055)/1.055,2.4))+.0722*(z[2]<=.03928?z[2]/12.92:Math.pow((z[2]+.055)/1.055,2.4)),g=n.properties.get("color").toArray01(),x=n.properties.get("intensity"),T=n.properties.get("direction"),E=1-r.bQ(T.x,T.y,T.z)[2]/90,C=f(g)*x*E,D=a.properties.get("color").toArray01(),L=a.properties.get("intensity");return(C+f(D)*L)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const n=[];return this.directionalLight&&n.push(this.directionalLight.get()),this.ambientLight&&n.push(this.ambientLight.get()),n}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(n){if(!n)return this;if(r.c4(n)){const a=r.c5(n),f=this.fragments.find(({id:x})=>x===a);if(!f)throw new Error(`Style import not found: ${n}`);const g=r.c3(n);return f.style.getFragmentStyle(g)}{const a=this.fragments.find(({id:f})=>f===n);if(!a)throw new Error(`Style import not found: ${n}`);return a.style}}getConfigProperty(n,a){const f=this.getFragmentStyle(n);if(!f)return null;const g=r.ag(a,f.scope),x=f.options.get(g),T=x?x.value||x.default:null;return T?T.serialize():null}setConfigProperty(n,a,f){const g=r.r(f);if(g.result!=="success")return void wo(this,g.value);const x=g.value.expression,T=this.getFragmentStyle(n);if(!T)return;const E=r.ag(a,T.scope),C=T.options.get(E);C&&(this.options.set(E,{...C,value:x}),this.updateConfigDependencies())}setConfig(n,a){if(this._config=n,n||a)if(a)for(const f in a){let g,x;const T=r.r(a[f].default);if(T.result==="success"&&(g=T.value.expression),n&&n[f]!==void 0){const B=r.r(n[f]);B.result==="success"&&(x=B.value.expression)}const{minValue:E,maxValue:C,stepValue:D,type:L,values:z}=a[f];if(g){const B=r.ag(f,this.scope);this.options.set(B,{default:g,value:x,minValue:E,maxValue:C,stepValue:D,type:L,values:z})}else this.fire(new r.a(new Error(`No schema defined for config option "${f}".`)))}else this.fire(new r.a(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const n of this._configDependentLayers){const a=this.getLayer(n);a&&(a.possiblyEvaluateVisibility(),this._updateLayer(a))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this._changes.setDirty()}addLayer(n,a,f={}){this._checkLoaded();const g=n.id;if(this._layers[g])return void this.fire(new r.a(new Error(`Layer with id "${g}" already exists on this map`)));let x;if(n.type==="custom"){if(wo(this,r.c6(n)))return;x=r.c2(n,this.scope,this.options)}else{if(typeof n.source=="object"&&(this.addSource(g,n.source),n=r.c1(n),n=r.e(n,{source:g})),this._validate(he,`layers.${g}`,n,{arrayIndex:-1},f))return;x=r.c2(n,this.scope,this.options),this._validateLayer(x),x.setEventedParent(this,{layer:{id:g}}),this._serializedLayers[x.id]=x.serialize()}x.isConfigDependent&&this._configDependentLayers.add(x.fqid);let T=this._order.length;if(a){const L=this._order.indexOf(a);if(L===-1)return void this.fire(new r.a(new Error(`Layer with id "${a}" does not exist on this map.`)));x.slot===this._layers[a].slot?T=L:r.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(T,0,g),this._layerOrderChanged=!0,this._layers[g]=x;const E=this.getOwnLayerSourceCache(x),C=!!this.directionalLight&&this.directionalLight.shadowsEnabled();E&&x.canCastShadows()&&C&&(E.castsShadows=!0);const D=this._changes.getRemovedLayer(x);if(D&&x.source&&E&&x.type!=="custom"){this._changes.discardLayerRemoval(x);const L=r.ag(x.source,x.scope);D.type!==x.type?this._changes.updateSourceCache(L,"clear"):(this._changes.updateSourceCache(L,"reload"),E.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),x.scope=this.scope,this.mergeLayers()}moveLayer(n,a){this._checkLoaded();const f=this._checkLayer(n);if(!f||n===a)return;const g=this._order.indexOf(n);this._order.splice(g,1);let x=this._order.length;if(a){const T=this._order.indexOf(a);if(T===-1)return void this.fire(new r.a(new Error(`Layer with id "${a}" does not exist on this map.`)));f.slot===this._layers[a].slot?x=T:r.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,n),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(n){this._checkLoaded();const a=this._checkLayer(n);if(!a)return;a.setEventedParent(null);const f=this._order.indexOf(n);this._order.splice(f,1),delete this._layers[n],delete this._serializedLayers[n],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(a.fqid),this._changes.removeLayer(a);const g=this.getOwnLayerSourceCache(a);if(g&&g.castsShadows){let x=!1;for(const T in this._layers)if(this._layers[T].source===a.source&&this._layers[T].canCastShadows()){x=!0;break}g.castsShadows=x}a.onRemove&&a.onRemove(this.map),this.mergeLayers()}getOwnLayer(n){return this._layers[n]}hasLayer(n){return n in this._mergedLayers}hasLayerType(n){for(const a in this._layers)if(this._layers[a].type===n)return!0;return!1}setLayerZoomRange(n,a,f){this._checkLoaded();const g=this._checkLayer(n);g&&(g.minzoom===a&&g.maxzoom===f||(a!=null&&(g.minzoom=a),f!=null&&(g.maxzoom=f),this._updateLayer(g)))}setSlot(n,a){this._checkLoaded();const f=this._checkLayer(n);f&&f.slot!==a&&(f.slot=a,this._updateLayer(f))}setFilter(n,a,f={}){this._checkLoaded();const g=this._checkLayer(n);if(g&&!k(g.filter,a))return a==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(Le,`layers.${g.id}.filter`,a,{layerType:g.type},f)||(g.filter=r.c1(a),this._updateLayer(g)))}getFilter(n){const a=this._checkLayer(n);if(a)return r.c1(a.filter)}setLayoutProperty(n,a,f,g={}){this._checkLoaded();const x=this._checkLayer(n);if(x&&!k(x.getLayoutProperty(a),f)){if(f!=null&&(!g||g.validate!==!1)&&wo(x,Xe.call(kt,{key:`layers.${n}.layout.${a}`,layerType:x.type,objectKey:a,value:f,styleSpec:r.D,style:{glyphs:!0,sprite:!0}})))return;x.setLayoutProperty(a,f),x.isConfigDependent&&this._configDependentLayers.add(x.fqid),this._updateLayer(x)}}getLayoutProperty(n,a){const f=this._checkLayer(n);if(f)return f.getLayoutProperty(a)}setPaintProperty(n,a,f,g={}){this._checkLoaded();const x=this._checkLayer(n);if(!x||k(x.getPaintProperty(a),f)||f!=null&&(!g||g.validate!==!1)&&wo(x,Ve.call(kt,{key:`layers.${n}.paint.${a}`,layerType:x.type,objectKey:a,value:f,styleSpec:r.D})))return;const T=x.setPaintProperty(a,f);x.isConfigDependent&&this._configDependentLayers.add(x.fqid),T&&this._updateLayer(x),this._changes.updatePaintProperties(x)}getPaintProperty(n,a){const f=this._checkLayer(n);if(f)return f.getPaintProperty(a)}setFeatureState(n,a){this._checkLoaded();const f=n.source,g=n.sourceLayer,x=this._checkSource(f);if(!x)return;const T=x.type;if(T==="geojson"&&g)return void this.fire(new r.a(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!g)return void this.fire(new r.a(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new r.a(new Error("The feature id parameter must be provided.")));const E=this.getOwnSourceCaches(f);for(const C of E)C.setFeatureState(g,n.id,a)}removeFeatureState(n,a){this._checkLoaded();const f=n.source,g=this._checkSource(f);if(!g)return;const x=g.type,T=x==="vector"?n.sourceLayer:void 0;if(x==="vector"&&!T)return void this.fire(new r.a(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new r.a(new Error("A feature id is required to remove its specific state property.")));const E=this.getOwnSourceCaches(f);for(const C of E)C.removeFeatureState(T,n.id,a)}getFeatureState(n){this._checkLoaded();const a=n.source,f=n.sourceLayer,g=this._checkSource(a);if(g){if(g.type!=="vector"||f)return n.id===void 0&&this.fire(new r.a(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(a)[0].getFeatureState(f,n.id);this.fire(new r.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(n){return this.stylesheet.transition=r.e({},this.stylesheet.transition,n),this.transition=this.stylesheet.transition,this}getTransition(){return r.e({},this.stylesheet.transition)}serialize(){this._checkLoaded();const n=this.getTerrain(),a=n&&this.terrain&&this.terrain.scope===this.scope?n:this.stylesheet.terrain;return r.c7({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:a,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},f=>f!==void 0)}_updateLayer(n){this._changes.updateLayer(n);const a=this.getLayerSourceCache(n),f=r.ag(n.source,n.scope),g=this._changes.getUpdatedSourceCaches();n.source&&!g[f]&&a&&a.getSource().type!=="raster"&&(this._changes.updateSourceCache(f,"reload"),a.pause()),n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const a=E=>this._mergedLayers[E].type==="fill-extrusion"||this._mergedLayers[E].type==="model",f=this.order,g={},x=[];for(let E=f.length-1;E>=0;E--){const C=f[E];if(a(C)){g[C]=E;for(const D of n){const L=D[C];if(L)for(const z of L)x.push(z)}}}x.sort((E,C)=>C.intersectionZ-E.intersectionZ);const T=[];for(let E=f.length-1;E>=0;E--){const C=f[E];if(a(C))for(let D=x.length-1;D>=0;D--){const L=x[D].feature;if(g[L.layer.id]<E)break;T.push(L),x.pop()}else for(const D of n){const L=D[C];if(L)for(const z of L)T.push(z.feature)}}return T}queryRenderedFeatures(n,a,f){a&&a.filter&&this._validate(Le,"queryRenderedFeatures.filter",a.filter,null,a),a.scope=this.scope,a.availableImages=this._availableImages,a.serializedLayers=this._serializedLayers;const g={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new r.a(new Error("parameters.layers must be an Array."))),[];for(const D of a.layers){const L=this._mergedLayers[D];if(!L)return this.fire(new r.a(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];g[L.source]=!0}}const x=[],T=a.serializedLayers||{},E=a&&a.layers?a.layers.some(D=>{const L=this.getLayer(D);return L&&L.is3D()}):this.has3DLayers(),C=Yn.createFromScreenPoints(n,f);for(const D in this._mergedSourceCaches){const L=this._mergedSourceCaches[D].getSource();if(!L||L.scope!==a.scope)continue;const z=this._mergedSourceCaches[D].getSource().id;a.layers&&!g[z]||x.push(uh(this._mergedSourceCaches[D],this._mergedLayers,T,C,a,f,E,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(D,L,z,B,V,H,W){const q={},j=H.queryRenderedSymbols(B),Y=[];for(const re of Object.keys(j).map(Number))Y.push(W[re]);Y.sort(La);for(const re of Y){const Q=re.featureIndex.lookupSymbolFeatures(j[re.bucketInstanceId],L,re.bucketIndex,re.sourceLayerIndex,V.filter,V.layers,V.availableImages,D);for(const se in Q){const X=q[se]=q[se]||[],oe=Q[se];oe.sort((ue,de)=>{const _e=re.featureSortOrder;if(_e){const Pe=_e.indexOf(ue.featureIndex);return _e.indexOf(de.featureIndex)-Pe}return de.featureIndex-ue.featureIndex});for(const ue of oe)X.push(ue)}}for(const re in q)q[re].forEach(Q=>{const se=Q.feature,X=z(D[re]);if(!X)return;const oe=X.getFeatureState(se.layer["source-layer"],se.id);se.source=se.layer.source,se.layer["source-layer"]&&(se.sourceLayer=se.layer["source-layer"]),se.state=oe});return q}(this._mergedLayers,T,this.getLayerSourceCache.bind(this),C.screenGeometry,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(n,a){a&&a.filter&&this._validate(Le,"querySourceFeatures.filter",a.filter,null,a);const f=this.getOwnSourceCaches(n);let g=[];for(const x of f)g=g.concat($s(x,a));return g}addSourceType(n,a,f){return Ts.getSourceType(n)?f(new Error(`A source type called "${n}" already exists.`)):(Ts.setSourceType(n,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:a.workerSourceURL},f):f(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(n,a,f={}){this._checkLoaded();const g=this.light.getLight();let x=!1;for(const E in n)if(!k(n[E],g[E])){x=!0;break}if(!x)return;const T=this._getTransitionParameters();this.light.setLight(n,a,f),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,a=1){if(this._checkLoaded(),!n)return this.terrainSetForDrapingOnly()&&a!==0||delete this.terrain,n===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let f=n;const g=n.source==null;if(a===1){if(typeof f.source=="object"){const E="terrain-dem-src";this.addSource(E,f.source),f=r.c1(f),f=r.e(f,{source:E})}const x=r.e({},f),T={};if(this.terrain&&g){x.source=this.terrain.get().source;const E=this.terrain?this.getFragmentStyle(this.terrain.scope):null;E&&(T.style=E.serialize())}if(this._validate(Z,"terrain",x,T))return}if(!this.terrain||this.terrain.scope!==this.scope&&!g||this.terrain&&a!==this.terrain.drapeRenderMode){if(!f)return;this._createTerrain(f,a),this.fire(new r.b("data",{dataType:"style"}))}else{const x=this.terrain,T=x.get();for(const E of Object.keys(r.D.terrain))!f.hasOwnProperty(E)&&r.D.terrain[E].default&&(f[E]=r.D.terrain[E].default);for(const E in n)if(!k(n[E],T[E])){x.set(n,this.options),this.stylesheet.terrain=n;const C=this._getTransitionParameters({duration:0});x.updateTransitions(C),this.fire(new r.b("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const a=this.fog=new Or(n,this.map.transform,this.scope,this.options);this.stylesheet.fog=a.get();const f=this._getTransitionParameters({duration:0});a.updateTransitions(f)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog;if(!k(a.get(),n)){a.set(n,this.options),this.stylesheet.fog=a.get();const f=this._getTransitionParameters({duration:0});a.updateTransitions(f)}}else this._createFog(n);this._markersNeedUpdate=!0}_getTransitionParameters(n){return{now:r.f.now(),transition:r.e(this.transition,n)}}updateDrapeFirstLayers(){if(!this.terrain)return;const n=[],a=[];for(const f in this._mergedLayers)this.isLayerDraped(this._mergedLayers[f])?n.push(f):a.push(f);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...a)}_createTerrain(n,a){const f=this.terrain=new dn(n,a,this.scope,this.options);a===1&&(this.stylesheet.terrain=n),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const g=this._getTransitionParameters({duration:0});f.updateTransitions(g)}_force3DLayerUpdate(){for(const n in this._layers){const a=this._layers[n];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const a=this._layers[n];a.type==="symbol"&&this._updateLayer(a)}}_validate(n,a,f,g,x={}){if(x&&x.validate===!1)return!1;const T=r.e({},this.serialize());return wo(this,n.call(kt,r.e({key:a,style:T,value:f,styleSpec:r.D},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.c8.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._mergedLayers)this._mergedLayers[n].setEventedParent(null);for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles(),this._mergedSourceCaches[n].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(n){const a=this.getSourceCaches(n);for(const f of a)f.clearTiles()}clearSources(){for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles()}reloadSource(n){const a=this.getSourceCaches(n);for(const f of a)f.resume(),f.reload()}reloadSources(){for(const n of this.getSources())n.reload&&n.reload()}updateSources(n){let a;this.directionalLight&&(a=tu(this.directionalLight));for(const f in this._mergedSourceCaches)this._mergedSourceCaches[f].update(n,void 0,void 0,a)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const a=this._sourceCaches[n];a.resume(),a.reload()}}_updatePlacement(n,a,f,g,x=!1){let T=!1,E=!1;const C={},D={};for(const L of this._mergedOrder){const z=this._mergedLayers[L];if(z.type!=="symbol")continue;const B=r.ag(z.source,z.scope);let V=C[B];if(!V){const W=this.getLayerSourceCache(z);if(!W)continue;const q=W.getRenderableIds(!0).map(j=>W.getTileByID(j));D[B]=q.slice(),V=C[B]=q.sort((j,Y)=>Y.tileID.overscaledZ-j.tileID.overscaledZ||(j.tileID.isLessThan(Y.tileID)?-1:1))}const H=this.crossTileSymbolIndex.addLayer(z,V,n.center.lng,n.projection);T=T||H}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),x=x||this._layerOrderChanged||f===0,this._layerOrderChanged&&this.fire(new r.b("neworder")),(x||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.f.now(),n.zoom))&&(this.pauseablePlacement=new Jc(n,this._mergedOrder,x,a,f,g,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,C,D),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.f.now()),E=!0),T&&this.pauseablePlacement.placement.setStale()),E||T){this._buildingIndex.onNewFrame(n.zoom);for(const L of this._mergedOrder){const z=this._mergedLayers[L];z.type==="symbol"&&this.placement.updateLayerOpacities(z,C[r.ag(z.source,z.scope)])}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.f.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}addImport(n,a){this._checkLoaded();const f=this.stylesheet.imports=this.stylesheet.imports||[];if(f.findIndex(({id:x})=>x===n.id)!==-1)return this.fire(new r.a(new Error(`Import with id '${n.id}' already exists in the map's style.`)));if(!a)return f.push(n),this._loadImports([n],!0),this;const g=f.findIndex(({id:x})=>x===a);return g===-1?this.fire(new r.a(new Error(`Import with id "${a}" does not exist on this map.`))):(this.stylesheet.imports=f.slice(0,g).concat(n).concat(f.slice(g)),this._loadImports([n],!0,a),this)}updateImport(n,a){this._checkLoaded();const f=this.stylesheet.imports||[],g=this.getImportIndex(n);return g===-1?this:typeof a=="string"?(this.setImportUrl(n,a),this):(a.url&&a.url!==f[g].url&&this.setImportUrl(n,a.url),k(a.config,f[g].config)||this.setImportConfig(n,a.config),k(a.data,f[g].data)||this.setImportData(n,a.data),this)}moveImport(n,a){this._checkLoaded();let f=this.stylesheet.imports||[];const g=this.getImportIndex(n);if(g===-1)return this;const x=this.getImportIndex(a);if(x===-1)return this;const T=f[g],E=this.fragments[g];return f=f.filter(({id:C})=>C!==n),this.fragments=this.fragments.filter(({id:C})=>C!==n),this.stylesheet.imports=f.slice(0,x).concat(T).concat(f.slice(x)),this.fragments=this.fragments.slice(0,x).concat(E).concat(this.fragments.slice(x)),this.mergeLayers(),this}setImportUrl(n,a){this._checkLoaded();const f=this.stylesheet.imports||[],g=this.getImportIndex(n);if(g===-1)return this;f[g].url=a;const x=this.fragments[g];return x.style=this._createFragmentStyle(f[g]),x.style.on("style.import.load",()=>this.mergeAll()),x.style.loadURL(a),this}setImportData(n,a){this._checkLoaded();const f=this.getImportIndex(n),g=this.stylesheet.imports||[];return f===-1?this:a?(this.fragments[f].style.setState(a),this._reloadImports(),this):(delete g[f].data,this.setImportUrl(n,g[f].url))}setImportConfig(n,a){this._checkLoaded();const f=this.getImportIndex(n),g=this.stylesheet.imports||[];if(f===-1)return this;a?g[f].config=a:delete g[f].config;const x=this.fragments[f],T=x.style.stylesheet&&x.style.stylesheet.schema;return x.config=a,x.style.setConfig(a,T),this.updateConfigDependencies(),this}removeImport(n){this._checkLoaded();const a=this.stylesheet.imports||[],f=this.getImportIndex(n);return f===-1||(a.splice(f,1),this.fragments[f].style._remove(),this.fragments.splice(f,1),this._reloadImports()),this}getImportIndex(n){const a=(this.stylesheet.imports||[]).findIndex(f=>f.id===n);return a===-1&&this.fire(new r.a(new Error(`Import '${n}' does not exist in the map's style and cannot be updated.`))),a}getLayer(n){return this._mergedLayers[n]}getSources(){const n=[];for(const a in this._mergedOtherSourceCaches){const f=this._mergedOtherSourceCaches[a];f&&n.push(f.getSource())}return n}getSource(n,a){const f=this.getSourceCache(n,a);return f&&f.getSource()}getLayerSource(n){const a=this.getLayerSourceCache(n);return a&&a.getSource()}getSourceCache(n,a){const f=r.ag(n,a);return this._mergedOtherSourceCaches[f]}getLayerSourceCache(n){const a=r.ag(n.source,n.scope);return n.type==="symbol"?this._mergedSymbolSourceCaches[a]:this._mergedOtherSourceCaches[a]}getSourceCaches(n){const a=[];return this._mergedOtherSourceCaches[n]&&a.push(this._mergedOtherSourceCaches[n]),this._mergedSymbolSourceCaches[n]&&a.push(this._mergedSymbolSourceCaches[n]),a}updateSourceCaches(){const n=this._changes.getUpdatedSourceCaches();for(const a in n){const f=n[a];f==="reload"?this.reloadSource(a):f==="clear"&&this.clearSource(a)}}updateLayers(n){const a=this._changes.getUpdatedPaintProperties();for(const f of a){const g=this.getLayer(f);g&&g.updateTransitions(n)}}getImages(n,a,f){this.imageManager.getImages(a.icons,a.scope,f),this._updateTilesForChangedImages();const g=x=>{x&&x.setDependencies(a.tileID.key,a.type,a.icons)};g(this._otherSourceCaches[a.source]),g(this._symbolSourceCaches[a.source])}getGlyphs(n,a,f){this.glyphManager.getGlyphs(a.stacks,a.scope,f)}getResource(n,a,f){return r.c9(a,f)}getOwnSourceCache(n){return this._otherSourceCaches[n]}getOwnLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}getOwnSourceCaches(n){const a=[];return this._otherSourceCaches[n]&&a.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&a.push(this._symbolSourceCaches[n]),a}_isSourceCacheLoaded(n){const a=this.getOwnSourceCaches(n);return a.length===0?(this.fire(new r.a(new Error(`There is no source with ID '${n}'`))),!1):a.every(f=>f.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(n=>{n.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ts.getSourceType=function(d){return Gs[d]},Ts.setSourceType=function(d,n){Gs[d]=n},Ts.registerForPluginStateChange=r.bV;var iu=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,nu=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}`,ru=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,su="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",kh=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Rh=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,op=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Va=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Ua=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform vec2 u_velocity_res;uniform float u_max_speed;const vec2 INVALID_VELOCITY=vec2(-1);uniform vec2 u_texture_offset;uniform float u_data_offset;uniform vec4 u_data_scale;vec2 lookup_velocity(vec2 uv) {uv=u_texture_offset.x+u_texture_offset.y*uv;vec2 fxy;ivec4 c=_raTexLinearCoord(uv,u_velocity_res,fxy);vec4 tl=texelFetch(u_velocity,c.yz,0);vec4 tr=texelFetch(u_velocity,c.xz,0);vec4 bl=texelFetch(u_velocity,c.yw,0);vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NODATA) {return INVALID_VELOCITY;}if (tr==NODATA) {return INVALID_VELOCITY;}if (bl==NODATA) {return INVALID_VELOCITY;}if (br==NODATA) {return INVALID_VELOCITY;}vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);
#ifdef DATA_FORMAT_UINT32
vec2 velocity=vec2(u_data_offset+dot(t,u_data_scale),0);return velocity;
#else
vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));
#endif
return velocity/max(u_max_speed,length(velocity));}
#endif`,zh=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Ul=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const ja=[];To(iu,ja),To(ru,ja),To(nu,ja);const is={"_prelude_fog.vertex.glsl":Rh,"_prelude_terrain.vertex.glsl":kh,"_prelude_shadow.vertex.glsl":zh,"_prelude_fog.fragment.glsl":op,"_prelude_shadow.fragment.glsl":Ul,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Va,"_prelude_raster_particle.glsl":Ua},Ga={};Vi("",kh),Vi(op,Rh),Vi(Ul,zh),Vi(Va,""),Vi(Ua,"");const Oh=Vi(nu,ru),ou=iu;var Fh={background:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Vi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Vi(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Vi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Vi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Vi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Vi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Vi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Vi(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Vi(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Vi(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;vec2 uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
vec2 uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Vi("precision highp float;uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`precision highp float;
#include "_prelude_raster_array.glsl"
#include "_prelude_raster_particle.glsl"
in vec3 a_pos;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {vec2 pos=a_pos.xy+u_tile_offset;vec2 tex_coords=fract(pos);gl_PointSize=1.0;vec2 velocity=lookup_velocity(tex_coords);if (velocity==INVALID_VELOCITY) {v_particle_speed=0.0;gl_Position=vec4(2.0,2.0,2.0,1.0);} else {v_particle_speed=length(velocity);gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);}}`),rasterParticleTexture:Vi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {v_tex_pos=0.5*a_pos+vec2(0.5);gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Vi("void main() {}",`#include "_prelude_raster_array.glsl"
#include "_prelude_raster_particle.glsl"
in vec3 a_pos;uniform float u_speed_factor;uniform float u_lifetime_delta;uniform float u_rand_seed;out vec3 v_new_particle;const vec3 rand_constants=vec3(12.9898,78.233,4375.85453);float rand(const vec2 co) {float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {float lifetime=a_pos.z;vec2 pos=a_pos.xy;vec2 uv=clamp(pos,vec2(0.0),vec2(1.0));vec2 velocity=lookup_velocity(uv);float next_lifetime=lifetime-u_lifetime_delta;float t=step(0.0,next_lifetime);
#ifdef DATA_FORMAT_UINT32
vec2 dp=vec2(0);
#else
vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;
#endif
vec2 seed=pos*u_rand_seed;vec2 next_pos=pos+dp;vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));v_new_particle=vec3(
vec2(mix(random_pos,next_pos,t)),mix(1.0,next_lifetime,t)
);}`),symbolIcon:Vi(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
uniform mediump float u_icon_saturation;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;
#else
out_color=texture(u_texture,v_tex_a)*alpha;
#endif
#ifdef SATURATION
vec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:Vi(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:Vi(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Vi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Vi(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,su),skyboxGradient:Vi(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,su),skyboxCapture:Vi(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Vi(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=local_pos;
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Vi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Vi(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function To(d,n){const a=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let f of a)if(f=f.trim(),f[0]==="#"&&f.includes("if")&&!f.includes("endif")){f=f.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const g=f.split(" ");for(const x of g)n.includes(x)||n.push(x)}}function Vi(d,n){const a=/#include\s+"([^"]+)"/g,f=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let g=n.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);g&&(g=g.map(D=>{const L=D.split(" ");return L[L.length-1]}),g=[...new Set(g)]);const x={},T=[],E=[];if(d=d.replace(a,(D,L)=>(E.push(L),"")),(n=n.replace(a,(D,L)=>(T.push(L),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let C=[...ja];To(d,C),To(n,C);for(const D of[...T,...E])is[D]||console.error(`Undefined include: ${D}`),Ga[D]||(Ga[D]=[],To(is[D],Ga[D])),C=[...C,...Ga[D]];return{fragmentSource:d=d.replace(f,(D,L,z,B,V)=>(x[V]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${V}
in ${z} ${B} ${V};
#else
uniform ${z} ${B} u_${V};
#endif
`:L==="initialize"?`
#ifdef HAS_UNIFORM_u_${V}
    ${z} ${B} ${V} = u_${V};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${z} ${B} ${V};
#endif
`:L==="initialize-attribute"?"":void 0)),vertexSource:n=n.replace(f,(D,L,z,B,V)=>{const H=B==="float"?"vec2":B,W=V.match(/color/)?"color":H;return L==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${V}
in ${z} ${B} a_${V};
#endif
`:x[V]?L==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${z} ${H} a_${V};
out ${z} ${B} ${V};
#else
uniform ${z} ${B} u_${V};
#endif
`:L==="initialize"?W==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = a_${V};
#else
    ${z} ${B} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = unpack_mix_${W}(a_${V}, u_${V}_t);
#else
    ${z} ${B} ${V} = u_${V};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${z} ${B} a_${V};
    out ${z} ${B} ${V};
#endif
`:L==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${V} = a_${V};
#endif
`:void 0:L==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${z} ${H} a_${V};
#else
uniform ${z} ${B} u_${V};
#endif
`:L==="define-instanced"?W==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${V}0;
in vec4 a_${V}1;
in vec4 a_${V}2;
in vec4 a_${V}3;
#else
uniform ${z} ${B} u_${V};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${z} ${H} a_${V};
#else
uniform ${z} ${B} u_${V};
#endif
`:L==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${z} ${B} ${V} = a_${V};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${z} ${B} ${V} = a_${V};
#else
    ${z} ${B} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${z} ${B} ${V} = unpack_mix_${W}(a_${V}, u_${V}_t);
#else
    ${z} ${B} ${V} = u_${V};
#endif
`}),staticAttributes:g,usedDefines:C,vertexIncludes:T,fragmentIncludes:E}}class Bh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,a,f,g,x,T,E,C){this.context=n;let D=this.boundPaintVertexBuffers.length!==g.length;for(let z=0;!D&&z<g.length;z++)this.boundPaintVertexBuffers[z]!==g[z]&&(D=!0);let L=this.boundDynamicVertexBuffers.length!==E.length;for(let z=0;!L&&z<E.length;z++)this.boundDynamicVertexBuffers[z]!==E[z]&&(L=!0);if(!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==f||D||L||this.boundIndexBuffer!==x||this.boundVertexOffset!==T)this.freshBind(a,f,g,x,T,E,C);else{n.bindVertexArrayOES.set(this.vao);for(const z of E)z&&(z.bind(),C&&z.instanceCount&&z.setVertexAttribDivisor(n.gl,a,C));x&&x.dynamicDraw&&x.bind()}}freshBind(n,a,f,g,x,T,E){const C=n.numAttributes,D=this.context,L=D.gl;this.vao&&this.destroy(),this.vao=D.gl.createVertexArray(),D.bindVertexArrayOES.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=g,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=T,a.enableAttributes(L,n),a.bind(),a.setVertexAttribPointers(L,n,x);for(const z of f)z.enableAttributes(L,n),z.bind(),z.setVertexAttribPointers(L,n,x);for(const z of T)z&&(z.enableAttributes(L,n),z.bind(),z.setVertexAttribPointers(L,n,x),E&&z.instanceCount&&z.setVertexAttribDivisor(L,n,E));g&&g.bind(),D.currentNumAttributes=C}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function ig(d,n){const a=Math.pow(2,n.canonical.z),f=n.canonical.y;return[new r.L(0,f/a).toLngLat().lat,new r.L(0,(f+1)/a).toLngLat().lat]}function au(d,n,a,f,g,x,T){const E=d.context,C=E.gl,D=a.hillshadeFBO;if(!D)return;d.prepareDrawTile();const L=d.isTileAffectedByFog(n),z=d.getOrCreateProgram("hillshade",{overrideFog:L});E.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,D.colorAttachment.get());const B=((q,j,Y,re)=>{const Q=Y.paint.get("hillshade-shadow-color"),se=Y.paint.get("hillshade-highlight-color"),X=Y.paint.get("hillshade-accent-color"),oe=Y.paint.get("hillshade-emissive-strength");let ue=r.bj(Y.paint.get("hillshade-illumination-direction"));if(Y.paint.get("hillshade-illumination-anchor")==="viewport")ue-=q.transform.angle;else if(q.style&&q.style.enable3dLights()&&q.style.directionalLight){const _e=q.style.directionalLight.properties.get("direction"),Pe=r.bQ(_e.x,_e.y,_e.z);ue=r.bj(Pe[1])}const de=!q.options.moving;return{u_matrix:re||q.transform.calculateProjMatrix(j.tileID.toUnwrapped(),de),u_image:0,u_latrange:ig(0,j.tileID),u_light:[Y.paint.get("hillshade-exaggeration"),ue],u_shadow:Q,u_highlight:se,u_emissive_strength:oe,u_accent:X}})(d,a,f,d.terrain?n.projMatrix:null);d.uploadCommonUniforms(E,z,n.toUnwrapped());const{tileBoundsBuffer:V,tileBoundsIndexBuffer:H,tileBoundsSegments:W}=d.getTileBoundsBuffers(a);z.draw(d,C.TRIANGLES,g,x,T,ri.disabled,B,f.id,V,H,W)}function ap(d,n,a){if(!n.needsDEMTextureUpload)return;const f=d.context,g=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||d.getTileTexture(a.stride);const x=a.getPixels();n.demTexture?n.demTexture.update(x,{premultiply:!1}):n.demTexture=new r.T(f,x,g.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function Nh(d,n,a){const f=d.context,g=f.gl;if(!n.dem)return;const x=n.dem;if(f.activeTexture.set(g.TEXTURE1),ap(d,n,x),!n.demTexture)return;n.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE);const T=x.dim;f.activeTexture.set(g.TEXTURE0);let E=n.hillshadeFBO;if(!E){const B=new r.T(f,{width:T,height:T,data:null},g.RGBA);B.bind(g.LINEAR,g.CLAMP_TO_EDGE),E=n.hillshadeFBO=f.createFramebuffer(T,T,!0,"renderbuffer"),E.colorAttachment.set(B.texture)}f.bindFramebuffer.set(E.framebuffer),f.viewport.set([0,0,T,T]);const{tileBoundsBuffer:C,tileBoundsIndexBuffer:D,tileBoundsSegments:L}=d.getMercatorTileBoundsBuffers(),z=[];d.linearFloatFilteringSupported()&&z.push("TERRAIN_DEM_FLOAT_FORMAT"),d.getOrCreateProgram("hillshadePrepare",{defines:z}).draw(d,g.TRIANGLES,ni.disabled,di.disabled,Ai.unblended,ri.disabled,((B,V)=>{const H=V.stride,W=r.a6.create();return r.a6.ortho(W,0,r.V,-r.V,0,0,1),r.a6.translate(W,W,[0,-r.V,0]),{u_matrix:W,u_image:1,u_dimension:[H,H],u_zoom:B.overscaledZ}})(n.tileID,x),a.id,C,D,L),n.needsHillshadePrepare=!1}const lp=d=>({u_matrix:new r.bK(d),u_image0:new r.bO(d),u_skirt_height:new r.bN(d),u_ground_shadow_factor:new r.bM(d)}),lu=(d,n,a)=>({u_matrix:d,u_image0:0,u_skirt_height:n,u_ground_shadow_factor:a}),cp=(d,n,a,f,g,x,T,E,C,D,L,z,B,V,H,W)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(f),u_merc_matrix:a,u_zoom_transition:g,u_merc_center:x,u_image0:0,u_frustum_tl:T,u_frustum_tr:E,u_frustum_br:C,u_frustum_bl:D,u_globe_pos:L,u_globe_radius:z,u_viewport:B,u_grid_matrix:W?Float32Array.from(W):new Float32Array(9),u_skirt_height:V,u_far_z_cutoff:H});function jl(d,n){return d!=null&&n!=null&&!(!d.hasData()||!n.hasData())&&d.demTexture!=null&&n.demTexture!=null&&d.tileID.key!==n.tileID.key}const $a=new class{constructor(){this.operations={}}newMorphing(d,n,a,f,g){if(d in this.operations){const x=this.operations[d];x.to.tileID.key!==a.tileID.key&&(x.queued=a)}else this.operations[d]={startTime:f,phase:0,duration:g,from:n,to:a,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const n=this.operations[d];return{from:n.from,to:n.to,phase:n.phase}}update(d){for(const n in this.operations){const a=this.operations[n];for(a.phase=(d-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,d)){delete this.operations[n];break}}}_nextOp(d,n){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=n,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},Vh={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Uh(d,n,a){if(n===0)return 0;const f=n<1&&a===514?.25/n:1;return 6*Math.pow(1.5,22-d)*Math.max(n,1)*f}function Wa(d,n){const a=1<<d.z;return!n&&(d.x===0||d.x===a-1)||d.y===0||d.y===a-1}const jh=d=>({u_matrix:d});function Gh(d,n,a,f,g){if(g>0){const x=r.f.now(),T=(x-d.timeAdded)/g,E=n?(x-n.timeAdded)/g:-1,C=a.getSource(),D=f.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),L=!n||Math.abs(n.tileID.overscaledZ-D)>Math.abs(d.tileID.overscaledZ-D),z=L&&d.refreshedUponExpiration?1:r.aa(L?T:1-E,0,1);return d.refreshedUponExpiration&&T>=1&&(d.refreshedUponExpiration=!1),n?{opacity:1,mix:1-z}:{opacity:z,mix:0}}return{opacity:1,mix:0}}class ng extends bs{constructor(n){const a={type:"raster-dem",maxzoom:n.transform.maxZoom},f=new r.bW(r.bX(),null),g=rr("mock-dem",a,f,n.style);super("mock-dem",g,!1),g.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,a){n.state="loaded",a(null)}}class rg extends bs{constructor(n){const a=rr("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new r.bW(r.bX(),null),n.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,a,f){if(n.freezeTileCoverage)return;this.transform=n;const g=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,T)=>{if(x[T.key]="",!this._tiles[T.key]){const E=new mo(T,this._source.tileSize*T.overscaleFactor(),n.tileZoom);E.state="loaded",this._tiles[T.key]=E}return x},{});for(const x in this._tiles)x in g||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(n){const a=this.proxyCachedFBO[n];if(a!==void 0){const f=Object.values(a);this.renderCachePool.push(...f),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class up extends r.am{constructor(n,a,f){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=a,this.projMatrix=f}}class sg extends r.ck{constructor(n,a){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},n.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[f,g,x]=function(C){const D=new r.aN,L=new r.aw,z=131;D.reserve(17161),L.reserve(33800);const B=r.V/128,V=r.V+B/2,H=V+B;for(let q=-B;q<H;q+=B)for(let j=-B;j<H;j+=B){const Y=j<0||j>V||q<0||q>V?24575:0,re=r.aa(Math.round(j),0,r.V),Q=r.aa(Math.round(q),0,r.V);D.emplaceBack(re+Y,Q)}const W=(q,j)=>{const Y=j*z+q;L.emplaceBack(Y+1,Y,Y+z),L.emplaceBack(Y+z,Y+z+1,Y+1)};for(let q=1;q<129;q++)for(let j=1;j<129;j++)W(j,q);return[0,129].forEach(q=>{for(let j=0;j<130;j++)W(j,q),W(q,j)}),[D,L,32768]}(),T=n.context;this.gridBuffer=T.createVertexBuffer(f,r.aP.members),this.gridIndexBuffer=T.createIndexBuffer(g),this.gridSegments=r.aB.simpleSegment(0,0,f.length,g.length),this.gridNoSkirtSegments=r.aB.simpleSegment(0,0,f.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new rg(a.map),this.orthoMatrix=r.a6.create(),r.a6.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.V,0,r.V,0,1);const E=T.gl;this._overlapStencilMode=new di({func:E.GEQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ng(a.map),this._pendingGroundEffectLayers=[]}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),this._style=n,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,a,f){if(n&&n.terrain){this._style!==n&&(this.style=n,this._evaluationZoom=void 0);const g=n.terrain.properties,x=n.terrain.drapeRenderMode===0,T=n.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.f.now();const E=n.terrain&&n.terrain.scope,C=g.get("source"),D=x?this._mockSourceCache:n.getSourceCache(C,E);if(!D)return void r.w(`Couldn't find terrain source "${C}".`);if(this.sourceCache=D,this._exaggeration=T?this.calculateExaggeration(a):g.get("exaggeration"),!a.projection.requiresDraping&&T&&this._exaggeration===0)return void this._disable();this.enabled=!0;const L=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const z=this.getScaledDemTileSize();this.sourceCache.update(a,z,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,L(),this._initializing=!0),L(),a.updateElevation(!0,f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0,this._previousZoom=a.zoom}else this._disable()}calculateExaggeration(n){const a=this._previousCameraAltitude,f=n.getFreeCameraOptions().position.z/n.pixelsPerMeter*n.worldSize;this._previousCameraAltitude=f;const g=a!=null?f-a:Number.MAX_VALUE;if(Math.abs(g)<2)return this._exaggeration;const x=n.zoom,T=this._style.terrain;if(!this._previousUpdateTimestamp)return T.getExaggeration(x);let E=x-this._previousZoom;const C=this._previousUpdateTimestamp;let D=x;this._evaluationZoom!=null&&(D=this._evaluationZoom,Math.abs(x-D)>.5&&(E=.5*(x-D+E)),E*g<0&&(D+=E)),this._evaluationZoom=D;const L=T.getExaggeration(D),z=L===T.getExaggeration(Math.max(0,D-.1));if(z&&Math.abs(L-this._exaggeration)<.01)return L;let B=Math.min(.1,.00375*(this._updateTimestamp-C));return(z||L<.1||Math.abs(E)<1e-4)&&(B=Math.min(.2,4*B)),r.U(this._exaggeration,L,B)}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._mergedSourceCaches)this._style._mergedSourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=f._centerAltitude===0&&this.getAtPointOrZero(r.L.fromLngLat(f.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const g=this.proxyCoords=a.getIds().map(C=>{const D=a.getTileByID(C).tileID;return D.projMatrix=f.calculateProjMatrix(D.toUnwrapped()),D});(function(C,D){const L=D.transform.pointCoordinate(D.transform.getCameraPoint()),z=new r.P(L.x,L.y);C.sort((B,V)=>{if(V.overscaledZ-B.overscaledZ)return V.overscaledZ-B.overscaledZ;const H=new r.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),W=new r.P(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),q=z.mult(1<<B.canonical.z);return q.x-=.5,q.y-=.5,q.distSqr(H)-q.distSqr(W)})})(g,this.painter);const x=this.proxyToSource||{};this.proxyToSource={},g.forEach(C=>{this.proxyToSource[C.key]={}}),this.terrainTileForTile={};const T=this._style._mergedSourceCaches;for(const C in T){const D=T[C];if(!D.used||(D!==this.sourceCache&&this.resetTileLookupCache(D.id),this._setupProxiedCoordsForOrtho(D,n[C],x),D.usedForTerrain))continue;const L=n[C];D.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[a.id]=g.map(C=>new up(C,C.key,this.orthoMatrix)),this._assignTerrainTiles(g),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1;const E={};this._visibleDemTiles=[];for(const C of this.proxyCoords){const D=this.terrainTileForTile[C.key];if(!D)continue;const L=D.tileID.key;L in E||(this._visibleDemTiles.push(D),E[L]=L)}}_assignTerrainTiles(n){this._initializing||n.forEach(a=>{if(this.terrainTileForTile[a.key])return;const f=this._findTileCoveringTileID(a,this.sourceCache);f&&(this.terrainTileForTile[a.key]=f)})}_prepareDEMTextures(){const n=this.painter.context,a=n.gl;for(const f in this.terrainTileForTile){const g=this.terrainTileForTile[f],x=g.dem;!x||g.demTexture&&!g.needsDEMTextureUpload||(n.activeTexture.set(a.TEXTURE1),ap(this.painter,g,x))}}_prepareDemTileUniforms(n,a,f,g){if(!a||a.demTexture==null)return!1;const x=n.tileID.canonical,T=Math.pow(2,a.tileID.canonical.z-x.z),E=g||"";return f[`u_dem_tl${E}`]=[x.x*T%1,x.y*T%1],f[`u_dem_scale${E}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,a=n.gl;if(!this._emptyDepthBufferTexture){const f=new r.h({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new r.T(n,f,a.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const a=this._visibleDemTiles.reduce((f,g)=>{if(!g.dem)return f;const x=g.dem.tree.minimums[0];return x>0&&n++,f+x},0);return n?a/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,a=n.gl;n.activeTexture.set(a.TEXTURE2);const f=this._getLoadedAreaMinimum(),[g,x]=(()=>{const E=new r.cm({width:1,height:1},new Float32Array([f]));return[a.R32F,E]})();this._emptyDEMTextureDirty=!1;let T=this._emptyDEMTexture;return T?T.update(x,{premultiply:!1}):T=this._emptyDEMTexture=new r.T(n,x,g,{premultiply:!1}),T}setupElevationDraw(n,a,f){const g=this.painter.context,x=g.gl,T={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};T.u_exaggeration=this.exaggeration();let E=null,C=null,D=1;if(f&&f.morphing&&this._useVertexMorphing){const B=f.morphing.srcDemTile,V=f.morphing.dstDemTile;D=f.morphing.phase,B&&V&&(this._prepareDemTileUniforms(n,B,T,"_prev")&&(C=B),this._prepareDemTileUniforms(n,V,T)&&(E=V))}const L=B=>B&&B.demTexture&&this.painter.linearFloatFilteringSupported()?x.LINEAR:x.NEAREST,z=B=>{T.u_dem_size=B.size[0]===1?1:B.size[0]-2};if(C&&E)g.activeTexture.set(x.TEXTURE2),E.demTexture.bind(L(E),x.CLAMP_TO_EDGE),g.activeTexture.set(x.TEXTURE4),C.demTexture.bind(L(C),x.CLAMP_TO_EDGE),E.demTexture&&z(E.demTexture),T.u_dem_lerp=D;else{E=this.terrainTileForTile[n.tileID.key],g.activeTexture.set(x.TEXTURE2);const B=this._prepareDemTileUniforms(n,E,T)?E.demTexture:this.emptyDEMTexture;B.bind(L(E),x.CLAMP_TO_EDGE),z(B)}if(g.activeTexture.set(x.TEXTURE3),f&&f.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),this._depthFBO&&(T.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),T.u_depth_size_inv=[1,1]),f&&f.useMeterToDem&&E){const B=(1<<E.tileID.canonical.z)*r.bl(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=B}if(f&&f.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),a.setTerrainUniformValues(g,T),this.painter.transform.projection.name==="globe"){const B=this.globeUniformValues(this.painter.transform,n.tileID.canonical,f&&f.useDenormalizedUpVectorScale);a.setGlobeUniformValues(g,B)}}globeUniformValues(n,a,f){const g=n.projection;return{u_tile_tl_up:g.upVector(a,0,0),u_tile_tr_up:g.upVector(a,r.V,0),u_tile_br_up:g.upVector(a,r.V,r.V),u_tile_bl_up:g.upVector(a,0,r.V),u_tile_up_scale:f?r.cl(1):g.upVectorScale(a,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const a=this.painter,f=this.painter.context;n.length!==0&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(g,x,T,E,C){if(g.transform.projection.name==="globe")(function(D,L,z,B,V){const H=D.context,W=H.gl;let q,j;const Y=D.transform,re=r.cd(D,H,Y),Q=(Ne,Oe)=>{if(j===Oe)return;const et=[Vh[Oe],"PROJECTION_GLOBE_VIEW"];re&&et.push("CUSTOM_ANTIALIASING");const Me=D.isTileAffectedByFog(Ne);q=D.getOrCreateProgram("globeRaster",{defines:et,overrideFog:Me}),j=Oe},se=D.colorModeForRenderPass(),X=new ni(W.LEQUAL,ni.ReadWrite,D.depthRangeFor3D);$a.update(V);const oe=r.ce(Y),ue=[r.a5(Y.center.lng),r.ae(Y.center.lat)],de=D.globeSharedBuffers,_e=[Y.width*r.f.devicePixelRatio,Y.height*r.f.devicePixelRatio],Pe=Float32Array.from(Y.globeMatrix),be={useDenormalizedUpVectorScale:!0};{const Ne=D.transform,Oe=Uh(Ne.zoom,L.exaggeration(),L.sourceCache._source.tileSize);j=-1;const et=W.TRIANGLES;for(const Me of B){const ke=z.getTile(Me),me=di.disabled,Ae=L.prevTerrainTileForTile[Me.key],it=L.terrainTileForTile[Me.key];jl(Ae,it)&&$a.newMorphing(Me.key,Ae,it,V,250),H.activeTexture.set(W.TEXTURE0),ke.texture&&ke.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);const pt=$a.getMorphValuesForProxy(Me.key),ht=pt?1:0;pt&&r.j(be,{morphing:{srcDemTile:pt.from,dstDemTile:pt.to,phase:r.cc(pt.phase)}});const Et=r.cf(Me.canonical),Wt=r.cg(Et.getCenter().lat),Jt=r.ch(Me.canonical,Et,Wt,Ne.worldSize/Ne._pixelsPerMercatorPixel),qt=r.aT(r.ci(Me.canonical)),Yt=cp(Ne.expandedFarZProjMatrix,Pe,oe,qt,r.S(Ne.zoom),ue,Ne.frustumCorners.TL,Ne.frustumCorners.TR,Ne.frustumCorners.BR,Ne.frustumCorners.BL,Ne.globeCenterInViewSpace,Ne.globeRadius,_e,Oe,Ne._farZ,Jt);if(Q(Me,ht),q&&(L.setupElevationDraw(ke,q,be),D.uploadCommonUniforms(H,q,Me.toUnwrapped()),de)){const[vi,ui,mi]=de.getGridBuffers(Wt,Oe!==0);q.draw(D,et,X,me,se,ri.backCCW,Yt,"globe_raster",vi,ui,mi)}}}if(de&&(D.renderDefaultNorthPole||D.renderDefaultSouthPole)){const Ne=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];re&&Ne.push("CUSTOM_ANTIALIASING"),q=D.getOrCreateProgram("globeRaster",{defines:Ne});for(const Oe of B){const{x:et,y:Me,z:ke}=Oe.canonical,me=Me===0,Ae=Me===(1<<ke)-1,[it,pt,ht,Et]=de.getPoleBuffers(ke,!1);if(Et&&(me||Ae)){const Wt=z.getTile(Oe);H.activeTexture.set(W.TEXTURE0),Wt.texture&&Wt.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);let Jt=r.cj(ke,et,Y);const qt=r.aT(r.ci(Oe.canonical)),Yt=(vi,ui)=>vi.draw(D,W.TRIANGLES,X,di.disabled,se,ri.disabled,cp(Y.expandedFarZProjMatrix,Jt,Jt,qt,0,ue,Y.frustumCorners.TL,Y.frustumCorners.TR,Y.frustumCorners.BR,Y.frustumCorners.BL,Y.globeCenterInViewSpace,Y.globeRadius,_e,0,Y._farZ),"globe_pole_raster",ui,ht,Et);L.setupElevationDraw(Wt,q,be),D.uploadCommonUniforms(H,q,Oe.toUnwrapped()),me&&D.renderDefaultNorthPole&&Yt(q,it),Ae&&D.renderDefaultSouthPole&&(Jt=r.a6.scale(r.a6.create(),Jt,[1,-1,1]),Yt(q,pt))}}}})(g,x,T,E,C);else{const D=g.context,L=D.gl;let z,B;const V=g.shadowRenderer,H=bo(g,g.longestCutoffRange),W=se=>{if(B===se)return;const X=[];X.push(Vh[se]),H.shouldRenderCutoff&&X.push("RENDER_CUTOFF"),z=g.getOrCreateProgram("terrainRaster",{defines:X}),B=se},q=g.colorModeForRenderPass(),j=new ni(L.LEQUAL,ni.ReadWrite,g.depthRangeFor3D);$a.update(C);const Y=g.transform,re=Uh(Y.zoom,x.exaggeration(),x.sourceCache._source.tileSize);let Q=[0,0,0];if(V){const se=g.style.directionalLight,X=g.style.ambientLight;se&&X&&(Q=Vl(se,X))}{B=-1;const se=L.TRIANGLES,[X,oe]=[x.gridIndexBuffer,x.gridSegments];for(const ue of E){const de=T.getTile(ue),_e=di.disabled,Pe=x.prevTerrainTileForTile[ue.key],be=x.terrainTileForTile[ue.key];jl(Pe,be)&&$a.newMorphing(ue.key,Pe,be,C,250),D.activeTexture.set(L.TEXTURE0),de.texture&&de.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const Ne=$a.getMorphValuesForProxy(ue.key),Oe=Ne?1:0;let et;Ne&&(et={morphing:{srcDemTile:Ne.from,dstDemTile:Ne.to,phase:r.cc(Ne.phase)}});const Me=lu(ue.projMatrix,Wa(ue.canonical,Y.renderWorldCopies)?re/10:re,Q);if(W(Oe),!z)continue;x.setupElevationDraw(de,z,et);const ke=ue.toUnwrapped();V&&V.setupShadows(ke,z),g.uploadCommonUniforms(D,z,ke,null,H),z.draw(g,se,j,_e,q,ri.backCCW,Me,"terrain_raster",x.gridBuffer,X,oe)}}}}(a,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const a=this.painter,f=this.painter.context,g=this.proxySourceCache,x=this.proxiedCoords[g.id],T=this._drapedRenderBatches.shift(),E=a.style.order,C=[];let D=0;for(const L of x){const z=g.getTileByID(L.proxyTileKey),B=g.proxyCachedFBO[L.key]?g.proxyCachedFBO[L.key][n]:void 0,V=B!==void 0?g.renderCache[B]:this.pool[D++],H=B!==void 0;if(z.texture=V.tex,H&&!V.dirty){C.push(z.tileID);continue}let W;f.bindFramebuffer.set(V.fb.framebuffer),this.renderedToTile=!1,V.dirty&&(f.clear({color:r.ax.transparent,stencil:0}),V.dirty=!1);for(let q=T.start;q<=T.end;++q){const j=a.style._mergedLayers[E[q]];if(j.isHidden(a.transform.zoom))continue;const Y=a.style.getLayerSourceCache(j),re=Y?this.proxyToSource[L.key][Y.id]:[L];if(!re)continue;const Q=re;f.viewport.set([0,0,V.fb.width,V.fb.height]),W!==(Y?Y.id:null)&&(this._setupStencil(V,re,j,Y),W=Y?Y.id:null),a.renderLayer(a,Y,j,Q)}if(this._drapedRenderBatches.length===0)for(const q of this._pendingGroundEffectLayers){const j=a.style._mergedLayers[E[q]];if(j.isHidden(a.transform.zoom))continue;const Y=a.style.getLayerSourceCache(j),re=Y?this.proxyToSource[L.key][Y.id]:[L];if(!re)continue;const Q=re;f.viewport.set([0,0,V.fb.width,V.fb.height]),W!==(Y?Y.id:null)&&(this._setupStencil(V,re,j,Y),W=Y?Y.id:null),a.renderLayer(a,Y,j,Q)}this.renderedToTile?(V.dirty=!0,C.push(z.tileID)):H||--D,D===5&&(D=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,a.width,a.height]),T.end+1}postRender(){}isLayerOrderingCorrect(n){const a=n.order.length;let f=-1,g=a;for(let x=0;x<a;++x)this._style.isLayerDraped(n._mergedLayers[n.order[x]])?f=Math.max(f,x):g=Math.min(g,x);return g>f}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{n=Math.min(n,a.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,a,f){if(!this._visibleDemTiles)return null;const g=this._visibleDemTiles.filter(x=>x.dem).map(x=>{const T=x.tileID,E=1<<T.overscaledZ,{x:C,y:D}=T.canonical,L=C/E,z=(C+1)/E,B=D/E,V=(D+1)/E;return{minx:L,miny:B,maxx:z,maxy:V,t:x.dem.tree.raycastRoot(L,B,z,V,n,a,f),tile:x}});g.sort((x,T)=>(x.t!==null?x.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(const x of g){if(x.t==null)return null;const T=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,n,a,f);if(T!=null)return T}return null}_createFBO(){const n=this.painter.context,a=n.gl,f=this.drapeBufferSize;n.activeTexture.set(a.TEXTURE0);const g=new r.T(n,{width:f[0],height:f[1],data:null},a.RGBA);g.bind(a.LINEAR,a.CLAMP_TO_EDGE);const x=n.createFramebuffer(f[0],f[1],!0,null);return x.colorAttachment.set(g.texture),x.depthAttachment=new Gr(n,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:x,tex:g,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const a=this._style._mergedLayers[n],f=a.isHidden(this.painter.transform.zoom);return a.type==="custom"?!f&&a.shouldRedrape():!f&&a.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const f of this._style.getSources())if(f instanceof At){n=!0;break}if(!n)return;const a={};for(let f=0;f<this._style.order.length;++f){const g=this._style._mergedLayers[this._style.order[f]],x=this._style.getLayerSourceCache(g);if(x&&!a[x.id]&&!g.isHidden(this.painter.transform.zoom)&&g.type==="line"&&g.widthExpression()instanceof r.Z){a[x.id]=!0;for(const T of this.proxyCoords){const E=this.proxyToSource[T.key][x.id];if(E)for(const C of E)this._clearRenderCacheForTile(x.id,C)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const f in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[f]._source instanceof It){n=!0;break}if(!n)return;const a={};for(let f=0;f<this._style.order.length;++f){const g=this._style._mergedLayers[this._style.order[f]],x=this._style.getLayerSourceCache(g);if(!x||a[x.id]||g.isHidden(this.painter.transform.zoom)||g.type!=="raster")continue;const T=g.paint.get("raster-fade-duration");for(const E of this.proxyCoords){const C=this.proxyToSource[E.key][x.id];if(C)for(const D of C){const L=Gh(x.getTile(D),x.findLoadedParent(D,0),x,this.painter.transform,T);(L.opacity!==1||L.mix!==0)&&this._clearRenderCacheForTile(x.id,D)}}}}_setupDrapedRenderBatches(){const n=this._style.order,a=n.length;if(a===0)return;const f=[];this._pendingGroundEffectLayers=[];let g,x=0,T=this._style._mergedLayers[n[x]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++x<a;)T=this._style._mergedLayers[n[x]];for(;x<a;++x){const E=this._style._mergedLayers[n[x]];E.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(E)?g===void 0&&(g=x):(E.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(x),g!==void 0&&(f.push({start:g,end:x-1}),g=void 0)))}if(g!==void 0&&f.push({start:g,end:x-1}),f.length!==0){const E=f[f.length-1];this._pendingGroundEffectLayers.every(C=>C>E.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=f}_setupRenderCache(n){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const T=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let E=0;E<T.length;++E){const C=Object.values(T[E]);a.renderCachePool.push(...C)}}return}this._clearRasterLayersFromRenderCache();const f=this.proxyCoords,g=this._tilesDirty;for(let T=f.length-1;T>=0;T--){const E=f[T];if(a.getTileByID(E.key),a.proxyCachedFBO[E.key]!==void 0){const C=n[E.key],D=this.proxyToSource[E.key];let L=0;for(const z in D){const B=D[z],V=C[z];if(!V||V.length!==B.length||B.some((H,W)=>H!==V[W]||g[z]&&g[z].hasOwnProperty(H.key))){L=-1;break}++L}for(const z in a.proxyCachedFBO[E.key])a.renderCache[a.proxyCachedFBO[E.key][z]].dirty=L<0||L!==Object.values(C).length}}const x=[...this._drapedRenderBatches];x.sort((T,E)=>E.end-E.start-(T.end-T.start));for(const T of x)for(const E of f){if(a.proxyCachedFBO[E.key])continue;let C=a.renderCachePool.pop();C===void 0&&a.renderCache.length<50&&(C=a.renderCache.length,a.renderCache.push(this._createFBO())),C!==void 0&&(a.proxyCachedFBO[E.key]={},a.proxyCachedFBO[E.key][T.start]=C,a.renderCache[C].dirty=!0)}this._tilesDirty={}}_setupStencil(n,a,f,g){if(!g||!this._sourceTilesOverlap[g.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,T=x.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let E;if(f.isTileClipped())E=a.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);E=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+E>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=E,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):di.disabled}_renderTileClippingMasks(n,a){const f=this.painter,g=this.painter.context,x=g.gl;f._tileClippingMaskIDs={},g.setColorMode(Ai.disabled),g.setDepthMode(ni.disabled);const T=f.getOrCreateProgram("clippingMask");for(const E of n){const C=f._tileClippingMaskIDs[E.key]=--a;T.draw(f,x.TRIANGLES,ni.disabled,new di({func:x.ALWAYS,mask:0},C,255,x.KEEP,x.KEEP,x.REPLACE),Ai.disabled,ri.disabled,jh(E.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(n){const a=this.painter.transform;if(n.x<0||n.x>a.width||n.y<0||n.y>a.height)return null;const f=[n.x,n.y,1,1];r.a7.transformMat4(f,f,a.pixelMatrixInverse),r.a7.scale(f,f,1/f[3]),f[0]/=a.worldSize,f[1]/=a.worldSize;const g=a._camera.position,x=r.bl(1,a.center.lat),T=[g[0],g[1],g[2]/x,0],E=r.N.subtract([],f.slice(0,3),T);r.N.normalize(E,E);const C=this.raycast(T,E,this._exaggeration);return C!==null&&C?(r.N.scaleAndAdd(T,T,E,C),T[3]=T[2],T[2]*=x,T):null}drawDepth(){const n=this.painter,a=n.context,f=this.proxySourceCache,g=Math.ceil(n.width),x=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===g&&this._depthFBO.height===x||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const T=a.gl,E=a.createFramebuffer(g,x,!0,"renderbuffer");a.activeTexture.set(T.TEXTURE0);const C=new r.T(a,{width:g,height:x,data:null},T.RGBA);C.bind(T.NEAREST,T.CLAMP_TO_EDGE),E.colorAttachment.set(C.texture);const D=a.createRenderbuffer(a.gl.DEPTH_COMPONENT16,g,x);E.depthAttachment.set(D),this._depthFBO=E,this._depthTexture=C}a.bindFramebuffer.set(this._depthFBO.framebuffer),a.viewport.set([0,0,g,x]),function(T,E,C,D){if(T.transform.projection.name==="globe")return;const L=T.context,z=L.gl;L.clear({depth:1});const B=T.getOrCreateProgram("terrainDepth"),V=new ni(z.LESS,ni.ReadWrite,T.depthRangeFor3D);for(const H of D){const W=C.getTile(H),q=lu(H.projMatrix,0,[0,0,0]);E.setupElevationDraw(W,B),B.draw(T,z.TRIANGLES,V,di.disabled,Ai.unblended,ri.backCCW,q,"terrain_depth",E.gridBuffer,E.gridIndexBuffer,E.gridNoSkirtSegments)}}(n,this,f,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,a,f){if(n.getSource()instanceof r.ap)return this._setupProxiedCoordsForImageSource(n,a,f);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const g=this.proxiedCoords[n.id]=[],x=this.proxyCoords;for(let C=0;C<x.length;C++){const D=x[C],L=this._findTileCoveringTileID(D,n);if(L){const z=this._createProxiedId(D,L,f[D.key]&&f[D.key][n.id]);g.push(z),this.proxyToSource[D.key][n.id]=[z]}}let T=!1;const E=new Set;for(let C=0;C<a.length;C++){const D=n.getTile(a[C]);if(!D||!D.hasData())continue;const L=this._findTileCoveringTileID(D.tileID,this.proxySourceCache);if(L&&L.tileID.canonical.z!==D.tileID.canonical.z){const z=this.proxyToSource[L.tileID.key][n.id],B=this._createProxiedId(L.tileID,D,f[L.tileID.key]&&f[L.tileID.key][n.id]);z?z.splice(z.length-1,0,B):this.proxyToSource[L.tileID.key][n.id]=[B];const V=this.proxyToSource[L.tileID.key][n.id];E.has(V)||E.add(V),g.push(B),T=!0}}if(this._sourceTilesOverlap[n.id]=T,T&&this._debugParams.sortTilesHiZFirst)for(const C of E)C.sort((D,L)=>L.overscaledZ-D.overscaledZ)}_setupProxiedCoordsForImageSource(n,a,f){if(!n.getSource().loaded())return;const g=this.proxiedCoords[n.id]=[],x=this.proxyCoords,T=n.getSource(),E=T.tileID;if(!E)return;const C=new r.P(E.x,E.y)._div(1<<E.z),D=T.coordinates.map(r.L.fromLngLat).reduce((z,B)=>(z.min.x=Math.min(z.min.x,B.x-C.x),z.min.y=Math.min(z.min.y,B.y-C.y),z.max.x=Math.max(z.max.x,B.x-C.x),z.max.y=Math.max(z.max.y,B.y-C.y),z),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),L=(z,B)=>{const V=z.wrap+z.canonical.x/(1<<z.canonical.z),H=z.canonical.y/(1<<z.canonical.z),W=r.V/(1<<z.canonical.z),q=B.wrap+B.canonical.x/(1<<B.canonical.z),j=B.canonical.y/(1<<B.canonical.z);return V+W<q+D.min.x||V>q+D.max.x||H+W<j+D.min.y||H>j+D.max.y};for(let z=0;z<x.length;z++){const B=x[z];for(let V=0;V<a.length;V++){const H=n.getTile(a[V]);if(!H||!H.hasData()||L(B,H.tileID))continue;const W=this._createProxiedId(B,H,f[B.key]&&f[B.key][n.id]),q=this.proxyToSource[B.key][n.id];q?q.push(W):this.proxyToSource[B.key][n.id]=[W],g.push(W)}}}_createProxiedId(n,a,f){let g=this.orthoMatrix;if(f){const x=f.find(T=>T.key===a.tileID.key);if(x)return x}if(a.tileID.key!==n.key){const x=n.canonical.z-a.tileID.canonical.z;let T,E,C;g=r.a6.create();const D=a.tileID.wrap-n.wrap<<n.overscaledZ;x>0?(T=r.V>>x,E=T*((a.tileID.canonical.x<<x)-n.canonical.x+D),C=T*((a.tileID.canonical.y<<x)-n.canonical.y)):(T=r.V<<-x,E=r.V*(a.tileID.canonical.x-(n.canonical.x+D<<-x)),C=r.V*(a.tileID.canonical.y-(n.canonical.y<<-x))),r.a6.ortho(g,0,T,0,T,0,1),r.a6.translate(g,g,[E,C,0])}return new up(a.tileID,n.key,g)}_findTileCoveringTileID(n,a){let f=a.getTile(n);if(f&&f.hasData())return f;const g=this._findCoveringTileCache[a.id],x=g[n.key];if(f=x?a.getTileByID(x):null,f&&f.hasData()||x===null)return f;let T=f?f.tileID:n,E=T.overscaledZ;const C=a.getSource().minzoom,D=[];if(!x){const z=a.getSource().maxzoom;if(n.canonical.z>=z){const B=n.canonical.z-z;a.getSource().reparseOverscaled?(E=Math.max(n.canonical.z+2,a.transform.tileZoom),T=new r.am(E,n.wrap,z,n.canonical.x>>B,n.canonical.y>>B)):B!==0&&(E=z,T=new r.am(E,n.wrap,z,n.canonical.x>>B,n.canonical.y>>B))}T.key!==n.key&&(D.push(T.key),f=a.getTile(T))}const L=z=>{D.forEach(B=>{g[B]=z}),D.length=0};for(E-=1;E>=C&&(!f||!f.hasData());E--){f&&L(f.tileID.key);const z=T.calculateScaledKey(E);if(f=a.getTileByID(z),f&&f.hasData())break;const B=g[z];if(B===null)break;B===void 0?D.push(z):f=a.getTileByID(B)}return L(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,a){let f=this._tilesDirty[n];f||(f=this._tilesDirty[n]={}),f[a.key]=!0}}function $h(d,n,a){const f=function(E,C,D){const L=r.N.dot(C,E),z=r.N.dot(D,[.2126,.7152,.0722]),B=(H,W,q)=>(1-q)*H+q*W,V=B(1-.3*Math.min(z,1),1,Math.min(L+1,1));return B(.92,1,Math.asin(r.aa(C[2],-1,1))/Math.PI+.5)*V}(d,[0,0,1],n),g=[0,0,0];r.N.scale(g,a.slice(0,3),f);const x=[0,0,0];r.N.scale(x,n.slice(0,3),d[2]);const T=[0,0,0];return r.N.add(T,g,x),r.bU(T)}const Wh=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],hp=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Hh{static cacheKey(n,a,f,g){let x=`${a}${g?g.cacheKey:""}`;for(const T of f)n.usedDefines.includes(T)&&(x+=`/${T}`);return x}constructor(n,a,f,g,x,T,E){const C=n.gl;this.program=C.createProgram(),this.configuration=g,this.name=a,this.fixedDefines=[...T];const D=g?g.getBinderAttributes():[],L=(f.staticAttributes||[]).concat(D);let z=g?g.defines():[];z=z.concat(T.map(j=>`#define ${j}`));const B=`#version 300 es
`;let V=B+z.concat("precision mediump float;",ou,Oh.fragmentSource).join(`
`);for(const j of f.fragmentIncludes)V+=`
${is[j]}`;V+=`
${f.fragmentSource}`;let H=B+z.concat("precision highp float;",ou,Oh.vertexSource).join(`
`);for(const j of f.vertexIncludes)H+=`
${is[j]}`;H+=`
${f.vertexSource}`;const W=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(W,V),C.compileShader(W),C.attachShader(this.program,W);const q=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(q,H),C.compileShader(q),C.attachShader(this.program,q),this.attributes={},this.numAttributes=L.length;for(let j=0;j<this.numAttributes;j++)if(L[j]){const Y=L[j].startsWith("a_")?L[j]:`a_${L[j]}`;C.bindAttribLocation(this.program,j,Y),this.attributes[Y]=j}E&&E.shaderVaryings.length>0&&C.transformFeedbackVaryings(this.program,E.shaderVaryings,E.bufferMode),C.linkProgram(this.program),C.deleteShader(q),C.deleteShader(W),this.fixedUniforms=x(n),this.binderUniforms=g?g.getUniforms(n):[],T.includes("TERRAIN")&&(this.terrainUniforms=(j=>({u_dem:new r.bO(j),u_dem_prev:new r.bO(j),u_dem_tl:new r.bL(j),u_dem_scale:new r.bN(j),u_dem_tl_prev:new r.bL(j),u_dem_scale_prev:new r.bN(j),u_dem_size:new r.bN(j),u_dem_lerp:new r.bN(j),u_exaggeration:new r.bN(j),u_depth:new r.bO(j),u_depth_size_inv:new r.bL(j),u_meter_to_dem:new r.bN(j),u_label_plane_matrix_inv:new r.bK(j)}))(n)),T.includes("GLOBE")&&(this.globeUniforms=(j=>({u_tile_tl_up:new r.bM(j),u_tile_tr_up:new r.bM(j),u_tile_br_up:new r.bM(j),u_tile_bl_up:new r.bM(j),u_tile_up_scale:new r.bN(j)}))(n)),T.includes("FOG")&&(this.fogUniforms=(j=>({u_fog_matrix:new r.bK(j),u_fog_range:new r.bL(j),u_fog_color:new r.bP(j),u_fog_horizon_blend:new r.bN(j),u_fog_vertical_limit:new r.bL(j),u_fog_temporal_offset:new r.bN(j),u_frustum_tl:new r.bM(j),u_frustum_tr:new r.bM(j),u_frustum_br:new r.bM(j),u_frustum_bl:new r.bM(j),u_globe_pos:new r.bM(j),u_globe_radius:new r.bN(j),u_globe_transition:new r.bN(j),u_is_globe:new r.bO(j),u_viewport:new r.bL(j)}))(n)),T.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(j=>({u_cutoff_params:new r.bP(j)}))(n)),T.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(j=>({u_lighting_ambient_color:new r.bM(j),u_lighting_directional_dir:new r.bM(j),u_lighting_directional_color:new r.bM(j),u_ground_radiance:new r.bM(j)}))(n)),T.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(j=>({u_light_matrix_0:new r.bK(j),u_light_matrix_1:new r.bK(j),u_fade_range:new r.bL(j),u_shadow_normal_offset:new r.bM(j),u_shadow_intensity:new r.bN(j),u_shadow_texel_size:new r.bN(j),u_shadow_map_resolution:new r.bN(j),u_shadow_direction:new r.bM(j),u_shadow_bias:new r.bM(j),u_shadowmap_0:new r.bO(j),u_shadowmap_1:new r.bO(j)}))(n))}}setTerrainUniformValues(n,a){if(!this.terrainUniforms)return;const f=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const g in a)f[g]&&f[g].set(this.program,g,a[g])}}setGlobeUniformValues(n,a){if(!this.globeUniforms)return;const f=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const g in a)f[g]&&f[g].set(this.program,g,a[g])}}setFogUniformValues(n,a){if(!this.fogUniforms)return;const f=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const g in a)f[g].set(this.program,g,a[g])}}setCutoffUniformValues(n,a){if(!this.cutoffUniforms)return;const f=this.cutoffUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const g in a)f[g].set(this.program,g,a[g])}}setLightsUniformValues(n,a){if(!this.lightsUniforms)return;const f=this.lightsUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const g in a)f[g].set(this.program,g,a[g])}}setShadowUniformValues(n,a){if(this.failedToCreate||!this.shadowUniforms)return;const f=this.shadowUniforms;n.program.set(this.program);for(const g in a)f[g].set(this.program,g,a[g])}_drawDebugWireframe(n,a,f,g,x,T,E,C,D,L){const z=n.options.wireframe;if(z.terrain===!1&&z.layers2D===!1&&z.layers3D===!1)return;const B=n.context;if(!(!(!z.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!z.layers2D||n._terrain&&n._terrain.renderingToTexture||!Wh.includes(this.name))||!(!z.layers3D||!hp.includes(this.name))))return;const V=B.gl,H=n.wireframeDebugCache.getLinesFromTrianglesBuffer(n.frameCounter,x,B);if(!H)return;const W=[...this.fixedDefines];W.push("DEBUG_WIREFRAME");const q=n.getOrCreateProgram(this.name,{config:this.configuration,defines:W});B.program.set(q.program);const j=(Q,se,X)=>{if(se[Q]&&X[Q])for(const oe in se[Q])X[Q][oe]&&X[Q][oe].set(X.program,oe,se[Q][oe].current)};D&&D.setUniforms(q.program,B,q.binderUniforms,E,{zoom:C}),j("fixedUniforms",this,q),j("terrainUniforms",this,q),j("globeUniforms",this,q),j("fogUniforms",this,q),j("lightsUniforms",this,q),j("shadowUniforms",this,q),H.bind(),B.setColorMode(new Ai([V.ONE,V.ONE_MINUS_SRC_ALPHA,V.ZERO,V.ONE],r.ax.transparent,[!0,!0,!0,!1])),B.setDepthMode(new ni(a.func===V.LESS?V.LEQUAL:a.func,ni.ReadOnly,a.range)),B.setStencilMode(di.disabled);const Y=3*T.primitiveLength*2,re=3*T.primitiveOffset*2*2;L&&L>1?V.drawElementsInstanced(V.LINES,Y,V.UNSIGNED_SHORT,re,L):V.drawElements(V.LINES,Y,V.UNSIGNED_SHORT,re),x.bind(),B.program.set(this.program),B.setDepthMode(a),B.setStencilMode(f),B.setColorMode(g)}draw(n,a,f,g,x,T,E,C,D,L,z,B,V,H,W,q,j){const Y=n.context,re=Y.gl;if(this.failedToCreate)return;Y.program.set(this.program),Y.setDepthMode(f),Y.setStencilMode(g),Y.setColorMode(x),Y.setCullFace(T);for(const oe of Object.keys(this.fixedUniforms))this.fixedUniforms[oe].set(this.program,oe,E[oe]);H&&H.setUniforms(this.program,Y,this.binderUniforms,B,{zoom:V});const Q={[re.POINTS]:1,[re.LINES]:2,[re.TRIANGLES]:3,[re.LINE_STRIP]:1}[a],se=j&&j.length>0;if(se){for(const oe of j)re.bindBufferBase(re.TRANSFORM_FEEDBACK_BUFFER,oe.targetIndex,oe.buffer.buffer);re.beginTransformFeedback(a)}const X=q&&q>0?1:void 0;for(const oe of z.get()){const ue=oe.vaos||(oe.vaos={});(ue[C]||(ue[C]=new Bh)).bind(Y,this,D,H?H.getPaintVertexBuffers():[],L,oe.vertexOffset,W||[],X),q&&q>1?re.drawElementsInstanced(a,oe.primitiveLength*Q,re.UNSIGNED_SHORT,oe.primitiveOffset*Q*2,q):L?re.drawElements(a,oe.primitiveLength*Q,re.UNSIGNED_SHORT,oe.primitiveOffset*Q*2):re.drawArrays(a,oe.vertexOffset,oe.vertexLength),a===re.TRIANGLES&&L&&this._drawDebugWireframe(n,f,g,x,L,oe,B,V,H,q)}se&&re.endTransformFeedback()}}function qh(d,n){const a=Math.pow(2,n.tileID.overscaledZ),f=n.tileSize*Math.pow(2,d.transform.tileZoom)/a,g=f*(n.tileID.canonical.x+n.tileID.wrap*a),x=f*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.a3(n,1,d.transform.tileZoom),u_pixel_coord_upper:[g>>16,x>>16],u_pixel_coord_lower:[65535&g,65535&x]}}const dp=r.a6.create(),Zh=(d,n,a,f,g,x,T,E,C,D,L,z,B,V,H,W)=>{const q=n.style.light,j=q.properties.get("position"),Y=[j.x,j.y,j.z],re=r.co.create();q.properties.get("anchor")==="viewport"&&(r.co.fromRotation(re,-n.transform.angle),r.N.transformMat3(Y,Y,re));const Q=q.properties.get("color"),se=n.transform,X={u_matrix:d,u_lightpos:Y,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[Q.r,Q.g,Q.b],u_vertical_gradient:+a,u_opacity:f,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:dp,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:g,u_edge_radius:x,u_flood_light_color:z,u_vertical_scale:B,u_flood_light_intensity:V,u_ground_shadow_factor:H,u_emissive_strength:W};return se.projection.name==="globe"&&(X.u_tile_id=[T.canonical.x,T.canonical.y,1<<T.canonical.z],X.u_zoom_transition=C,X.u_inv_rot_matrix=L,X.u_merc_center=D,X.u_up_dir=se.projection.upVector(new r.bs(0,0,0),D[0]*r.V,D[1]*r.V),X.u_height_lift=E),X},Xh=(d,n,a)=>({u_matrix:d,u_edge_radius:n,u_vertical_scale:a}),Qo=(d,n,a,f,g,x,T,E,C,D,L,z,B,V)=>{const H=Zh(d,n,a,f,g,x,T,C,D,L,z,B,V,1,[0,0,0],0),W={u_height_factor:-Math.pow(2,T.overscaledZ)/E.tileSize/8};return r.e(H,qh(n,E),W)},Ha=(d,n)=>({u_matrix:d,u_emissive_strength:n}),Yh=(d,n,a,f)=>r.e(Ha(d,n),qh(a,f)),ea=(d,n,a)=>({u_matrix:d,u_world:a,u_emissive_strength:n}),fp=(d,n,a,f,g)=>r.e(Yh(d,n,a,f),{u_world:g}),cu=(d,n,a,f)=>{const g=r.V/a.tileSize;return{u_matrix:d,u_camera_to_center_distance:n.getCameraToCenterDistance(f),u_extrude_scale:[n.pixelsToGLUnits[0]/g,n.pixelsToGLUnits[1]/g]}},Kh=(d,n,a=1)=>({u_matrix:d,u_color:n,u_overlay:0,u_overlay_scale:a}),pp=r.a6.create(),Jh=(d,n,a,f,g,x,T)=>{const E=d.transform,C=E.projection.name==="globe",D=C?r.cp(E.zoom,n.canonical)*E._pixelsPerMercatorPixel:r.a3(a,1,x),L={u_matrix:n.projMatrix,u_extrude_scale:D,u_intensity:T,u_inv_rot_matrix:pp,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){L.u_inv_rot_matrix=f,L.u_merc_center=g,L.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],L.u_zoom_transition=r.S(E.zoom);const z=g[0]*r.V,B=g[1]*r.V;L.u_up_dir=E.projection.upVector(new r.bs(0,0,0),z,B)}return L};function uu(d,[n,a,f,g],[x,T]){if(x===T)return[0,0,0,0];const E=255*(d-1)/(d*(T-x));return[n*E,a*E,f*E,g*E]}function mp(d,n,[a,f]){return a===f?0:.5/d+(n-a)*(d-1)/(d*(f-a))}const Qh=(d,n,a,f,g,x,T,E,C,D,L,z,B,V,H,W,q,j,Y,re,Q)=>{return{u_matrix:d,u_normalize_matrix:n,u_globe_matrix:a,u_merc_matrix:f,u_grid_matrix:g,u_tl_parent:x,u_scale_parent:D,u_fade_t:L.mix,u_opacity:L.opacity*z.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:z.paint.get("raster-brightness-min"),u_brightness_high:z.paint.get("raster-brightness-max"),u_saturation_factor:(X=z.paint.get("raster-saturation"),X>0?1-1/(1.001-X):-X),u_contrast_factor:(se=z.paint.get("raster-contrast"),se>0?1/(1-se):1+se),u_spin_weights:Gl(z.paint.get("raster-hue-rotate")),u_perspective_transform:B,u_raster_elevation:V,u_zoom_transition:T,u_merc_center:E,u_cutoff_params:C,u_colorization_mix:uu(r.cq,W,j),u_colorization_offset:mp(r.cq,q,j),u_color_ramp:H,u_texture_offset:[re/(Y+2*re),Y/(Y+2*re)],u_texture_res:[Y+2*re,Y+2*re],u_emissive_strength:Q};var se,X};function Gl(d){d*=Math.PI/180;const n=Math.sin(d),a=Math.cos(d);return[(2*a+1)/3,(-Math.sqrt(3)*n-a+1)/3,(Math.sqrt(3)*n-a+1)/3]}const og=(d,n,a,f,g,x,T,E,C,D,L,z)=>({u_matrix:d,u_normalize_matrix:n,u_globe_matrix:a,u_merc_matrix:f,u_grid_matrix:g,u_tl_parent:x,u_scale_parent:D,u_fade_t:L.mix,u_opacity:L.opacity,u_image0:0,u_image1:1,u_raster_elevation:z,u_zoom_transition:T,u_merc_center:E,u_cutoff_params:C}),ag=(d,n,a,f,g,x,T,E)=>({u_tile_offset:d,u_velocity:n,u_color_ramp:f,u_velocity_res:a,u_max_speed:g,u_texture_offset:x,u_data_scale:T,u_data_offset:E}),_p=(d,n,a,f,g,x,T,E)=>({u_velocity:d,u_velocity_res:n,u_max_speed:a,u_speed_factor:f,u_lifetime_delta:g,u_rand_seed:Math.random(),u_texture_offset:x,u_data_scale:T,u_data_offset:E}),gp=r.a6.create(),hu=(d,n,a,f,g,x,T,E,C,D,L,z,B,V,H,W,q,j)=>{const Y=g.transform,re={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:Y.getCameraToCenterDistance(W),u_rotate_symbol:+a,u_aspect_ratio:Y.width/Y.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:T,u_coord_matrix:E,u_is_text:+C,u_pitch_with_map:+f,u_texsize:D,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:gp,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:gp,u_up_vector:[0,-1,0],u_icon_transition:j||0,u_icon_saturation:q};return W.name==="globe"&&(re.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],re.u_zoom_transition=z,re.u_inv_rot_matrix=V,re.u_merc_center=B,re.u_camera_forward=Y._camera.forward(),re.u_ecef_origin=r.cr(Y.globeMatrix,L.toUnwrapped()),re.u_tile_matrix=Float32Array.from(Y.globeMatrix),re.u_up_vector=H),re},$l=(d,n,a,f,g,x,T,E,C,D,L,z,B,V,H,W,q)=>r.e(hu(d,n,a,f,g,x,T,E,C,D,z,B,V,H,W,q,1),{u_gamma_scale:f?g.transform.getCameraToCenterDistance(q)*Math.cos(g.terrain?0:g.transform._pitch):1,u_device_pixel_ratio:r.f.devicePixelRatio,u_is_halo:+L,undefined:void 0}),du=(d,n,a,f,g,x,T,E,C,D,L,z,B,V,H,W)=>r.e($l(d,n,a,f,g,x,T,E,!0,C,!0,L,z,B,V,H,W),{u_texsize_icon:D,u_texture_icon:1}),ed=(d,n,a,f)=>({u_matrix:d,u_emissive_strength:n,u_opacity:a,u_color:f}),Wl=(d,n,a,f,g,x,T)=>r.e(function(E,C,D,L){const z=D.imageManager.getPattern(E.toString(),C),{width:B,height:V}=D.imageManager.getPixelSize(C),H=Math.pow(2,L.tileID.overscaledZ),W=L.tileSize*Math.pow(2,D.transform.tileZoom)/H,q=W*(L.tileID.canonical.x+L.tileID.wrap*H),j=W*L.tileID.canonical.y;return{u_image:0,u_pattern_tl:z.tl,u_pattern_br:z.br,u_texsize:[B,V],u_pattern_size:z.displaySize,u_tile_units_to_pixels:1/r.a3(L,1,D.transform.tileZoom),u_pixel_coord_upper:[q>>16,j>>16],u_pixel_coord_lower:[65535&q,65535&j]}}(g,x,f,T),{u_matrix:d,u_emissive_strength:n,u_opacity:a}),fu=(d,n,a,f,g,x,T,E,C,D,L,z,B=[0,0,0],V)=>{const H=f.style.light,W=H.properties.get("position"),q=[-W.x,-W.y,W.z],j=r.co.create();H.properties.get("anchor")==="viewport"&&(r.co.fromRotation(j,-f.transform.angle),r.N.transformMat3(q,q,j));const Y=D.alphaMode==="MASK",re=H.properties.get("color"),Q=z.paint.get("model-ambient-occlusion-intensity"),se=z.paint.get("model-color").constantOr(r.ax.white),X=z.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:d,u_lighting_matrix:n,u_normal_matrix:a,u_lightpos:q,u_lightintensity:H.properties.get("intensity"),u_lightcolor:[re.r,re.g,re.b],u_camera_pos:B,u_opacity:g,u_baseTextureIsAlpha:0,u_alphaMask:+Y,u_alphaCutoff:D.alphaCutoff,u_baseColorFactor:[x.r,x.g,x.b,x.a],u_emissiveFactor:[T[0],T[1],T[2],1],u_metallicFactor:E,u_roughnessFactor:C,u_baseColorTexture:Er.BaseColor,u_metallicRoughnessTexture:Er.MetallicRoughness,u_normalTexture:Er.Normal,u_occlusionTexture:Er.Occlusion,u_emissionTexture:Er.Emission,u_color_mix:[se.r,se.g,se.b,X],u_aoIntensity:Q,u_emissive_strength:L,u_occlusionTextureTransform:V||[0,0,0,0]}},Hl=new Float32Array(16),ql=(d,n=Hl,a=Hl)=>({u_matrix:d,u_instance:n,u_node_matrix:a}),lg={fillExtrusion:d=>({u_matrix:new r.bK(d),u_lightpos:new r.bM(d),u_lightintensity:new r.bN(d),u_lightcolor:new r.bM(d),u_vertical_gradient:new r.bN(d),u_opacity:new r.bN(d),u_edge_radius:new r.bN(d),u_ao:new r.bL(d),u_tile_id:new r.bM(d),u_zoom_transition:new r.bN(d),u_inv_rot_matrix:new r.bK(d),u_merc_center:new r.bL(d),u_up_dir:new r.bM(d),u_height_lift:new r.bN(d),u_flood_light_color:new r.bM(d),u_vertical_scale:new r.bN(d),u_flood_light_intensity:new r.bN(d),u_ground_shadow_factor:new r.bM(d),u_emissive_strength:new r.bN(d)}),fillExtrusionDepth:d=>({u_matrix:new r.bK(d),u_edge_radius:new r.bN(d),u_vertical_scale:new r.bN(d)}),fillExtrusionPattern:d=>({u_matrix:new r.bK(d),u_lightpos:new r.bM(d),u_lightintensity:new r.bN(d),u_lightcolor:new r.bM(d),u_vertical_gradient:new r.bN(d),u_height_factor:new r.bN(d),u_edge_radius:new r.bN(d),u_ao:new r.bL(d),u_tile_id:new r.bM(d),u_zoom_transition:new r.bN(d),u_inv_rot_matrix:new r.bK(d),u_merc_center:new r.bL(d),u_up_dir:new r.bM(d),u_height_lift:new r.bN(d),u_image:new r.bO(d),u_texsize:new r.bL(d),u_pixel_coord_upper:new r.bL(d),u_pixel_coord_lower:new r.bL(d),u_tile_units_to_pixels:new r.bN(d),u_opacity:new r.bN(d)}),fillExtrusionGroundEffect:d=>({u_matrix:new r.bK(d),u_opacity:new r.bN(d),u_ao_pass:new r.bN(d),u_meter_to_tile:new r.bN(d),u_ao:new r.bL(d),u_flood_light_intensity:new r.bN(d),u_flood_light_color:new r.bM(d),u_attenuation:new r.bN(d),u_edge_radius:new r.bN(d),u_fb:new r.bO(d),u_fb_size:new r.bN(d)}),fill:d=>({u_matrix:new r.bK(d),u_emissive_strength:new r.bN(d)}),fillPattern:d=>({u_matrix:new r.bK(d),u_emissive_strength:new r.bN(d),u_image:new r.bO(d),u_texsize:new r.bL(d),u_pixel_coord_upper:new r.bL(d),u_pixel_coord_lower:new r.bL(d),u_tile_units_to_pixels:new r.bN(d)}),fillOutline:d=>({u_matrix:new r.bK(d),u_emissive_strength:new r.bN(d),u_world:new r.bL(d)}),fillOutlinePattern:d=>({u_matrix:new r.bK(d),u_emissive_strength:new r.bN(d),u_world:new r.bL(d),u_image:new r.bO(d),u_texsize:new r.bL(d),u_pixel_coord_upper:new r.bL(d),u_pixel_coord_lower:new r.bL(d),u_tile_units_to_pixels:new r.bN(d)}),circle:r.cs,collisionBox:d=>({u_matrix:new r.bK(d),u_camera_to_center_distance:new r.bN(d),u_extrude_scale:new r.bL(d)}),collisionCircle:d=>({u_matrix:new r.bK(d),u_inv_matrix:new r.bK(d),u_camera_to_center_distance:new r.bN(d),u_viewport_size:new r.bL(d)}),debug:d=>({u_color:new r.ca(d),u_matrix:new r.bK(d),u_overlay:new r.bO(d),u_overlay_scale:new r.bN(d)}),clippingMask:d=>({u_matrix:new r.bK(d)}),heatmap:d=>({u_extrude_scale:new r.bN(d),u_intensity:new r.bN(d),u_matrix:new r.bK(d),u_inv_rot_matrix:new r.bK(d),u_merc_center:new r.bL(d),u_tile_id:new r.bM(d),u_zoom_transition:new r.bN(d),u_up_dir:new r.bM(d)}),heatmapTexture:d=>({u_image:new r.bO(d),u_color_ramp:new r.bO(d),u_opacity:new r.bN(d)}),hillshade:d=>({u_matrix:new r.bK(d),u_image:new r.bO(d),u_latrange:new r.bL(d),u_light:new r.bL(d),u_shadow:new r.ca(d),u_highlight:new r.ca(d),u_emissive_strength:new r.bN(d),u_accent:new r.ca(d)}),hillshadePrepare:d=>({u_matrix:new r.bK(d),u_image:new r.bO(d),u_dimension:new r.bL(d),u_zoom:new r.bN(d)}),line:r.ct,linePattern:r.cu,raster:d=>({u_matrix:new r.bK(d),u_normalize_matrix:new r.bK(d),u_globe_matrix:new r.bK(d),u_merc_matrix:new r.bK(d),u_grid_matrix:new r.cb(d),u_tl_parent:new r.bL(d),u_scale_parent:new r.bN(d),u_fade_t:new r.bN(d),u_opacity:new r.bN(d),u_image0:new r.bO(d),u_image1:new r.bO(d),u_brightness_low:new r.bN(d),u_brightness_high:new r.bN(d),u_saturation_factor:new r.bN(d),u_contrast_factor:new r.bN(d),u_spin_weights:new r.bM(d),u_perspective_transform:new r.bL(d),u_raster_elevation:new r.bN(d),u_zoom_transition:new r.bN(d),u_merc_center:new r.bL(d),u_cutoff_params:new r.bP(d),u_colorization_mix:new r.bP(d),u_colorization_offset:new r.bN(d),u_color_ramp:new r.bO(d),u_texture_offset:new r.bL(d),u_texture_res:new r.bL(d),u_emissive_strength:new r.bN(d)}),rasterParticle:d=>({u_matrix:new r.bK(d),u_normalize_matrix:new r.bK(d),u_globe_matrix:new r.bK(d),u_merc_matrix:new r.bK(d),u_grid_matrix:new r.cb(d),u_tl_parent:new r.bL(d),u_scale_parent:new r.bN(d),u_fade_t:new r.bN(d),u_opacity:new r.bN(d),u_image0:new r.bO(d),u_image1:new r.bO(d),u_raster_elevation:new r.bN(d),u_zoom_transition:new r.bN(d),u_merc_center:new r.bL(d),u_cutoff_params:new r.bP(d)}),rasterParticleTexture:d=>({u_texture:new r.bO(d),u_opacity:new r.bN(d)}),rasterParticleDraw:d=>({u_tile_offset:new r.bL(d),u_velocity:new r.bO(d),u_color_ramp:new r.bO(d),u_velocity_res:new r.bL(d),u_max_speed:new r.bN(d),u_texture_offset:new r.bL(d),u_data_scale:new r.bP(d),u_data_offset:new r.bN(d)}),rasterParticleUpdate:d=>({u_velocity:new r.bO(d),u_velocity_res:new r.bL(d),u_max_speed:new r.bN(d),u_speed_factor:new r.bN(d),u_lifetime_delta:new r.bN(d),u_rand_seed:new r.bN(d),u_texture_offset:new r.bL(d),u_data_scale:new r.bP(d),u_data_offset:new r.bN(d)}),symbolIcon:d=>({u_is_size_zoom_constant:new r.bO(d),u_is_size_feature_constant:new r.bO(d),u_size_t:new r.bN(d),u_size:new r.bN(d),u_camera_to_center_distance:new r.bN(d),u_rotate_symbol:new r.bO(d),u_aspect_ratio:new r.bN(d),u_fade_change:new r.bN(d),u_matrix:new r.bK(d),u_label_plane_matrix:new r.bK(d),u_coord_matrix:new r.bK(d),u_is_text:new r.bO(d),u_pitch_with_map:new r.bO(d),u_texsize:new r.bL(d),u_tile_id:new r.bM(d),u_zoom_transition:new r.bN(d),u_inv_rot_matrix:new r.bK(d),u_merc_center:new r.bL(d),u_camera_forward:new r.bM(d),u_tile_matrix:new r.bK(d),u_up_vector:new r.bM(d),u_ecef_origin:new r.bM(d),u_texture:new r.bO(d),u_icon_transition:new r.bN(d),u_icon_saturation:new r.bN(d)}),symbolSDF:d=>({u_is_size_zoom_constant:new r.bO(d),u_is_size_feature_constant:new r.bO(d),u_size_t:new r.bN(d),u_size:new r.bN(d),u_camera_to_center_distance:new r.bN(d),u_rotate_symbol:new r.bO(d),u_aspect_ratio:new r.bN(d),u_fade_change:new r.bN(d),u_matrix:new r.bK(d),u_label_plane_matrix:new r.bK(d),u_coord_matrix:new r.bK(d),u_is_text:new r.bO(d),u_pitch_with_map:new r.bO(d),u_texsize:new r.bL(d),u_texture:new r.bO(d),u_gamma_scale:new r.bN(d),u_device_pixel_ratio:new r.bN(d),u_tile_id:new r.bM(d),u_zoom_transition:new r.bN(d),u_inv_rot_matrix:new r.bK(d),u_merc_center:new r.bL(d),u_camera_forward:new r.bM(d),u_tile_matrix:new r.bK(d),u_up_vector:new r.bM(d),u_ecef_origin:new r.bM(d),u_is_halo:new r.bO(d)}),symbolTextAndIcon:d=>({u_is_size_zoom_constant:new r.bO(d),u_is_size_feature_constant:new r.bO(d),u_size_t:new r.bN(d),u_size:new r.bN(d),u_camera_to_center_distance:new r.bN(d),u_rotate_symbol:new r.bO(d),u_aspect_ratio:new r.bN(d),u_fade_change:new r.bN(d),u_matrix:new r.bK(d),u_label_plane_matrix:new r.bK(d),u_coord_matrix:new r.bK(d),u_is_text:new r.bO(d),u_pitch_with_map:new r.bO(d),u_texsize:new r.bL(d),u_texsize_icon:new r.bL(d),u_texture:new r.bO(d),u_texture_icon:new r.bO(d),u_gamma_scale:new r.bN(d),u_device_pixel_ratio:new r.bN(d),u_is_halo:new r.bO(d)}),background:d=>({u_matrix:new r.bK(d),u_emissive_strength:new r.bN(d),u_opacity:new r.bN(d),u_color:new r.ca(d)}),backgroundPattern:d=>({u_matrix:new r.bK(d),u_emissive_strength:new r.bN(d),u_opacity:new r.bN(d),u_image:new r.bO(d),u_pattern_tl:new r.bL(d),u_pattern_br:new r.bL(d),u_texsize:new r.bL(d),u_pattern_size:new r.bL(d),u_pixel_coord_upper:new r.bL(d),u_pixel_coord_lower:new r.bL(d),u_tile_units_to_pixels:new r.bN(d)}),terrainRaster:lp,terrainDepth:lp,skybox:d=>({u_matrix:new r.bK(d),u_sun_direction:new r.bM(d),u_cubemap:new r.bO(d),u_opacity:new r.bN(d),u_temporal_offset:new r.bN(d)}),skyboxGradient:d=>({u_matrix:new r.bK(d),u_color_ramp:new r.bO(d),u_center_direction:new r.bM(d),u_radius:new r.bN(d),u_opacity:new r.bN(d),u_temporal_offset:new r.bN(d)}),skyboxCapture:d=>({u_matrix_3f:new r.cb(d),u_sun_direction:new r.bM(d),u_sun_intensity:new r.bN(d),u_color_tint_r:new r.bP(d),u_color_tint_m:new r.bP(d),u_luminance:new r.bN(d)}),globeRaster:d=>({u_proj_matrix:new r.bK(d),u_globe_matrix:new r.bK(d),u_normalize_matrix:new r.bK(d),u_merc_matrix:new r.bK(d),u_zoom_transition:new r.bN(d),u_merc_center:new r.bL(d),u_image0:new r.bO(d),u_grid_matrix:new r.cb(d),u_skirt_height:new r.bN(d),u_far_z_cutoff:new r.bN(d),u_frustum_tl:new r.bM(d),u_frustum_tr:new r.bM(d),u_frustum_br:new r.bM(d),u_frustum_bl:new r.bM(d),u_globe_pos:new r.bM(d),u_globe_radius:new r.bN(d),u_viewport:new r.bL(d)}),globeAtmosphere:d=>({u_frustum_tl:new r.bM(d),u_frustum_tr:new r.bM(d),u_frustum_br:new r.bM(d),u_frustum_bl:new r.bM(d),u_horizon:new r.bN(d),u_transition:new r.bN(d),u_fadeout_range:new r.bN(d),u_color:new r.bP(d),u_high_color:new r.bP(d),u_space_color:new r.bP(d),u_temporal_offset:new r.bN(d),u_horizon_angle:new r.bN(d)}),model:d=>({u_matrix:new r.bK(d),u_lighting_matrix:new r.bK(d),u_normal_matrix:new r.bK(d),u_lightpos:new r.bM(d),u_lightintensity:new r.bN(d),u_lightcolor:new r.bM(d),u_camera_pos:new r.bM(d),u_opacity:new r.bN(d),u_baseColorFactor:new r.bP(d),u_emissiveFactor:new r.bP(d),u_metallicFactor:new r.bN(d),u_roughnessFactor:new r.bN(d),u_baseTextureIsAlpha:new r.bO(d),u_alphaMask:new r.bO(d),u_alphaCutoff:new r.bN(d),u_baseColorTexture:new r.bO(d),u_metallicRoughnessTexture:new r.bO(d),u_normalTexture:new r.bO(d),u_occlusionTexture:new r.bO(d),u_emissionTexture:new r.bO(d),u_color_mix:new r.bP(d),u_aoIntensity:new r.bN(d),u_emissive_strength:new r.bN(d),u_occlusionTextureTransform:new r.bP(d)}),modelDepth:d=>({u_matrix:new r.bK(d),u_instance:new r.bK(d),u_node_matrix:new r.bK(d)}),groundShadow:d=>({u_matrix:new r.bK(d),u_ground_shadow_factor:new r.bM(d)}),stars:d=>({u_matrix:new r.bK(d),u_up:new r.bM(d),u_right:new r.bM(d),u_intensity_multiplier:new r.bN(d)})};let Ms;function Ss(d,n,a,f,g,x,T){const E=d.context,C=E.gl,D=d.transform,L=d.getOrCreateProgram("collisionBox"),z=[];let B=0,V=0;for(let Q=0;Q<f.length;Q++){const se=f[Q],X=n.getTile(se),oe=X.getBucket(a);if(!oe)continue;const ue=bh(se,oe,D);let de=ue;g[0]===0&&g[1]===0||(de=d.translatePosMatrix(ue,X,g,x));const _e=T?oe.textCollisionBox:oe.iconCollisionBox,Pe=oe.collisionCircleArray;if(Pe.length>0){const be=r.a6.create(),Ne=de;r.a6.mul(be,oe.placementInvProjMatrix,D.glCoordMatrix),r.a6.mul(be,be,oe.placementViewportMatrix),z.push({circleArray:Pe,circleOffset:V,transform:Ne,invTransform:be,projection:oe.getProjection()}),B+=Pe.length/4,V=B}_e&&(d.terrain&&d.terrain.setupElevationDraw(X,L),L.draw(d,C.LINES,ni.disabled,di.disabled,d.colorModeForRenderPass(),ri.disabled,cu(de,D,X,oe.getProjection()),a.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,null,D.zoom,null,[_e.collisionVertexBuffer,_e.collisionVertexBufferExt]))}if(!T||!z.length)return;const H=d.getOrCreateProgram("collisionCircle"),W=new r.cv;W.resize(4*B),W._trim();let q=0;for(const Q of z)for(let se=0;se<Q.circleArray.length/4;se++){const X=4*se,oe=Q.circleArray[X+0],ue=Q.circleArray[X+1],de=Q.circleArray[X+2],_e=Q.circleArray[X+3];W.emplace(q++,oe,ue,de,_e,0),W.emplace(q++,oe,ue,de,_e,1),W.emplace(q++,oe,ue,de,_e,2),W.emplace(q++,oe,ue,de,_e,3)}(!Ms||Ms.length<2*B)&&(Ms=function(Q){const se=2*Q,X=new r.aw;X.resize(se),X._trim();for(let oe=0;oe<se;oe++){const ue=6*oe;X.uint16[ue+0]=4*oe+0,X.uint16[ue+1]=4*oe+1,X.uint16[ue+2]=4*oe+2,X.uint16[ue+3]=4*oe+2,X.uint16[ue+4]=4*oe+3,X.uint16[ue+5]=4*oe+0}return X}(B));const j=E.createIndexBuffer(Ms,!0),Y=E.createVertexBuffer(W,r.cw.members,!0);for(const Q of z){const se={u_matrix:Q.transform,u_inv_matrix:Q.invTransform,u_camera_to_center_distance:(re=D).getCameraToCenterDistance(Q.projection),u_viewport_size:[re.width,re.height]};H.draw(d,C.TRIANGLES,ni.disabled,di.disabled,d.colorModeForRenderPass(),ri.disabled,se,a.id,Y,j,r.aB.simpleSegment(0,2*Q.circleOffset,Q.circleArray.length,Q.circleArray.length/2),null,D.zoom)}var re;Y.destroy(),j.destroy()}const qs=r.a6.create();function Zl(d){const n=d._camera.getWorldToCamera(d.worldSize,1),a=r.a6.multiply([],n,d.globeMatrix);r.a6.invert(a,a);const f=[0,0,0],g=[0,1,0,0];return r.a7.transformMat4(g,g,a),f[0]=g[0],f[1]=g[1],f[2]=g[2],r.N.normalize(f,f),f}function Bt({width:d,height:n,anchor:a,textOffset:f,textScale:g},x){const{horizontalAlign:T,verticalAlign:E}=r.bf(a),C=-(T-.5)*d,D=-(E-.5)*n,L=r.bd(a,f);return new r.P((C/g+L[0])*x,(D/g+L[1])*x)}function yp(d,n,a,f,g,x,T,E,C,D,L){const z=d.text.placedSymbolArray,B=d.text.dynamicLayoutVertexArray,V=d.icon.dynamicLayoutVertexArray,H={},W=d.getProjection(),q=Rl(E,W,x),j=x.elevation,Y=W.upVectorScale(E.canonical,x.center.lat,x.worldSize).metersToTile;B.clear();for(let re=0;re<z.length;re++){const Q=z.get(re),{tileAnchorX:se,tileAnchorY:X,numGlyphs:oe}=Q,ue=Q.hidden||!Q.crossTileID||d.allowVerticalPlacement&&!Q.placedOrientation?null:f[Q.crossTileID];if(ue){let de=0,_e=0,Pe=0;if(j){const it=j?j.getAtTileOffset(E,se,X):0,[pt,ht,Et]=W.upVector(E.canonical,se,X);de=it*pt*Y,_e=it*ht*Y,Pe=it*Et*Y}let[be,Ne,Oe,et]=cs(Q.projectedAnchorX+de,Q.projectedAnchorY+_e,Q.projectedAnchorZ+Pe,a?q:T);const Me=Kf(x.getCameraToCenterDistance(W),et);let ke=g.evaluateSizeForFeature(d.textSizeData,D,Q)*Me/r.bc;a&&(ke*=d.tilePixelRatio/C);const me=Bt(ue,ke);a?({x:be,y:Ne,z:Oe}=W.projectTilePoint(se+me.x,X+me.y,E.canonical),[be,Ne,Oe]=cs(be+de,Ne+_e,Oe+Pe,T)):(n&&me._rotate(-x.angle),be+=me.x,Ne+=me.y,Oe=0);const Ae=d.allowVerticalPlacement&&Q.placedOrientation===r.b6.vertical?Math.PI/2:0;for(let it=0;it<oe;it++)r.b9(B,be,Ne,Oe,Ae);L&&Q.associatedIconIndex>=0&&(H[Q.associatedIconIndex]={x:be,y:Ne,z:Oe,angle:Ae})}else xo(oe,B)}if(L){V.clear();const re=d.icon.placedSymbolArray;for(let Q=0;Q<re.length;Q++){const se=re.get(Q),{numGlyphs:X}=se,oe=H[Q];if(se.hidden||!oe)xo(X,V);else{const{x:ue,y:de,z:_e,angle:Pe}=oe;for(let be=0;be<X;be++)r.b9(V,ue,de,_e,Pe)}}d.icon.dynamicLayoutVertexBuffer.updateData(V)}d.text.dynamicLayoutVertexBuffer.updateData(B)}function pu(d,n,a,f,g,x,T={}){const E=a.paint.get("icon-translate"),C=a.paint.get("text-translate"),D=a.paint.get("icon-translate-anchor"),L=a.paint.get("text-translate-anchor"),z=a.layout.get("icon-rotation-alignment"),B=a.layout.get("text-rotation-alignment"),V=a.layout.get("icon-pitch-alignment"),H=a.layout.get("text-pitch-alignment"),W=a.layout.get("icon-keep-upright"),q=a.layout.get("text-keep-upright"),j=a.paint.get("icon-color-saturation"),Y=d.context,re=Y.gl,Q=d.transform,se=z==="map",X=B==="map",oe=V==="map",ue=H==="map",de=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let _e=!1;const Pe=d.depthModeForSublayer(0,ni.ReadOnly),be=[r.a5(Q.center.lng),r.ae(Q.center.lat)],Ne=a.layout.get("text-variable-anchor"),Oe=Q.projection.name==="globe",et=[],Me=[0,-1,0];for(const ke of f){const me=n.getTile(ke),Ae=me.getBucket(a);if(!Ae||Ae.projection.name==="mercator"&&Oe||Ae.fullyClipped)continue;const it=Ae.projection.name==="globe",pt=it?r.S(Q.zoom):0,ht=Rl(ke,Ae.getProjection(),Q),Et=Q.calculatePixelsToTileUnitsMatrix(me),Wt=Ne&&Ae.hasTextData(),Jt=Ae.hasIconTextFit()&&Wt&&Ae.hasIconData(),qt=Ae.getProjection().createInversionMatrix(Q,ke.canonical),Yt=()=>{const Bn=se&&a.layout.get("symbol-placement")!=="point",Pi=[],ji=Bn||Jt,Di=a.paint.get("icon-image-cross-fade").constantOr(0);d.terrainRenderModeElevated()&&oe&&Pi.push("PITCH_WITH_MAP_TERRAIN"),it&&(Pi.push("PROJECTION_GLOBE_VIEW"),ji&&Pi.push("PROJECTED_POS_ON_VIEWPORT")),Di>0&&Pi.push("ICON_TRANSITION"),Ae.icon.zOffsetVertexBuffer&&Pi.push("Z_OFFSET"),j<1&&Pi.push("SATURATION");const Ui=Ae.icon.programConfigurations.get(a.id),Tn=d.getOrCreateProgram(Ae.sdfIcons?"symbolSDF":"symbolIcon",{config:Ui,defines:Pi});let qi;const dr=me.imageAtlasTexture?me.imageAtlasTexture.size:[0,0],Ar=Ae.iconSizeData,Hr=r.b5(Ar,Q.zoom),Bs=oe||Q.pitch!==0,qr=Ll(ht,me.tileID.canonical,oe,se,Q,Ae.getProjection(),Et),fr=ph(ht,me.tileID.canonical,oe,se,Q,Ae.getProjection(),Et),sr=d.translatePosMatrix(fr,me,E,D,!0),kr=d.translatePosMatrix(ht,me,E,D),Nr=ji?qs:qr,Zr=se&&!oe&&!Bn;let Ns=Me;!Oe&&!Q.mercatorFromTransition||se||(Ns=Zl(Q));const Lo=it?Ns:Me;qi=Ae.sdfIcons&&!Ae.iconsInText?$l(Ar.kind,Hr,Zr,oe,d,kr,Nr,sr,!1,dr,!0,ke,pt,be,qt,Lo,Ae.getProjection()):hu(Ar.kind,Hr,Zr,oe,d,kr,Nr,sr,!1,dr,ke,pt,be,qt,Lo,Ae.getProjection(),j,Di);const sa=me.imageAtlasTexture?me.imageAtlasTexture:null,fc=a.layout.get("icon-size").constantOr(0)!==1||Ae.iconsNeedLinear,pc=Ae.sdfIcons||d.options.rotating||d.options.zooming||fc||Bs?re.LINEAR:re.NEAREST,Pd=Ae.sdfIcons&&a.paint.get("icon-halo-width").constantOr(1)!==0,mc=d.terrain&&oe&&Bn?r.a6.invert(r.a6.create(),qr):qs;if(Bn&&Ae.icon){const Ka=Q.elevation,Mu=Ka?Ka.getAtTileOffsetFunc(ke,Q.center.lat,Q.worldSize,Ae.getProjection()):null,Ks=fh(ht,me.tileID.canonical,oe,se,Q,Ae.getProjection(),Et);_h(Ae,ht,d,!1,Ks,fr,oe,W,Mu,ke)}return{program:Tn,buffers:Ae.icon,uniformValues:qi,atlasTexture:sa,atlasTextureIcon:null,atlasInterpolation:pc,atlasInterpolationIcon:null,isSDF:Ae.sdfIcons,hasHalo:Pd,tile:me,labelPlaneMatrixInv:mc}},vi=()=>{const Bn=X&&a.layout.get("symbol-placement")!=="point",Pi=[],ji=Bn||Ne||Jt;d.terrainRenderModeElevated()&&ue&&Pi.push("PITCH_WITH_MAP_TERRAIN"),it&&(Pi.push("PROJECTION_GLOBE_VIEW"),ji&&Pi.push("PROJECTED_POS_ON_VIEWPORT")),Ae.text.zOffsetVertexBuffer&&Pi.push("Z_OFFSET");const Di=Ae.text.programConfigurations.get(a.id),Ui=d.getOrCreateProgram(Ae.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:Di,defines:Pi});let Tn,qi=[0,0],dr=null;const Ar=Ae.textSizeData;Ae.iconsInText&&(qi=me.imageAtlasTexture?me.imageAtlasTexture.size:[0,0],dr=me.imageAtlasTexture?me.imageAtlasTexture:null,Tn=ue||Q.pitch!==0||d.options.rotating||d.options.zooming||Ar.kind==="composite"||Ar.kind==="camera"?re.LINEAR:re.NEAREST);const Hr=me.glyphAtlasTexture?me.glyphAtlasTexture.size:[0,0],Bs=r.b5(Ar,Q.zoom),qr=Ll(ht,me.tileID.canonical,ue,X,Q,Ae.getProjection(),Et),fr=ph(ht,me.tileID.canonical,ue,X,Q,Ae.getProjection(),Et),sr=d.translatePosMatrix(fr,me,C,L,!0),kr=d.translatePosMatrix(ht,me,C,L),Nr=ji?qs:qr,Zr=X&&!ue&&!Bn;let Ns=Me;!Oe&&!Q.mercatorFromTransition||X||(Ns=Zl(Q));const Lo=it?Ns:Me;let sa;sa=Ae.iconsInText?du(Ar.kind,Bs,Zr,ue,d,kr,Nr,sr,Hr,qi,ke,pt,be,qt,Lo,Ae.getProjection()):$l(Ar.kind,Bs,Zr,ue,d,kr,Nr,sr,!0,Hr,!0,ke,pt,be,qt,Lo,Ae.getProjection());const fc=me.glyphAtlasTexture?me.glyphAtlasTexture:null,pc=re.LINEAR,Pd=a.paint.get("text-halo-width").constantOr(1)!==0,mc=d.terrain&&ue&&Bn?r.a6.invert(r.a6.create(),qr):qs;if(Bn&&Ae.text){const Ka=Q.elevation,Mu=Ka?Ka.getAtTileOffsetFunc(ke,Q.center.lat,Q.worldSize,Ae.getProjection()):null,Ks=fh(ht,me.tileID.canonical,ue,X,Q,Ae.getProjection(),Et);_h(Ae,ht,d,!0,Ks,fr,ue,q,Mu,ke)}return{program:Ui,buffers:Ae.text,uniformValues:sa,atlasTexture:fc,atlasTextureIcon:dr,atlasInterpolation:pc,atlasInterpolationIcon:Tn,isSDF:!0,hasHalo:Pd,tile:me,labelPlaneMatrixInv:mc}},ui=Ae.icon.segments.get().length,mi=Ae.text.segments.get().length,pi=ui&&!T.onlyText?Yt():null,Fi=mi&&!T.onlyIcons?vi():null,gn=a.paint.get("icon-opacity").constantOr(1),Ci=a.paint.get("text-opacity").constantOr(1);if(de&&Ae.canOverlap){_e=!0;const Bn=gn&&!T.onlyText?Ae.icon.segments.get():[],Pi=Ci&&!T.onlyIcons?Ae.text.segments.get():[];for(const ji of Bn)et.push({segments:new r.aB([ji]),sortKey:ji.sortKey,state:pi});for(const ji of Pi)et.push({segments:new r.aB([ji]),sortKey:ji.sortKey,state:Fi})}else T.onlyText||et.push({segments:gn?Ae.icon.segments:new r.aB([]),sortKey:0,state:pi}),T.onlyIcons||et.push({segments:Ci?Ae.text.segments:new r.aB([]),sortKey:0,state:Fi})}_e&&et.sort((ke,me)=>ke.sortKey-me.sortKey);for(const ke of et){const me=ke.state;if(me)if(d.terrain&&d.terrain.setupElevationDraw(me.tile,me.program,{useDepthForOcclusion:Q.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:me.labelPlaneMatrixInv}),Y.activeTexture.set(re.TEXTURE0),me.atlasTexture&&me.atlasTexture.bind(me.atlasInterpolation,re.CLAMP_TO_EDGE,!0),me.atlasTextureIcon&&(Y.activeTexture.set(re.TEXTURE1),me.atlasTextureIcon&&me.atlasTextureIcon.bind(me.atlasInterpolationIcon,re.CLAMP_TO_EDGE,!0)),d.uploadCommonLightUniforms(d.context,me.program),me.hasHalo){const Ae=me.uniformValues;Ae.u_is_halo=1,Mo(me.buffers,ke.segments,a,d,me.program,Pe,g,x,Ae,2),Ae.u_is_halo=0}else{if(me.isSDF){const Ae=me.uniformValues;me.hasHalo&&(Ae.u_is_halo=1,Mo(me.buffers,ke.segments,a,d,me.program,Pe,g,x,Ae,1)),Ae.u_is_halo=0}Mo(me.buffers,ke.segments,a,d,me.program,Pe,g,x,me.uniformValues,1)}}}function Mo(d,n,a,f,g,x,T,E,C,D){const L=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.iconTransitioningVertexBuffer,d.globeExtVertexBuffer,d.zOffsetVertexBuffer];g.draw(f,f.context.gl.TRIANGLES,x,T,E,ri.disabled,C,a.id,d.layoutVertexBuffer,d.indexBuffer,n,a.paint,f.transform.zoom,d.programConfigurations.get(a.id),L,D)}function ta(d,n,a,f,g,x,T){const E=d.context.gl,C=a.paint.get("fill-pattern"),D=C&&C.constantOr(1);let L,z,B,V,H;T?(z=D&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=E.LINES):(z=D?"fillPattern":"fill",L=E.TRIANGLES);for(const W of f){const q=n.getTile(W);if(D&&!q.patternsLoaded())continue;const j=q.getBucket(a);if(!j)continue;d.prepareDrawTile();const Y=j.programConfigurations.get(a.id),re=d.isTileAffectedByFog(W),Q=d.getOrCreateProgram(z,{config:Y,overrideFog:re});D&&(d.context.activeTexture.set(E.TEXTURE0),q.imageAtlasTexture&&q.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),Y.updatePaintBuffers());const se=C.constantOr(null);if(se&&q.imageAtlas){const ue=q.imageAtlas.patternPositions[se.toString()];ue&&Y.setConstantPatternPositions(ue)}const X=d.translatePosMatrix(W.projMatrix,q,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor")),oe=a.paint.get("fill-emissive-strength");if(T){V=j.indexBuffer2,H=j.segments2;const ue=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[E.drawingBufferWidth,E.drawingBufferHeight];B=z==="fillOutlinePattern"&&D?fp(X,oe,d,q,ue):ea(X,oe,ue)}else V=j.indexBuffer,H=j.segments,B=D?Yh(X,oe,d,q):Ha(X,oe);d.uploadCommonUniforms(d.context,Q,W.toUnwrapped()),Q.draw(d,L,g,d.stencilModeForClipping(W),x,ri.disabled,B,a.id,j.layoutVertexBuffer,V,H,a.paint,d.transform.zoom,Y,void 0)}}function Ht(d,n,a,f,g,x,T,E){a.resetLayerRenderingStats(d);const C=d.context,D=C.gl,L=d.transform,z=a.paint.get("fill-extrusion-pattern"),B=z.constantOr(1),V=a.paint.get("fill-extrusion-opacity"),H=d.style.enable3dLights(),W=a.paint.get(H&&!B?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),q=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),W],j=a.layout.get("fill-extrusion-edge-radius"),Y=j>0&&!a.paint.get("fill-extrusion-rounded-roof"),re=Y?0:j,Q=L.projection.name==="globe"?r.cF():0,se=L.projection.name==="globe",X=se?r.S(L.zoom):0,oe=[r.a5(L.center.lng),r.ae(L.center.lat)],ue=a.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),de=a.paint.get("fill-extrusion-flood-light-intensity"),_e=a.paint.get("fill-extrusion-vertical-scale"),Pe=bo(d,a.paint.get("fill-extrusion-cutoff-fade-range")),be=a.paint.get("fill-extrusion-emissive-strength"),Ne=[];let Oe;se&&Ne.push("PROJECTION_GLOBE_VIEW"),q[0]>0&&Ne.push("FAUX_AO"),Y&&Ne.push("ZERO_ROOF_RADIUS"),E&&Ne.push("HAS_CENTROID"),de>0&&Ne.push("FLOOD_LIGHT"),Pe.shouldRenderCutoff&&Ne.push("RENDER_CUTOFF");const et=d.renderPass==="shadow",Me=d.shadowRenderer,ke=et&&!!Me;d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!0);let me=[0,0,0];if(Me){const pt=d.style.directionalLight,ht=d.style.ambientLight;pt&&ht&&(me=Vl(pt,ht)),Oe=Ne.concat(["SHADOWS_SINGLE_CASCADE"])}const Ae=ke?"fillExtrusionDepth":B?"fillExtrusionPattern":"fillExtrusion",it=a.getLayerRenderingStats();for(const pt of f){const ht=n.getTile(pt),Et=ht.getBucket(a);if(!Et||Et.projection.name!==L.projection.name)continue;let Wt=!1;Me&&(Wt=Me.getMaxCascadeForTile(pt.toUnwrapped())===0);const Jt=d.isTileAffectedByFog(pt),qt=Et.programConfigurations.get(a.id),Yt=d.getOrCreateProgram(Ae,{config:qt,defines:Wt?Oe:Ne,overrideFog:Jt});if(d.terrain&&d.terrain.setupElevationDraw(ht,Yt,{useMeterToDem:!0}),!Et.centroidVertexBuffer){const gn=Yt.attributes.a_centroid_pos;gn!==void 0&&D.vertexAttrib2f(gn,0,0)}!et&&Me&&Me.setupShadows(ht.tileID.toUnwrapped(),Yt,"vector-tile",ht.tileID.overscaledZ),B&&(d.context.activeTexture.set(D.TEXTURE0),ht.imageAtlasTexture&&ht.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),qt.updatePaintBuffers());const vi=z.constantOr(null);if(vi&&ht.imageAtlas){const gn=ht.imageAtlas.patternPositions[vi.toString()];gn&&qt.setConstantPatternPositions(gn)}const ui=a.paint.get("fill-extrusion-vertical-gradient");let mi;if(et&&Me){if(vp(ht.tileID,Et,d))continue;const gn=Me.calculateShadowPassMatrixFromTile(ht.tileID.toUnwrapped());mi=Xh(gn,re,_e)}else{const gn=d.translatePosMatrix(pt.expandedProjMatrix,ht,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Ci=L.projection.createInversionMatrix(L,pt.canonical);mi=B?Qo(gn,d,ui,V,q,re,pt,ht,Q,X,oe,Ci,ue,_e):Zh(gn,d,ui,V,q,re,pt,Q,X,oe,Ci,ue,_e,de,me,be)}d.uploadCommonUniforms(C,Yt,pt.toUnwrapped(),null,Pe);let pi=Et.segments;if(L.projection.name==="mercator"&&!et&&(pi=Et.getVisibleSegments(ht.tileID,d.terrain,d.transform.getFrustum(0)),!pi.get().length))continue;if(it)if(et)for(const gn of pi.get())it.numRenderedVerticesInShadowPass+=gn.primitiveLength;else for(const gn of pi.get())it.numRenderedVerticesInTransparentPass+=gn.primitiveLength;const Fi=[];(d.terrain||E)&&Fi.push(Et.centroidVertexBuffer),se&&Fi.push(Et.layoutVertexExtBuffer),Yt.draw(d,C.gl.TRIANGLES,g,x,T,ri.backCCW,mi,a.id,Et.layoutVertexBuffer,Et.indexBuffer,pi,a.paint,d.transform.zoom,qt,Fi)}d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!1)}function So(d,n,a,f,g,x,T,E,C,D,L,z,B,V,H,W,q,j,Y){const re=d.context,Q=re.gl,se=d.transform,X=d.transform.zoom,oe=[],ue=bo(d,a.paint.get("fill-extrusion-cutoff-fade-range"));D==="clear"?(oe.push("CLEAR_SUBPASS"),Y&&(oe.push("CLEAR_FROM_TEXTURE"),re.activeTexture.set(Q.TEXTURE0),Y.bind(Q.LINEAR,Q.CLAMP_TO_EDGE))):D==="sdf"&&oe.push("SDF_SUBPASS"),q&&oe.push("HAS_CENTROID"),ue.shouldRenderCutoff&&oe.push("RENDER_CUTOFF");const de=a.layout.get("fill-extrusion-edge-radius"),_e=(Pe,be,Ne,Oe,et)=>{const Me=be.programConfigurations.get(a.id),ke=d.isTileAffectedByFog(Pe),me=d.getOrCreateProgram("fillExtrusionGroundEffect",{config:Me,defines:oe,overrideFog:ke}),Ae=((pt,ht,Et,Wt,Jt,qt,Yt,vi,ui,mi,pi)=>({u_matrix:ht,u_opacity:Et,u_ao_pass:Wt?1:0,u_meter_to_tile:Jt,u_ao:qt,u_flood_light_intensity:Yt,u_flood_light_color:vi,u_attenuation:ui,u_edge_radius:mi,u_fb:0,u_fb_size:pi}))(0,Oe,L,C,et,[z,B*et],V,H,W,X>=17?0:de*et,Y?Y.size[0]:0),it=[];q&&it.push(be.hiddenByLandmarkVertexBuffer),d.uploadCommonUniforms(re,me,Pe.toUnwrapped(),null,ue),me.draw(d,re.gl.TRIANGLES,g,x,T,E,Ae,a.id,be.vertexBuffer,be.indexBuffer,Ne,a.paint,X,Me,it)};for(const Pe of f){const be=n.getTile(Pe),Ne=be.getBucket(a);if(!Ne||Ne.projection.name!==se.projection.name||!Ne.groundEffect||Ne.groundEffect&&!Ne.groundEffect.hasData())continue;const Oe=Ne.groundEffect,et=1/Ne.tileToMeter;{const Me=d.translatePosMatrix(Pe.projMatrix,be,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),ke=Oe.getDefaultSegment();_e(Pe,Oe,ke,Me,et)}if(j)for(let Me=0;Me<4;Me++){const ke=r.cG[Me](Pe),me=n.getTile(ke);if(!me)continue;const Ae=me.getBucket(a);if(!Ae||Ae.projection.name!==se.projection.name||!Ae.groundEffect||Ae.groundEffect&&!Ae.groundEffect.hasData())continue;const it=Ae.groundEffect;let pt,ht;Me===0?(pt=[-r.V,0,0],ht=1):Me===1?(pt=[r.V,0,0],ht=0):Me===2?(pt=[0,-r.V,0],ht=3):(pt=[0,r.V,0],ht=2);const Et=it.regionSegments[ht];if(!Et)continue;const Wt=new Float32Array(16);r.a6.translate(Wt,Pe.projMatrix,pt),_e(Pe,it,Et,d.translatePosMatrix(Wt,be,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),et)}}}function cg(d,n,a,f,g,x,T){f.centroidVertexArray.length===0&&f.createCentroidsBuffer();const E=x?x.findDEMTileFor(a):null;if(!(E&&E.dem||T))return;const C=j=>new r.P(Math.ceil((j+r.cJ)*r.cK),0),D=j=>{const Y=n.getSource().minzoom,re=se=>{const X=n.getTileByID(se);if(X&&X.hasData())return X.getBucket(g)},Q=[0,-1,1];for(const se of Q){if(j.overscaledZ+se<Y)continue;const X=re(j.calculateScaledKey(j.overscaledZ+se));if(X)return X}},L=[0,0,0],z=(j,Y)=>(L[0]=Math.min(j.min.y,Y.min.y),L[1]=Math.max(j.max.y,Y.max.y),L[2]=r.V-Y.min.x>j.max.x?Y.min.x-r.V:j.max.x,L),B=(j,Y)=>(L[0]=Math.min(j.min.x,Y.min.x),L[1]=Math.max(j.max.x,Y.max.x),L[2]=r.V-Y.min.y>j.max.y?Y.min.y-r.V:j.max.y,L),V=[(j,Y)=>z(j,Y),(j,Y)=>z(Y,j),(j,Y)=>B(j,Y),(j,Y)=>B(Y,j)],H=(j,Y,re,Q,se,X,oe)=>{if(!x)return 0;const ue=[[X?re:j,X?j:re,0],[X?re:Y,X?Y:re,0]],de=oe<0?r.V+oe:oe,_e=[X?de:(j+Y)/2,X?(j+Y)/2:de,0];return re===0&&oe<0||re!==0&&oe>0?x.getForTilePoints(se,[_e],!0,Q):ue.push(_e),x.getForTilePoints(a,ue,!0,E),Math.max(ue[0][2],ue[1][2],_e[2])/x.exaggeration()};for(let j=0;j<4;j++){const Y=f.borderFeatureIndices[j];if(Y.length===0)continue;const re=r.cG[j](a),Q=D(re);if(!(Q&&Q instanceof r.cH)||f.borderDoneWithNeighborZ[j]===Q.canonical.z)continue;Q.centroidVertexArray.length===0&&Q.createCentroidsBuffer();const se=x?x.findDEMTileFor(re):null;if(!(se&&se.dem||T))continue;const X=(j<2?1:5)-j,oe=Q.borderDoneWithNeighborZ[X]!==f.canonical.z,ue=Q.borderFeatureIndices[X];let de=0;if(f.canonical.z!==Q.canonical.z){for(const _e of Y)f.showCentroid(f.featuresOnBorder[_e]);if(oe)for(const _e of ue)Q.showCentroid(Q.featuresOnBorder[_e]);f.borderDoneWithNeighborZ[j]=Q.canonical.z,Q.borderDoneWithNeighborZ[X]=f.canonical.z}for(const _e of Y){const Pe=f.featuresOnBorder[_e],be=f.centroidData[Pe.centroidDataIndex],Ne=Pe.borders[j];let Oe;for(;de<ue.length;){Oe=Q.featuresOnBorder[ue[de]];const et=Oe.borders[X];if(et[1]>Ne[0]+3||et[0]>Ne[0]-3)break;Q.showCentroid(Oe),de++}if(Oe&&de<ue.length){const et=de;let Me=0;for(;!(Oe.borders[X][0]>Ne[1]-3)&&(Me++,++de!==ue.length);)Oe=Q.featuresOnBorder[ue[de]];if(Oe=Q.featuresOnBorder[ue[et]],Me>1){const Ae=Oe.borders[X];Math.abs(Ne[0]-Ae[0])<3&&Math.abs(Ne[1]-Ae[1])<3&&(Me=1,de=et+1)}else if(Me===0){f.showCentroid(Pe);continue}const ke=Q.centroidData[Oe.centroidDataIndex];T&&Me===1&&(((W=be).flags|(q=ke).flags)&r.cI?(W.flags|=r.cI,q.flags|=r.cI):(W.flags&=~r.cI,q.flags&=~r.cI));const me=Pe.intersectsCount()>1||Oe.intersectsCount()>1;if(Me>1)de=et,be.centroidXY=ke.centroidXY=new r.P(0,0);else if(se&&se.dem&&!me){const Ae=V[j](be,ke),it=j%2?r.V-1:0,pt=H(Ae[0],Math.min(r.V-1,Ae[1]),it,se,re,j<2,Ae[2]);be.centroidXY=ke.centroidXY=C(pt)}else me?be.centroidXY=ke.centroidXY=new r.P(0,0):(be.centroidXY=f.encodeBorderCentroid(Pe),ke.centroidXY=Q.encodeBorderCentroid(Oe));f.writeCentroidToBuffer(be),Q.writeCentroidToBuffer(ke)}else f.showCentroid(Pe)}f.borderDoneWithNeighborZ[j]=Q.canonical.z,Q.borderDoneWithNeighborZ[X]=f.canonical.z}var W,q;(f.needsCentroidUpdate||!f.centroidVertexBuffer&&f.centroidVertexArray.length!==0)&&f.uploadCentroid(d)}const ug=[1,0,0],td=[0,1,0],xp=[0,0,1];function vp(d,n,a){const f=a.transform,g=a.shadowRenderer;if(!g)return!0;const x=d.toUnwrapped(),T=f.tileSize*g._cascades[a.currentShadowCascade].scale;let E=n.maxHeight;if(f.elevation){const W=f.elevation.getMinMaxForTile(d);W&&(E+=W.max)}const C=[...g.shadowDirection];C[2]=-C[2];const D=g.computeSimplifiedTileShadowVolume(x,E,T,C);if(!D)return!1;const L=[ug,td,xp,C,[C[0],0,C[2]],[0,C[1],C[2]]],z=f.projection.name==="globe",B=f.scaleZoom(T),V=r.bq.fromInvProjectionMatrix(f.invProjMatrix,f.worldSize,B,!z),H=g.getCurrentCascadeFrustum();return V.intersectsPrecise(D.vertices,D.planes,L)===0||H.intersectsPrecise(D.vertices,D.planes,L)===0}function bp(d){return[d[0]*r.cL,d[1]*r.cL,d[2]*r.cL,0]}function id(d,n,a,f,g,x,T,E,C){const D=f.getSource(),L=a.globeSharedBuffers;if(!L)return;let z,B,V;if(n&&(z=f.getTile(n)),D instanceof r.ap?(B=D.texture,V=r.cj(0,0,a.transform)):z&&n&&(B=z.texture,V=r.cj(n.canonical.z,n.canonical.x,a.transform)),!B||!V)return;d||(V=r.a6.scale(r.a6.create(),V,[1,-1,1]));const H=a.context,W=H.gl,q=g.paint.get("raster-resampling")==="nearest"?W.NEAREST:W.LINEAR,j=a.colorModeForDrapableLayerRenderPass(x),Y=T.defines;Y.push("GLOBE_POLES");const re=new ni(W.LEQUAL,ni.ReadWrite,a.depthRangeFor3D),Q=Float32Array.from(a.transform.expandedFarZProjMatrix),se=Float32Array.from(r.aT(r.ci(new r.bs(0,0,0))));a.terrain&&a.terrain.prepareDrawTile(),H.activeTexture.set(W.TEXTURE0),B.bind(q,W.CLAMP_TO_EDGE),H.activeTexture.set(W.TEXTURE1),B.bind(q,W.CLAMP_TO_EDGE),B.useMipmap&&H.extTextureFilterAnisotropic&&a.transform.pitch>20&&W.texParameterf(W.TEXTURE_2D,H.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,H.extTextureFilterAnisotropicMax);const[X,oe,ue,de]=n?L.getPoleBuffers(n.canonical.z,!1):L.getPoleBuffers(0,!0),_e=g.paint.get("raster-elevation");let Pe;d?(Pe=X,a.renderDefaultNorthPole=_e!==0):(Pe=oe,a.renderDefaultSouthPole=_e!==0);const be=bp(T.mix),Ne=((et,Me,ke,me,Ae,it,pt,ht,Et,Wt,Jt,qt,Yt)=>Qh(et,Me,ke,new Float32Array(16),new Float32Array(9),[0,0],me,[0,0],[0,0,0,0],1,{opacity:1,mix:0},it,[0,0],ht,2,Wt,Jt,qt,1,0,Yt))(Q,se,V,r.S(a.transform.zoom),0,g,0,_e,0,be,T.offset,T.range,x),Oe=a.getOrCreateProgram("raster",{defines:Y});a.uploadCommonUniforms(H,Oe,null),Oe.draw(a,W.TRIANGLES,re,C,j,E,Ne,g.id,Pe,ue,de)}function nd(d){const n=d._nearZ,a=d.projection.farthestPixelDistance(d),f=a-n,g=.2*d.height,x=n+g;return[n,a,(x-g-n)/f,(x-n)/f]}function rd(d,n,a,f){if(d)return n instanceof xt&&d instanceof qo?n.getTextureDescriptor(d,a,!0):{texture:d.texture,mix:bp(f.mix),offset:f.offset,buffer:0,tileSize:1}}function sd(d,n,a){if(!d)return null;const f=n.getTextureDescriptor(d,a,!0);if(!f)return null;let{texture:g,mix:x,offset:T,tileSize:E,buffer:C,format:D}=f;if(!g||!D)return null;let L=!1;return D==="uint32"&&(L=!0,x[3]=0,x=uu(r.cM,x,[0,a.paint.get("raster-particle-max-speed")]),T=mp(r.cM,T,[0,a.paint.get("raster-particle-max-speed")])),{texture:g,textureOffset:[C/(E+2*C),E/(E+2*C)],tileSize:E,scalarData:L,scale:x,offset:T,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[D]]}}function od(d){const n=d._nearZ,a=d.projection.farthestPixelDistance(d),f=a-n,g=.2*d.height,x=n+g;return[n,a,(x-g-n)/f,(x-n)/f]}const $r=new r.ax(1,0,0,1),Eo=new r.ax(0,1,0,1),wp=new r.ax(0,0,1,1),ad=new r.ax(1,0,1,1),ld=new r.ax(0,1,1,1);function Ao(d,n,a,f,g,x,T){const E=d.context,C=d.transform,D=E.gl,L=C.projection.name==="globe",z=L?["PROJECTION_GLOBE_VIEW"]:[];let B=r.a6.clone(a.projMatrix);if(L&&r.S(C.zoom)>0){const be=r.aS(a.canonical,C),Ne=r.cN(be);B=r.a6.multiply(new Float32Array(16),C.globeMatrix,Ne),r.a6.multiply(B,C.projMatrix,B)}const V=r.a6.create();V[12]+=2*g/(r.f.devicePixelRatio*C.width),V[13]+=2*x/(r.f.devicePixelRatio*C.height),r.a6.multiply(B,V,B);const H=d.getOrCreateProgram("debug",{defines:z}),W=n.getTileByID(a.key);d.terrain&&d.terrain.setupElevationDraw(W,H);const q=ni.disabled,j=di.disabled,Y=d.colorModeForRenderPass(),re="$debug";E.activeTexture.set(D.TEXTURE0),d.emptyTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),L?W._makeGlobeTileDebugBuffers(d.context,C):W._makeDebugTileBoundsBuffers(d.context,C.projection);const Q=W._tileDebugBuffer||d.debugBuffer,se=W._tileDebugIndexBuffer||d.debugIndexBuffer,X=W._tileDebugSegments||d.debugSegments;if(H.draw(d,D.LINE_STRIP,q,j,Y,ri.disabled,Kh(B,f),re,Q,se,X,null,null,null,[W._globeTileDebugBorderBuffer]),T){const be=W.latestRawTileData,Ne=Math.floor((be&&be.byteLength||0)/1024);let Oe=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(Oe+=` => ${a.overscaledZ}`),Oe+=` ${W.state}`,Oe+=` ${Ne}kb`,function(et,Me){et.initDebugOverlayCanvas();const ke=et.debugOverlayCanvas,me=et.context.gl,Ae=et.debugOverlayCanvas.getContext("2d");Ae.clearRect(0,0,ke.width,ke.height),Ae.shadowColor="white",Ae.shadowBlur=2,Ae.lineWidth=1.5,Ae.strokeStyle="white",Ae.textBaseline="top",Ae.font="bold 36px Open Sans, sans-serif",Ae.fillText(Me,5,5),Ae.strokeText(Me,5,5),et.debugOverlayTexture.update(ke),et.debugOverlayTexture.bind(me.LINEAR,me.CLAMP_TO_EDGE)}(d,Oe)}const oe=n.getTile(a).tileSize,ue=512/Math.min(oe,512)*(a.overscaledZ/C.zoom)*.5,de=W._tileDebugTextBuffer||d.debugBuffer,_e=W._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,Pe=W._tileDebugTextSegments||d.debugSegments;H.draw(d,D.TRIANGLES,q,j,Ai.alphaBlended,ri.disabled,Kh(B,r.ax.transparent,ue),re,de,_e,Pe,null,null,null,[W._globeTileDebugTextBuffer])}function cd(d,n,a,f){On(d,0,n+a/2,d.transform.width,a,f)}function ns(d,n,a,f){On(d,n-a/2,0,a,d.transform.height,f)}function On(d,n,a,f,g,x){const T=d.context,E=T.gl;E.enable(E.SCISSOR_TEST),E.scissor(n*r.f.devicePixelRatio,a*r.f.devicePixelRatio,f*r.f.devicePixelRatio,g*r.f.devicePixelRatio),T.clear({color:x}),E.disable(E.SCISSOR_TEST)}const mu=r.ay([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ud}=mu;function Zs(d,n,a,f){d.emplaceBack(n,a,f)}class hd{constructor(n){this.vertexArray=new r.az,this.indices=new r.aw,Zs(this.vertexArray,-1,-1,1),Zs(this.vertexArray,1,-1,1),Zs(this.vertexArray,-1,1,1),Zs(this.vertexArray,1,1,1),Zs(this.vertexArray,-1,-1,-1),Zs(this.vertexArray,1,-1,-1),Zs(this.vertexArray,-1,1,-1),Zs(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,ud),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=r.aB.simpleSegment(0,0,36,12)}}function ia(d,n,a,f,g,x){const T=d.context.gl,E=n.paint.get("sky-atmosphere-color"),C=n.paint.get("sky-atmosphere-halo-color"),D=n.paint.get("sky-atmosphere-sun-intensity"),L=((z,B,V,H,W)=>({u_matrix_3f:z,u_sun_direction:B,u_sun_intensity:V,u_color_tint_r:[H.r,H.g,H.b,H.a],u_color_tint_m:[W.r,W.g,W.b,W.a],u_luminance:5e-5}))(r.co.fromMat4(r.co.create(),f),g,D,E,C);T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+x,n.skyboxTexture,0),a.draw(d,T.TRIANGLES,ni.disabled,di.disabled,Ai.unblended,ri.frontCW,L,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const hg=r.ay([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class qa{constructor(n){const a=new r.cO;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const f=new r.aw;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(a,hg.members),this.indexBuffer=n.createIndexBuffer(f),this.segments=r.aB.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Xl=r.ay([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class gt{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class ti{constructor(n){this.colorModeAlphaBlendedWriteRGB=new Ai([1,po,1,po],r.ax.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Ai([1,0,1,0],r.ax.transparent,[!1,!1,!1,!0]),this.params=new gt,this.updateNeeded=!0,n.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),n.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(n){const a=n.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new qa(a);const f=this.params.sizeRange,g=this.params.intensityRange,x=function(L){const z=r.aA(30),B=[];for(let V=0;V<L;++V){const H=2*Math.PI*z(),W=Math.acos(1-2*z())-.5*Math.PI;B.push(r.N.fromValues(Math.cos(W)*Math.cos(H),Math.cos(W)*Math.sin(H),Math.sin(W)))}return B}(this.params.starsCount),T=r.aA(300),E=new r.cP,C=new r.aw;let D=0;for(let L=0;L<x.length;++L){const z=r.N.scale([],x[L],200),B=Math.max(0,1+.01*f*(1*T()-.5)),V=Math.max(0,1+.01*g*(1*T()-.5));E.emplaceBack(z[0],z[1],z[2],-1,-1,B,V),E.emplaceBack(z[0],z[1],z[2],1,-1,B,V),E.emplaceBack(z[0],z[1],z[2],1,1,B,V),E.emplaceBack(z[0],z[1],z[2],-1,1,B,V),C.emplaceBack(D+0,D+1,D+2),C.emplaceBack(D+0,D+2,D+3),D+=4}this.starsVx=a.createVertexBuffer(E,Xl.members),this.starsIdx=a.createIndexBuffer(C),this.starsSegments=r.aB.simpleSegment(0,0,E.length,C.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(n,a){const f=n.context,g=f.gl,x=n.transform,T=new ni(g.LEQUAL,ni.ReadOnly,[0,1]),E=r.S(x.zoom),C=a.properties.get("color").toArray01(),D=a.properties.get("high-color").toArray01(),L=a.properties.get("space-color").toArray01PremultipliedAlpha(),z=5e-4,B=r.cQ(a.properties.get("horizon-blend"),0,1,z,.25),V=r.cd(n,f,x)&&B===z?x.worldSize/(2*Math.PI*1.025)-1:x.globeRadius,H=n.frameCounter/1e3%1,W=r.N.length(x.globeCenterInViewSpace),q=Math.sqrt(Math.pow(W,2)-Math.pow(V,2)),j=Math.acos(q/W),Y=re=>{const Q=x.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];re&&Q.push("ALPHA_PASS");const se=n.getOrCreateProgram("globeAtmosphere",{defines:Q}),X=((ue,de,_e,Pe,be,Ne,Oe,et,Me,ke,me,Ae)=>({u_frustum_tl:ue,u_frustum_tr:de,u_frustum_br:_e,u_frustum_bl:Pe,u_horizon:be,u_transition:Ne,u_fadeout_range:Oe,u_color:et,u_high_color:Me,u_space_color:ke,u_temporal_offset:me,u_horizon_angle:Ae}))(x.frustumCorners.TL,x.frustumCorners.TR,x.frustumCorners.BR,x.frustumCorners.BL,x.frustumCorners.horizon,E,B,C,D,L,H,j);n.uploadCommonUniforms(f,se);const oe=this.atmosphereBuffer;oe&&se.draw(n,g.TRIANGLES,T,di.disabled,re?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,ri.backCW,X,re?"atmosphere_glow_alpha":"atmosphere_glow",oe.vertexBuffer,oe.indexBuffer,oe.segments)};Y(!1),Y(!0)}drawStars(n,a){const f=r.aa(a.properties.get("star-intensity"),0,1);if(f===0)return;const g=n.context,x=g.gl,T=n.transform,E=n.getOrCreateProgram("stars"),C=r.bi.identity([]);r.bi.rotateX(C,C,-T._pitch),r.bi.rotateZ(C,C,-T.angle),r.bi.rotateX(C,C,r.bj(T._center.lat)),r.bi.rotateY(C,C,-r.bj(T._center.lng));const D=r.a6.fromQuat(new Float32Array(16),C),L=r.a6.multiply([],T.starsProjMatrix,D),z=r.co.fromMat4([],D),B=r.co.invert([],z),V=[0,1,0];r.N.transformMat3(V,V,B),r.N.scale(V,V,this.params.sizeMultiplier);const H=[1,0,0];r.N.transformMat3(H,H,B),r.N.scale(H,H,this.params.sizeMultiplier);const W=(q=V,j=H,Y=f,{u_matrix:Float32Array.from(L),u_up:q,u_right:j,u_intensity_multiplier:Y});var q,j,Y;n.uploadCommonUniforms(g,E),this.starsVx&&this.starsIdx&&E.draw(n,x.TRIANGLES,ni.disabled,di.disabled,this.colorModeAlphaBlendedWriteRGB,ri.disabled,W,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function na(d,n){const a=[...d],f=n.cameraWorldSizeForFog/n.worldSize,g=r.a6.identity([]);return r.a6.scale(g,g,[f,f,1]),r.a6.multiply(a,g,a),r.a6.multiply(a,n.worldToFogMatrix,a),a}function Fn(d,n,a,f){const g=a.material,x=f.context,{baseColorTexture:T,metallicRoughnessTexture:E}=g.pbrMetallicRoughness,{normalTexture:C,occlusionTexture:D,emissionTexture:L}=g;function z(B,V,H){if(B&&(d.push(V),x.activeTexture.set(x.gl.TEXTURE0+H),B.gfxTexture)){const{minFilter:W,magFilter:q,wrapS:j,wrapT:Y}=B.sampler;B.gfxTexture.bindExtraParam(W,q,j,Y)}}z(T,"HAS_TEXTURE_u_baseColorTexture",Er.BaseColor),z(E,"HAS_TEXTURE_u_metallicRoughnessTexture",Er.MetallicRoughness),z(C,"HAS_TEXTURE_u_normalTexture",Er.Normal),z(D,"HAS_TEXTURE_u_occlusionTexture",Er.Occlusion),z(L,"HAS_TEXTURE_u_emissionTexture",Er.Emission),a.texcoordBuffer&&(d.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(a.texcoordBuffer)),a.colorBuffer&&(d.push(a.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(a.colorBuffer)),a.normalBuffer&&(d.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(a.normalBuffer)),a.pbrBuffer&&(d.push("HAS_ATTRIBUTE_a_pbr"),d.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(a.pbrBuffer)),g.alphaMode!=="OPAQUE"&&g.alphaMode!=="MASK"||d.push("UNPREMULT_TEXTURE_IN_SHADER"),g.defined||d.push("DIFFUSE_SHADED"),d.push("USE_STANDARD_DERIVATIVES")}function Yl(d,n,a,f,g,x){const T=a.paint.get("model-opacity"),E=n.context,C=new ni(n.context.gl.LEQUAL,ni.ReadWrite,n.depthRangeFor3D),D=n.transform,L=d.mesh,z=L.material,B=z.pbrMetallicRoughness,V=n.style.fog;let H;H=n.transform.projection.zAxisUnit==="pixels"?[...d.nodeModelMatrix]:r.a6.multiply([],f.zScaleMatrix,d.nodeModelMatrix),r.a6.multiply(H,f.negCameraPosMatrix,H);const W=r.a6.invert([],H);r.a6.transpose(W,W);const q=a.paint.get("model-emissive-strength").constantOr(0),j=fu(new Float32Array(d.worldViewProjection),new Float32Array(H),new Float32Array(W),n,T,B.baseColorFactor,z.emissiveFactor,B.metallicFactor,B.roughnessFactor,z,q,a),Y={defines:[]},re=[];Fn(Y.defines,re,L,n);const Q=n.shadowRenderer;Q&&(Q.useNormalOffset=!1);let se=null;if(V){const ue=na(d.nodeModelMatrix,n.transform);if(se=new Float32Array(ue),D.projection.name!=="globe"){const de=L.aabb.min,_e=L.aabb.max,[Pe,be]=V.getOpacityForBounds(ue,de[0],de[1],_e[0],_e[1]);Y.overrideFog=Pe>=tn||be>=tn}}const X=bo(n,a.paint.get("model-cutoff-fade-range"));X.shouldRenderCutoff&&Y.defines.push("RENDER_CUTOFF");const oe=n.getOrCreateProgram("model",Y);n.uploadCommonUniforms(E,oe,null,se,X),n.renderPass!=="shadow"&&Q&&Q.setupShadowsFromMatrix(d.nodeModelMatrix,oe),oe.draw(n,E.gl.TRIANGLES,C,g,x,L.material.doubleSided?ri.disabled:ri.backCCW,j,a.id,L.vertexBuffer,L.indexBuffer,L.segments,a.paint,n.transform.zoom,void 0,re)}function Kl(d,n,a,f,g,x,T){let E;E=d.projection.name==="globe"?r.cS(a,d):[...a],r.a6.multiply(E,E,n.matrix);const C=r.a6.multiply([],f,E);if(n.meshes)for(const D of n.meshes){if(D.material.alphaMode!=="BLEND"){T.push({mesh:D,depth:0,modelIndex:g,worldViewProjection:C,nodeModelMatrix:E});continue}const L=r.N.transformMat4([],D.centroid,C);L[2]>0&&x.push({mesh:D,depth:L[2],modelIndex:g,worldViewProjection:C,nodeModelMatrix:E})}if(n.children)for(const D of n.children)Kl(d,D,a,f,g,x,T)}function Ie(d,n,a,f){const g=a.shadowRenderer;if(!g)return;const x=g.getShadowPassDepthMode(),T=g.getShadowPassColorMode(),E=g.calculateShadowPassMatrixFromMatrix(n),C=ql(E);a.getOrCreateProgram("modelDepth",{defines:a._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(a,a.context.gl.TRIANGLES,x,di.disabled,T,ri.backCCW,C,f.id,d.vertexBuffer,d.indexBuffer,d.segments,f.paint,a.transform.zoom,void 0,void 0)}function dd(d,n,a){const f=n.updateZoomBasedPaintProperties(),g=function(x,T,E){let C,D,L,z=x.terrain?x.terrain.exaggeration():0;if(x.terrain&&z>0){const B=x.terrain,V=B.findDEMTileFor(E);V&&V.dem?C=r.cU.create(B,E,V):z=0}if(z===0&&(T.terrainElevationMin=0,T.terrainElevationMax=0),z===T.validForExaggeration&&(z===0||C&&C._demTile&&C._demTile.tileID===T.validForDEMTile.id&&C._dem._timestamp===T.validForDEMTile.timestamp))return!1;for(const B in T.instancesPerModel){const V=T.instancesPerModel[B];for(let H=0;H<V.instancedDataArray.length;++H){const W=(C?z*C.getElevationAt(0|V.instancedDataArray.float32[16*H],0|V.instancedDataArray.float32[16*H+1],!0,!0):0)+V.instancesEvaluatedElevation[H];V.instancedDataArray.float32[16*H+6]=W,D=D?Math.min(T.terrainElevationMin,W):W,L=L?Math.max(T.terrainElevationMax,W):W}}return T.terrainElevationMin=D||0,T.terrainElevationMax=L||0,T.validForExaggeration=z,T.validForDEMTile=C&&C._demTile?{id:C._demTile.tileID,timestamp:C._dem._timestamp}:{id:void 0,timestamp:0},!0}(d,n,a);(f||g)&&(n.uploaded=!1,n.upload(d.context))}const rs={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.bS([0,0,0],[r.V,r.V,0])};function Tp(d,n){const a=1<<d.canonical.z,f=n.getFreeCameraOptions().position,g=n.elevation,x=d.canonical.x/a,T=(d.canonical.x+1)/a,E=d.canonical.y/a,C=(d.canonical.y+1)/a;let D=n._centerAltitude;if(g){const V=g.getMinMaxForTile(d);V&&V.max>D&&(D=V.max)}const L=r.aa(f.x,x,T)-f.x,z=r.aa(f.y,E,C)-f.y,B=r.bl(D,n.center.lat)-f.z;return n._zoomFromMercatorZ(Math.sqrt(L*L+z*z+B*B))}function fd(d,n,a,f,g,x,T){const E=d.context,C=d.renderPass==="shadow",D=d.shadowRenderer,L=C&&D?D.getShadowPassDepthMode():new ni(E.gl.LEQUAL,ni.ReadWrite,d.depthRangeFor3D),z=d.isTileAffectedByFog(x);if(a.meshes)for(const B of a.meshes){const V=["MODEL_POSITION_ON_GPU"],H=[];let W,q,j;f.instancedDataArray.length>20&&V.push("INSTANCED_ARRAYS");const Y=bo(d,n.paint.get("model-cutoff-fade-range"));if(Y.shouldRenderCutoff&&V.push("RENDER_CUTOFF"),C&&D)W=d.getOrCreateProgram("modelDepth",{defines:V}),q=ql(T.shadowTileMatrix,T.shadowTileMatrix,Float32Array.from(a.matrix)),j=D.getShadowPassColorMode();else{Fn(V,H,B,d),W=d.getOrCreateProgram("model",{defines:V,overrideFog:z});const Q=B.material,se=Q.pbrMetallicRoughness,X=n.paint.get("model-opacity"),oe=n.paint.get("model-emissive-strength").constantOr(0);q=fu(x.expandedProjMatrix,Float32Array.from(a.matrix),new Float32Array(16),d,X,se.baseColorFactor,Q.emissiveFactor,se.metallicFactor,se.roughnessFactor,Q,oe,n,g),D&&(T.shadowUniformsInitialized?W.setShadowUniformValues(E,D.getShadowUniformValues()):(D.setupShadows(x.toUnwrapped(),W,"model-tile",x.overscaledZ),T.shadowUniformsInitialized=!0)),j=Y.shouldRenderCutoff||X<1||Q.alphaMode!=="OPAQUE"?Ai.alphaBlended:Ai.unblended}d.uploadCommonUniforms(E,W,x.toUnwrapped(),null,Y);const re=B.material.doubleSided?ri.disabled:ri.backCCW;if(f.instancedDataArray.length>20)H.push(f.instancedDataBuffer),W.draw(d,E.gl.TRIANGLES,L,di.disabled,j,re,q,n.id,B.vertexBuffer,B.indexBuffer,B.segments,n.paint,d.transform.zoom,void 0,H,f.instancedDataArray.length);else{const Q=C?"u_instance":"u_normal_matrix";for(let se=0;se<f.instancedDataArray.length;++se)q[Q]=new Float32Array(f.instancedDataArray.arrayBuffer,64*se,16),W.draw(d,E.gl.TRIANGLES,L,di.disabled,j,re,q,n.id,B.vertexBuffer,B.indexBuffer,B.segments,n.paint,d.transform.zoom,void 0,H)}}if(a.children)for(const B of a.children)fd(d,n,B,f,g,x,T)}const Za=[1,-1,1];function dg(d,n,a,f){if(!a.modelManager)return!0;const g=a.modelManager;if(!a.shadowRenderer)return!0;const x=a.shadowRenderer,T=n.aabb;let E=!0,C=d.maxHeight;if(C===0){let L=0;for(const z in d.instancesPerModel){const B=g.getModel(z,f);B?L=Math.max(L,Math.max(Math.max(B.aabb.max[0],B.aabb.max[1]),B.aabb.max[2])):E=!1}C=d.maxScale*L*1.41+d.maxVerticalOffset,E&&(d.maxHeight=C)}T.max[2]=C,T.min[2]+=d.terrainElevationMin,T.max[2]+=d.terrainElevationMax,r.N.transformMat4(T.min,T.min,n.tileMatrix),r.N.transformMat4(T.max,T.max,n.tileMatrix);const D=T.intersects(x.getCurrentCascadeFrustum());return a.currentShadowCascade===0&&(d.isInsideFirstShadowMapFrustum=D===2),D===0}class fg{}class Mp{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(n,a,f){{const z=this._storage.get(a.id);if(z)return z.lastUsedFrameIdx=n,z.buf}const g=f.gl,x=g.getBufferParameter(g.ELEMENT_ARRAY_BUFFER,g.BUFFER_SIZE),T=new ArrayBuffer(x),E=new Int16Array(T);g.getBufferSubData(g.ELEMENT_ARRAY_BUFFER,0,new Int16Array(T));const C=new r.cW;for(let z=0;z<x/2;z+=3){const B=E[z],V=E[z+1],H=E[z+2];C.emplaceBack(B,V),C.emplaceBack(V,H),C.emplaceBack(H,B)}const D=f.bindVertexArrayOES.current,L=new fg;return L.buf=new vn(f,C),L.lastUsedFrameIdx=n,this._storage.set(a.id,L),f.bindVertexArrayOES.set(D),L.buf}update(n){for(const[a,f]of this._storage)n-f.lastUsedFrameIdx>30&&(f.buf.destroy(),this._storage.delete(a))}destroy(){for(const[n,a]of this._storage)a.buf.destroy(),this._storage.delete(n)}}class Jl{registerParameter(n,a,f,g,x){}registerButton(n,a,f){}}const Ql={symbol:function(d,n,a,f,g){if(d.renderPass!=="translucent")return;const x=di.disabled,T=d.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(D,L,z,B,V,H,W){const q=L.transform,j=V==="map",Y=H==="map";for(const re of D){const Q=B.getTile(re),se=Q.getBucket(z);if(!se||!se.text||!se.text.segments.get().length)continue;const X=r.b5(se.textSizeData,q.zoom),oe=Rl(re,se.getProjection(),q),ue=q.calculatePixelsToTileUnitsMatrix(Q),de=Ll(oe,Q.tileID.canonical,Y,j,q,se.getProjection(),ue),_e=se.hasIconTextFit()&&se.hasIconData();if(X){const Pe=Math.pow(2,q.zoom-Q.tileID.overscaledZ);yp(se,j,Y,W,r.cx,q,de,re,Pe,X,_e)}}}(f,d,a,n,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),g);const E=a.paint.get("icon-opacity").constantOr(1)!==0,C=a.paint.get("text-opacity").constantOr(1)!==0;a.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(E||C)?pu(d,n,a,f,x,T):(E&&pu(d,n,a,f,x,T,{onlyIcons:!0}),C&&pu(d,n,a,f,x,T,{onlyText:!0})),n.map.showCollisionBoxes&&(Ss(d,n,a,f,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),Ss(d,n,a,f,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(d,n,a,f){if(d.renderPass!=="translucent")return;const g=a.paint.get("circle-opacity"),x=a.paint.get("circle-stroke-width"),T=a.paint.get("circle-stroke-opacity"),E=a.layout.get("circle-sort-key").constantOr(1)!==void 0,C=a.paint.get("circle-emissive-strength");if(g.constantOr(1)===0&&(x.constantOr(1)===0||T.constantOr(1)===0))return;const D=d.context,L=D.gl,z=d.transform,B=d.depthModeForSublayer(0,ni.ReadOnly),V=di.disabled,H=d.colorModeForDrapableLayerRenderPass(C),W=z.projection.name==="globe",q=[r.a5(z.center.lng),r.ae(z.center.lat)],j=[];for(let re=0;re<f.length;re++){const Q=f[re],se=n.getTile(Q),X=se.getBucket(a);if(!X||X.projection.name!==z.projection.name)continue;const oe=X.programConfigurations.get(a.id),ue=r.cy(a),de=d.isTileAffectedByFog(Q);W&&ue.push("PROJECTION_GLOBE_VIEW");const _e=d.getOrCreateProgram("circle",{config:oe,defines:ue,overrideFog:de}),Pe=X.layoutVertexBuffer,be=X.globeExtVertexBuffer,Ne=X.indexBuffer,Oe=z.projection.createInversionMatrix(z,Q.canonical),et={programConfiguration:oe,program:_e,layoutVertexBuffer:Pe,globeExtVertexBuffer:be,indexBuffer:Ne,uniformValues:r.cz(d,Q,se,Oe,q,a),tile:se};if(E){const Me=X.segments.get();for(const ke of Me)j.push({segments:new r.aB([ke]),sortKey:ke.sortKey,state:et})}else j.push({segments:X.segments,sortKey:0,state:et})}E&&j.sort((re,Q)=>re.sortKey-Q.sortKey);const Y={useDepthForOcclusion:z.depthOcclusionForSymbolsAndCircles};for(const re of j){const{programConfiguration:Q,program:se,layoutVertexBuffer:X,globeExtVertexBuffer:oe,indexBuffer:ue,uniformValues:de,tile:_e}=re.state,Pe=re.segments;d.terrain&&d.terrain.setupElevationDraw(_e,se,Y),d.uploadCommonUniforms(D,se,_e.tileID.toUnwrapped()),se.draw(d,L.TRIANGLES,B,V,H,ri.disabled,de,a.id,X,ue,Pe,a.paint,z.zoom,Q,[oe])}},heatmap:function(d,n,a,f){if(a.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const g=d.context,x=g.gl,T=di.disabled,E=new Ai([x.ONE,x.ONE,x.ONE,x.ONE],r.ax.transparent,[!0,!0,!0,!0]);(function(V,H,W,q){const j=V.gl,Y=H.width*q,re=H.height*q;V.activeTexture.set(j.TEXTURE1),V.viewport.set([0,0,Y,re]);let Q=W.heatmapFbo;if(!Q||Q&&(Q.width!==Y||Q.height!==re)){Q&&Q.destroy();const se=j.createTexture();j.bindTexture(j.TEXTURE_2D,se),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,j.LINEAR),Q=W.heatmapFbo=V.createFramebuffer(Y,re,!0,null),function(X,oe,ue,de,_e,Pe){const be=X.gl;be.texImage2D(be.TEXTURE_2D,0,X.extRenderToTextureHalfFloat?be.RGBA16F:be.RGBA,_e,Pe,0,be.RGBA,X.extRenderToTextureHalfFloat?be.HALF_FLOAT:be.UNSIGNED_BYTE,null),de.colorAttachment.set(ue)}(V,0,se,Q,Y,re)}else j.bindTexture(j.TEXTURE_2D,Q.colorAttachment.get()),V.bindFramebuffer.set(Q.framebuffer)})(g,d,a,d.transform.projection.name==="globe"?.5:.25),g.clear({color:r.ax.transparent});const C=d.transform,D=C.projection.name==="globe",L=D?["PROJECTION_GLOBE_VIEW"]:[],z=D?ri.frontCCW:ri.disabled,B=[r.a5(C.center.lng),r.ae(C.center.lat)];for(let V=0;V<f.length;V++){const H=f[V];if(n.hasRenderableParent(H))continue;const W=n.getTile(H),q=W.getBucket(a);if(!q||q.projection.name!==C.projection.name)continue;const j=d.isTileAffectedByFog(H),Y=q.programConfigurations.get(a.id),re=d.getOrCreateProgram("heatmap",{config:Y,defines:L,overrideFog:j}),{zoom:Q}=d.transform;d.terrain&&d.terrain.setupElevationDraw(W,re),d.uploadCommonUniforms(g,re,H.toUnwrapped());const se=C.projection.createInversionMatrix(C,H.canonical);re.draw(d,x.TRIANGLES,ni.disabled,T,E,z,Jh(d,H,W,se,B,Q,a.paint.get("heatmap-intensity")),a.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,a.paint,d.transform.zoom,Y,D?[q.globeExtVertexBuffer]:null)}g.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(g,x){const T=g.context,E=T.gl,C=x.heatmapFbo;if(!C)return;T.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,C.colorAttachment.get()),T.activeTexture.set(E.TEXTURE1);let D=x.colorRampTexture;D||(D=x.colorRampTexture=new r.T(T,x.colorRamp,E.RGBA)),D.bind(E.LINEAR,E.CLAMP_TO_EDGE),g.getOrCreateProgram("heatmapTexture").draw(g,E.TRIANGLES,ni.disabled,di.disabled,g.colorModeForRenderPass(),ri.disabled,((L,z,B,V)=>({u_image:0,u_color_ramp:1,u_opacity:z.paint.get("heatmap-opacity")}))(0,x),x.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,x.paint,g.transform.zoom)}(d,a))},line:function(d,n,a,f){if(d.renderPass!=="translucent")return;const g=a.paint.get("line-opacity"),x=a.paint.get("line-width");if(g.constantOr(1)===0||x.constantOr(1)===0)return;const T=a.paint.get("line-emissive-strength"),E=d.depthModeForSublayer(0,ni.ReadOnly),C=d.colorModeForDrapableLayerRenderPass(T),D=d.terrain&&d.terrain.renderingToTexture?1:r.f.devicePixelRatio,L=a.paint.get("line-dasharray"),z=L.constantOr(1),B=a.layout.get("line-cap"),V=a.paint.get("line-pattern"),H=V.constantOr(1),W=a.paint.get("line-pattern").constantOr(1),q=a.paint.get("line-opacity").constantOr(1)!==1;let j=!W&&q;const Y=a.paint.get("line-gradient"),re=H?"linePattern":"line",Q=d.context,se=Q.gl,X=r.cA(a);d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(j=!1);for(const oe of f){const ue=n.getTile(oe);if(H&&!ue.patternsLoaded())continue;const de=ue.getBucket(a);if(!de)continue;d.prepareDrawTile();const _e=de.programConfigurations.get(a.id),Pe=d.isTileAffectedByFog(oe),be=d.getOrCreateProgram(re,{config:_e,defines:X,overrideFog:Pe}),Ne=V.constantOr(null);if(Ne&&ue.imageAtlas){const pt=ue.imageAtlas.patternPositions[Ne.toString()];pt&&_e.setConstantPatternPositions(pt)}const Oe=L.constantOr(null),et=B.constantOr(null);if(!H&&Oe&&et&&ue.lineAtlas){const pt=ue.lineAtlas.getDash(Oe,et);pt&&_e.setConstantPatternPositions(pt)}let[Me,ke]=a.paint.get("line-trim-offset");(et==="round"||et==="square")&&Me!==ke&&(Me===0&&(Me-=1),ke===1&&(ke+=1));const me=d.terrain?oe.projMatrix:null,Ae=H?r.cB(d,ue,a,me,D,[Me,ke]):r.cC(d,ue,a,me,de.lineClipsArray.length,D,[Me,ke]);if(Y){const pt=de.gradients[a.id];let ht=pt.texture;if(a.gradientVersion!==pt.version){let Et=256;if(a.stepInterpolant){const Wt=n.getSource().maxzoom,Jt=oe.canonical.z===Wt?Math.ceil(1<<d.transform.maxZoom-oe.canonical.z):1;Et=r.aa(r.cD(de.maxLineLength/r.V*1024*Jt),256,Q.maxTextureSize)}pt.gradient=r.cE({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:Et,image:pt.gradient||void 0,clips:de.lineClipsArray}),pt.texture?pt.texture.update(pt.gradient):pt.texture=new r.T(Q,pt.gradient,se.RGBA),pt.version=a.gradientVersion,ht=pt.texture}Q.activeTexture.set(se.TEXTURE1),ht.bind(a.stepInterpolant?se.NEAREST:se.LINEAR,se.CLAMP_TO_EDGE)}z&&(Q.activeTexture.set(se.TEXTURE0),ue.lineAtlasTexture&&ue.lineAtlasTexture.bind(se.LINEAR,se.REPEAT),_e.updatePaintBuffers()),H&&(Q.activeTexture.set(se.TEXTURE0),ue.imageAtlasTexture&&ue.imageAtlasTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE),_e.updatePaintBuffers()),d.uploadCommonUniforms(Q,be,oe.toUnwrapped());const it=pt=>{be.draw(d,se.TRIANGLES,E,pt,C,ri.disabled,Ae,a.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,a.paint,d.transform.zoom,_e,[de.layoutVertexBuffer2])};if(j){const pt=d.stencilModeForClipping(oe).ref;pt===0&&d.terrain&&Q.clear({stencil:0});const ht={func:se.EQUAL,mask:255};Ae.u_alpha_discard_threshold=.8,it(new di(ht,pt,255,se.KEEP,se.KEEP,se.INVERT)),Ae.u_alpha_discard_threshold=0,it(new di(ht,pt,255,se.KEEP,se.KEEP,se.KEEP))}else it(d.stencilModeForClipping(oe))}j&&(d.resetStencilClippingMasks(),d.terrain&&Q.clear({stencil:0}))},fill:function(d,n,a,f){const g=a.paint.get("fill-color"),x=a.paint.get("fill-opacity");if(x.constantOr(1)===0)return;const T=a.paint.get("fill-emissive-strength"),E=d.colorModeForDrapableLayerRenderPass(T),C=a.paint.get("fill-pattern"),D=d.opaquePassEnabledForLayer()&&!C.constantOr(1)&&g.constantOr(r.ax.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===D){const L=d.depthModeForSublayer(1,d.renderPass==="opaque"?ni.ReadWrite:ni.ReadOnly);ta(d,n,a,f,L,E,!1)}if(d.renderPass==="translucent"&&a.paint.get("fill-antialias")){const L=d.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,ni.ReadOnly);ta(d,n,a,f,L,E,!0)}},"fill-extrusion":function(d,n,a,f){const g=a.paint.get("fill-extrusion-opacity"),x=d.context,T=x.gl,E=d.terrain,C=E&&E.renderingToTexture;if(g===0)return;const D=d.conflationActive&&d.layerUsedInConflation(a,n.getSource());if(D&&function(L,z,B,V){for(const H of V){const W=z.getTile(H).getBucket(B);W&&(W.updateReplacement(H,L.replacementSource),W.uploadCentroid(L.context))}}(d,n,a,f),E||D)for(const L of f){const z=n.getTile(L).getBucket(a);z&&cg(d.context,n,L,z,a,E,D)}if(d.renderPass==="shadow"&&d.shadowRenderer){const L=d.shadowRenderer;if(E&&g<.65&&a._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.Z)return;const z=L.getShadowPassDepthMode(),B=L.getShadowPassColorMode();Ht(d,n,a,f,z,di.disabled,B,D)}else if(d.renderPass==="translucent"){const L=!a.paint.get("fill-extrusion-pattern").constantOr(1),z=a.paint.get("fill-extrusion-color").constantOr(r.ax.white);if(!C&&z.a!==0){const B=new ni(d.context.gl.LEQUAL,ni.ReadWrite,d.depthRangeFor3D);g===1&&L?Ht(d,n,a,f,B,di.disabled,Ai.unblended,D):(Ht(d,n,a,f,B,di.disabled,Ai.disabled,D),Ht(d,n,a,f,B,d.stencilModeFor3D(),d.colorModeForRenderPass(),D),d.resetStencilClippingMasks())}if(d.style.enable3dLights()&&L&&(!E&&d.transform.projection.name!=="globe"||C)){const B=a.paint.get("fill-extrusion-opacity"),V=a.paint.get("fill-extrusion-ambient-occlusion-intensity"),H=a.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),W=a.paint.get("fill-extrusion-flood-light-intensity"),q=a.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),j=V>0&&H>0,Y=W>0,re=(se,X,oe)=>(1-oe)*se+oe*X,Q=se=>{const X=d.depthModeForSublayer(1,ni.ReadOnly,T.LEQUAL,!0),oe=a.paint.get(se?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ue=re(.1,3,oe),de=d._showOverdrawInspector;if(!de){const _e=new di({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),Pe=new Ai([T.ONE,T.ONE,T.ONE,T.ONE],r.ax.transparent,[!1,!1,!1,!0],T.MIN);So(d,n,a,f,X,_e,Pe,ri.disabled,se,"sdf",B,V,H,W,q,ue,D,!1)}{const _e=de?di.disabled:new di({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),Pe=de?d.colorModeForRenderPass():new Ai([T.ONE_MINUS_DST_ALPHA,T.DST_ALPHA,T.ONE,T.ONE],r.ax.transparent,[!0,!0,!0,!0]);So(d,n,a,f,X,_e,Pe,ri.disabled,se,"color",B,V,H,W,q,ue,D,!1)}};if(C){const se=(X,oe,ue)=>{const de=d.depthModeForSublayer(1,ni.ReadOnly,T.LEQUAL,!1),_e=a.paint.get(X?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Pe=re(.1,3,_e);{const be=new Ai([T.ONE,T.ONE,T.ONE,T.ONE],r.ax.transparent,[!1,!1,!1,!0]);So(d,n,a,f,de,di.disabled,be,ri.disabled,X,"clear",B,V,H,W,q,Pe,D,oe)}{const be=new di({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),Ne=new Ai([T.ONE,T.ONE,T.ONE,T.ONE],r.ax.transparent,[!1,!1,!1,!0],T.MIN);So(d,n,a,f,de,be,Ne,ri.disabled,X,"sdf",B,V,H,W,q,Pe,D,oe)}{const be=X?T.ZERO:T.ONE_MINUS_DST_ALPHA,Ne=new di({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),Oe=new Ai([be,T.DST_ALPHA,T.ONE_MINUS_DST_ALPHA,T.ZERO],r.ax.transparent,[!0,!0,!0,!0]);So(d,n,a,f,de,Ne,Oe,ri.disabled,X,"color",B,V,H,W,q,Pe,D,oe)}{const be=new Ai([T.ONE,T.ONE,T.ONE,X?T.ZERO:T.ONE],r.ax.transparent,[!1,!1,!1,!0],X?T.FUNC_ADD:T.MAX);So(d,n,a,f,de,di.disabled,be,ri.disabled,X,"clear",B,V,H,W,q,Pe,D,oe,ue)}};if(j||Y){let X;if(d.prepareDrawTile(),E){const oe=E.drapeBufferSize[0],ue=E.drapeBufferSize[1];X=E.framebufferCopyTexture,X&&(!X||X.size[0]===oe&&X.size[1]===ue)||(X&&X.destroy(),X=E.framebufferCopyTexture=new r.T(x,new r.h({width:oe,height:ue}),T.RGBA)),X.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.copyTexImage2D(T.TEXTURE_2D,0,T.RGBA,0,0,oe,ue,0)}j&&se(!0,!1,X),Y&&se(!1,!0,X)}}else j&&Q(!0),Y&&Q(!1)}}},hillshade:function(d,n,a,f){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent"||d.style.disableElevatedTerrain)return;const g=d.context,x=d.terrain&&d.terrain.renderingToTexture,[T,E]=d.renderPass!=="translucent"||x?[{},f]:d.stencilConfigForOverlap(f);for(const C of E){const D=n.getTile(C);if(D.needsHillshadePrepare&&d.renderPass==="offscreen")Nh(d,D,a);else if(d.renderPass==="translucent"){const L=d.depthModeForSublayer(0,ni.ReadOnly),z=a.paint.get("hillshade-emissive-strength"),B=d.colorModeForDrapableLayerRenderPass(z),V=x&&d.terrain?d.terrain.stencilModeForRTTOverlap(C):T[C.overscaledZ];au(d,C,D,a,L,V,B)}}g.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,n,a,f,g,x){if(d.renderPass!=="translucent"||a.paint.get("raster-opacity")===0)return;const T=d.transform.projection.name==="globe",E=a.paint.get("raster-elevation")!==0,C=E&&T;if(d.renderElevatedRasterBackface&&!C)return;const D=d.context,L=D.gl,z=n.getSource(),B=function(X,oe,ue,de){const _e=oe.paint.get("raster-color"),Pe=X.type==="raster-array",be=[],Ne=oe.paint.get("raster-resampling"),Oe=oe.paint.get("raster-color-mix");let et=oe.paint.get("raster-color-range");const Me=[Oe[0],Oe[1],Oe[2],0],ke=Oe[3];let me=Ne==="nearest"?de.NEAREST:de.LINEAR;if(Pe&&(be.push("RASTER_ARRAY"),_e||be.push("RASTER_COLOR"),Ne==="linear"&&be.push("RASTER_ARRAY_LINEAR"),me=de.NEAREST,!et&&X.rasterLayers)){const Ae=X.rasterLayers.find(({id:it})=>it===oe.sourceLayer);Ae&&Ae.fields&&Ae.fields.range&&(et=Ae.fields.range)}if(et=et||[0,1],_e){be.push("RASTER_COLOR"),ue.activeTexture.set(de.TEXTURE2),oe.updateColorRamp(et);let Ae=oe.colorRampTexture;Ae||(Ae=oe.colorRampTexture=new r.T(ue,oe.colorRamp,de.RGBA)),Ae.bind(de.LINEAR,de.CLAMP_TO_EDGE)}return{mix:Me,range:et,offset:ke,defines:be,resampling:me}}(z,a,D,L);if(z instanceof r.ap&&!f.length&&!T)return;const V=a.paint.get("raster-emissive-strength"),H=d.colorModeForDrapableLayerRenderPass(V),W=d.terrain&&d.terrain.renderingToTexture,q=!d.options.moving,j=a.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;if(z instanceof r.ap&&!f.length&&(z.onNorthPole||z.onSouthPole)){const X=E?d.stencilModeFor3D():di.disabled;return void id(!!z.onNorthPole,null,d,n,a,V,B,ri.disabled,X)}if(!f.length)return;const[Y,re]=z instanceof r.ap||W?[{},f]:d.stencilConfigForOverlap(f),Q=re[re.length-1].overscaledZ;C&&B.defines.push("PROJECTION_GLOBE_VIEW"),E&&B.defines.push("RENDER_CUTOFF");const se=(X,oe,ue)=>{for(const de of X){const _e=de.toUnwrapped(),Pe=n.getTile(de);if(W&&(!Pe||!Pe.hasData()))continue;D.activeTexture.set(L.TEXTURE0);const be=rd(Pe,z,a,B);if(!be||!be.texture)continue;const{texture:Ne,mix:Oe,offset:et,tileSize:Me,buffer:ke}=be;let me,Ae;W?(me=ni.disabled,Ae=de.projMatrix):E?(me=new ni(L.LEQUAL,ni.ReadWrite,d.depthRangeFor3D),Ae=T?Float32Array.from(d.transform.expandedFarZProjMatrix):d.transform.calculateProjMatrix(_e,q)):(me=d.depthModeForSublayer(de.overscaledZ-Q,a.paint.get("raster-opacity")===1?ni.ReadWrite:ni.ReadOnly,L.LESS),Ae=d.transform.calculateProjMatrix(_e,q));const it=d.terrain&&W?d.terrain.stencilModeForRTTOverlap(de):Y[de.overscaledZ],pt=x?0:a.paint.get("raster-fade-duration");Pe.registerFadeDuration(pt);const ht=n.findLoadedParent(de,0),Et=Gh(Pe,ht,n,d.transform,pt);let Wt,Jt;d.terrain&&d.terrain.prepareDrawTile(),D.activeTexture.set(L.TEXTURE0),Ne.bind(j,L.CLAMP_TO_EDGE),D.activeTexture.set(L.TEXTURE1),ht?(ht.texture&&ht.texture.bind(j,L.CLAMP_TO_EDGE),Wt=Math.pow(2,ht.tileID.overscaledZ-Pe.tileID.overscaledZ),Jt=[Pe.tileID.canonical.x*Wt%1,Pe.tileID.canonical.y*Wt%1]):Ne.bind(j,L.CLAMP_TO_EDGE),Ne.useMipmap&&D.extTextureFilterAnisotropic&&d.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax);const qt=d.transform;let Yt;const vi=E?nd(qt):[0,0,0,0];let ui,mi,pi,Fi,gn,Ci=0;if(C&&z instanceof r.ap&&z.coordinates.length>3)ui=Float32Array.from(r.aT(r.ci(new r.bs(0,0,0)))),mi=Float32Array.from(qt.globeMatrix),pi=Float32Array.from(r.ce(qt)),Fi=[r.a5(qt.center.lng),r.ae(qt.center.lat)],Yt=z.elevatedGlobePerspectiveTransform,gn=z.elevatedGlobeGridMatrix||new Float32Array(9);else if(C){const Di=r.cf(de.canonical);Ci=r.cg(Di.getCenter().lat),ui=Float32Array.from(r.aT(r.ci(de.canonical))),mi=Float32Array.from(qt.globeMatrix),pi=Float32Array.from(r.ce(qt)),Fi=[r.a5(qt.center.lng),r.ae(qt.center.lat)],Yt=[0,0],gn=Float32Array.from(r.ch(de.canonical,Di,Ci,qt.worldSize/qt._pixelsPerMercatorPixel))}else Yt=z instanceof r.ap?z.perspectiveTransform:[0,0],ui=new Float32Array(16),mi=new Float32Array(9),pi=new Float32Array(16),Fi=[0,0],gn=new Float32Array(9);const Bn=Qh(Ae,ui,mi,pi,gn,Jt||[0,0],r.S(d.transform.zoom),Fi,vi,Wt||1,Et,a,Yt,E?a.paint.get("raster-elevation"):0,2,Oe,et,B.range,Me,ke,V),Pi=d.isTileAffectedByFog(de),ji=d.getOrCreateProgram("raster",{defines:B.defines,overrideFog:Pi});if(d.uploadCommonUniforms(D,ji,_e),z instanceof r.ap){const Di=z.elevatedGlobeVertexBuffer,Ui=z.elevatedGlobeIndexBuffer;if(W||!T)z.boundsBuffer&&z.boundsSegments&&ji.draw(d,L.TRIANGLES,me,di.disabled,H,ri.disabled,Bn,a.id,z.boundsBuffer,d.quadTriangleIndexBuffer,z.boundsSegments);else if(Di&&Ui){const Tn=qt.zoom<=r.bG?z.elevatedGlobeSegments:z.getSegmentsForLongitude(qt.center.lng);Tn&&ji.draw(d,L.TRIANGLES,me,di.disabled,H,oe,Bn,a.id,Di,Ui,Tn)}}else if(C){me=new ni(L.LEQUAL,ni.ReadOnly,d.depthRangeFor3D);const Di=d.globeSharedBuffers;if(Di){const[Ui,Tn,qi]=Di.getGridBuffers(Ci,!1);ji.draw(d,L.TRIANGLES,me,ue||it,d.colorModeForRenderPass(),oe,Bn,a.id,Ui,Tn,qi)}}else{const{tileBoundsBuffer:Di,tileBoundsIndexBuffer:Ui,tileBoundsSegments:Tn}=d.getTileBoundsBuffers(Pe);ji.draw(d,L.TRIANGLES,me,it,H,ri.disabled,Bn,a.id,Di,Ui,Tn)}}if(!(z instanceof r.ap)&&C)for(const de of X){const _e=de.canonical.y===(1<<de.canonical.z)-1;de.canonical.y===0&&id(!0,de,d,n,a,V,B,oe,ue||di.disabled),_e&&id(!1,de,d,n,a,V,B,oe===ri.frontCW?ri.backCW:ri.frontCW,ue||di.disabled)}};C?se(re,d.renderElevatedRasterBackface?ri.backCW:ri.frontCW,d.stencilModeFor3D()):se(re,ri.disabled,void 0),d.resetStencilClippingMasks()},"raster-particle":function(d,n,a,f,g,x){d.renderPass==="offscreen"&&function(T,E,C,D){if(!D.length)return;const L=T.context,z=L.gl,B=E.getSource();if(!(B instanceof xt))return;const V=[];for(const q of D){const j=E.getTile(q);if(!(j instanceof qo))continue;const Y=sd(j,B,C);if(!Y)continue;const re=[Y.tileSize,Y.tileSize];let Q=C.tileFramebuffer;Q||(Q=C.tileFramebuffer=L.createFramebuffer(re[0],re[1],!0,null));let se=j.rasterParticleState;const X=C.paint.get("raster-particle-count");se||(se=j.rasterParticleState=new nr(L,q,re,X));const oe=se.update(C.lastInvalidatedAt);se.numParticles!==X&&se.setNumParticles(q,X);const ue=se.targetColorTexture;se.targetColorTexture=se.backgroundColorTexture,se.backgroundColorTexture=ue;const de=se.particleVertices0;se.particleVertices0=se.particleVertices1,se.particleVertices1=de,V.push([q,Y,se,oe])}if(V.length===0)return;const H=r.f.now(),W=C.previousDrawTimestamp?.001*(H-C.previousDrawTimestamp):.0167;if(C.previousDrawTimestamp=H,C.hasColorMap()){L.activeTexture.set(z.TEXTURE0+2);let q=C.colorRampTexture;q||(q=C.colorRampTexture=new r.T(L,C.colorRamp,z.RGBA)),q.bind(z.LINEAR,z.CLAMP_TO_EDGE)}L.bindFramebuffer.set(C.tileFramebuffer.framebuffer),L.activeTexture.set(z.TEXTURE0),function(q,j,Y){const re=q.context,Q=re.gl,se=j.tileFramebuffer;re.activeTexture.set(Q.TEXTURE0);const X={u_texture:0,u_opacity:1.05*(ue=j.paint.get("raster-particle-fade-opacity-factor"))/(ue+.05)},oe=q.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ue;for(const de of Y){const[,,_e,Pe]=de;se.colorAttachment.set(_e.targetColorTexture.texture),re.viewport.set([0,0,se.width,se.height]),re.clear({color:r.ax.transparent}),Pe&&(_e.backgroundColorTexture.bind(Q.NEAREST,Q.CLAMP_TO_EDGE),oe.draw(q,Q.TRIANGLES,ni.disabled,di.disabled,Ai.alphaBlended,ri.disabled,X,j.id,q.viewportBuffer,q.quadTriangleIndexBuffer,q.viewportSegments))}}(T,C,V),function(q,j,Y,re){const Q=q.context.gl,se=Y.tileFramebuffer,X=q.transform.projection.name==="globe",oe=Y.paint.get("raster-particle-max-speed");for(const ue of re){const[de,_e,Pe]=ue;_e.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),se.colorAttachment.set(Pe.targetColorTexture.texture);const be=q.getOrCreateProgram("rasterParticleDraw",{defines:_e.defines,overrideFog:!1}),Ne=_e.scalarData?[]:[0,1,2,3].map(Me=>r.cG[Me](de));Ne.push(de);const Oe=de.canonical.x,et=de.canonical.y;for(const Me of Ne){const ke=j.getTile(X?Me.wrapped():Me);if(!ke)continue;const me=ke.rasterParticleState;if(!me)continue;const Ae=ag([Me.canonical.x+(1<<Me.canonical.z)*(Me.wrap-de.wrap)-Oe,Me.canonical.y-et],0,_e.texture.size,2,oe,_e.textureOffset,_e.scale,_e.offset);be.draw(q,Q.POINTS,ni.disabled,di.disabled,Ai.alphaBlended,ri.disabled,Ae,Y.id,me.particleVertices0,void 0,me.particleSegment)}}}(T,E,C,V),function(q,j,Y,re){const Q=q.context.gl;let se=j.transformFeedbackObject;se||(se=j.transformFeedbackObject=Q.createTransformFeedback()),Q.bindTransformFeedback(Q.TRANSFORM_FEEDBACK,j.transformFeedbackObject);const X=j.paint.get("raster-particle-max-speed"),oe=re*j.paint.get("raster-particle-speed-factor")*.3,ue=(de=j.paint.get("raster-particle-reset-rate-factor"),Math.pow(de,6));var de;for(const _e of Y){const[,Pe,be]=_e;Pe.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const Ne=_p(0,Pe.texture.size,X,oe,ue,Pe.textureOffset,Pe.scale,Pe.offset);q.getOrCreateProgram("rasterParticleUpdate",{defines:Pe.defines,transformFeedback:{bufferMode:Q.SEPARATE_ATTRIBS,shaderVaryings:["v_new_particle"]}}).draw(q,Q.POINTS,ni.disabled,di.disabled,Ai.disabled,ri.disabled,Ne,j.id,be.particleVertices0,void 0,be.particleSegment,{},void 0,void 0,void 0,void 0,[{buffer:be.particleVertices1,targetIndex:0}])}Q.bindTransformFeedback(Q.TRANSFORM_FEEDBACK,null)}(T,C,V,W)}(d,n,a,f),d.renderPass==="translucent"&&(function(T,E,C,D,L){const z=T.context,B=z.gl,V=!T.options.moving,H=T.transform.projection.name==="globe";if(!D.length)return;const[W,q]=T.stencilConfigForOverlap(D),j=[];H&&j.push("PROJECTION_GLOBE_VIEW");for(const Y of q){const re=Y.toUnwrapped(),Q=E.getTile(Y);if(!Q.rasterParticleState)continue;const se=Q.rasterParticleState,X=100;Q.registerFadeDuration(X);const oe=E.findLoadedParent(Y,0),ue=Gh(Q,oe,E,T.transform,X);let de,_e;T.terrain&&T.terrain.prepareDrawTile(),z.activeTexture.set(B.TEXTURE0),se.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),z.activeTexture.set(B.TEXTURE1),oe&&oe.rasterParticleState?(oe.rasterParticleState.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),de=Math.pow(2,oe.tileID.overscaledZ-Q.tileID.overscaledZ),_e=[Q.tileID.canonical.x*de%1,Q.tileID.canonical.y*de%1]):se.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const Pe=H?Float32Array.from(T.transform.expandedFarZProjMatrix):T.transform.calculateProjMatrix(re,V),be=T.transform,Ne=od(be),Oe=r.cf(Y.canonical),et=r.cg(Oe.getCenter().lat);let Me,ke,me,Ae,it;H?(Me=Float32Array.from(r.aT(r.ci(Y.canonical))),ke=Float32Array.from(be.globeMatrix),me=Float32Array.from(r.ce(be)),Ae=[r.a5(be.center.lng),r.ae(be.center.lat)],it=Float32Array.from(r.ch(Y.canonical,Oe,et,be.worldSize/be._pixelsPerMercatorPixel))):(Me=new Float32Array(16),ke=new Float32Array(9),me=new Float32Array(16),Ae=[0,0],it=new Float32Array(9));const pt=og(Pe,Me,ke,me,it,_e||[0,0],r.S(T.transform.zoom),Ae,Ne,de||1,ue,250),ht=T.isTileAffectedByFog(Y),Et=T.getOrCreateProgram("rasterParticle",{defines:j,overrideFog:ht});if(T.uploadCommonUniforms(z,Et,re),H){const Wt=new ni(B.LEQUAL,ni.ReadWrite,T.depthRangeFor3D),Jt=0,qt=T.globeSharedBuffers;if(qt){const[Yt,vi,ui]=qt.getGridBuffers(et,Jt!==0);Et.draw(T,B.TRIANGLES,Wt,di.disabled,Ai.alphaBlended,ri.backCCW,pt,C.id,Yt,vi,ui)}}else{const Wt=T.depthModeForSublayer(0,ni.ReadOnly),Jt=W[Y.overscaledZ],{tileBoundsBuffer:qt,tileBoundsIndexBuffer:Yt,tileBoundsSegments:vi}=T.getTileBoundsBuffers(Q);Et.draw(T,B.TRIANGLES,Wt,Jt,Ai.alphaBlended,ri.disabled,pt,C.id,qt,Yt,vi)}}T.resetStencilClippingMasks()}(d,n,a,f),d.style.map.triggerRepaint())},background:function(d,n,a,f){const g=a.paint.get("background-color"),x=a.paint.get("background-opacity"),T=a.paint.get("background-emissive-strength");if(x===0)return;const E=d.context,C=E.gl,D=d.transform,L=D.tileSize,z=a.paint.get("background-pattern");if(d.isPatternMissing(z,a.scope))return;const B=!z&&g.a===1&&x===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==B)return;const V=di.disabled,H=d.depthModeForSublayer(0,B==="opaque"?ni.ReadWrite:ni.ReadOnly),W=d.colorModeForDrapableLayerRenderPass(T),q=z?"backgroundPattern":"background";let j,Y=f;Y||(j=d.getBackgroundTiles(),Y=Object.values(j).map(re=>re.tileID)),z&&(E.activeTexture.set(C.TEXTURE0),d.imageManager.bind(d.context,a.scope));for(const re of Y){const Q=d.isTileAffectedByFog(re),se=d.getOrCreateProgram(q,{overrideFog:Q}),X=re.toUnwrapped(),oe=f?re.projMatrix:d.transform.calculateProjMatrix(X);d.prepareDrawTile();const ue=n?n.getTile(re):j?j[re.key]:new mo(re,L,D.zoom,d),de=z?Wl(oe,T,x,d,z,a.scope,{tileID:re,tileSize:L}):ed(oe,T,x,g);d.uploadCommonUniforms(E,se,X);const{tileBoundsBuffer:_e,tileBoundsIndexBuffer:Pe,tileBoundsSegments:be}=d.getTileBoundsBuffers(ue);se.draw(d,C.TRIANGLES,H,V,W,ri.disabled,de,a.id,_e,Pe,be)}},sky:function(d,n,a){const f=d._atmosphere?r.S(d.transform.zoom):1,g=a.paint.get("sky-opacity")*f;if(g===0)return;const x=d.context,T=a.paint.get("sky-type"),E=new ni(x.gl.LEQUAL,ni.ReadOnly,[0,1]),C=d.frameCounter/1e3%1;T==="atmosphere"?d.renderPass==="offscreen"?a.needsSkyboxCapture(d)&&(function(D,L,z,B){const V=D.context,H=V.gl;let W=L.skyboxFbo;if(!W){W=L.skyboxFbo=V.createFramebuffer(32,32,!0,null),L.skyboxGeometry=new hd(V),L.skyboxTexture=V.gl.createTexture(),H.bindTexture(H.TEXTURE_CUBE_MAP,L.skyboxTexture),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MIN_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MAG_FILTER,H.LINEAR);for(let re=0;re<6;++re)H.texImage2D(H.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,H.RGBA,32,32,0,H.RGBA,H.UNSIGNED_BYTE,null)}V.bindFramebuffer.set(W.framebuffer),V.viewport.set([0,0,32,32]);const q=L.getCenter(D,!0),j=D.getOrCreateProgram("skyboxCapture"),Y=new Float64Array(16);r.a6.identity(Y),r.a6.rotateY(Y,Y,.5*-Math.PI),ia(D,L,j,Y,q,0),r.a6.identity(Y),r.a6.rotateY(Y,Y,.5*Math.PI),ia(D,L,j,Y,q,1),r.a6.identity(Y),r.a6.rotateX(Y,Y,.5*-Math.PI),ia(D,L,j,Y,q,2),r.a6.identity(Y),r.a6.rotateX(Y,Y,.5*Math.PI),ia(D,L,j,Y,q,3),r.a6.identity(Y),ia(D,L,j,Y,q,4),r.a6.identity(Y),r.a6.rotateY(Y,Y,Math.PI),ia(D,L,j,Y,q,5),V.viewport.set([0,0,D.width,D.height])}(d,a),a.markSkyboxValid(d)):d.renderPass==="sky"&&function(D,L,z,B,V){const H=D.context,W=H.gl,q=D.transform,j=D.getOrCreateProgram("skybox");H.activeTexture.set(W.TEXTURE0),W.bindTexture(W.TEXTURE_CUBE_MAP,L.skyboxTexture);const Y=((re,Q,se,X,oe)=>({u_matrix:re,u_sun_direction:Q,u_cubemap:0,u_opacity:X,u_temporal_offset:oe}))(q.skyboxMatrix,L.getCenter(D,!1),0,B,V);D.uploadCommonUniforms(H,j),j.draw(D,W.TRIANGLES,z,di.disabled,D.colorModeForRenderPass(),ri.backCW,Y,"skybox",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(d,a,E,g,C):T==="gradient"&&d.renderPass==="sky"&&function(D,L,z,B,V){const H=D.context,W=H.gl,q=D.transform,j=D.getOrCreateProgram("skyboxGradient");L.skyboxGeometry||(L.skyboxGeometry=new hd(H)),H.activeTexture.set(W.TEXTURE0);let Y=L.colorRampTexture;Y||(Y=L.colorRampTexture=new r.T(H,L.colorRamp,W.RGBA)),Y.bind(W.LINEAR,W.CLAMP_TO_EDGE);const re=((Q,se,X,oe,ue)=>({u_matrix:Q,u_color_ramp:0,u_center_direction:se,u_radius:r.bj(X),u_opacity:oe,u_temporal_offset:ue}))(q.skyboxMatrix,L.getCenter(D,!1),L.paint.get("sky-gradient-radius"),B,V);D.uploadCommonUniforms(H,j),j.draw(D,W.TRIANGLES,z,di.disabled,D.colorModeForRenderPass(),ri.backCW,re,"skyboxGradient",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(d,a,E,g,C)},debug:function(d,n,a,f,g,x){for(let T=0;T<a.length;T++)if(g){const D=new r.ax(f.r*.8,f.g*.8,f.b*.8,1);Ao(d,n,a[T],f,-1,-1,x),Ao(d,n,a[T],f,-1,1,x),Ao(d,n,a[T],f,1,1,x),Ao(d,n,a[T],f,1,-1,x),Ao(d,n,a[T],D,0,0,x)}else Ao(d,n,a[T],f,0,0,x)},custom:function(d,n,a,f){const g=d.context,x=a.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&a.isLayerDraped(n)){if(d.renderPass==="offscreen"){const T=x.prerender;if(T){if(d.setCustomLayerDefaults(),g.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){const E=d.transform.pointMerc;T.call(x,g.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),r.S(d.transform.zoom),[E.x,E.y],d.transform.pixelsPerMeterRatio)}else T.call(x,g.gl,d.transform.customLayerMatrix());g.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){const E=x.renderToTile;if(E){const C=f[0].canonical,D=new r.L(C.x+f[0].wrap*(1<<C.z),C.y,C.z);g.setDepthMode(ni.disabled),g.setStencilMode(di.disabled),g.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),E.call(x,g.gl,D),g.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),g.setColorMode(d.colorModeForRenderPass()),g.setStencilMode(di.disabled);const T=x.renderingMode==="3d"?new ni(d.context.gl.LEQUAL,ni.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,ni.ReadOnly);if(g.setDepthMode(T),d.transform.projection.name==="globe"){const E=d.transform.pointMerc;x.render(g.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),r.S(d.transform.zoom),[E.x,E.y],d.transform.pixelsPerMeterRatio)}else x.render(g.gl,d.transform.customLayerMatrix());g.setDirty(),d.setBaseState(),g.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(d,n,a,f){if(d.renderPass==="opaque")return;const g=a.paint.get("model-opacity");if(g===0)return;const x=a.paint.get("model-cast-shadows");if(d.renderPass==="shadow"&&(!x||d.terrain&&g<.65&&a._transitionablePaint._values["model-opacity"].value.expression instanceof r.Z))return;const T=d.shadowRenderer,E=a.paint.get("model-receive-shadows");T&&(T.useNormalOffset=!0,E||(T.enabled=!1));const C=()=>{T&&(T.useNormalOffset=!0,E||(T.enabled=!0))},D=n.getSource();if(d.renderPass==="light-beam"&&D.type!=="batched-model")return;if(D.type==="vector"||D.type==="geojson")return function(j,Y,re,Q){const se=j.transform;if(se.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${se.projection.name} projection is not yet implemented`);const X=se.getFreeCameraOptions().position;if(!j.modelManager)return;const oe=j.modelManager;re.modelManager=oe;const ue=j.shadowRenderer;if(!re._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const de=re._unevaluatedLayout._values["model-id"],_e={...re.layout.get("model-id").parameters};for(const Pe of Q){const be=Y.getTile(Pe).getBucket(re);if(!be||be.projection.name!==se.projection.name)continue;const Ne=Tp(Pe,se);_e.zoom=Ne;const Oe=de.possiblyEvaluate(_e);if(dd(j,be,Pe),rs.shadowUniformsInitialized=!1,rs.useSingleShadowCascade=!!ue&&ue.getMaxCascadeForTile(Pe.toUnwrapped())===0,j.renderPass==="shadow"&&ue){if(j.currentShadowCascade===1&&be.isInsideFirstShadowMapFrustum)continue;const ke=se.calculatePosMatrix(Pe.toUnwrapped(),se.worldSize);if(rs.tileMatrix.set(ke),rs.shadowTileMatrix=Float32Array.from(ue.calculateShadowPassMatrixFromMatrix(ke)),rs.aabb.min.fill(0),rs.aabb.max[0]=rs.aabb.max[1]=r.V,rs.aabb.max[2]=0,dg(be,rs,j,re.scope))continue}const et=1<<Pe.canonical.z,Me=[((X.x-Pe.wrap)*et-Pe.canonical.x)*r.V,(X.y*et-Pe.canonical.y)*r.V,X.z*et*r.V];for(let ke in be.instancesPerModel){const me=be.instancesPerModel[ke];me.features.length>0&&(ke=Oe.evaluate(me.features[0].feature,{}));const Ae=oe.getModel(ke,re.scope);if(Ae&&Ae.uploaded)for(const it of Ae.nodes)fd(j,re,it,me,Me,Pe,rs)}}}(d,n,a,f),void C();if(!D.loaded())return;if(D.type==="batched-model")return function(j,Y,re,Q){re.resetLayerRenderingStats(j);const se=j.context,X=j.transform,oe=j.style.fog,ue=j.shadowRenderer;if(X.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${X.projection.name} projection is not yet implemented`);const de=j.transform.getFreeCameraOptions().position,_e=r.N.scale([],[de.x,de.y,de.z],j.transform.worldSize);r.N.negate(_e,_e);const Pe=r.a6.identity([]),be=r.cR(X.center.lat,X.zoom),Ne=r.a6.fromScaling([],[1,1,1/be]);r.a6.translate(Pe,Pe,_e);const Oe=re.paint.get("model-opacity"),et=new ni(se.gl.LEQUAL,ni.ReadWrite,j.depthRangeFor3D),Me=new ni(se.gl.LEQUAL,ni.ReadOnly,j.depthRangeFor3D),ke=new r.bS([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),me=j.renderPass==="shadow",Ae=me&&ue?ue.getCurrentCascadeFrustum():X.getFrustum(X.scaleZoom(X.worldSize)),it=re.getLayerRenderingStats(),pt=function(ht,Et){for(const Wt of Q){const Jt=Y.getTile(Wt).getBucket(re);if(!Jt||!Jt.uploaded)continue;let qt=!1;ue&&(qt=ue.getMaxCascadeForTile(Wt.toUnwrapped())===0);const Yt=X.calculatePosMatrix(Wt.toUnwrapped(),X.worldSize),vi=Jt.modelTraits;for(const ui of Jt.getNodesInfo()){if(ui.hiddenByReplacement||!ui.node.meshes)continue;const mi=ui.evaluatedScale,pi=ui.node;let Fi=0;if(j.terrain&&pi.elevation&&(Fi=pi.elevation*j.terrain.exaggeration()),mi[0]<=1&&mi[1]<=1&&mi[2]<=1&&(()=>{const Tn=ui.getLocalBounds();return ke.min=[...Tn.min],ke.max=[...Tn.max],ke.min[2]+=Fi,ke.max[2]+=Fi,r.N.transformMat4(ke.min,ke.min,Yt),r.N.transformMat4(ke.max,ke.max,Yt),ke})().intersects(Ae)===0)continue;const gn=j.renderPass==="light-beam",Ci=[...Yt];r.a6.translate(Ci,Ci,[(pi.anchor?pi.anchor[0]:0)*(mi[0]-1),(pi.anchor?pi.anchor[1]:0)*(mi[1]-1),Fi]),r.N.exactEquals(mi,r.cT)||r.a6.scale(Ci,Ci,mi),r.a6.multiply(Ci,Ci,pi.matrix);const Bn=r.a6.multiply([],Ne,Ci);r.a6.multiply(Bn,Pe,Bn);const Pi=r.a6.invert([],Bn);r.a6.transpose(Pi,Pi),r.a6.scale(Pi,Pi,Za);const ji=r.a6.multiply([],X.expandedFarZProjMatrix,Ci),Di=vi&r.cV.HasMapboxMeshFeatures,Ui=Di?0:ui.evaluatedRMEA[0][2];for(let Tn=0;Tn<pi.meshes.length;++Tn){const qi=pi.meshes[Tn],dr=Tn===pi.lightMeshIndex;if(dr){if(!gn&&!j.terrain&&j.shadowRenderer){j.currentLayer<j.firstLightBeamLayer&&(j.firstLightBeamLayer=j.currentLayer);continue}}else if(gn)continue;const Ar={defines:[]},Hr=[];if(Fn(Ar.defines,Hr,qi,j),Di||Ar.defines.push("DIFFUSE_SHADED"),qt&&Ar.defines.push("SHADOWS_SINGLE_CASCADE"),it&&(me?it.numRenderedVerticesInShadowPass+=qi.vertexArray.length:it.numRenderedVerticesInTransparentPass+=qi.vertexArray.length),me){Ie(qi,Ci,j,re);continue}let Bs=null;if(oe){const Zr=na(Ci,j.transform);if(Bs=new Float32Array(Zr),X.projection.name!=="globe"){const Ns=qi.aabb.min,Lo=qi.aabb.max,[sa,fc]=oe.getOpacityForBounds(Zr,Ns[0],Ns[1],Lo[0],Lo[1]);Ar.overrideFog=sa>=tn||fc>=tn}}const qr=qi.material;let fr;qr.occlusionTexture&&qr.occlusionTexture.offsetScale&&(fr=qr.occlusionTexture.offsetScale,Ar.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!me&&ue&&(ue.useNormalOffset=!!qi.normalBuffer);const sr=j.getOrCreateProgram("model",Ar);!me&&ue&&ue.setupShadowsFromMatrix(Ci,sr,ue.useNormalOffset),j.uploadCommonUniforms(se,sr,Wt.toUnwrapped(),Bs);const kr=qr.pbrMetallicRoughness;kr.metallicFactor=.9,kr.roughnessFactor=.5;const Nr=fu(new Float32Array(ji),new Float32Array(Bn),new Float32Array(Pi),j,Oe,kr.baseColorFactor,qr.emissiveFactor,kr.metallicFactor,kr.roughnessFactor,qr,Ui,re,[0,0,0],fr);sr.draw(j,se.gl.TRIANGLES,Et&&!dr?et:Me,di.disabled,ht?dr||Oe<1||ui.hasTranslucentParts?Ai.alphaBlended:Ai.unblended:Ai.disabled,ri.backCCW,Nr,re.id,qi.vertexBuffer,qi.indexBuffer,qi.segments,re.paint,j.transform.zoom,void 0,Hr)}}}};(function(ht,Et,Wt,Jt){const qt=ht.terrain?ht.terrain.exaggeration():0,Yt=ht.transform.zoom;for(const vi of Jt){const ui=Et.getTile(vi).getBucket(Wt);ui&&(ht.conflationActive&&ui.updateReplacement(vi,ht.replacementSource),ui.evaluateScale(ht,Wt),ht.terrain&&qt>0&&ui.elevationUpdate(ht.terrain,qt,vi,Wt.source),ui.needsReEvaluation(ht,Yt,Wt)&&ui.evaluate(Wt))}})(j,Y,re,Q),Oe===1?pt(!0,!0):(pt(!1,!0),pt(!0,!1))}(d,n,a,f),void C();const L=D.getModels(),z=[],B=d.transform.getFreeCameraOptions().position,V=r.N.scale([],[B.x,B.y,B.z],d.transform.worldSize);r.N.negate(V,V);const H=[],W=[];let q=0;for(const j of L){const Y=a.paint.get("model-rotation").constantOr(null),re=a.paint.get("model-scale").constantOr(null),Q=a.paint.get("model-translation").constantOr(null);j.computeModelMatrix(d,Y,re,Q,!0,!0,!1);const se=r.a6.identity([]),X=r.cR(j.position.lat,d.transform.zoom),oe=r.a6.fromScaling([],[1,1,1/X]);r.a6.translate(se,se,V),z.push({zScaleMatrix:oe,negCameraPosMatrix:se});for(const ue of j.nodes)Kl(d.transform,ue,j.matrix,d.transform.expandedFarZProjMatrix,q,H,W);q++}if(H.sort((j,Y)=>Y.depth-j.depth),d.renderPass!=="shadow"){if(g===1)for(const j of W)Yl(j,d,a,z[j.modelIndex],di.disabled,d.colorModeForRenderPass());else{for(const j of W)Yl(j,d,a,z[j.modelIndex],di.disabled,Ai.disabled);for(const j of W)Yl(j,d,a,z[j.modelIndex],d.stencilModeFor3D(),d.colorModeForRenderPass());d.resetStencilClippingMasks()}for(const j of H)Yl(j,d,a,z[j.modelIndex],di.disabled,d.colorModeForRenderPass());C()}else{for(const j of W)Ie(j.mesh,j.nodeModelMatrix,d,a);for(const j of H)Ie(j.mesh,j.nodeModelMatrix,d,a);C()}}},pd={model:function(d,n,a){const f=d.scope,g=n.getSource();if(!g.loaded())return;if(g.type==="vector"||g.type==="geojson")return void(a.modelManager&&a.modelManager.upload(a,f));if(g.type==="batched-model")return;const x=g.getModels();for(const T of x)T.upload(a.context)},raster:function(d,n,a){const f=n.getSource();if(!(f instanceof xt&&f.loaded()))return;const g=d.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!g)return;const x=d.paint.get("raster-array-band")||f.getInitialBand(g);if(x==null)return;const T=n.getIds().map(E=>n.getTileByID(E));for(const E of T)E.updateNeeded(g,x)&&f.prepareTile(E,g,x)},"raster-particle":function(d,n,a){const f=n.getSource();if(!(f instanceof xt&&f.loaded()))return;const g=d.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!g)return;const x=d.paint.get("raster-particle-array-band")||f.getInitialBand(g);if(x==null)return;const T=n.getIds().map(E=>n.getTileByID(E));for(const E of T)E.updateNeeded(g,x)&&f.prepareTile(E,g,x)}};class Sp{constructor(n,a,f,g){this.context=new Zf(n,a),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=g,this._debugParams={showTerrainProxyTiles:!1},g.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),this.setup(),this.numSublayers=bs.maxUnderzooming+bs.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.cX,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Dh(this),this._wireframeDebugCache=new Mp,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(n,a){const f=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new sg(this,n));const g=this._terrain;this.transform.elevation=f?g:null,g.update(n,this.transform,a),this.transform.elevation&&!g.enabled&&(this.transform.elevation=null)}_updateFog(n){const a=n.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[f,g]=a.getFovAdjustedRange(this.transform._fov);if(f>g)return void(this.transform.fogCullDistSq=null);const x=f+.78*(g-f);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(n,a){if(this.width=n*r.f.devicePixelRatio,this.height=a*r.f.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style.order)this.style._mergedLayers[f].resize()}setup(){const n=this.context,a=new r.aN;a.emplaceBack(0,0),a.emplaceBack(r.V,0),a.emplaceBack(0,r.V),a.emplaceBack(r.V,r.V),this.tileExtentBuffer=n.createVertexBuffer(a,r.aP.members),this.tileExtentSegments=r.aB.simpleSegment(0,0,4,2);const f=new r.aN;f.emplaceBack(0,0),f.emplaceBack(r.V,0),f.emplaceBack(0,r.V),f.emplaceBack(r.V,r.V),this.debugBuffer=n.createVertexBuffer(f,r.aP.members),this.debugSegments=r.aB.simpleSegment(0,0,4,5);const g=new r.aN;g.emplaceBack(-1,-1),g.emplaceBack(1,-1),g.emplaceBack(-1,1),g.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(g,r.aP.members),this.viewportSegments=r.aB.simpleSegment(0,0,4,2);const x=new r.av;x.emplaceBack(0,0,0,0),x.emplaceBack(r.V,0,r.V,0),x.emplaceBack(0,r.V,0,r.V),x.emplaceBack(r.V,r.V,r.V,r.V),this.mercatorBoundsBuffer=n.createVertexBuffer(x,r.aR.members),this.mercatorBoundsSegments=r.aB.simpleSegment(0,0,4,2);const T=new r.aw;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(T);const E=new r.aO;for(const D of[0,1,3,2,0])E.emplaceBack(D);this.debugIndexBuffer=n.createIndexBuffer(E),this.emptyTexture=new r.T(n,new r.h({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=r.a6.create();const C=this.context.gl;this.stencilClearMode=new di({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,n.TRIANGLES,ni.disabled,this.stencilClearMode,Ai.disabled,ri.disabled,jh(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,a,f){if(!a||this.currentStencilSource===a.id||!n.isTileClipped()||!f||f.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let E=!1;for(const C of f)if(this._tileClippingMaskIDs[C.key]===void 0){E=!0;break}if(!E)return}this.currentStencilSource=a.id;const g=this.context,x=g.gl;this.nextStencilID+f.length>256&&this.clearStencil(),g.setColorMode(Ai.disabled),g.setDepthMode(ni.disabled);const T=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of f){const C=a.getTile(E),D=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:z,tileBoundsSegments:B}=this.getTileBoundsBuffers(C);T.draw(this,x.TRIANGLES,ni.disabled,new di({func:x.ALWAYS,mask:0},D,255,x.KEEP,x.KEEP,x.REPLACE),Ai.disabled,ri.disabled,jh(E.projMatrix),"$clipping",L,z,B)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,a=this.context.gl;return new di({func:a.NOTEQUAL,mask:255},n,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const a=this.context.gl;return new di({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(n){const a=this.context.gl,f=n.sort((T,E)=>E.overscaledZ-T.overscaledZ),g=f[f.length-1].overscaledZ,x=f[0].overscaledZ-g+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const T={};for(let E=0;E<x;E++)T[E+g]=new di({func:a.GEQUAL,mask:255},E+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=x,[T,f]}return[{[g]:di.disabled},f]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new Ai([n.CONSTANT_COLOR,n.ONE,n.CONSTANT_COLOR,n.ONE],new r.ax(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ai.unblended:Ai.alphaBlended}colorModeForDrapableLayerRenderPass(n){const a=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Ai([a.ONE,a.ONE_MINUS_SRC_ALPHA,a.CONSTANT_ALPHA,a.ONE_MINUS_SRC_ALPHA],new r.ax(0,0,0,n===void 0?0:n),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(n,a,f,g=!1){if(!this.opaquePassEnabledForLayer()&&!g)return ni.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new ni(f||this.context.gl.LEQUAL,a,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,a){this._wireframeDebugCache.update(this.frameCounter),this.style=n,this.options=a;const f=this.style._mergedLayers,g=this.style.order,x=g.map(X=>f[X]),T=this.style._mergedSourceCaches;this.imageManager=n.imageManager,this.modelManager=n.modelManager,this.symbolFadeChange=n.placement.symbolFadeChange(r.f.now()),this.imageManager.beginFrame();let E=0,C=!1;for(const X in T){const oe=T[X];oe.used&&(oe.prepare(this.context),oe.getSource().usedInConflation&&++E)}for(const X of x)X.isHidden(this.transform.zoom)||this.prepareLayer(X);const D={},L={},z={},B={},V={};for(const X in T){const oe=T[X];D[X]=oe.getVisibleCoordinates(),L[X]=D[X].slice().reverse(),z[X]=oe.getVisibleCoordinates(!0).reverse(),B[X]=oe.getShadowCasterCoordinates(),V[X]=oe.sortCoordinatesByDistance(D[X])}const H=X=>{const oe=this.style.getLayerSourceCache(X);return oe&&oe.used?oe.getSource():null};if(E){const X=[];for(const oe of x)this.layerUsedInConflation(oe,H(oe))&&X.push(oe);if(X&&X.length>1){const oe=[];for(const ue of X){const de=this.style.getLayerSourceCache(ue);de&&de.used&&de.getSource().usedInConflation&&oe.push({layer:ue.fqid,cache:de})}this.replacementSource.setSources(oe),C=!0}}C||this.replacementSource.clear(),this.conflationActive=C,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const X of x){const oe=X.cutoffRange();if(this.longestCutoffRange=Math.max(oe,this.longestCutoffRange),oe>0){const ue=H(X);ue&&(this.minCutoffZoom=Math.max(ue.minzoom,this.minCutoffZoom)),X.minzoom&&(this.minCutoffZoom=Math.max(X.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let X=0;X<x.length;X++)if(x[X].is3D()){this.opaquePassCutoff=X;break}const W=this.style&&this.style.fog;W?(this._fogVisible=W.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=W.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(z),this.opaquePassCutoff=0);const q=this._shadowRenderer;if(q){q.updateShadowParameters(this.transform,this.style.directionalLight);for(const X in T)for(const oe of D[X]){let ue={min:0,max:0};this.terrain&&(ue=this.terrain.getMinMaxForTile(oe)||ue),q.addShadowReceiver(oe.toUnwrapped(),ue.min,ue.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.cY(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new ti(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!r.cZ(this.context.gl))return;this.renderPass="offscreen";for(const X of x){const oe=n.getLayerSourceCache(X);if(!X.hasOffscreenPass()||X.isHidden(this.transform.zoom))continue;const ue=oe?L[oe.id]:void 0;(X.type==="custom"||X.type==="raster"||X.type==="raster-particle"||X.isSky()||ue&&ue.length)&&this.renderLayer(this,oe,X,ue)}this.depthRangeFor3D=[0,1-(x.length+2)*this.numSublayers*this.depthEpsilon];const j=this.terrain;j&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&j.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,B)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Y=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),re=(()=>{if(a.showOverdrawInspector)return r.ax.black;if(this.style.fog&&this.transform.projection.supportsFog&&!Y){const X=this.style.fog.properties.get("color").toArray01();return new r.ax(...X)}if(this.style.fog&&this.transform.projection.supportsFog&&Y){const X=this.style.fog.properties.get("space-color").toArray01();return new r.ax(...X)}return r.ax.transparent})();if(this.context.clear({color:re,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Y&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const X=x[this.currentLayer],oe=n.getLayerSourceCache(X);if(X.isSky())continue;const ue=oe?(X.is3D()?V:L)[oe.id]:void 0;this._renderTileClippingMasks(X,oe,ue),this.renderLayer(this,oe,X,ue)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Y&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.S(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const X=x[this.currentLayer],oe=n.getLayerSourceCache(X);X.isSky()&&this.renderLayer(this,oe,X,oe?L[oe.id]:void 0)}function Q(X,oe){let ue;return oe&&(ue=(X.type==="symbol"?z:X.is3D()?V:L)[oe.id]),ue}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<g.length;){const X=x[this.currentLayer];if(X.type==="raster"){const oe=n.getLayerSourceCache(X);this.renderLayer(this,oe,X,Q(X,oe))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let se=0;for(q&&(se=q.getShadowCastingLayerCount());this.currentLayer<g.length;){const X=x[this.currentLayer],oe=n.getLayerSourceCache(X);if(X.isSky())++this.currentLayer;else if(j&&this.style.isLayerDraped(X)){if(X.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=j.renderBatch(this.currentLayer)}else{if(this._renderTileClippingMasks(X,oe,oe?D[oe.id]:void 0),this.renderLayer(this,oe,X,Q(X,oe)),!j&&q&&se>0&&X.hasShadowPass()&&--se==0&&(q.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const ue=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ue;this.currentLayer++){const de=x[this.currentLayer];if(!de.hasLightBeamPass())continue;const _e=n.getLayerSourceCache(de);this.renderLayer(this,_e,de,_e?L[_e.id]:void 0)}this.currentLayer=ue,this.renderPass="translucent"}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let X=null;x.forEach(oe=>{const ue=n.getLayerSourceCache(oe);ue&&!oe.isHidden(this.transform.zoom)&&ue.getVisibleCoordinates().length&&(!X||X.getSource().maxzoom<ue.getSource().maxzoom)&&(X=ue)}),X&&this.options.showTileBoundaries&&Ql.debug(this,X,X.getVisibleCoordinates(),r.ax.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Ql.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.ax(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(X){const oe=X.transform.padding;cd(X,X.transform.height-(oe.top||0),3,$r),cd(X,oe.bottom||0,3,Eo),ns(X,oe.left||0,3,wp),ns(X,X.transform.width-(oe.right||0),3,ad);const ue=X.transform.centerPoint;(function(de,_e,Pe,be){On(de,_e-1,Pe-10,2,20,be),On(de,_e-10,Pe-1,20,2,be)})(X,ue.x,X.transform.height-ue.y,ld)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),C||(this.conflationActive=!1)}prepareLayer(n){this.gpuTimingStart(n);const{unsupportedLayers:a}=this.transform.projection,f=!a||!a.includes(n.type);if(pd[n.type]&&(f||this.terrain&&n.type==="custom")){const g=this.style.getLayerSourceCache(n);pd[n.type](n,g,this)}this.gpuTimingEnd()}renderLayer(n,a,f,g){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="sky"||f.type==="custom"||f.type==="model"||f.type==="raster"||f.type==="raster-particle"||g&&g.length)&&(this.id=f.id,this.gpuTimingStart(f),(!n.transform.projection.unsupportedLayers||!n.transform.projection.unsupportedLayers.includes(f.type)||n.terrain&&f.type==="custom")&&Ql[f.type](n,a,f,g,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery,f=this.context.gl;let g=this.gpuTimers[n.id];g||(g=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:f.createQuery()}),g.calls++,f.beginQuery(a.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,a=this.context.gl,f=a.createQuery();this.deferredRenderGpuTimeQueries.push(f),a.beginQuery(n.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const a={};for(const f in n){const g=n[f],x=this.context.extTimerQuery,T=x.getQueryParameter(g.query,this.context.gl.QUERY_RESULT)/1e6;x.deleteQueryEXT(g.query),a[f]=T}return a}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.extTimerQuery,f=this.context.gl;let g=0;for(const x of n)g+=a.getQueryParameter(x,f.QUERY_RESULT)/1e6,a.deleteQueryEXT(x);return g}translatePosMatrix(n,a,f,g,x){if(!f[0]&&!f[1])return n;const T=x?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(T){const D=Math.sin(T),L=Math.cos(T);f=[f[0]*L-f[1]*D,f[0]*D+f[1]*L]}const E=[x?f[0]:r.a3(a,f[0],this.transform.zoom),x?f[1]:r.a3(a,f[1],this.transform.zoom),0],C=new Float32Array(16);return r.a6.translate(C,n,E),C}saveTileTexture(n){const a=n.size[0],f=this._tileTextures[a];f?f.push(n):this._tileTextures[a]=[n]}getTileTexture(n){const a=this._tileTextures[n];return a&&a.length>0?a.pop():null}isPatternMissing(n,a){return n===null||n!==void 0&&!this.imageManager.getPattern(n.toString(),a)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(n,a,f){const g=f===void 0?this.terrain&&this.terrain.renderingToTexture:f,x=this.terrain&&this.terrain.exaggeration()===0,T=[];return this.style&&this.style.enable3dLights()&&(n==="globeRaster"||n==="terrainRaster"?(T.push("LIGHTING_3D_MODE"),T.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):g||T.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||T.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?T.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):T.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(T.push("TERRAIN"),this.linearFloatFilteringSupported()&&T.push("TERRAIN_DEM_FLOAT_FORMAT"),x&&T.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&T.push("GLOBE"),!this._fogVisible||g||a!==void 0&&!a||T.push("FOG","FOG_DITHERING"),g&&T.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&T.push("OVERDRAW_INSPECTOR"),T}getOrCreateProgram(n,a){this.cache=this.cache||{};const f=a&&a.defines||[],g=a&&a.config,x=a&&a.transformFeedback,T=this.currentGlobalDefines(n,a&&a.overrideFog,a&&a.overrideRtt).concat(f),E=Hh.cacheKey(Fh[n],n,T,g);return this.cache[E]||(this.cache[E]=new Hh(this.context,n,Fh[n],g,lg[n],T,x)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(n,a){if(this.style.enable3dLights()){const f=this.style.directionalLight,g=this.style.ambientLight;if(f&&g){const x=((T,E)=>{const C=T.properties.get("direction"),D=T.properties.get("color").toArray01(),L=T.properties.get("intensity"),z=E.properties.get("color").toArray01(),B=E.properties.get("intensity"),V=[C.x,C.y,C.z],H=r.cn(z,B),W=r.cn(D,L);return{u_lighting_ambient_color:H,u_lighting_directional_dir:V,u_lighting_directional_color:W,u_ground_radiance:$h(V,W,H)}})(f,g);a.setLightsUniformValues(n,x)}}}uploadCommonUniforms(n,a,f,g,x){if(this.uploadCommonLightUniforms(n,a),this.terrain&&this.terrain.renderingToTexture)return;const T=this.style.fog;if(T){const E=T.getOpacity(this.transform.pitch),C=((D,L,z,B,V,H,W,q,j,Y,re,Q)=>{const se=D.transform,X=L.properties.get("color").toArray01();X[3]=B;const oe=D.frameCounter/1e3%1,[ue,de]=L.properties.get("vertical-range");return{u_fog_matrix:z?se.calculateFogTileMatrix(z):Q||D.identityMat,u_fog_range:L.getFovAdjustedRange(se._fov),u_fog_color:X,u_fog_horizon_blend:L.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ue,de),de],u_fog_temporal_offset:oe,u_frustum_tl:V,u_frustum_tr:H,u_frustum_br:W,u_frustum_bl:q,u_globe_pos:j,u_globe_radius:Y,u_viewport:re,u_globe_transition:r.S(se.zoom),u_is_globe:+(se.projection.name==="globe")}})(this,T,f,E,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.f.devicePixelRatio,this.transform.height*r.f.devicePixelRatio],g);a.setFogUniformValues(n,C)}x&&a.setCutoffUniformValues(n,x.uniformValues)}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,a=n.createTexture();return n.bindTexture(n.TEXTURE_2D,a),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,a=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(const g of f)a[g.key]=n[g.key]||new mo(g,512,this.transform.tileZoom,this);return a}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(n,a){return!(!n.is3D()||n.minzoom&&n.minzoom>this.transform.zoom||n.sourceLayer!=="building"&&(!a||a.type!=="batched-model"))}isTileAffectedByFog(n){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let a=this._cachedTileFogOpacities[n.key];return a||(this._cachedTileFogOpacities[n.key]=a=this.style.fog.getOpacityForTile(n)),a[0]>=tn||a[1]>=tn}}function ec(d,n){let a=!1,f=null;const g=()=>{f=null,a&&(d(),f=setTimeout(g,n),a=!1)};return()=>(a=!0,f||g(),f)}class _u{constructor(n){this._hashName=n&&encodeURIComponent(n),r.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ec(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const a=md(n);if(this._hashName){const f=this._hashName;let g=!1;const x=location.hash.slice(1).split("&").map(T=>{const E=T.split("=")[0];return E===f?(g=!0,`${E}=${a}`):T}).filter(T=>T);return g||x.push(`${f}=${a}`),`#${x.join("&")}`}return`#${a}`}_getCurrentHash(){const n=location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(a=f)}),(a&&a[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some(f=>isNaN(f))){const f=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(a[3]||0):n.getBearing();return n.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:f,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function md(d,n){const a=d.getCenter(),f=Math.round(100*d.getZoom())/100,g=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,g),T=Math.round(a.lng*x)/x,E=Math.round(a.lat*x)/x,C=d.getBearing(),D=d.getPitch();let L=n?`/${T}/${E}/${f}`:`${f}/${E}/${T}`;return(C||D)&&(L+="/"+Math.round(10*C)/10),D&&(L+=`/${Math.round(D)}`),L}const tc={linearity:.3,easing:r.c_(0,0,.3,1)},Wr=r.e({deceleration:2500,maxSpeed:1400},tc),pg=r.e({deceleration:20,maxSpeed:1400},tc),gu=r.e({deceleration:1e3,maxSpeed:360},tc),Pn=r.e({deceleration:1e3,maxSpeed:90},tc);class rn{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.f.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,a=r.f.now();for(;n.length>0&&a-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const a={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)a.zoom+=x.zoomDelta||0,a.bearing+=x.bearingDelta||0,a.pitch+=x.pitchDelta||0,x.panDelta&&a.pan._add(x.panDelta),x.around&&(a.around=x.around),x.pinchAround&&(a.pinchAround=x.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(a.pan.mag()){const x=Es(a.pan.mag(),f,r.e({},Wr,n||{}));g.offset=a.pan.mult(x.amount/a.pan.mag()),g.center=this._map.transform.center,ic(g,x)}if(a.zoom){const x=Es(a.zoom,f,pg);g.zoom=this._map.transform.zoom+x.amount,ic(g,x)}if(a.bearing){const x=Es(a.bearing,f,gu);g.bearing=this._map.transform.bearing+r.aa(x.amount,-179,179),ic(g,x)}if(a.pitch){const x=Es(a.pitch,f,Pn);g.pitch=this._map.transform.pitch+x.amount,ic(g,x)}if(g.zoom||g.bearing){const x=a.pinchAround===void 0?a.around:a.pinchAround;g.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),g.noMoveStart=!0,g}}function ic(d,n){(!d.duration||d.duration<n.duration)&&(d.duration=n.duration,d.easing=n.easing)}function Es(d,n,a){const{maxSpeed:f,linearity:g,deceleration:x}=a,T=r.aa(d*g/(n/1e3),-f,f),E=Math.abs(T)/(x*g);return{easing:a.easing,duration:1e3*E,amount:T*(E/2)}}class Br extends r.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,f,g={}){const x=at(a.getCanvasContainer(),f),T=a.unproject(x);super(n,r.e({point:x,lngLat:T,originalEvent:f},g)),this._defaultPrevented=!1,this.target=a}}class Xs extends r.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,f){const g=n==="touchend"?f.changedTouches:f.touches,x=dt(a.getCanvasContainer(),g),T=x.map(C=>a.unproject(C)),E=x.reduce((C,D,L,z)=>C.add(D.div(z.length)),new r.P(0,0));super(n,{points:x,point:E,lngLats:T,lngLat:a.unproject(E),originalEvent:f}),this._defaultPrevented=!1}}class _d extends r.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,f){super(n,{originalEvent:f}),this._defaultPrevented=!1}}class gd{constructor(n,a){this._map=n,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new _d(n.type,this._map,n))}mousedown(n,a){return this._mousedownPos=a,this._firePreventable(new Br(n.type,this._map,n))}mouseup(n){this._map.fire(new Br(n.type,this._map,n))}preclick(n){const a=r.e({},n);a.type="preclick",this._map.fire(new Br(a.type,this._map,a))}click(n,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(n),this._map.fire(new Br(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new Br(n.type,this._map,n))}mouseover(n){this._map.fire(new Br(n.type,this._map,n))}mouseout(n){this._map.fire(new Br(n.type,this._map,n))}touchstart(n){return this._firePreventable(new Xs(n.type,this._map,n))}touchmove(n){this._map.fire(new Xs(n.type,this._map,n))}touchend(n){this._map.fire(new Xs(n.type,this._map,n))}touchcancel(n){this._map.fire(new Xs(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Io{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new Br(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Br("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new Br(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Co{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,a){this.isEnabled()&&n.shiftKey&&n.button===0&&($e(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(n,a){if(!this._active)return;const f=a,g=this._startPos,x=this._lastPos;if(!g||!x||x.equals(f)||!this._box&&f.dist(g)<this._clickTolerance)return;this._lastPos=f,this._box||(this._box=ie("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const T=Math.min(g.x,f.x),E=Math.max(g.x,f.x),C=Math.min(g.y,f.y),D=Math.max(g.y,f.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${C}px)`,this._box.style.width=E-T+"px",this._box.style.height=D-C+"px")})}mouseupWindow(n,a){if(!this._active)return;const f=this._startPos,g=a;if(f&&n.button===0){if(this.reset(),ot(),f.x!==g.x||f.y!==g.y)return this._map.fire(new r.b("boxzoomend",{originalEvent:n})),{cameraAnimation:x=>x.fitScreenCoordinates(f,g,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),tt(),delete this._startPos,delete this._lastPos}_fireEvent(n,a){return this._map.fire(new r.b(n,{originalEvent:a}))}}function Xa(d,n){const a={};for(let f=0;f<d.length;f++)a[d[f].identifier]=n[f];return a}class yu{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,a,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),f.length===this.numTouches&&(this.centroid=function(g){const x=new r.P(0,0);for(const T of g)x._add(T);return x.div(g.length)}(a),this.touches=Xa(f,a)))}touchmove(n,a,f){if(this.aborted||!this.centroid)return;const g=Xa(f,a);for(const x in this.touches){const T=g[x];(!T||T.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(n,a,f){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class nc{constructor(n){this.singleTap=new yu(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,a,f){this.singleTap.touchstart(n,a,f)}touchmove(n,a,f){this.singleTap.touchmove(n,a,f)}touchend(n,a,f){const g=this.singleTap.touchend(n,a,f);if(g){const x=n.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(g)<30;if(x&&T||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class yd{constructor(){this._zoomIn=new nc({numTouches:1,numTaps:2}),this._zoomOut=new nc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,a,f){this._zoomIn.touchstart(n,a,f),this._zoomOut.touchstart(n,a,f)}touchmove(n,a,f){this._zoomIn.touchmove(n,a,f),this._zoomOut.touchmove(n,a,f)}touchend(n,a,f){const g=this._zoomIn.touchend(n,a,f),x=this._zoomOut.touchend(n,a,f);return g?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(g)},{originalEvent:n})}):x?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(x)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const xd={0:1,2:2};class Fs{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,a){return!1}_move(n,a){return{}}mousedown(n,a){if(this._lastPoint)return;const f=xe(n);this._correctButton(n,f)&&(this._lastPoint=a,this._eventButton=f)}mousemoveWindow(n,a){const f=this._lastPoint;if(f){if(n.preventDefault(),this._eventButton!=null&&function(g,x){const T=xd[x];return g.buttons===void 0||(g.buttons&T)!==T}(n,this._eventButton))this.reset();else if(this._moved||!(a.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(f,a)}}mouseupWindow(n){this._lastPoint&&xe(n)===this._eventButton&&(this._moved&&ot(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vd extends Fs{mousedown(n,a){super.mousedown(n,a),this._lastPoint&&(this._active=!0)}_correctButton(n,a){return a===0&&!n.ctrlKey}_move(n,a){return{around:a,panDelta:a.sub(n)}}}class rc extends Fs{_correctButton(n,a){return a===0&&n.ctrlKey||a===2}_move(n,a){const f=.8*(a.x-n.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(n){n.preventDefault()}}class xu extends Fs{_correctButton(n,a){return a===0&&n.ctrlKey||a===2}_move(n,a){const f=-.5*(a.y-n.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(n){n.preventDefault()}}class bd{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),r.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(n,a,f){return this._calculateTransform(n,a,f)}touchmove(n,a,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(f.length===1&&!r.c$())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,a,f)}}touchend(n,a,f){this._calculateTransform(n,a,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,a,f){f.length>0&&(this._active=!0);const g=Xa(f,a),x=new r.P(0,0),T=new r.P(0,0);let E=0;for(const D in g){const L=g[D],z=this._touches[D];z&&(x._add(L),T._add(L.sub(z)),E++,g[D]=L)}if(this._touches=g,E<this._minTouches||!T.mag())return;const C=T.div(E);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(E),panDelta:C}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ie("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class hr{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,a,f){return{}}touchstart(n,a,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([a[0],a[1]]))}touchmove(n,a,f){const g=this._firstTwoTouches;if(!g)return;n.preventDefault();const[x,T]=g,E=Ya(f,a,x),C=Ya(f,a,T);if(!E||!C)return;const D=this._aroundCenter?null:E.add(C).div(2);return this._move([E,C],D,n)}touchend(n,a,f){if(!this._firstTwoTouches)return;const[g,x]=this._firstTwoTouches,T=Ya(f,a,g),E=Ya(f,a,x);T&&E||(this._active&&ot(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ya(d,n,a){for(let f=0;f<d.length;f++)if(d[f].identifier===a)return n[f]}function vu(d,n){return Math.log(d/n)/Math.LN2}class sc extends hr{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,a){const f=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(vu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:vu(this._distance,f),pinchAround:a}}}function Po(d,n){return 180*d.angleWith(n)/Math.PI}class wd extends hr{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,a){const f=this._vector;if(this._vector=n[0].sub(n[1]),f&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Po(this._vector,f),pinchAround:a}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const a=25/(Math.PI*this._minDiameter)*360,f=this._startVector;if(!f)return!1;const g=Po(n,f);return Math.abs(g)<a}}function oc(d){return Math.abs(d.y)>Math.abs(d.x)}class Td extends hr{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,oc(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,a,f){const g=this._lastPoints;if(!g)return;const x=n[0].sub(g[0]),T=n[1].sub(g[1]);return this._map._cooperativeGestures&&!r.c$()&&f.touches.length<3||(this._valid=this.gestureBeginsVertically(x,T,f.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(x.y+T.y)/2*-.5})}gestureBeginsVertically(n,a,f){if(this._valid!==void 0)return this._valid;const g=n.mag()>=2,x=a.mag()>=2;if(!g&&!x)return;if(!g||!x)return this._firstMove==null&&(this._firstMove=f),f-this._firstMove<100&&void 0;const T=n.y>0==a.y>0;return oc(n)&&oc(a)&&T}}const ra={panStep:100,bearingStep:15,pitchStep:10};class ac{constructor(){const n=ra;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let a=0,f=0,g=0,x=0,T=0;switch(n.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:n.shiftKey?f=-1:(n.preventDefault(),x=-1);break;case 39:n.shiftKey?f=1:(n.preventDefault(),x=1);break;case 38:n.shiftKey?g=1:(n.preventDefault(),T=-1);break;case 40:n.shiftKey?g=-1:(n.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(f=0,g=0),{cameraAnimation:E=>{const C=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:Md,zoom:a?Math.round(C)+a*(n.shiftKey?2:1):C,bearing:E.getBearing()+f*this._bearingStep,pitch:E.getPitch()+g*this._pitchStep,offset:[-x*this._panStep,-T*this._panStep],center:E.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Md(d){return d*(2-d)}const lc=4.000244140625,Sd=1/450;class Ep{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._handler=a,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Sd,r.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||r.c$()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const f=r.f.now(),g=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,a!==0&&a%lc==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(g*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),n.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=n,this._delta-=a,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=at(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const a=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>lc?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&L!==0&&(L=1/L);const z=a(),B=Math.pow(2,z),V=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(V*L))),this._type==="wheel"&&(this._startZoom=z,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:a(),g=this._startZoom,x=this._easing;let T,E=!1;if(this._type==="wheel"&&g&&x){const D=Math.min((r.f.now()-this._lastWheelEventTime)/200,1),L=x(D);T=r.U(g,f,L),D<1?this._frameId||(this._frameId=!0):E=!0}else T=f,E=!0;this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let C=T-a();return C*this._lastDelta<0&&(C=0),{noInertia:!0,needsRenderFrame:!E,zoomDelta:C,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let a=r.d0;if(this._prevEase){const f=this._prevEase,g=(r.f.now()-f.start)/f.duration,x=f.easing(g+.01)-f.easing(g),T=.27/Math.sqrt(x*x+1e-4)*.01,E=Math.sqrt(.0729-T*T);a=r.c_(T,E,.25,1)}return this._prevEase={start:r.f.now(),duration:n,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ie("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Ap{constructor(n,a){this._clickZoom=n,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ip{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,a){return n.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(n.shiftKey?-1:1),around:f.unproject(a)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cp{constructor(){this._tap=new nc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,a,f){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=a[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(n,a,f))}touchmove(n,a,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const g=a[0],x=g.y-this._swipePoint.y;return this._swipePoint=g,n.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(n,a,f)}touchend(n,a,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(n,a,f)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pp{constructor(n,a,f){this._el=n,this._mousePan=a,this._touchPan=f}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Dp{constructor(n,a,f){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=a,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Lp{constructor(n,a,f,g){this._el=n,this._touchZoom=a,this._touchRotate=f,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const cc=d=>d.zoom||d.drag||d.pitch||d.rotate;class kp extends r.b{}class Rp{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,a){const f=r.N.sub([],a,n);this.radius=r.N.length(f[2]<0?r.N.div([],f,this.constants):[f[0],f[1],0])}projectRay(n){r.N.div(n,n,this.constants),r.N.normalize(n,n),r.N.mul(n,n,this.constants);const a=r.N.scale([],n,this.radius);if(a[2]>0){const f=r.N.scale([],[0,0,1],r.N.dot(a,[0,0,1])),g=r.N.scale([],r.N.normalize([],[a[0],a[1],0]),this.radius),x=r.N.add([],a,r.N.scale([],r.N.sub([],r.N.add([],g,f),a),2));a[0]=x[0],a[1]=x[1]}return a}}function uc(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class mg{constructor(n,a){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new rn(n),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Rp,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),r.aY(["handleEvent","handleWindowEvent"],this);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,x,T]of this._listeners){const E=g===document?this.handleWindowEvent:this.handleEvent;g.addEventListener(x,E,T)}}destroy(){for(const[n,a,f]of this._listeners){const g=n===document?this.handleWindowEvent:this.handleEvent;n.removeEventListener(a,g,f)}}_addDefaultHandlers(n){const a=this._map,f=a.getCanvasContainer();this._add("mapEvent",new gd(a,n));const g=a.boxZoom=new Co(a,n);this._add("boxZoom",g);const x=new yd,T=new Ip;a.doubleClickZoom=new Ap(T,x),this._add("tapZoom",x),this._add("clickZoom",T);const E=new Cp;this._add("tapDragZoom",E);const C=a.touchPitch=new Td(a);this._add("touchPitch",C);const D=new rc(n),L=new xu(n);a.dragRotate=new Dp(n,D,L),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const z=new vd(n),B=new bd(a,n);a.dragPan=new Pp(f,z,B),this._add("mousePan",z),this._add("touchPan",B,["touchZoom","touchRotate"]);const V=new wd,H=new sc;a.touchZoomRotate=new Lp(f,H,V,E),this._add("touchRotate",V,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Io(a));const W=a.scrollZoom=new Ep(a,this);this._add("scrollZoom",W,["mousePan"]);const q=a.keyboard=new ac;this._add("keyboard",q);for(const j of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[j]&&a[j].enable(n[j])}_add(n,a,f){this._handlers.push({handlerName:n,handler:a,allowed:f}),this._handlersById[n]=a}stop(n){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!cc(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,a,f){for(const g in n)if(g!==f&&(!a||a.indexOf(g)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const a=[];for(const f of n)this._el.contains(f.target)&&a.push(f);return a}handleEvent(n,a){this._updatingCamera=!0;const f=n.type==="renderFrame",g=f?void 0:n,x={needsRenderFrame:!1},T={},E={},C=n.touches?this._getMapTouches(n.touches):void 0,D=C?dt(this._el,C):f?void 0:at(this._el,n);for(const{handlerName:B,handler:V,allowed:H}of this._handlers){if(!V.isEnabled())continue;let W;this._blockedByActive(E,H,B)?V.reset():V[a||n.type]&&(W=V[a||n.type](n,D,C),this.mergeHandlerResult(x,T,W,B,g),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||V.isActive())&&(E[B]=V)}const L={};for(const B in this._previousActiveHandlers)E[B]||(L[B]=g);this._previousActiveHandlers=E,(Object.keys(L).length||uc(x))&&(this._changes.push([x,T,L]),this._triggerRenderFrame()),(Object.keys(E).length||uc(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:z}=x;z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],z(this._map))}mergeHandlerResult(n,a,f,g,x){if(!f)return;r.e(n,f);const T={handlerName:g,originalEvent:f.originalEvent||x};f.zoomDelta!==void 0&&(a.zoom=T),f.panDelta!==void 0&&(a.drag=T),f.pitchDelta!==void 0&&(a.pitch=T),f.bearingDelta!==void 0&&(a.rotate=T)}_applyChanges(){const n={},a={},f={};for(const[g,x,T]of this._changes)g.panDelta&&(n.panDelta=(n.panDelta||new r.P(0,0))._add(g.panDelta)),g.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(n.around=g.around),g.aroundCoord!==void 0&&(n.aroundCoord=g.aroundCoord),g.pinchAround!==void 0&&(n.pinchAround=g.pinchAround),g.noInertia&&(n.noInertia=g.noInertia),r.e(a,x),r.e(f,T);this._updateMapTransform(n,a,f),this._changes=[]}_updateMapTransform(n,a,f){const g=this._map,x=g.transform,T=Y=>[Y.x,Y.y,Y.z];if((Y=>{const re=this._eventsInProgress.drag;return re&&!this._handlersById[re.handlerName].isActive()})()&&!uc(n)){const Y=x.zoom;x.cameraElevationReference="sea",this._originalZoom!=null&&x._orthographicProjectionAtLowPitch&&x.projection.name!=="globe"&&x.pitch===0?(x.cameraElevationReference="ground",x.zoom=this._originalZoom):(x.recenterOnTerrain(),x.cameraElevationReference="ground"),Y!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&g._stop(!0),!uc(n))return void this._fireEvents(a,f,!0);let{panDelta:E,zoomDelta:C,bearingDelta:D,pitchDelta:L,around:z,aroundCoord:B,pinchAround:V}=n;x._isCameraConstrained&&(C>0&&(C=0),x._isCameraConstrained=!1),V!==void 0&&(z=V),(C||(Y=>a[Y]&&!this._eventsInProgress[Y])("drag"))&&z&&(this._dragOrigin=T(x.pointCoordinate3D(z)),this._originalZoom=x.zoom,this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",g._stop(!0),z=z||g.transform.centerPoint,D&&(x.bearing+=D),L&&(x.pitch+=L),x._updateCameraState();const H=[0,0,0];if(E)if(x.projection.name==="mercator"){const Y=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(z).dir),re=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(z.sub(E)).dir);H[0]=re[0]-Y[0],H[1]=re[1]-Y[1]}else{const Y=x.pointCoordinate(z);if(x.projection.name==="globe"){E=E.rotate(-x.angle);const re=x._pixelsPerMercatorPixel/x.worldSize;H[0]=-E.x*r.d1(r.au(Y.y))*re,H[1]=-E.y*r.d1(x.center.lat)*re}else{const re=x.pointCoordinate(z.sub(E));Y&&re&&(H[0]=re.x-Y.x,H[1]=re.y-Y.y)}}const W=x.zoom,q=[0,0,0];if(C){const Y=T(B||x.pointCoordinate3D(z)),re={dir:r.N.normalize([],r.N.sub([],Y,x._camera.position))};if(re.dir[2]<0){const Q=x.zoomDeltaToMovement(Y,C);r.N.scale(q,re.dir,Q)}}const j=r.N.add(H,H,q);x._translateCameraConstrained(j),C&&Math.abs(x.zoom-W)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(a,f,!0)}_fireEvents(n,a,f){const g=cc(this._eventsInProgress),x=cc(n),T={};for(const L in n){const{originalEvent:z}=n[L];this._eventsInProgress[L]||(T[`${L}start`]=z),this._eventsInProgress[L]=n[L]}!g&&x&&this._fireEvent("movestart",x.originalEvent);for(const L in T)this._fireEvent(L,T[L]);x&&this._fireEvent("move",x.originalEvent);for(const L in n){const{originalEvent:z}=n[L];this._fireEvent(L,z)}const E={};let C;for(const L in this._eventsInProgress){const{handlerName:z,originalEvent:B}=this._eventsInProgress[L];this._handlersById[z].isActive()||(delete this._eventsInProgress[L],C=a[z]||B,E[`${L}end`]=C)}for(const L in E)this._fireEvent(L,E[L]);const D=cc(this._eventsInProgress);if(f&&(g||x)&&!D){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;L?(z(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:C})):(this._map.fire(new r.b("moveend",{originalEvent:C})),z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,a){this._map.fire(new r.b(n,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new kp("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const zp="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class $n extends r.E{constructor(n,a){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=a.respectPrefersReducedMotion!==!1,r.aY(["_renderFrameCallback"],this)}getCenter(){return new r.bn(this.transform.center.lng,this.transform.center.lat)}setCenter(n,a){return this.jumpTo({center:n},a)}panBy(n,a,f){return n=r.P.convert(n).mult(-1),this.panTo(this.transform.center,r.e({offset:n},a),f)}panTo(n,a,f){return this.easeTo(r.e({center:n},a),f)}getZoom(){return this.transform.zoom}setZoom(n,a){return this.jumpTo({zoom:n},a),this}zoomTo(n,a,f){return this.easeTo(r.e({zoom:n},a),f)}zoomIn(n,a){return this.zoomTo(this.getZoom()+1,n,a),this}zoomOut(n,a){return this.zoomTo(this.getZoom()-1,n,a),this}getBearing(){return this.transform.bearing}setBearing(n,a){return this.jumpTo({bearing:n},a),this}getPadding(){return this.transform.padding}setPadding(n,a){return this.jumpTo({padding:n},a),this}rotateTo(n,a,f){return this.easeTo(r.e({bearing:n},a),f)}resetNorth(n,a){return this.rotateTo(0,r.e({duration:1e3},n),a),this}resetNorthPitch(n,a){return this.easeTo(r.e({bearing:0,pitch:0,duration:1e3},n),a),this}snapToNorth(n,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,a):this}getPitch(){return this.transform.pitch}setPitch(n,a){return this.jumpTo({pitch:n},a),this}cameraForBounds(n,a){n=r.ad.convert(n);const f=a&&a.bearing||0,g=a&&a.pitch||0,x=n.getNorthWest(),T=n.getSouthEast();return this._cameraForBounds(this.transform,x,T,f,g,a)}_extendCameraOptions(n){const a={top:0,bottom:0,right:0,left:0};if(typeof(n=r.e({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=="number"){const f=n.padding;n.padding={top:f,bottom:f,right:f,left:f}}return n.padding=r.e(a,n.padding),n}_minimumAABBFrustumDistance(n,a){const f=a.max[0]-a.min[0],g=a.max[1]-a.min[1];return f/g>n.aspect?f/(2*Math.tan(.5*n.fovX)*n.aspect):g/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,a,f,g,x,T){const E=n.clone(),C=this._extendCameraOptions(T);E.bearing=g,E.pitch=x;const D=r.bn.convert(a),L=r.bn.convert(f),z=.5*(D.lat+L.lat),B=.5*(D.lng+L.lng),V=r.d2(z,B),H=r.N.normalize([],V),W=r.N.normalize([],r.N.cross([],H,[0,1,0])),q=r.N.cross([],W,H),j=[W[0],W[1],W[2],0,q[0],q[1],q[2],0,H[0],H[1],H[2],0,0,0,0,1],Y=[V,r.d2(D.lat,D.lng),r.d2(L.lat,D.lng),r.d2(L.lat,L.lng),r.d2(D.lat,L.lng),r.d2(z,D.lng),r.d2(z,L.lng),r.d2(D.lat,B),r.d2(L.lat,B)];let re=r.bS.fromPoints(Y.map(Ae=>[r.N.dot(W,Ae),r.N.dot(q,Ae),r.N.dot(H,Ae)]));const Q=r.N.transformMat4([],re.center,j);r.N.squaredLength(Q)===0&&r.N.set(Q,0,0,1),r.N.normalize(Q,Q),r.N.scale(Q,Q,r.ab),E.center=r.d3(Q);const se=E.getWorldToCameraMatrix(),X=r.a6.invert(new Float64Array(16),se);re=r.bS.applyTransform(re,r.a6.multiply([],se,j)),r.N.transformMat4(Q,Q,se);const oe=.5*(re.max[2]-re.min[2]),ue=this._minimumAABBFrustumDistance(E,re),de=r.N.scale([],[0,0,1],oe),_e=r.N.add(de,Q,de),Pe=ue+(E.pitch===0?0:r.N.distance(Q,_e)),be=E.globeCenterInViewSpace,Ne=r.N.sub([],Q,[be[0],be[1],be[2]]);r.N.normalize(Ne,Ne),r.N.scale(Ne,Ne,Pe);const Oe=r.N.add([],Q,Ne);r.N.transformMat4(Oe,Oe,X);const et=r.d4/r.ab,Me=r.N.length(Oe),ke=r.bl(Math.max(Me*et-r.d4,Number.EPSILON),0),me=Math.min(E.zoomFromMercatorZAdjusted(ke),C.maxZoom);return me>.5*(r.bG+r.bx)?(E.setProjection({name:"mercator"}),E.zoom=me,this._cameraForBounds(E,a,f,g,x,T)):{center:E.center,zoom:me,bearing:g,pitch:x}}queryTerrainElevation(n,a){const f=this.transform.elevation;return f?(a=r.e({},{exaggerated:!0},a),f.getAtPoint(r.L.fromLngLat(n),null,a.exaggerated)):null}_cameraForBounds(n,a,f,g,x,T){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,a,f,g,x,T);const E=n.clone(),C=this._extendCameraOptions(T),D=E.padding;E.bearing=g,E.pitch=x;const L=r.bn.convert(a),z=r.bn.convert(f),B=new r.bn(L.lng,z.lat),V=new r.bn(z.lng,L.lat),H=E.project(L),W=E.project(z),q=this.queryTerrainElevation(L),j=this.queryTerrainElevation(z),Y=this.queryTerrainElevation(B),re=this.queryTerrainElevation(V),Q=[[H.x,H.y,Math.min(q||0,j||0,Y||0,re||0)],[W.x,W.y,Math.max(q||0,j||0,Y||0,re||0)]];let se=r.bS.fromPoints(Q);const X=E.getWorldToCameraMatrix(),oe=r.a6.invert(new Float64Array(16),X);se=r.bS.applyTransform(se,X);const ue=r.N.sub([],se.max,se.min),de=D.left||0,_e=D.right||0,Pe=D.bottom||0,be=D.top||0,{left:Ne,right:Oe,top:et,bottom:Me}=C.padding,ke=.5*(de+_e),me=.5*(be+Pe),Ae=Math.min(E.scaleZoom(E.scale*Math.min((E.width-(de+_e+Ne+Oe))/ue[0],(E.height-(Pe+be+Me+et))/ue[1])),C.maxZoom),it=E.scale/E.zoomScale(Ae);se=new r.bS([se.min[0]-(Ne+ke)*it,se.min[1]-(Me+me)*it,se.min[2]],[se.max[0]+(Oe+ke)*it,se.max[1]+(et+me)*it,se.max[2]]);const pt=.5*ue[2],ht=this._minimumAABBFrustumDistance(E,se),Et=[0,0,1,0];r.a7.transformMat4(Et,Et,X),r.a7.normalize(Et,Et);const Wt=r.N.scale([],Et,ht+pt),Jt=r.N.add([],se.center,Wt),qt=(typeof C.offset.x=="number"&&typeof C.offset.y=="number"?new r.P(C.offset.x,C.offset.y):r.P.convert(C.offset)).rotate(-r.bj(g));se.center[0]-=qt.x*it,se.center[1]+=qt.y*it,r.N.transformMat4(se.center,se.center,oe),r.N.transformMat4(Jt,Jt,oe);const Yt=[se.center[0],se.center[1],Jt[2]*E.pixelsPerMeter];r.N.scale(Yt,Yt,1/E.worldSize);const vi=r.at(Yt[0]),ui=r.au(Yt[1]),mi=Math.min(E._zoomFromMercatorZ(Yt[2]),C.maxZoom),pi=new r.bn(vi,ui);return E.mercatorFromTransition&&mi<.5*(r.bG+r.bx)?(E.setProjection({name:"globe"}),E.zoom=mi,this._cameraForBounds(E,a,f,g,x,T)):{center:pi,zoom:mi,bearing:g,pitch:x}}fitBounds(n,a,f){const g=this.cameraForBounds(n,a);return this._fitInternal(g,a,f)}fitScreenCoordinates(n,a,f,g,x){const T=r.P.convert(n),E=r.P.convert(a),C=new r.P(Math.min(T.x,E.x),Math.min(T.y,E.y)),D=new r.P(Math.max(T.x,E.x),Math.max(T.y,E.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,E))return this;const L=this.transform.pointLocation3D(C),z=this.transform.pointLocation3D(D),B=this.transform.pointLocation3D(new r.P(C.x,D.y)),V=this.transform.pointLocation3D(new r.P(D.x,C.y)),H=[Math.min(L.lng,z.lng,B.lng,V.lng),Math.min(L.lat,z.lat,B.lat,V.lat)],W=[Math.max(L.lng,z.lng,B.lng,V.lng),Math.max(L.lat,z.lat,B.lat,V.lat)],q=g&&g.pitch?g.pitch:this.getPitch(),j=this._cameraForBounds(this.transform,H,W,f,q,g);return this._fitInternal(j,g,x)}_fitInternal(n,a,f){return n?(delete(a=r.e(n,a)).padding,a.linear?this.easeTo(a,f):this.flyTo(a,f)):this}jumpTo(n,a){this.stop();const f=n.preloadOnly?this.transform.clone():this.transform;let g=!1,x=!1,T=!1;return"zoom"in n&&f.zoom!==+n.zoom&&(g=!0,f.zoom=+n.zoom),n.center!==void 0&&(f.center=r.bn.convert(n.center)),"bearing"in n&&f.bearing!==+n.bearing&&(x=!0,f.bearing=+n.bearing),"pitch"in n&&f.pitch!==+n.pitch&&(T=!0,f.pitch=+n.pitch),n.padding==null||f.isPaddingEqual(n.padding)||(f.padding=n.padding),n.preloadOnly?(this._preloadTiles(f),this):(this.fire(new r.b("movestart",a)).fire(new r.b("move",a)),g&&this.fire(new r.b("zoomstart",a)).fire(new r.b("zoom",a)).fire(new r.b("zoomend",a)),x&&this.fire(new r.b("rotatestart",a)).fire(new r.b("rotate",a)).fire(new r.b("rotateend",a)),T&&this.fire(new r.b("pitchstart",a)).fire(new r.b("pitch",a)).fire(new r.b("pitchend",a)),this.fire(new r.b("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(zp),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,a){const f=this.transform;if(!f.projection.supportsFreeCamera)return r.w(zp),this;this.stop();const g=f.zoom,x=f.pitch,T=f.bearing;f.setFreeCameraOptions(n);const E=g!==f.zoom,C=x!==f.pitch,D=T!==f.bearing;return this.fire(new r.b("movestart",a)).fire(new r.b("move",a)),E&&this.fire(new r.b("zoomstart",a)).fire(new r.b("zoom",a)).fire(new r.b("zoomend",a)),D&&this.fire(new r.b("rotatestart",a)).fire(new r.b("rotate",a)).fire(new r.b("rotateend",a)),C&&this.fire(new r.b("pitchstart",a)).fire(new r.b("pitch",a)).fire(new r.b("pitchend",a)),this.fire(new r.b("moveend",a)),this}easeTo(n,a){this._stop(!1,n.easeId),((n=r.e({offset:[0,0],duration:500,easing:r.d0},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const f=this.transform,g=this.getZoom(),x=this.getBearing(),T=this.getPitch(),E=this.getPadding(),C="zoom"in n?+n.zoom:g,D="bearing"in n?this._normalizeBearing(n.bearing,x):x,L="pitch"in n?+n.pitch:T,z="padding"in n?n.padding:f.padding,B=r.P.convert(n.offset);let V,H,W;if(f.projection.name==="globe"){const de=r.L.fromLngLat(f.center),_e=B.rotate(-f.angle);de.x+=_e.x/f.worldSize,de.y+=_e.y/f.worldSize;const Pe=de.toLngLat(),be=r.bn.convert(n.center||Pe);this._normalizeCenter(be),V=f.centerPoint.add(_e),H=new r.P(de.x,de.y).mult(f.worldSize),W=new r.P(r.a5(be.lng),r.ae(be.lat)).mult(f.worldSize).sub(H)}else{V=f.centerPoint.add(B);const de=f.pointLocation(V),_e=r.bn.convert(n.center||de);this._normalizeCenter(_e),H=f.project(de),W=f.project(_e).sub(H)}const q=f.zoomScale(C-g);let j,Y;n.around&&(j=r.bn.convert(n.around),Y=f.locationPoint(j));const re=this._zooming||C!==g,Q=this._rotating||x!==D,se=this._pitching||L!==T,X=!f.isPaddingEqual(z),oe=de=>_e=>{if(re&&(de.zoom=r.U(g,C,_e)),Q&&(de.bearing=r.U(x,D,_e)),se&&(de.pitch=r.U(T,L,_e)),X&&(de.interpolatePadding(E,z,_e),V=de.centerPoint.add(B)),j)de.setLocationAtPoint(j,Y);else{const Pe=de.zoomScale(de.zoom-g),be=C>g?Math.min(2,q):Math.max(.5,q),Ne=Math.pow(be,1-_e),Oe=de.unproject(H.add(W.mult(_e*Ne)).mult(Pe));de.setLocationAtPoint(de.renderWorldCopies?Oe.wrap():Oe,V)}return n.preloadOnly||this._fireMoveEvents(a),de};if(n.preloadOnly){const de=this._emulate(oe,n.duration,f);return this._preloadTiles(de),this}const ue={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=re,this._rotating=Q,this._pitching=se,this._easeId=n.easeId,this._prepareEase(a,n.noMoveStart,ue),this._ease(oe(f),de=>{f.cameraElevationReference==="sea"&&f.recenterOnTerrain(),this._afterEase(a,de)},n),this}_prepareEase(n,a,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),a||f.moving||this.fire(new r.b("movestart",n)),this._zooming&&!f.zooming&&this.fire(new r.b("zoomstart",n)),this._rotating&&!f.rotating&&this.fire(new r.b("rotatestart",n)),this._pitching&&!f.pitching&&this.fire(new r.b("pitchstart",n))}_fireMoveEvents(n){this.fire(new r.b("move",n)),this._zooming&&this.fire(new r.b("zoom",n)),this._rotating&&this.fire(new r.b("rotate",n)),this._pitching&&this.fire(new r.b("pitch",n))}_afterEase(n,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const f=this._zooming,g=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,f&&this.fire(new r.b("zoomend",n)),g&&this.fire(new r.b("rotateend",n)),x&&this.fire(new r.b("pitchend",n)),this.fire(new r.b("moveend",n))}flyTo(n,a){if(this._prefersReducedMotion(n)){const Me=r.ac(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Me,a)}this.stop(),n=r.e({offset:[0,0],speed:1.2,curve:1.42,easing:r.d0},n);const f=this.transform,g=this.getZoom(),x=this.getBearing(),T=this.getPitch(),E="zoom"in n?r.aa(+n.zoom,f.minZoom,f.maxZoom):g,C="bearing"in n?this._normalizeBearing(n.bearing,x):x,D="pitch"in n?+n.pitch:T,L=f.zoomScale(E-g),z=r.P.convert(n.offset),B=f.centerPoint.add(z),V=f.pointLocation(B);let H=n.center;if(H&&n.padding){const Me=this._cameraForBounds(this.transform,H,H,C,D,n);Me&&(H=Me.center)}H=r.bn.convert(H||V),this._normalizeCenter(H);const W=f.project(V),q=f.project(H).sub(W);let j=n.curve;const Y=Math.max(f.width,f.height),re=Y/L,Q=q.mag();if("minZoom"in n){const Me=r.aa(Math.min(n.minZoom,g,E),f.minZoom,f.maxZoom),ke=Y/f.zoomScale(Me-g);j=Math.sqrt(ke/Q*2)}const se=j*j;function X(Me){const ke=(re*re-Y*Y+(Me?-1:1)*se*se*Q*Q)/(2*(Me?re:Y)*se*Q);return Math.log(Math.sqrt(ke*ke+1)-ke)}function oe(Me){return(Math.exp(Me)-Math.exp(-Me))/2}function ue(Me){return(Math.exp(Me)+Math.exp(-Me))/2}const de=X(0);let _e=function(Me){return ue(de)/ue(de+j*Me)},Pe=function(Me){return Y*((ue(de)*(oe(ke=de+j*Me)/ue(ke))-oe(de))/se)/Q;var ke},be=(X(1)-de)/j;if(Math.abs(Q)<1e-6||!isFinite(be)){if(Math.abs(Y-re)<1e-6)return this.easeTo(n,a);const Me=re<Y?-1:1;be=Math.abs(Math.log(re/Y))/j,Pe=function(){return 0},_e=function(ke){return Math.exp(Me*j*ke)}}n.duration="duration"in n?+n.duration:1e3*be/("screenSpeed"in n?+n.screenSpeed/j:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const Ne=x!==C,Oe=D!==T,et=Me=>ke=>{const me=ke*be,Ae=1/_e(me);Me.zoom=ke===1?E:g+Me.scaleZoom(Ae),Ne&&(Me.bearing=r.U(x,C,ke)),Oe&&(Me.pitch=r.U(T,D,ke));const it=ke===1?H:Me.unproject(W.add(q.mult(Pe(me))).mult(Ae));return Me.setLocationAtPoint(Me.renderWorldCopies?it.wrap():it,B),Me._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(a),Me};if(n.preloadOnly){const Me=this._emulate(et,n.duration,f);return this._preloadTiles(Me),this}return this._zooming=!0,this._rotating=Ne,this._pitching=Oe,this._prepareEase(a,!1),this._ease(et(f),()=>this._afterEase(a),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const f=this._onEaseEnd;this._onEaseEnd=void 0,f.call(this,a)}if(!n){const f=this.handlers;f&&f.stop(!1)}return this}_ease(n,a,f){f.animate===!1||f.duration===0?(n(1),a()):(this._easeStart=r.f.now(),this._easeOptions=f,this._onEaseFrame=n,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((r.f.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,a){n=r.bh(n,-180,180);const f=Math.abs(n-a);return Math.abs(n-360-a)<f&&(n-=360),Math.abs(n+360-a)<f&&(n+=360),n}_normalizeCenter(n){const a=this.transform;if(a.maxBounds||a.projection.name!=="globe"&&!a.renderWorldCopies)return;const f=n.lng-a.center.lng;n.lng+=f>180?-360:f<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&r.f.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,a,f){const g=Math.ceil(15*a/1e3),x=[],T=n(f.clone());for(let E=0;E<=g;E++){const C=T(E/g);x.push(C.clone())}return x}}class Ed{constructor(n={}){this.options=n,r.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const a=this.options&&this.options.compact;return this._map=n,this._container=ie("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ie("button","mapboxgl-ctrl-attrib-button",this._container),ie("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ie("div","mapboxgl-ctrl-attrib-inner",this._container),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,a){const f=this._map._getUIString(`AttributionControl.${a}`);n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",f)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.d5.ACCESS_TOKEN}];if(n){const f=a.reduce((g,x,T)=>(x.value&&(g+=`${x.key}=${x.value}${T<a.length-1?"&":""}`),g),"?");n.href=`${r.d5.FEEDBACK_URL}/${f}#${md(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const a=this._map.style._mergedSourceCaches;for(const g in a){const x=a[g];if(x.used){const T=x.getSource();T.attribution&&n.indexOf(T.attribution)<0&&n.push(T.attribution)}}n.sort((g,x)=>g.length-x.length),n=n.filter((g,x)=>{for(let T=x+1;T<n.length;T++)if(n[T].indexOf(g)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const f=n.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,n.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Op{constructor(){r.aY(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=ie("div","mapboxgl-ctrl");const a=ie("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const a in n){const f=n[a].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const a=n[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class Fp{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const a=++this._id;return this._queue.push({callback:n,id:a,cancelled:!1}),a}remove(n){const a=this._currentlyRunning,f=a?this._queue.concat(a):this._queue;for(const g of f)if(g.id===n)return void(g.cancelled=!0)}run(n=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const f of a)if(!f.cancelled&&(f.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function hc(d,n,a){if(d=new r.bn(d.lng,d.lat),n){const f=new r.bn(d.lng-360,d.lat),g=new r.bn(d.lng+360,d.lat),x=360*Math.ceil(Math.abs(d.lng-a.center.lng)/360),T=a.locationPoint(d).distSqr(n),E=n.x<0||n.y<0||n.x>a.width||n.y>a.height;a.locationPoint(f).distSqr(n)<T&&(E||Math.abs(f.lng-a.center.lng)<x)?d=f:a.locationPoint(g).distSqr(n)<T&&(E||Math.abs(g.lng-a.center.lng)<x)&&(d=g)}for(;Math.abs(d.lng-a.center.lng)>180;){const f=a.locationPoint(d);if(f.x>=0&&f.y>=0&&f.x<=a.width&&f.y<=a.height)break;d.lng>a.center.lng?d.lng-=360:d.lng+=360}return d}const bu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ad extends r.E{constructor(n,a){if(super(),(n instanceof HTMLElement||a)&&(n=r.e({element:n},a)),r.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=n&&n.occludedOpacity||.2,n&&n.element)this._element=n.element,this._offset=r.P.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=ie("div");const x=41,T=27,E=pe("svg",{display:"block",height:x*this._scale+"px",width:T*this._scale+"px",viewBox:`0 0 ${T} ${x}`},this._element),C=pe("radialGradient",{id:"shadowGradient"},pe("defs",{},E));pe("stop",{offset:"10%","stop-opacity":.4},C),pe("stop",{offset:"100%","stop-opacity":.05},C),pe("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},E),pe("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},E),pe("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},E),pe("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},E),this._offset=r.P.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const f=this._element.classList;for(const x in bu)f.remove(`mapboxgl-marker-anchor-${x}`);f.add(`mapboxgl-marker-anchor-${this._anchor}`);const g=n&&n.className?n.className.trim().split(/\s+/):[];f.add(...g),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=r.bn.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const g=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const a=n.code,f=n.charCode||n.keyCode;a!=="Space"&&a!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(n){const a=n.originalEvent.target,f=this._element;this._popup&&(a===f||f.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,a=this._pos;if(!n||!a)return!1;const f=n.unproject(a),g=n.getFreeCameraOptions();if(!g.position)return!1;const x=g.position.toLngLat();return x.distanceTo(f)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const a=this._pos;if(!a||a.x<0||a.x>n.transform.width||a.y<0||a.y>n.transform.height)return void this._clearFadeTimer();const f=n.unproject(a);let g;n._showingGlobe()&&r.d6(n.transform,this._lngLat)?g=0:(g=1-n._queryFogOpacity(f),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(g*=this._occludedOpacity)),this._element.style.opacity=`${g}`,this._element.style.pointerEvents=g>0?"auto":"none",this._popup&&this._popup._setOpacity(g),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${bu[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){const n=this._pos,a=this._map,f=this.getPitchAlignment();if(!a||!n||f!=="map")return"";if(!a._showingGlobe()){const C=a.getPitch();return C?`rotateX(${C}deg)`:""}const g=r.bF(r.d7(a.transform,this._lngLat)),x=n.sub(r.d8(a.transform)),T=Math.abs(x.x)+Math.abs(x.y);if(T===0)return"";const E=g/T;return`rotateX(${-x.y*E}deg) rotateY(${x.x*E}deg)`}_calculateZTransform(){const n=this._pos,a=this._map;if(!a||!n)return"";let f=0;const g=this.getRotationAlignment();if(g==="map")if(a._showingGlobe()){const x=a.project(new r.bn(this._lngLat.lng,this._lngLat.lat+.001)),T=a.project(new r.bn(this._lngLat.lng,this._lngLat.lat-.001)).sub(x);f=r.bF(Math.atan2(T.y,T.x))-90}else f=-a.getBearing();else if(g==="horizon"){const x=r.O(4,6,a.getZoom()),T=r.d8(a.transform);T.y+=x*a.transform.height;const E=n.sub(T),C=r.bF(Math.atan2(E.y,E.x));f=(C>90?C-270:C+90)*(1-x)}return f+=this._rotation,f?`rotateZ(${f}deg)`:""}_update(n){cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=hc(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat),n===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=r.P.convert(n),this._update(),this}addClassName(n){return this._element.classList.add(n),this}removeClassName(n){return this._element.classList.remove(n),this}toggleClassName(n){return this._element.classList.toggle(n)}_onMove(n){const a=this._map;if(!a)return;const f=this._pointerdownPos,g=this._positionDelta;if(f&&g){if(!this._isDragging){const x=this._clickTolerance||a._clickTolerance;if(n.point.dist(f)<x)return;this._isDragging=!0}this._pos=n.point.sub(g),this._lngLat=a.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.b("dragstart"))),this.fire(new r.b("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.b("dragend")),this._state="inactive"}_addDragHandler(n){const a=this._map,f=this._pos;a&&f&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(f),this._pointerdownPos=n.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const a=this._map;return a&&(n?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Bp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Np=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Vp(d=new r.P(0,0),n="bottom"){if(typeof d=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(n){case"top":return new r.P(0,d);case"top-left":return new r.P(a,a);case"top-right":return new r.P(-a,a);case"bottom":return new r.P(0,-d);case"bottom-left":return new r.P(a,-a);case"bottom-right":return new r.P(-a,-a);case"left":return new r.P(d,0);case"right":return new r.P(-d,0)}return new r.P(0,0)}return d instanceof r.P||Array.isArray(d)?r.P.convert(d):r.P.convert(d[n]||[0,0])}class Id{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const a=r.cc((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,a,f){this._start=this.getValue(a),this._end=n,this._startTime=a,this._endTime=a+f}}const dc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Up={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1};class Cd{constructor(){this.showOverdrawInspector=!1,this.showTileBoundaries=!1,this.showParseStatus=!1,this.continuousRedraw=!1,this.showTileAABBs=!1,this.showPadding=!1,this.showTerrainWireframe=!1,this.showLayers2DWireframe=!1,this.showLayers3DWireframe=!1}}const wu={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ys{constructor(n,a,f=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new rc({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,f&&(this.mousePitch=new xu({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),r.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(n,a){this.mouseRotate.mousedown(n,a),this.mousePitch&&this.mousePitch.mousedown(n,a),$e()}move(n,a){const f=this.map,g=this.mouseRotate.mousemoveWindow(n,a),x=g&&g.bearingDelta;if(x&&f.setBearing(f.getBearing()+x),this.mousePitch){const T=this.mousePitch.mousemoveWindow(n,a),E=T&&T.pitchDelta;E&&f.setPitch(f.getPitch()+E)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){tt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(r.e({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),at(this.element,n)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,at(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=dt(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=dt(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Tu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Lr={maxWidth:100,unit:"metric"},Do={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:r.dk,supported:N,setRTLTextPlugin:r.dm,getRTLTextPluginStatus:r.dn,Map:class extends $n{constructor(d){const n=d;if((d=r.e({},Up,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&r.d9(window)&&(d.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Nl(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._repaint=!1,this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new Fp,this._domRenderTaskQueue=new Fp,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.aC(),this._locale=r.e({},dc,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Id(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new r.da(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,this._contextCreateOptions=d.contextCreateOptions?{...d.contextCreateOptions}:{},typeof d.container=="string"){const a=document.getElementById(d.container);if(!a)throw new Error(`Container '${d.container.toString()}' not found.`);this._container=a}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),r.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._debugParams=new Cd,this._tp=d.devtools?new Jl(this):new Jl,this._tp.registerParameter(this._debugParams,["Debug"],"showOverdrawInspector",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileBoundaries",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showParseStatus",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"continuousRedraw",void 0,a=>{this.repaint=a}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileAABBs",void 0,a=>{this.showTileAABBs=a}),this._tp.registerParameter(this._debugParams,["Debug"],"showPadding",void 0,a=>{this.showPadding=a}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showTerrainWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers2DWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers3DWireframe",void 0,()=>{this._update()}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new mg(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,(d.style||!d.testMode)&&this.setStyle(d.style||r.d5.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),d.hash&&(this._hash=new _u(typeof d.hash=="string"&&d.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){n.center==null&&n.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch});const a=d.bounds;a&&(this.resize(),this.fitBounds(a,r.e({},d.fitBoundsOptions,{duration:0})))}this.resize(),d.attributionControl&&this.addControl(new Ed({customAttribution:d.customAttribution})),this._logoControl=new Op,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new r.b(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new r.b(`${a.dataType}dataloading`,a))})}_getMapId(){return this._mapId}addControl(d,n){if(n===void 0&&(n=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new r.a(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=d.onAdd(this);this._controls.push(d);const f=this._controlPositions[n];return n.indexOf("bottom")!==-1?f.insertBefore(a,f.firstChild):f.appendChild(a),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new r.a(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(d);return n>-1&&this._controls.splice(n,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new r.b("movestart",d)).fire(new r.b("move",d)),this.fire(new r.b("resize",d)),n&&this.fire(new r.b("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(r.ad.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new r.b("zoomstart")).fire(new r.b("zoom")).fire(new r.b("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new r.b("zoomstart")).fire(new r.b("zoom")).fire(new r.b("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new r.b("pitchstart")).fire(new r.b("pitch")).fire(new r.b("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new r.b("pitchstart")).fire(new r.b("pitch")).fire(new r.b("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?navigator.language:Array.isArray(d)?d.length===0?void 0:d.map(n=>n==="auto"?navigator.language:n):d}setLanguage(d){const n=this._parseLanguage(d);if(!this.style||n===this._language)return this;this._language=n,this.style.reloadSources();for(const a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const d=this.transform,n=d.projection.name;let a;n==="globe"&&d.zoom>=r.bx?(d.setMercatorFromTransition(),a=!0):n==="mercator"&&d.zoom<r.bx&&(d.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,n){return this._updateProjection(d||n||{name:"mercator"})}_updateProjection(d){let n;return n=d.name==="globe"&&this.transform.zoom>=r.bx?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),n&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(d){return this.transform.locationPoint3D(r.bn.convert(d))}unproject(d){return this.transform.pointLocation3D(r.P.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,n,a){if(d==="mouseenter"||d==="mouseover"){let f=!1;const g=T=>{const E=n.filter(D=>this.getLayer(D)),C=E.length?this.queryRenderedFeatures(T.point,{layers:E}):[];C.length?f||(f=!0,a.call(this,new Br(d,this,T.originalEvent,{features:C}))):f=!1},x=()=>{f=!1};return{layers:new Set(n),listener:a,delegates:{mousemove:g,mouseout:x}}}if(d==="mouseleave"||d==="mouseout"){let f=!1;const g=T=>{const E=n.filter(C=>this.getLayer(C));(E.length?this.queryRenderedFeatures(T.point,{layers:E}):[]).length?f=!0:f&&(f=!1,a.call(this,new Br(d,this,T.originalEvent)))},x=T=>{f&&(f=!1,a.call(this,new Br(d,this,T.originalEvent)))};return{layers:new Set(n),listener:a,delegates:{mousemove:g,mouseout:x}}}{const f=g=>{const x=n.filter(E=>this.getLayer(E)),T=x.length?this.queryRenderedFeatures(g.point,{layers:x}):[];T.length&&(g.features=T,a.call(this,g),delete g.features)};return{layers:new Set(n),listener:a,delegates:{[d]:f}}}}on(d,n,a){if(a===void 0)return super.on(d,n);if(Array.isArray(n)||(n=[n]),n){for(const g of n)if(!this._isValidId(g))return this}const f=this._createDelegatedListener(d,n,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(f);for(const g in f.delegates)this.on(g,f.delegates[g]);return this}once(d,n,a){if(a===void 0)return super.once(d,n);if(Array.isArray(n)||(n=[n]),n){for(const g of n)if(!this._isValidId(g))return this}const f=this._createDelegatedListener(d,n,a);for(const g in f.delegates)this.once(g,f.delegates[g]);return this}off(d,n,a){if(a===void 0)return super.off(d,n);n=new Set(Array.isArray(n)?n:[n]);for(const x of n)if(!this._isValidId(x))return this;const f=(x,T)=>{if(x.size!==T.size)return!1;for(const E of x)if(!T.has(E))return!1;return!0},g=this._delegatedListeners?this._delegatedListeners[d]:void 0;return g&&(x=>{for(let T=0;T<x.length;T++){const E=x[T];if(E.listener===a&&f(E.layers,n)){for(const C in E.delegates)this.off(C,E.delegates[C]);return x.splice(T,1),this}}})(g),this}queryRenderedFeatures(d,n){if(!this.style)return[];if(n!==void 0||d===void 0||d instanceof r.P||Array.isArray(d)||(n=d,d=void 0),d=d||[[0,0],[this.transform.width,this.transform.height]],(n=n||{}).layers&&Array.isArray(n.layers)){for(const a of n.layers)if(!this._isValidId(a))return[]}return this.style.queryRenderedFeatures(d,n,this.transform)}querySourceFeatures(d,n){return this._isValidId(d)?this.style.querySourceFeatures(d,n):[]}isPointOnSurface(d){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&r.w(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(d))}setStyle(d,n){return(n=r.e({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&d?(this._diffStyle(d,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(d,n))}_getUIString(d){const n=this._locale[d];if(n==null)throw new Error(`Missing UI string '${d}'`);return n}_updateStyle(d,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d&&(this.style=new Ts(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ts(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,n){if(typeof d=="string"){const a=this._requestManager.normalizeStyleURL(d),f=this._requestManager.transformRequest(a,r.R.Style);r.g(f,(g,x)=>{g?this.fire(new r.a(g)):x&&this._updateDiff(x,n)})}else typeof d=="object"&&this._updateDiff(d,n)}_updateDiff(d,n){try{this.style.setState(d)&&this._update(!0)}catch(a){r.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(d,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(d){return d==null?(this.fire(new r.a(new Error("IDs can't be empty."))),!1):!r.c4(d)||(this.fire(new r.a(new Error(`IDs can't contain special symbols: "${d}".`))),!1)}addSource(d,n){return this._isValidId(d)?(this._lazyInitEmptyStyle(),this.style.addSource(d,n),this._update(!0)):this}isSourceLoaded(d){return!!this._isValidId(d)&&!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(d,n,a){this._lazyInitEmptyStyle(),this.style.addSourceType(d,n,a)}removeSource(d){return this._isValidId(d)?(this.style.removeSource(d),this._updateTerrain(),this._update(!0)):this}getSource(d){return this._isValidId(d)?this.style.getOwnSource(d):null}addImage(d,n,{pixelRatio:a=1,sdf:f=!1,stretchX:g,stretchY:x,content:T}={}){if(this._lazyInitEmptyStyle(),n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){const{width:E,height:C,data:D}=r.f.getImageData(n);this.style.addImage(d,{data:new r.h({width:E,height:C},D),pixelRatio:a,stretchX:g,stretchY:x,content:T,sdf:f,version:0})}else if(n.width===void 0||n.height===void 0)this.fire(new r.a(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:E,height:C}=n,D=n;this.style.addImage(d,{data:new r.h({width:E,height:C},new Uint8Array(D.data)),pixelRatio:a,stretchX:g,stretchY:x,content:T,sdf:f,version:0,userImage:D}),D.onAdd&&D.onAdd(this,d)}}updateImage(d,n){this._lazyInitEmptyStyle();const a=this.style.getImage(d);if(!a)return void this.fire(new r.a(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?r.f.getImageData(n):n,{width:g,height:x}=f,T=f.data;if(g===void 0||x===void 0)return void this.fire(new r.a(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==a.data.width||x!==a.data.height)return void this.fire(new r.a(new Error(`The width and height of the updated image (${g}, ${x})
                must be that same as the previous version of the image
                (${a.data.width}, ${a.data.height})`)));const E=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);a.data.replace(T,E),this.style.updateImage(d,a)}hasImage(d){return d?!!this.style&&!!this.style.getImage(d):(this.fire(new r.a(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,n){r.d(this._requestManager.transformRequest(d,r.R.Image),(a,f)=>{n(a,f instanceof HTMLImageElement?r.f.getImageData(f):f)})}listImages(){return this.style.listImages()}addModel(d,n){this._lazyInitEmptyStyle(),this.style.addModel(d,n)}hasModel(d){return d?this.style.hasModel(d):(this.fire(new r.a(new Error("Missing required model id"))),!1)}removeModel(d){this.style.removeModel(d)}listModels(){return this.style.listModels()}addLayer(d,n){return this._isValidId(d.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(d,n),this._update(!0)):this}getSlot(d){const n=this.getLayer(d);return n&&n.slot||null}setSlot(d,n){return this.style.setSlot(d,n),this.style.mergeLayers(),this._update(!0)}addImport(d,n){return this.style.addImport(d,n),this}updateImport(d,n){return typeof n!="string"&&n.id!==d?(this.removeImport(d),this.addImport(n)):(this.style.updateImport(d,n),this._update(!0))}removeImport(d){return this.style.removeImport(d),this}moveImport(d,n){return this.style.moveImport(d,n),this._update(!0)}moveLayer(d,n){return this._isValidId(d)?(this.style.moveLayer(d,n),this._update(!0)):this}removeLayer(d){return this._isValidId(d)?(this.style.removeLayer(d),this._update(!0)):this}getLayer(d){return this._isValidId(d)?this.style.getOwnLayer(d):null}setLayerZoomRange(d,n,a){return this._isValidId(d)?(this.style.setLayerZoomRange(d,n,a),this._update(!0)):this}setFilter(d,n,a={}){return this._isValidId(d)?(this.style.setFilter(d,n,a),this._update(!0)):this}getFilter(d){return this._isValidId(d)?this.style.getFilter(d):null}setPaintProperty(d,n,a,f={}){return this._isValidId(d)?(this.style.setPaintProperty(d,n,a,f),this._update(!0)):this}getPaintProperty(d,n){return this._isValidId(d)?this.style.getPaintProperty(d,n):null}setLayoutProperty(d,n,a,f={}){return this._isValidId(d)?(this.style.setLayoutProperty(d,n,a,f),this._update(!0)):this}getLayoutProperty(d,n){return this._isValidId(d)?this.style.getLayoutProperty(d,n):null}getConfigProperty(d,n){return this.style.getConfigProperty(d,n)}setConfigProperty(d,n,a){return this.style.setConfigProperty(d,n,a),this._update(!0)}setLights(d){if(this._lazyInitEmptyStyle(),d&&d.length===1&&d[0].type==="flat"){const n=d[0];n.properties?this.style.setFlatLight(n.properties,n.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(d),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const d=this.style.getLights()||[];return d.length===0&&d.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),d}setLight(d,n={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:d}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(d){return this.style.setCamera(d),this._triggerCameraUpdate(d)}_triggerCameraUpdate(d){return this._update(this.transform.setOrthographicProjectionAtLowPitch(d["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.bn.convert(d),this.transform):0}setFeatureState(d,n){return this._isValidId(d.source)?(this.style.setFeatureState(d,n),this._update()):this}removeFeatureState(d,n){return this._isValidId(d.source)?(this.style.removeFeatureState(d,n),this._update()):this}getFeatureState(d){return this._isValidId(d.source)?this.style.getFeatureState(d):null}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let a,f,g,x=this._container;for(;x&&(!f||!g);){const T=window.getComputedStyle(x).transform;T&&T!=="none"&&(a=T.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(f=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(g=a[3])),x=x.parentElement}this._containerWidth=f?Math.abs(d/f):d,this._containerHeight=g?Math.abs(n/g):n}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=ie("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=ie("div","mapboxgl-canvas-container",d);this._canvas=ie("canvas","mapboxgl-canvas",n),this._interactive&&(n.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=ie("div","mapboxgl-control-container",d),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(g=>{f[g]=ie("div",`mapboxgl-ctrl-${g}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,n){const a=r.f.devicePixelRatio||1;this._canvas.width=a*Math.ceil(d),this._canvas.height=a*Math.ceil(n),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${n}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const n=this._markers.indexOf(d);n!==-1&&this._markers.splice(n,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){const n=this._popups.indexOf(d);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const d=r.e({},N.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",d);n?(r.db(n,!0),this.painter=new Sp(n,this._contextCreateOptions,this.transform,this._tp),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.dc.testSupport(n)):this.fire(new r.a(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.b("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new r.b("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let n;this.fire(new r.b("renderstart"));const a=this.painter.context.extTimerQuery,f=r.f.now(),g=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=g.createQuery(),g.beginQuery(a.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const C=this.transform.zoom,D=this.transform.pitch,L=r.f.now(),z=new r.K(C,{now:L,fadeDuration:x,pitch:D,transition:this.style.transition});this.style.update(z)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(f),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(f),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries||this._debugParams.showTileBoundaries,showParseStatus:this.showParseStatus||this._debugParams.showParseStatus,wireframe:{terrain:this.showTerrainWireframe||this._debugParams.showTerrainWireframe,layers2D:this.showLayers2DWireframe||this._debugParams.showLayers2DWireframe,layers3D:this.showLayers3DWireframe||this._debugParams.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector||this._debugParams.showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs||this._debugParams.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding||this._debugParams.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.b("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new r.b("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const C=r.f.now()-f;g.endQuery(a.TIME_ELAPSED_EXT),setTimeout(()=>{const D=g.getQueryParameter(n,g.QUERY_RESULT)/1e6;g.deleteQuery(n),this.fire(new r.b("gpu-timing-frame",{cpuTime:C,gpuTime:D}))},50)}if(this.listens("gpu-timing-layer")){const C=this.painter.collectGpuTimers();setTimeout(()=>{const D=this.painter.queryGpuTimers(C);this.fire(new r.b("gpu-timing-layer",{layerTimes:D}))},50)}if(this.listens("gpu-timing-deferred-render")){const C=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const D=this.painter.queryGpuTimeDeferredRender(C);this.fire(new r.b("gpu-timing-deferred-render",{gpuTime:D}))},50)}const E=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(E||this._repaint)this.triggerRepaint();else{const C=!this.isMoving()&&this.loaded();if(C&&(T=this._updateAverageElevation(f,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),C&&(this.fire(new r.b("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const D=this._calculateSpeedIndex();this.fire(new r.b("speedindexcompleted",{speedIndex:D})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||E||(this._fullyLoaded=!0,this._performanceMetricsCollection&&r.dd(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(const n of this._markers)d&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!d||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(d,n=!1){const a=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);const f=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(f||(n||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const g=this.transform.averageElevation;let x=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=d;const T=Math.abs(g-x);if(T>1){if(this._isInitialLoad||f)return this._averageElevation.jumpTo(x),a(x);this._averageElevation.easeTo(x,d,300)}else if(T>1e-4)return this._averageElevation.jumpTo(x),a(x)}return!!this._averageElevation.isEasing(d)&&a(this._averageElevation.getValue(d))}_authenticate(){r.de(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===r.df||d.status===401)){const n=this.painter.context.gl;r.db(n,!1),this._logoControl instanceof Op&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.a(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),r.dg(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const a=this.painter.context.gl,f=a.createFramebuffer();function g(x){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,x,0);const T=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,T),T}return a.bindFramebuffer(a.FRAMEBUFFER,f),this._canvasPixelComparison(g(d),n.canvasCopies.map(g),n.timeStamps)}_canvasPixelComparison(d,n,a){let f=a[1]-a[0];const g=d.length/4;for(let x=0;x<n.length;x++){const T=n[x];let E=0;for(let C=0;C<T.length;C+=4)T[C]===d[C]&&T[C+1]===d[C+1]&&T[C+2]===d[C+2]&&T[C+3]===d[C+3]&&(E+=1);f+=(a[x+2]-a[x+1])*(1-E/g)}return f}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),r.dh(this.painter.context.gl),r.di.remove(),r.dj.remove(),this._removed=!0,this.fire(new r.b("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=r.f.frame(n=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(n)}))}_preloadTiles(d){const n=this.style?Object.values(this.style._sourceCaches):[];return r.b1(n,(a,f)=>a._preloadTiles(d,f),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(d){this._showParseStatus!==d&&(this._showParseStatus=d,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(d){this._showLayers2DWireframe!==d&&(this._showLayers2DWireframe=d,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(d){this._showLayers3DWireframe!==d&&(this._showLayers3DWireframe=d,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,d&&this._update())}_setCacheLimits(d,n){r.dl(d,n)}get version(){return r.dk}},NavigationControl:class{constructor(d){this.options=r.e({},wu,d),this._container=ie("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(r.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),ie("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),ie("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:n}):a.resetNorth({},{originalEvent:n}))}),this._compassIcon=ie("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map;if(!d)return;const n=d.getZoom(),a=n===d.getMaxZoom(),f=n===d.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())}_rotateCompassArrow(){const d=this._map;if(!d)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ys(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){const d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,n){const a=ie("button",d,this._container);return a.type="button",a.addEventListener("click",n),a}_setButtonTitle(d,n){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${n}`);d.setAttribute("aria-label",a),d.firstElementChild&&d.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends r.E{constructor(d){super();const n=navigator.geolocation;this.options=r.e({geolocation:n},Tu,d),r.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ec(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=ie("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){const n=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,d(a)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(a=>n(a.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(d){const n=this._map.getMaxBounds(),a=d.coords;return!!n&&(a.longitude<n.getWest()||a.longitude>n.getEast()||a.latitude<n.getSouth()||a.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new r.b("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.b("geolocate",d)),this._finish()}}_updateCamera(d){const n=new r.bn(d.coords.longitude,d.coords.latitude),a=d.coords.accuracy,f=this._map.getBearing(),g=r.e({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(a),g,{geolocateSource:!0})}_updateMarker(d){if(d){const n=new r.bn(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map.transform,n=r.bl(1,d._center.lat)*d.worldSize,a=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.b("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=ie("button","mapboxgl-ctrl-geolocate",this._container),ie("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ie("div","mapboxgl-user-location"),this._dotElement.appendChild(ie("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ie("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ad({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ie("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ad({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.b("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.b("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.b("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.b("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ed,ScaleControl:class{constructor(d){this.options=r.e({},Lr,d),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const d=this.options.maxWidth||100,n=this._map,a=n._containerHeight/2,f=n._containerWidth/2-d/2,g=n.unproject([f,a]),x=n.unproject([f+d,a]),T=g.distanceTo(x);if(this.options.unit==="imperial"){const E=3.2808*T;E>5280?this._setScale(d,E/5280,"mile"):this._setScale(d,E,"foot")}else this.options.unit==="nautical"?this._setScale(d,T/1852,"nautical-mile"):T>=1e3?this._setScale(d,T/1e3,"kilometer"):this._setScale(d,T,"meter")}_setScale(d,n,a){this._map._requestDomTask(()=>{const f=function(x){const T=Math.pow(10,`${Math.floor(x)}`.length-1);let E=x/T;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(C){const D=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*D)/D}(E),T*E}(n),g=f/n;this._container.innerHTML=this._isNumberFormatSupported&&a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(f):`${f}&nbsp;${Do[a]}`,this._container.style.width=d*g+"px"})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=ie("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:r.w("Full screen control 'container' must be a DOM element.")),r.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=ie("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=ie("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ie("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.E{constructor(d){super(),this.options=r.e(Object.create(Bp),d),r.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new r.b("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new r.b("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=r.bn.convert(d),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const n=document.createDocumentFragment(),a=document.createElement("body");let f;for(a.innerHTML=d;f=a.firstChild,f;)n.appendChild(f);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=ie("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(d),this.options.closeButton){const a=this._closeButton=ie("button","mapboxgl-popup-close-button",n);a.type="button",a.setAttribute("aria-label","Close popup"),a.setAttribute("aria-hidden","true"),a.innerHTML="&#215;",a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let n;return this._classList.delete(d)?n=!1:(this._classList.add(d),n=!0),this._updateClassList(),n}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const n=this._map,a=this._container,f=this._pos;if(!n||!a||!f)return"bottom";const g=a.offsetWidth,x=a.offsetHeight,T=f.x<g/2,E=f.x>n.transform.width-g/2;if(f.y+d<x)return T?"top-left":E?"top-right":"top";if(f.y>n.transform.height-x){if(T)return"bottom-left";if(E)return"bottom-right"}return T?"left":E?"right":"bottom"}_updateClassList(){const d=this._container;if(!d)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),d.className=n.join(" ")}_update(d){const n=this._map,a=this._content;if(!n||!this._lngLat&&!this._trackPointer||!a)return;let f=this._container;if(f||(f=this._container=ie("div","mapboxgl-popup",n.getContainer()),this._tip=ie("div","mapboxgl-popup-tip",f),f.appendChild(a)),this.options.maxWidth&&f.style.maxWidth!==this.options.maxWidth&&(f.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=hc(this._lngLat,this._pos,n.transform)),!this._trackPointer||d){const g=this._pos=this._trackPointer&&d?d:n.project(this._lngLat),x=Vp(this.options.offset),T=this._anchor=this._getAnchor(x.y),E=Vp(this.options.offset,T),C=g.add(E).round();n._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${bu[T]} translate(${C.x}px,${C.y}px)`)})}if(!this._marker&&n._showingGlobe()){const g=r.d6(n.transform,this._lngLat)?0:1;this._setOpacity(g)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(Np);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:Ad,Style:Ts,LngLat:r.bn,LngLatBounds:r.ad,Point:r.P,MercatorCoordinate:r.L,FreeCameraOptions:Fl,Evented:r.E,config:r.d5,prewarm:r.dp,clearPrewarmedResources:r.dq,get accessToken(){return r.d5.ACCESS_TOKEN},set accessToken(d){r.d5.ACCESS_TOKEN=d},get baseApiUrl(){return r.d5.API_URL},set baseApiUrl(d){r.d5.API_URL=d},get workerCount(){return r.dr.workerCount},set workerCount(d){r.dr.workerCount=d},get maxParallelImageRequests(){return r.d5.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){r.d5.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){r.ds(d)},get workerUrl(){return r.dt.workerUrl},set workerUrl(d){r.dt.workerUrl=d},get workerClass(){return r.dt.workerClass},set workerClass(d){r.dt.workerClass=d},get workerParams(){return r.dt.workerParams},set workerParams(d){r.dt.workerParams=d},get dracoUrl(){return r.du()},set dracoUrl(d){r.dv(d)},get meshoptUrl(){return r.dw()},set meshoptUrl(d){r.dx(d)},setNow:r.f.setNow,restoreNow:r.f.restoreNow}});var A=v;return A})})(SS);var LL=SS.exports;const AS=MS(LL);var IS={exports:{}};/* @license
Papa Parse
v5.4.1
https://github.com/mholt/PapaParse
License: MIT
*/(function(l,o){(function(u,m){l.exports=m()})(TS,function u(){var m=typeof self<"u"?self:typeof window<"u"?window:m!==void 0?m:{},_=!m.document&&!!m.postMessage,v=m.IS_PAPA_WORKER||!1,M={},A=0,r={parse:function(xe,le){var Je=(le=le||{}).dynamicTyping||!1;if(dt(Je)&&(le.dynamicTypingFunction=Je,Je={}),le.dynamicTyping=Je,le.transform=!!dt(le.transform)&&le.transform,le.worker&&r.WORKERS_SUPPORTED){var Mt=function(){if(!r.WORKERS_SUPPORTED)return!1;var Zt=(qe=m.URL||m.webkitURL||null,si=u.toString(),r.BLOB_URL||(r.BLOB_URL=qe.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",si,")();"],{type:"text/javascript"})))),xi=new m.Worker(Zt),qe,si;return xi.onmessage=$e,xi.id=A++,M[xi.id]=xi}();return Mt.userStep=le.step,Mt.userChunk=le.chunk,Mt.userComplete=le.complete,Mt.userError=le.error,le.step=dt(le.step),le.chunk=dt(le.chunk),le.complete=dt(le.complete),le.error=dt(le.error),delete le.worker,void Mt.postMessage({input:xe,config:le,workerId:Mt.id})}var Qe=null;return r.NODE_STREAM_INPUT,typeof xe=="string"?(xe=function(Zt){return Zt.charCodeAt(0)===65279?Zt.slice(1):Zt}(xe),Qe=le.download?new G(le):new ie(le)):xe.readable===!0&&dt(xe.read)&&dt(xe.on)?Qe=new pe(le):(m.File&&xe instanceof File||xe instanceof Object)&&(Qe=new K(le)),Qe.stream(xe)},unparse:function(xe,le){var Je=!1,Mt=!0,Qe=",",Zt=`\r
`,xi='"',qe=xi+xi,si=!1,yt=null,wt=!1;(function(){if(typeof le=="object"){if(typeof le.delimiter!="string"||r.BAD_DELIMITERS.filter(function(Nt){return le.delimiter.indexOf(Nt)!==-1}).length||(Qe=le.delimiter),(typeof le.quotes=="boolean"||typeof le.quotes=="function"||Array.isArray(le.quotes))&&(Je=le.quotes),typeof le.skipEmptyLines!="boolean"&&typeof le.skipEmptyLines!="string"||(si=le.skipEmptyLines),typeof le.newline=="string"&&(Zt=le.newline),typeof le.quoteChar=="string"&&(xi=le.quoteChar),typeof le.header=="boolean"&&(Mt=le.header),Array.isArray(le.columns)){if(le.columns.length===0)throw new Error("Option columns is empty");yt=le.columns}le.escapeChar!==void 0&&(qe=le.escapeChar+xi),(typeof le.escapeFormulae=="boolean"||le.escapeFormulae instanceof RegExp)&&(wt=le.escapeFormulae instanceof RegExp?le.escapeFormulae:/^[=+\-@\t\r].*$/)}})();var Qt=new RegExp(Te(xi),"g");if(typeof xe=="string"&&(xe=JSON.parse(xe)),Array.isArray(xe)){if(!xe.length||Array.isArray(xe[0]))return bn(null,xe,si);if(typeof xe[0]=="object")return bn(yt||Object.keys(xe[0]),xe,si)}else if(typeof xe=="object")return typeof xe.data=="string"&&(xe.data=JSON.parse(xe.data)),Array.isArray(xe.data)&&(xe.fields||(xe.fields=xe.meta&&xe.meta.fields||yt),xe.fields||(xe.fields=Array.isArray(xe.data[0])?xe.fields:typeof xe.data[0]=="object"?Object.keys(xe.data[0]):[]),Array.isArray(xe.data[0])||typeof xe.data[0]=="object"||(xe.data=[xe.data])),bn(xe.fields||[],xe.data||[],si);throw new Error("Unable to serialize unrecognized input");function bn(Nt,Qi,xn){var un="";typeof Nt=="string"&&(Nt=JSON.parse(Nt)),typeof Qi=="string"&&(Qi=JSON.parse(Qi));var en=Array.isArray(Nt)&&0<Nt.length,Ln=!Array.isArray(Qi[0]);if(en&&Mt){for(var In=0;In<Nt.length;In++)0<In&&(un+=Qe),un+=Ji(Nt[In],In);0<Qi.length&&(un+=Zt)}for(var hi=0;hi<Qi.length;hi++){var Ei=en?Nt.length:Qi[hi].length,on=!1,hn=en?Object.keys(Qi[hi]).length===0:Qi[hi].length===0;if(xn&&!en&&(on=xn==="greedy"?Qi[hi].join("").trim()==="":Qi[hi].length===1&&Qi[hi][0].length===0),xn==="greedy"&&en){for(var ye=[],we=0;we<Ei;we++){var Ge=Ln?Nt[we]:we;ye.push(Qi[hi][Ge])}on=ye.join("").trim()===""}if(!on){for(var nt=0;nt<Ei;nt++){0<nt&&!hn&&(un+=Qe);var ft=en&&Ln?Nt[nt]:nt;un+=Ji(Qi[hi][ft],nt)}hi<Qi.length-1&&(!xn||0<Ei&&!hn)&&(un+=Zt)}}return un}function Ji(Nt,Qi){if(Nt==null)return"";if(Nt.constructor===Date)return JSON.stringify(Nt).slice(1,25);var xn=!1;wt&&typeof Nt=="string"&&wt.test(Nt)&&(Nt="'"+Nt,xn=!0);var un=Nt.toString().replace(Qt,qe);return(xn=xn||Je===!0||typeof Je=="function"&&Je(Nt,Qi)||Array.isArray(Je)&&Je[Qi]||function(en,Ln){for(var In=0;In<Ln.length;In++)if(-1<en.indexOf(Ln[In]))return!0;return!1}(un,r.BAD_DELIMITERS)||-1<un.indexOf(Qe)||un.charAt(0)===" "||un.charAt(un.length-1)===" ")?xi+un+xi:un}}};if(r.RECORD_SEP="",r.UNIT_SEP="",r.BYTE_ORDER_MARK="\uFEFF",r.BAD_DELIMITERS=["\r",`
`,'"',r.BYTE_ORDER_MARK],r.WORKERS_SUPPORTED=!_&&!!m.Worker,r.NODE_STREAM_INPUT=1,r.LocalChunkSize=10485760,r.RemoteChunkSize=5242880,r.DefaultDelimiter=",",r.Parser=Re,r.ParserHandle=ge,r.NetworkStreamer=G,r.FileStreamer=K,r.StringStreamer=ie,r.ReadableStreamStreamer=pe,m.jQuery){var k=m.jQuery;k.fn.parse=function(xe){var le=xe.config||{},Je=[];return this.each(function(Zt){if(!(k(this).prop("tagName").toUpperCase()==="INPUT"&&k(this).attr("type").toLowerCase()==="file"&&m.FileReader)||!this.files||this.files.length===0)return!0;for(var xi=0;xi<this.files.length;xi++)Je.push({file:this.files[xi],inputElem:this,instanceConfig:k.extend({},le)})}),Mt(),this;function Mt(){if(Je.length!==0){var Zt,xi,qe,si,yt=Je[0];if(dt(xe.before)){var wt=xe.before(yt.file,yt.inputElem);if(typeof wt=="object"){if(wt.action==="abort")return Zt="AbortError",xi=yt.file,qe=yt.inputElem,si=wt.reason,void(dt(xe.error)&&xe.error({name:Zt},xi,qe,si));if(wt.action==="skip")return void Qe();typeof wt.config=="object"&&(yt.instanceConfig=k.extend(yt.instanceConfig,wt.config))}else if(wt==="skip")return void Qe()}var Qt=yt.instanceConfig.complete;yt.instanceConfig.complete=function(bn){dt(Qt)&&Qt(bn,yt.file,yt.inputElem),Qe()},r.parse(yt.file,yt.instanceConfig)}else dt(xe.complete)&&xe.complete()}function Qe(){Je.splice(0,1),Mt()}}}function N(xe){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(le){var Je=ot(le);Je.chunkSize=parseInt(Je.chunkSize),le.step||le.chunk||(Je.chunkSize=null),this._handle=new ge(Je),(this._handle.streamer=this)._config=Je}).call(this,xe),this.parseChunk=function(le,Je){if(this.isFirstChunk&&dt(this._config.beforeFirstChunk)){var Mt=this._config.beforeFirstChunk(le);Mt!==void 0&&(le=Mt)}this.isFirstChunk=!1,this._halted=!1;var Qe=this._partialLine+le;this._partialLine="";var Zt=this._handle.parse(Qe,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var xi=Zt.meta.cursor;this._finished||(this._partialLine=Qe.substring(xi-this._baseIndex),this._baseIndex=xi),Zt&&Zt.data&&(this._rowCount+=Zt.data.length);var qe=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(v)m.postMessage({results:Zt,workerId:r.WORKER_ID,finished:qe});else if(dt(this._config.chunk)&&!Je){if(this._config.chunk(Zt,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);Zt=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(Zt.data),this._completeResults.errors=this._completeResults.errors.concat(Zt.errors),this._completeResults.meta=Zt.meta),this._completed||!qe||!dt(this._config.complete)||Zt&&Zt.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),qe||Zt&&Zt.meta.paused||this._nextChunk(),Zt}this._halted=!0},this._sendError=function(le){dt(this._config.error)?this._config.error(le):v&&this._config.error&&m.postMessage({workerId:r.WORKER_ID,error:le,finished:!1})}}function G(xe){var le;(xe=xe||{}).chunkSize||(xe.chunkSize=r.RemoteChunkSize),N.call(this,xe),this._nextChunk=_?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(Je){this._input=Je,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(le=new XMLHttpRequest,this._config.withCredentials&&(le.withCredentials=this._config.withCredentials),_||(le.onload=at(this._chunkLoaded,this),le.onerror=at(this._chunkError,this)),le.open(this._config.downloadRequestBody?"POST":"GET",this._input,!_),this._config.downloadRequestHeaders){var Je=this._config.downloadRequestHeaders;for(var Mt in Je)le.setRequestHeader(Mt,Je[Mt])}if(this._config.chunkSize){var Qe=this._start+this._config.chunkSize-1;le.setRequestHeader("Range","bytes="+this._start+"-"+Qe)}try{le.send(this._config.downloadRequestBody)}catch(Zt){this._chunkError(Zt.message)}_&&le.status===0&&this._chunkError()}},this._chunkLoaded=function(){le.readyState===4&&(le.status<200||400<=le.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:le.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(Je){var Mt=Je.getResponseHeader("Content-Range");return Mt===null?-1:parseInt(Mt.substring(Mt.lastIndexOf("/")+1))}(le),this.parseChunk(le.responseText)))},this._chunkError=function(Je){var Mt=le.statusText||Je;this._sendError(new Error(Mt))}}function K(xe){var le,Je;(xe=xe||{}).chunkSize||(xe.chunkSize=r.LocalChunkSize),N.call(this,xe);var Mt=typeof FileReader<"u";this.stream=function(Qe){this._input=Qe,Je=Qe.slice||Qe.webkitSlice||Qe.mozSlice,Mt?((le=new FileReader).onload=at(this._chunkLoaded,this),le.onerror=at(this._chunkError,this)):le=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var Qe=this._input;if(this._config.chunkSize){var Zt=Math.min(this._start+this._config.chunkSize,this._input.size);Qe=Je.call(Qe,this._start,Zt)}var xi=le.readAsText(Qe,this._config.encoding);Mt||this._chunkLoaded({target:{result:xi}})},this._chunkLoaded=function(Qe){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(Qe.target.result)},this._chunkError=function(){this._sendError(le.error)}}function ie(xe){var le;N.call(this,xe=xe||{}),this.stream=function(Je){return le=Je,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var Je,Mt=this._config.chunkSize;return Mt?(Je=le.substring(0,Mt),le=le.substring(Mt)):(Je=le,le=""),this._finished=!le,this.parseChunk(Je)}}}function pe(xe){N.call(this,xe=xe||{});var le=[],Je=!0,Mt=!1;this.pause=function(){N.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){N.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(Qe){this._input=Qe,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){Mt&&le.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),le.length?this.parseChunk(le.shift()):Je=!0},this._streamData=at(function(Qe){try{le.push(typeof Qe=="string"?Qe:Qe.toString(this._config.encoding)),Je&&(Je=!1,this._checkIsFinished(),this.parseChunk(le.shift()))}catch(Zt){this._streamError(Zt)}},this),this._streamError=at(function(Qe){this._streamCleanUp(),this._sendError(Qe)},this),this._streamEnd=at(function(){this._streamCleanUp(),Mt=!0,this._streamData("")},this),this._streamCleanUp=at(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function ge(xe){var le,Je,Mt,Qe=Math.pow(2,53),Zt=-Qe,xi=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,qe=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,si=this,yt=0,wt=0,Qt=!1,bn=!1,Ji=[],Nt={data:[],errors:[],meta:{}};if(dt(xe.step)){var Qi=xe.step;xe.step=function(hi){if(Nt=hi,en())un();else{if(un(),Nt.data.length===0)return;yt+=hi.data.length,xe.preview&&yt>xe.preview?Je.abort():(Nt.data=Nt.data[0],Qi(Nt,si))}}}function xn(hi){return xe.skipEmptyLines==="greedy"?hi.join("").trim()==="":hi.length===1&&hi[0].length===0}function un(){return Nt&&Mt&&(In("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+r.DefaultDelimiter+"'"),Mt=!1),xe.skipEmptyLines&&(Nt.data=Nt.data.filter(function(hi){return!xn(hi)})),en()&&function(){if(!Nt)return;function hi(on,hn){dt(xe.transformHeader)&&(on=xe.transformHeader(on,hn)),Ji.push(on)}if(Array.isArray(Nt.data[0])){for(var Ei=0;en()&&Ei<Nt.data.length;Ei++)Nt.data[Ei].forEach(hi);Nt.data.splice(0,1)}else Nt.data.forEach(hi)}(),function(){if(!Nt||!xe.header&&!xe.dynamicTyping&&!xe.transform)return Nt;function hi(on,hn){var ye,we=xe.header?{}:[];for(ye=0;ye<on.length;ye++){var Ge=ye,nt=on[ye];xe.header&&(Ge=ye>=Ji.length?"__parsed_extra":Ji[ye]),xe.transform&&(nt=xe.transform(nt,Ge)),nt=Ln(Ge,nt),Ge==="__parsed_extra"?(we[Ge]=we[Ge]||[],we[Ge].push(nt)):we[Ge]=nt}return xe.header&&(ye>Ji.length?In("FieldMismatch","TooManyFields","Too many fields: expected "+Ji.length+" fields but parsed "+ye,wt+hn):ye<Ji.length&&In("FieldMismatch","TooFewFields","Too few fields: expected "+Ji.length+" fields but parsed "+ye,wt+hn)),we}var Ei=1;return!Nt.data.length||Array.isArray(Nt.data[0])?(Nt.data=Nt.data.map(hi),Ei=Nt.data.length):Nt.data=hi(Nt.data,0),xe.header&&Nt.meta&&(Nt.meta.fields=Ji),wt+=Ei,Nt}()}function en(){return xe.header&&Ji.length===0}function Ln(hi,Ei){return on=hi,xe.dynamicTypingFunction&&xe.dynamicTyping[on]===void 0&&(xe.dynamicTyping[on]=xe.dynamicTypingFunction(on)),(xe.dynamicTyping[on]||xe.dynamicTyping)===!0?Ei==="true"||Ei==="TRUE"||Ei!=="false"&&Ei!=="FALSE"&&(function(hn){if(xi.test(hn)){var ye=parseFloat(hn);if(Zt<ye&&ye<Qe)return!0}return!1}(Ei)?parseFloat(Ei):qe.test(Ei)?new Date(Ei):Ei===""?null:Ei):Ei;var on}function In(hi,Ei,on,hn){var ye={type:hi,code:Ei,message:on};hn!==void 0&&(ye.row=hn),Nt.errors.push(ye)}this.parse=function(hi,Ei,on){var hn=xe.quoteChar||'"';if(xe.newline||(xe.newline=function(Ge,nt){Ge=Ge.substring(0,1048576);var ft=new RegExp(Te(nt)+"([^]*?)"+Te(nt),"gm"),Ct=(Ge=Ge.replace(ft,"")).split("\r"),Gt=Ge.split(`
`),mt=1<Gt.length&&Gt[0].length<Ct[0].length;if(Ct.length===1||mt)return`
`;for(var zt=0,ct=0;ct<Ct.length;ct++)Ct[ct][0]===`
`&&zt++;return zt>=Ct.length/2?`\r
`:"\r"}(hi,hn)),Mt=!1,xe.delimiter)dt(xe.delimiter)&&(xe.delimiter=xe.delimiter(hi),Nt.meta.delimiter=xe.delimiter);else{var ye=function(Ge,nt,ft,Ct,Gt){var mt,zt,ct,kt;Gt=Gt||[",","	","|",";",r.RECORD_SEP,r.UNIT_SEP];for(var li=0;li<Gt.length;li++){var $t=Gt[li],Ce=0,Z=0,ne=0;ct=void 0;for(var he=new Re({comments:Ct,delimiter:$t,newline:nt,preview:10}).parse(Ge),Le=0;Le<he.data.length;Le++)if(ft&&xn(he.data[Le]))ne++;else{var Ve=he.data[Le].length;Z+=Ve,ct!==void 0?0<Ve&&(Ce+=Math.abs(Ve-ct),ct=Ve):ct=Ve}0<he.data.length&&(Z/=he.data.length-ne),(zt===void 0||Ce<=zt)&&(kt===void 0||kt<Z)&&1.99<Z&&(zt=Ce,mt=$t,kt=Z)}return{successful:!!(xe.delimiter=mt),bestDelimiter:mt}}(hi,xe.newline,xe.skipEmptyLines,xe.comments,xe.delimitersToGuess);ye.successful?xe.delimiter=ye.bestDelimiter:(Mt=!0,xe.delimiter=r.DefaultDelimiter),Nt.meta.delimiter=xe.delimiter}var we=ot(xe);return xe.preview&&xe.header&&we.preview++,le=hi,Je=new Re(we),Nt=Je.parse(le,Ei,on),un(),Qt?{meta:{paused:!0}}:Nt||{meta:{paused:!1}}},this.paused=function(){return Qt},this.pause=function(){Qt=!0,Je.abort(),le=dt(xe.chunk)?"":le.substring(Je.getCharIndex())},this.resume=function(){si.streamer._halted?(Qt=!1,si.streamer.parseChunk(le,!0)):setTimeout(si.resume,3)},this.aborted=function(){return bn},this.abort=function(){bn=!0,Je.abort(),Nt.meta.aborted=!0,dt(xe.complete)&&xe.complete(Nt),le=""}}function Te(xe){return xe.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Re(xe){var le,Je=(xe=xe||{}).delimiter,Mt=xe.newline,Qe=xe.comments,Zt=xe.step,xi=xe.preview,qe=xe.fastMode,si=le=xe.quoteChar===void 0||xe.quoteChar===null?'"':xe.quoteChar;if(xe.escapeChar!==void 0&&(si=xe.escapeChar),(typeof Je!="string"||-1<r.BAD_DELIMITERS.indexOf(Je))&&(Je=","),Qe===Je)throw new Error("Comment character same as delimiter");Qe===!0?Qe="#":(typeof Qe!="string"||-1<r.BAD_DELIMITERS.indexOf(Qe))&&(Qe=!1),Mt!==`
`&&Mt!=="\r"&&Mt!==`\r
`&&(Mt=`
`);var yt=0,wt=!1;this.parse=function(Qt,bn,Ji){if(typeof Qt!="string")throw new Error("Input must be a string");var Nt=Qt.length,Qi=Je.length,xn=Mt.length,un=Qe.length,en=dt(Zt),Ln=[],In=[],hi=[],Ei=yt=0;if(!Qt)return Xe();if(xe.header&&!bn){var on=Qt.split(Mt)[0].split(Je),hn=[],ye={},we=!1;for(var Ge in on){var nt=on[Ge];dt(xe.transformHeader)&&(nt=xe.transformHeader(nt,Ge));var ft=nt,Ct=ye[nt]||0;for(0<Ct&&(we=!0,ft=nt+"_"+Ct),ye[nt]=Ct+1;hn.includes(ft);)ft=ft+"_"+Ct;hn.push(ft)}if(we){var Gt=Qt.split(Mt);Gt[0]=hn.join(Je),Qt=Gt.join(Mt)}}if(qe||qe!==!1&&Qt.indexOf(le)===-1){for(var mt=Qt.split(Mt),zt=0;zt<mt.length;zt++){if(hi=mt[zt],yt+=hi.length,zt!==mt.length-1)yt+=Mt.length;else if(Ji)return Xe();if(!Qe||hi.substring(0,un)!==Qe){if(en){if(Ln=[],ne(hi.split(Je)),Ot(),wt)return Xe()}else ne(hi.split(Je));if(xi&&xi<=zt)return Ln=Ln.slice(0,xi),Xe(!0)}}return Xe()}for(var ct=Qt.indexOf(Je,yt),kt=Qt.indexOf(Mt,yt),li=new RegExp(Te(si)+Te(le),"g"),$t=Qt.indexOf(le,yt);;)if(Qt[yt]!==le)if(Qe&&hi.length===0&&Qt.substring(yt,yt+un)===Qe){if(kt===-1)return Xe();yt=kt+xn,kt=Qt.indexOf(Mt,yt),ct=Qt.indexOf(Je,yt)}else if(ct!==-1&&(ct<kt||kt===-1))hi.push(Qt.substring(yt,ct)),yt=ct+Qi,ct=Qt.indexOf(Je,yt);else{if(kt===-1)break;if(hi.push(Qt.substring(yt,kt)),Ve(kt+xn),en&&(Ot(),wt))return Xe();if(xi&&Ln.length>=xi)return Xe(!0)}else for($t=yt,yt++;;){if(($t=Qt.indexOf(le,$t+1))===-1)return Ji||In.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:Ln.length,index:yt}),Le();if($t===Nt-1)return Le(Qt.substring(yt,$t).replace(li,le));if(le!==si||Qt[$t+1]!==si){if(le===si||$t===0||Qt[$t-1]!==si){ct!==-1&&ct<$t+1&&(ct=Qt.indexOf(Je,$t+1)),kt!==-1&&kt<$t+1&&(kt=Qt.indexOf(Mt,$t+1));var Ce=he(kt===-1?ct:Math.min(ct,kt));if(Qt.substr($t+1+Ce,Qi)===Je){hi.push(Qt.substring(yt,$t).replace(li,le)),Qt[yt=$t+1+Ce+Qi]!==le&&($t=Qt.indexOf(le,yt)),ct=Qt.indexOf(Je,yt),kt=Qt.indexOf(Mt,yt);break}var Z=he(kt);if(Qt.substring($t+1+Z,$t+1+Z+xn)===Mt){if(hi.push(Qt.substring(yt,$t).replace(li,le)),Ve($t+1+Z+xn),ct=Qt.indexOf(Je,yt),$t=Qt.indexOf(le,yt),en&&(Ot(),wt))return Xe();if(xi&&Ln.length>=xi)return Xe(!0);break}In.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:Ln.length,index:yt}),$t++}}else $t++}return Le();function ne(Be){Ln.push(Be),Ei=yt}function he(Be){var Vt=0;if(Be!==-1){var Tt=Qt.substring($t+1,Be);Tt&&Tt.trim()===""&&(Vt=Tt.length)}return Vt}function Le(Be){return Ji||(Be===void 0&&(Be=Qt.substring(yt)),hi.push(Be),yt=Nt,ne(hi),en&&Ot()),Xe()}function Ve(Be){yt=Be,ne(hi),hi=[],kt=Qt.indexOf(Mt,yt)}function Xe(Be){return{data:Ln,errors:In,meta:{delimiter:Je,linebreak:Mt,aborted:wt,truncated:!!Be,cursor:Ei+(bn||0)}}}function Ot(){Zt(Xe()),Ln=[],In=[]}},this.abort=function(){wt=!0},this.getCharIndex=function(){return yt}}function $e(xe){var le=xe.data,Je=M[le.workerId],Mt=!1;if(le.error)Je.userError(le.error,le.file);else if(le.results&&le.results.data){var Qe={abort:function(){Mt=!0,tt(le.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:ut,resume:ut};if(dt(Je.userStep)){for(var Zt=0;Zt<le.results.data.length&&(Je.userStep({data:le.results.data[Zt],errors:le.results.errors,meta:le.results.meta},Qe),!Mt);Zt++);delete le.results}else dt(Je.userChunk)&&(Je.userChunk(le.results,Qe,le.file),delete le.results)}le.finished&&!Mt&&tt(le.workerId,le.results)}function tt(xe,le){var Je=M[xe];dt(Je.userComplete)&&Je.userComplete(le),Je.terminate(),delete M[xe]}function ut(){throw new Error("Not implemented.")}function ot(xe){if(typeof xe!="object"||xe===null)return xe;var le=Array.isArray(xe)?[]:{};for(var Je in xe)le[Je]=ot(xe[Je]);return le}function at(xe,le){return function(){xe.apply(le,arguments)}}function dt(xe){return typeof xe=="function"}return v&&(m.onmessage=function(xe){var le=xe.data;if(r.WORKER_ID===void 0&&le&&(r.WORKER_ID=le.workerId),typeof le.input=="string")m.postMessage({workerId:r.WORKER_ID,results:r.parse(le.input,le.config),finished:!0});else if(m.File&&le.input instanceof File||le.input instanceof Object){var Je=r.parse(le.input,le.config);Je&&m.postMessage({workerId:r.WORKER_ID,results:Je,finished:!0})}}),(G.prototype=Object.create(N.prototype)).constructor=G,(K.prototype=Object.create(N.prototype)).constructor=K,(ie.prototype=Object.create(ie.prototype)).constructor=ie,(pe.prototype=Object.create(N.prototype)).constructor=pe,r})})(IS);var kL=IS.exports;const RL=MS(kL);/*!
 * @kurkle/color v0.3.2
 * https://github.com/kurkle/color#readme
 * (c) 2023 Jukka Kurkela
 * Released under the MIT License
 */function Gf(l){return l+.5|0}const ml=(l,o,u)=>Math.max(Math.min(l,u),o);function pf(l){return ml(Gf(l*2.55),0,255)}function wl(l){return ml(Gf(l*255),0,255)}function ga(l){return ml(Gf(l/2.55)/100,0,1)}function tT(l){return ml(Gf(l*100),0,100)}const Us={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},_0=[..."0123456789ABCDEF"],zL=l=>_0[l&15],OL=l=>_0[(l&240)>>4]+_0[l&15],$m=l=>(l&240)>>4===(l&15),FL=l=>$m(l.r)&&$m(l.g)&&$m(l.b)&&$m(l.a);function BL(l){var o=l.length,u;return l[0]==="#"&&(o===4||o===5?u={r:255&Us[l[1]]*17,g:255&Us[l[2]]*17,b:255&Us[l[3]]*17,a:o===5?Us[l[4]]*17:255}:(o===7||o===9)&&(u={r:Us[l[1]]<<4|Us[l[2]],g:Us[l[3]]<<4|Us[l[4]],b:Us[l[5]]<<4|Us[l[6]],a:o===9?Us[l[7]]<<4|Us[l[8]]:255})),u}const NL=(l,o)=>l<255?o(l):"";function VL(l){var o=FL(l)?zL:OL;return l?"#"+o(l.r)+o(l.g)+o(l.b)+NL(l.a,o):void 0}const UL=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function CS(l,o,u){const m=o*Math.min(u,1-u),_=(v,M=(v+l/30)%12)=>u-m*Math.max(Math.min(M-3,9-M,1),-1);return[_(0),_(8),_(4)]}function jL(l,o,u){const m=(_,v=(_+l/60)%6)=>u-u*o*Math.max(Math.min(v,4-v,1),0);return[m(5),m(3),m(1)]}function GL(l,o,u){const m=CS(l,1,.5);let _;for(o+u>1&&(_=1/(o+u),o*=_,u*=_),_=0;_<3;_++)m[_]*=1-o-u,m[_]+=o;return m}function $L(l,o,u,m,_){return l===_?(o-u)/m+(o<u?6:0):o===_?(u-l)/m+2:(l-o)/m+4}function Q0(l){const u=l.r/255,m=l.g/255,_=l.b/255,v=Math.max(u,m,_),M=Math.min(u,m,_),A=(v+M)/2;let r,k,N;return v!==M&&(N=v-M,k=A>.5?N/(2-v-M):N/(v+M),r=$L(u,m,_,N,v),r=r*60+.5),[r|0,k||0,A]}function ex(l,o,u,m){return(Array.isArray(o)?l(o[0],o[1],o[2]):l(o,u,m)).map(wl)}function tx(l,o,u){return ex(CS,l,o,u)}function WL(l,o,u){return ex(GL,l,o,u)}function HL(l,o,u){return ex(jL,l,o,u)}function PS(l){return(l%360+360)%360}function qL(l){const o=UL.exec(l);let u=255,m;if(!o)return;o[5]!==m&&(u=o[6]?pf(+o[5]):wl(+o[5]));const _=PS(+o[2]),v=+o[3]/100,M=+o[4]/100;return o[1]==="hwb"?m=WL(_,v,M):o[1]==="hsv"?m=HL(_,v,M):m=tx(_,v,M),{r:m[0],g:m[1],b:m[2],a:u}}function ZL(l,o){var u=Q0(l);u[0]=PS(u[0]+o),u=tx(u),l.r=u[0],l.g=u[1],l.b=u[2]}function XL(l){if(!l)return;const o=Q0(l),u=o[0],m=tT(o[1]),_=tT(o[2]);return l.a<255?`hsla(${u}, ${m}%, ${_}%, ${ga(l.a)})`:`hsl(${u}, ${m}%, ${_}%)`}const iT={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},nT={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function YL(){const l={},o=Object.keys(nT),u=Object.keys(iT);let m,_,v,M,A;for(m=0;m<o.length;m++){for(M=A=o[m],_=0;_<u.length;_++)v=u[_],A=A.replace(v,iT[v]);v=parseInt(nT[M],16),l[A]=[v>>16&255,v>>8&255,v&255]}return l}let Wm;function KL(l){Wm||(Wm=YL(),Wm.transparent=[0,0,0,0]);const o=Wm[l.toLowerCase()];return o&&{r:o[0],g:o[1],b:o[2],a:o.length===4?o[3]:255}}const JL=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function QL(l){const o=JL.exec(l);let u=255,m,_,v;if(o){if(o[7]!==m){const M=+o[7];u=o[8]?pf(M):ml(M*255,0,255)}return m=+o[1],_=+o[3],v=+o[5],m=255&(o[2]?pf(m):ml(m,0,255)),_=255&(o[4]?pf(_):ml(_,0,255)),v=255&(o[6]?pf(v):ml(v,0,255)),{r:m,g:_,b:v,a:u}}}function ek(l){return l&&(l.a<255?`rgba(${l.r}, ${l.g}, ${l.b}, ${ga(l.a)})`:`rgb(${l.r}, ${l.g}, ${l.b})`)}const Hy=l=>l<=.0031308?l*12.92:Math.pow(l,1/2.4)*1.055-.055,Wu=l=>l<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4);function tk(l,o,u){const m=Wu(ga(l.r)),_=Wu(ga(l.g)),v=Wu(ga(l.b));return{r:wl(Hy(m+u*(Wu(ga(o.r))-m))),g:wl(Hy(_+u*(Wu(ga(o.g))-_))),b:wl(Hy(v+u*(Wu(ga(o.b))-v))),a:l.a+u*(o.a-l.a)}}function Hm(l,o,u){if(l){let m=Q0(l);m[o]=Math.max(0,Math.min(m[o]+m[o]*u,o===0?360:1)),m=tx(m),l.r=m[0],l.g=m[1],l.b=m[2]}}function DS(l,o){return l&&Object.assign(o||{},l)}function rT(l){var o={r:0,g:0,b:0,a:255};return Array.isArray(l)?l.length>=3&&(o={r:l[0],g:l[1],b:l[2],a:255},l.length>3&&(o.a=wl(l[3]))):(o=DS(l,{r:0,g:0,b:0,a:1}),o.a=wl(o.a)),o}function ik(l){return l.charAt(0)==="r"?QL(l):qL(l)}class Rf{constructor(o){if(o instanceof Rf)return o;const u=typeof o;let m;u==="object"?m=rT(o):u==="string"&&(m=BL(o)||KL(o)||ik(o)),this._rgb=m,this._valid=!!m}get valid(){return this._valid}get rgb(){var o=DS(this._rgb);return o&&(o.a=ga(o.a)),o}set rgb(o){this._rgb=rT(o)}rgbString(){return this._valid?ek(this._rgb):void 0}hexString(){return this._valid?VL(this._rgb):void 0}hslString(){return this._valid?XL(this._rgb):void 0}mix(o,u){if(o){const m=this.rgb,_=o.rgb;let v;const M=u===v?.5:u,A=2*M-1,r=m.a-_.a,k=((A*r===-1?A:(A+r)/(1+A*r))+1)/2;v=1-k,m.r=255&k*m.r+v*_.r+.5,m.g=255&k*m.g+v*_.g+.5,m.b=255&k*m.b+v*_.b+.5,m.a=M*m.a+(1-M)*_.a,this.rgb=m}return this}interpolate(o,u){return o&&(this._rgb=tk(this._rgb,o._rgb,u)),this}clone(){return new Rf(this.rgb)}alpha(o){return this._rgb.a=wl(o),this}clearer(o){const u=this._rgb;return u.a*=1-o,this}greyscale(){const o=this._rgb,u=Gf(o.r*.3+o.g*.59+o.b*.11);return o.r=o.g=o.b=u,this}opaquer(o){const u=this._rgb;return u.a*=1+o,this}negate(){const o=this._rgb;return o.r=255-o.r,o.g=255-o.g,o.b=255-o.b,this}lighten(o){return Hm(this._rgb,2,o),this}darken(o){return Hm(this._rgb,2,-o),this}saturate(o){return Hm(this._rgb,1,o),this}desaturate(o){return Hm(this._rgb,1,-o),this}rotate(o){return ZL(this._rgb,o),this}}/*!
 * Chart.js v4.4.3
 * https://www.chartjs.org
 * (c) 2024 Chart.js Contributors
 * Released under the MIT License
 */function fa(){}const nk=(()=>{let l=0;return()=>l++})();function An(l){return l===null||typeof l>"u"}function ar(l){if(Array.isArray&&Array.isArray(l))return!0;const o=Object.prototype.toString.call(l);return o.slice(0,7)==="[object"&&o.slice(-6)==="Array]"}function yn(l){return l!==null&&Object.prototype.toString.call(l)==="[object Object]"}function pr(l){return(typeof l=="number"||l instanceof Number)&&isFinite(+l)}function ks(l,o){return pr(l)?l:o}function sn(l,o){return typeof l>"u"?o:l}const rk=(l,o)=>typeof l=="string"&&l.endsWith("%")?parseFloat(l)/100:+l/o,LS=(l,o)=>typeof l=="string"&&l.endsWith("%")?parseFloat(l)/100*o:+l;function Xn(l,o,u){if(l&&typeof l.call=="function")return l.apply(u,o)}function Gn(l,o,u,m){let _,v,M;if(ar(l))for(v=l.length,_=0;_<v;_++)o.call(u,l[_],_);else if(yn(l))for(M=Object.keys(l),v=M.length,_=0;_<v;_++)o.call(u,l[M[_]],M[_])}function w_(l,o){let u,m,_,v;if(!l||!o||l.length!==o.length)return!1;for(u=0,m=l.length;u<m;++u)if(_=l[u],v=o[u],_.datasetIndex!==v.datasetIndex||_.index!==v.index)return!1;return!0}function T_(l){if(ar(l))return l.map(T_);if(yn(l)){const o=Object.create(null),u=Object.keys(l),m=u.length;let _=0;for(;_<m;++_)o[u[_]]=T_(l[u[_]]);return o}return l}function kS(l){return["__proto__","prototype","constructor"].indexOf(l)===-1}function sk(l,o,u,m){if(!kS(l))return;const _=o[l],v=u[l];yn(_)&&yn(v)?zf(_,v,m):o[l]=T_(v)}function zf(l,o,u){const m=ar(o)?o:[o],_=m.length;if(!yn(l))return l;u=u||{};const v=u.merger||sk;let M;for(let A=0;A<_;++A){if(M=m[A],!yn(M))continue;const r=Object.keys(M);for(let k=0,N=r.length;k<N;++k)v(r[k],l,M,u)}return l}function Sf(l,o){return zf(l,o,{merger:ok})}function ok(l,o,u){if(!kS(l))return;const m=o[l],_=u[l];yn(m)&&yn(_)?Sf(m,_):Object.prototype.hasOwnProperty.call(o,l)||(o[l]=T_(_))}const sT={"":l=>l,x:l=>l.x,y:l=>l.y};function ak(l){const o=l.split("."),u=[];let m="";for(const _ of o)m+=_,m.endsWith("\\")?m=m.slice(0,-1)+".":(u.push(m),m="");return u}function lk(l){const o=ak(l);return u=>{for(const m of o){if(m==="")break;u=u&&u[m]}return u}}function Tl(l,o){return(sT[o]||(sT[o]=lk(o)))(l)}function ix(l){return l.charAt(0).toUpperCase()+l.slice(1)}const Of=l=>typeof l<"u",Ml=l=>typeof l=="function",oT=(l,o)=>{if(l.size!==o.size)return!1;for(const u of l)if(!o.has(u))return!1;return!0};function ck(l){return l.type==="mouseup"||l.type==="click"||l.type==="contextmenu"}const er=Math.PI,Qn=2*er,uk=Qn+er,M_=Number.POSITIVE_INFINITY,hk=er/180,wr=er/2,Ec=er/4,aT=er*2/3,_l=Math.log10,jo=Math.sign;function Ef(l,o,u){return Math.abs(l-o)<u}function lT(l){const o=Math.round(l);l=Ef(l,o,l/1e3)?o:l;const u=Math.pow(10,Math.floor(_l(l))),m=l/u;return(m<=1?1:m<=2?2:m<=5?5:10)*u}function dk(l){const o=[],u=Math.sqrt(l);let m;for(m=1;m<u;m++)l%m===0&&(o.push(m),o.push(l/m));return u===(u|0)&&o.push(u),o.sort((_,v)=>_-v).pop(),o}function Qu(l){return!isNaN(parseFloat(l))&&isFinite(l)}function fk(l,o){const u=Math.round(l);return u-o<=l&&u+o>=l}function RS(l,o,u){let m,_,v;for(m=0,_=l.length;m<_;m++)v=l[m][u],isNaN(v)||(o.min=Math.min(o.min,v),o.max=Math.max(o.max,v))}function co(l){return l*(er/180)}function nx(l){return l*(180/er)}function cT(l){if(!pr(l))return;let o=1,u=0;for(;Math.round(l*o)/o!==l;)o*=10,u++;return u}function zS(l,o){const u=o.x-l.x,m=o.y-l.y,_=Math.sqrt(u*u+m*m);let v=Math.atan2(m,u);return v<-.5*er&&(v+=Qn),{angle:v,distance:_}}function g0(l,o){return Math.sqrt(Math.pow(o.x-l.x,2)+Math.pow(o.y-l.y,2))}function pk(l,o){return(l-o+uk)%Qn-er}function Rs(l){return(l%Qn+Qn)%Qn}function Ff(l,o,u,m){const _=Rs(l),v=Rs(o),M=Rs(u),A=Rs(v-_),r=Rs(M-_),k=Rs(_-v),N=Rs(_-M);return _===v||_===M||m&&v===M||A>r&&k<N}function Rr(l,o,u){return Math.max(o,Math.min(u,l))}function mk(l){return Rr(l,-32768,32767)}function va(l,o,u,m=1e-6){return l>=Math.min(o,u)-m&&l<=Math.max(o,u)+m}function rx(l,o,u){u=u||(M=>l[M]<o);let m=l.length-1,_=0,v;for(;m-_>1;)v=_+m>>1,u(v)?_=v:m=v;return{lo:_,hi:m}}const ba=(l,o,u,m)=>rx(l,u,m?_=>{const v=l[_][o];return v<u||v===u&&l[_+1][o]===u}:_=>l[_][o]<u),_k=(l,o,u)=>rx(l,u,m=>l[m][o]>=u);function gk(l,o,u){let m=0,_=l.length;for(;m<_&&l[m]<o;)m++;for(;_>m&&l[_-1]>u;)_--;return m>0||_<l.length?l.slice(m,_):l}const OS=["push","pop","shift","splice","unshift"];function yk(l,o){if(l._chartjs){l._chartjs.listeners.push(o);return}Object.defineProperty(l,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[o]}}),OS.forEach(u=>{const m="_onData"+ix(u),_=l[u];Object.defineProperty(l,u,{configurable:!0,enumerable:!1,value(...v){const M=_.apply(this,v);return l._chartjs.listeners.forEach(A=>{typeof A[m]=="function"&&A[m](...v)}),M}})})}function uT(l,o){const u=l._chartjs;if(!u)return;const m=u.listeners,_=m.indexOf(o);_!==-1&&m.splice(_,1),!(m.length>0)&&(OS.forEach(v=>{delete l[v]}),delete l._chartjs)}function FS(l){const o=new Set(l);return o.size===l.length?l:Array.from(o)}const BS=function(){return typeof window>"u"?function(l){return l()}:window.requestAnimationFrame}();function NS(l,o){let u=[],m=!1;return function(..._){u=_,m||(m=!0,BS.call(window,()=>{m=!1,l.apply(o,u)}))}}function xk(l,o){let u;return function(...m){return o?(clearTimeout(u),u=setTimeout(l,o,m)):l.apply(this,m),o}}const sx=l=>l==="start"?"left":l==="end"?"right":"center",Yr=(l,o,u)=>l==="start"?o:l==="end"?u:(o+u)/2,vk=(l,o,u,m)=>l===(m?"left":"right")?u:l==="center"?(o+u)/2:o;function VS(l,o,u){const m=o.length;let _=0,v=m;if(l._sorted){const{iScale:M,_parsed:A}=l,r=M.axis,{min:k,max:N,minDefined:G,maxDefined:K}=M.getUserBounds();G&&(_=Rr(Math.min(ba(A,r,k).lo,u?m:ba(o,r,M.getPixelForValue(k)).lo),0,m-1)),K?v=Rr(Math.max(ba(A,M.axis,N,!0).hi+1,u?0:ba(o,r,M.getPixelForValue(N),!0).hi+1),_,m)-_:v=m-_}return{start:_,count:v}}function US(l){const{xScale:o,yScale:u,_scaleRanges:m}=l,_={xmin:o.min,xmax:o.max,ymin:u.min,ymax:u.max};if(!m)return l._scaleRanges=_,!0;const v=m.xmin!==o.min||m.xmax!==o.max||m.ymin!==u.min||m.ymax!==u.max;return Object.assign(m,_),v}const qm=l=>l===0||l===1,hT=(l,o,u)=>-(Math.pow(2,10*(l-=1))*Math.sin((l-o)*Qn/u)),dT=(l,o,u)=>Math.pow(2,-10*l)*Math.sin((l-o)*Qn/u)+1,Af={linear:l=>l,easeInQuad:l=>l*l,easeOutQuad:l=>-l*(l-2),easeInOutQuad:l=>(l/=.5)<1?.5*l*l:-.5*(--l*(l-2)-1),easeInCubic:l=>l*l*l,easeOutCubic:l=>(l-=1)*l*l+1,easeInOutCubic:l=>(l/=.5)<1?.5*l*l*l:.5*((l-=2)*l*l+2),easeInQuart:l=>l*l*l*l,easeOutQuart:l=>-((l-=1)*l*l*l-1),easeInOutQuart:l=>(l/=.5)<1?.5*l*l*l*l:-.5*((l-=2)*l*l*l-2),easeInQuint:l=>l*l*l*l*l,easeOutQuint:l=>(l-=1)*l*l*l*l+1,easeInOutQuint:l=>(l/=.5)<1?.5*l*l*l*l*l:.5*((l-=2)*l*l*l*l+2),easeInSine:l=>-Math.cos(l*wr)+1,easeOutSine:l=>Math.sin(l*wr),easeInOutSine:l=>-.5*(Math.cos(er*l)-1),easeInExpo:l=>l===0?0:Math.pow(2,10*(l-1)),easeOutExpo:l=>l===1?1:-Math.pow(2,-10*l)+1,easeInOutExpo:l=>qm(l)?l:l<.5?.5*Math.pow(2,10*(l*2-1)):.5*(-Math.pow(2,-10*(l*2-1))+2),easeInCirc:l=>l>=1?l:-(Math.sqrt(1-l*l)-1),easeOutCirc:l=>Math.sqrt(1-(l-=1)*l),easeInOutCirc:l=>(l/=.5)<1?-.5*(Math.sqrt(1-l*l)-1):.5*(Math.sqrt(1-(l-=2)*l)+1),easeInElastic:l=>qm(l)?l:hT(l,.075,.3),easeOutElastic:l=>qm(l)?l:dT(l,.075,.3),easeInOutElastic(l){return qm(l)?l:l<.5?.5*hT(l*2,.1125,.45):.5+.5*dT(l*2-1,.1125,.45)},easeInBack(l){return l*l*((1.70158+1)*l-1.70158)},easeOutBack(l){return(l-=1)*l*((1.70158+1)*l+1.70158)+1},easeInOutBack(l){let o=1.70158;return(l/=.5)<1?.5*(l*l*(((o*=1.525)+1)*l-o)):.5*((l-=2)*l*(((o*=1.525)+1)*l+o)+2)},easeInBounce:l=>1-Af.easeOutBounce(1-l),easeOutBounce(l){return l<1/2.75?7.5625*l*l:l<2/2.75?7.5625*(l-=1.5/2.75)*l+.75:l<2.5/2.75?7.5625*(l-=2.25/2.75)*l+.9375:7.5625*(l-=2.625/2.75)*l+.984375},easeInOutBounce:l=>l<.5?Af.easeInBounce(l*2)*.5:Af.easeOutBounce(l*2-1)*.5+.5};function ox(l){if(l&&typeof l=="object"){const o=l.toString();return o==="[object CanvasPattern]"||o==="[object CanvasGradient]"}return!1}function fT(l){return ox(l)?l:new Rf(l)}function qy(l){return ox(l)?l:new Rf(l).saturate(.5).darken(.1).hexString()}const bk=["x","y","borderWidth","radius","tension"],wk=["color","borderColor","backgroundColor"];function Tk(l){l.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),l.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:o=>o!=="onProgress"&&o!=="onComplete"&&o!=="fn"}),l.set("animations",{colors:{type:"color",properties:wk},numbers:{type:"number",properties:bk}}),l.describe("animations",{_fallback:"animation"}),l.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:o=>o|0}}}})}function Mk(l){l.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const pT=new Map;function Sk(l,o){o=o||{};const u=l+JSON.stringify(o);let m=pT.get(u);return m||(m=new Intl.NumberFormat(l,o),pT.set(u,m)),m}function $f(l,o,u){return Sk(o,u).format(l)}const jS={values(l){return ar(l)?l:""+l},numeric(l,o,u){if(l===0)return"0";const m=this.chart.options.locale;let _,v=l;if(u.length>1){const k=Math.max(Math.abs(u[0].value),Math.abs(u[u.length-1].value));(k<1e-4||k>1e15)&&(_="scientific"),v=Ek(l,u)}const M=_l(Math.abs(v)),A=isNaN(M)?1:Math.max(Math.min(-1*Math.floor(M),20),0),r={notation:_,minimumFractionDigits:A,maximumFractionDigits:A};return Object.assign(r,this.options.ticks.format),$f(l,m,r)},logarithmic(l,o,u){if(l===0)return"0";const m=u[o].significand||l/Math.pow(10,Math.floor(_l(l)));return[1,2,3,5,10,15].includes(m)||o>.8*u.length?jS.numeric.call(this,l,o,u):""}};function Ek(l,o){let u=o.length>3?o[2].value-o[1].value:o[1].value-o[0].value;return Math.abs(u)>=1&&l!==Math.floor(l)&&(u=l-Math.floor(l)),u}var V_={formatters:jS};function Ak(l){l.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(o,u)=>u.lineWidth,tickColor:(o,u)=>u.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:V_.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),l.route("scale.ticks","color","","color"),l.route("scale.grid","color","","borderColor"),l.route("scale.border","color","","borderColor"),l.route("scale.title","color","","color"),l.describe("scale",{_fallback:!1,_scriptable:o=>!o.startsWith("before")&&!o.startsWith("after")&&o!=="callback"&&o!=="parser",_indexable:o=>o!=="borderDash"&&o!=="tickBorderDash"&&o!=="dash"}),l.describe("scales",{_fallback:"scale"}),l.describe("scale.ticks",{_scriptable:o=>o!=="backdropPadding"&&o!=="callback",_indexable:o=>o!=="backdropPadding"})}const Nc=Object.create(null),y0=Object.create(null);function If(l,o){if(!o)return l;const u=o.split(".");for(let m=0,_=u.length;m<_;++m){const v=u[m];l=l[v]||(l[v]=Object.create(null))}return l}function Zy(l,o,u){return typeof o=="string"?zf(If(l,o),u):zf(If(l,""),o)}class Ik{constructor(o,u){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=m=>m.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(m,_)=>qy(_.backgroundColor),this.hoverBorderColor=(m,_)=>qy(_.borderColor),this.hoverColor=(m,_)=>qy(_.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(o),this.apply(u)}set(o,u){return Zy(this,o,u)}get(o){return If(this,o)}describe(o,u){return Zy(y0,o,u)}override(o,u){return Zy(Nc,o,u)}route(o,u,m,_){const v=If(this,o),M=If(this,m),A="_"+u;Object.defineProperties(v,{[A]:{value:v[u],writable:!0},[u]:{enumerable:!0,get(){const r=this[A],k=M[_];return yn(r)?Object.assign({},k,r):sn(r,k)},set(r){this[A]=r}}})}apply(o){o.forEach(u=>u(this))}}var mr=new Ik({_scriptable:l=>!l.startsWith("on"),_indexable:l=>l!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[Tk,Mk,Ak]);function Ck(l){return!l||An(l.size)||An(l.family)?null:(l.style?l.style+" ":"")+(l.weight?l.weight+" ":"")+l.size+"px "+l.family}function S_(l,o,u,m,_){let v=o[_];return v||(v=o[_]=l.measureText(_).width,u.push(_)),v>m&&(m=v),m}function Pk(l,o,u,m){m=m||{};let _=m.data=m.data||{},v=m.garbageCollect=m.garbageCollect||[];m.font!==o&&(_=m.data={},v=m.garbageCollect=[],m.font=o),l.save(),l.font=o;let M=0;const A=u.length;let r,k,N,G,K;for(r=0;r<A;r++)if(G=u[r],G!=null&&!ar(G))M=S_(l,_,v,M,G);else if(ar(G))for(k=0,N=G.length;k<N;k++)K=G[k],K!=null&&!ar(K)&&(M=S_(l,_,v,M,K));l.restore();const ie=v.length/2;if(ie>u.length){for(r=0;r<ie;r++)delete _[v[r]];v.splice(0,ie)}return M}function Ac(l,o,u){const m=l.currentDevicePixelRatio,_=u!==0?Math.max(u/2,.5):0;return Math.round((o-_)*m)/m+_}function mT(l,o){!o&&!l||(o=o||l.getContext("2d"),o.save(),o.resetTransform(),o.clearRect(0,0,l.width,l.height),o.restore())}function x0(l,o,u,m){GS(l,o,u,m,null)}function GS(l,o,u,m,_){let v,M,A,r,k,N,G,K;const ie=o.pointStyle,pe=o.rotation,ge=o.radius;let Te=(pe||0)*hk;if(ie&&typeof ie=="object"&&(v=ie.toString(),v==="[object HTMLImageElement]"||v==="[object HTMLCanvasElement]")){l.save(),l.translate(u,m),l.rotate(Te),l.drawImage(ie,-ie.width/2,-ie.height/2,ie.width,ie.height),l.restore();return}if(!(isNaN(ge)||ge<=0)){switch(l.beginPath(),ie){default:_?l.ellipse(u,m,_/2,ge,0,0,Qn):l.arc(u,m,ge,0,Qn),l.closePath();break;case"triangle":N=_?_/2:ge,l.moveTo(u+Math.sin(Te)*N,m-Math.cos(Te)*ge),Te+=aT,l.lineTo(u+Math.sin(Te)*N,m-Math.cos(Te)*ge),Te+=aT,l.lineTo(u+Math.sin(Te)*N,m-Math.cos(Te)*ge),l.closePath();break;case"rectRounded":k=ge*.516,r=ge-k,M=Math.cos(Te+Ec)*r,G=Math.cos(Te+Ec)*(_?_/2-k:r),A=Math.sin(Te+Ec)*r,K=Math.sin(Te+Ec)*(_?_/2-k:r),l.arc(u-G,m-A,k,Te-er,Te-wr),l.arc(u+K,m-M,k,Te-wr,Te),l.arc(u+G,m+A,k,Te,Te+wr),l.arc(u-K,m+M,k,Te+wr,Te+er),l.closePath();break;case"rect":if(!pe){r=Math.SQRT1_2*ge,N=_?_/2:r,l.rect(u-N,m-r,2*N,2*r);break}Te+=Ec;case"rectRot":G=Math.cos(Te)*(_?_/2:ge),M=Math.cos(Te)*ge,A=Math.sin(Te)*ge,K=Math.sin(Te)*(_?_/2:ge),l.moveTo(u-G,m-A),l.lineTo(u+K,m-M),l.lineTo(u+G,m+A),l.lineTo(u-K,m+M),l.closePath();break;case"crossRot":Te+=Ec;case"cross":G=Math.cos(Te)*(_?_/2:ge),M=Math.cos(Te)*ge,A=Math.sin(Te)*ge,K=Math.sin(Te)*(_?_/2:ge),l.moveTo(u-G,m-A),l.lineTo(u+G,m+A),l.moveTo(u+K,m-M),l.lineTo(u-K,m+M);break;case"star":G=Math.cos(Te)*(_?_/2:ge),M=Math.cos(Te)*ge,A=Math.sin(Te)*ge,K=Math.sin(Te)*(_?_/2:ge),l.moveTo(u-G,m-A),l.lineTo(u+G,m+A),l.moveTo(u+K,m-M),l.lineTo(u-K,m+M),Te+=Ec,G=Math.cos(Te)*(_?_/2:ge),M=Math.cos(Te)*ge,A=Math.sin(Te)*ge,K=Math.sin(Te)*(_?_/2:ge),l.moveTo(u-G,m-A),l.lineTo(u+G,m+A),l.moveTo(u+K,m-M),l.lineTo(u-K,m+M);break;case"line":M=_?_/2:Math.cos(Te)*ge,A=Math.sin(Te)*ge,l.moveTo(u-M,m-A),l.lineTo(u+M,m+A);break;case"dash":l.moveTo(u,m),l.lineTo(u+Math.cos(Te)*(_?_/2:ge),m+Math.sin(Te)*ge);break;case!1:l.closePath();break}l.fill(),o.borderWidth>0&&l.stroke()}}function wa(l,o,u){return u=u||.5,!o||l&&l.x>o.left-u&&l.x<o.right+u&&l.y>o.top-u&&l.y<o.bottom+u}function U_(l,o){l.save(),l.beginPath(),l.rect(o.left,o.top,o.right-o.left,o.bottom-o.top),l.clip()}function j_(l){l.restore()}function Dk(l,o,u,m,_){if(!o)return l.lineTo(u.x,u.y);if(_==="middle"){const v=(o.x+u.x)/2;l.lineTo(v,o.y),l.lineTo(v,u.y)}else _==="after"!=!!m?l.lineTo(o.x,u.y):l.lineTo(u.x,o.y);l.lineTo(u.x,u.y)}function Lk(l,o,u,m){if(!o)return l.lineTo(u.x,u.y);l.bezierCurveTo(m?o.cp1x:o.cp2x,m?o.cp1y:o.cp2y,m?u.cp2x:u.cp1x,m?u.cp2y:u.cp1y,u.x,u.y)}function kk(l,o){o.translation&&l.translate(o.translation[0],o.translation[1]),An(o.rotation)||l.rotate(o.rotation),o.color&&(l.fillStyle=o.color),o.textAlign&&(l.textAlign=o.textAlign),o.textBaseline&&(l.textBaseline=o.textBaseline)}function Rk(l,o,u,m,_){if(_.strikethrough||_.underline){const v=l.measureText(m),M=o-v.actualBoundingBoxLeft,A=o+v.actualBoundingBoxRight,r=u-v.actualBoundingBoxAscent,k=u+v.actualBoundingBoxDescent,N=_.strikethrough?(r+k)/2:k;l.strokeStyle=l.fillStyle,l.beginPath(),l.lineWidth=_.decorationWidth||2,l.moveTo(M,N),l.lineTo(A,N),l.stroke()}}function zk(l,o){const u=l.fillStyle;l.fillStyle=o.color,l.fillRect(o.left,o.top,o.width,o.height),l.fillStyle=u}function Vc(l,o,u,m,_,v={}){const M=ar(o)?o:[o],A=v.strokeWidth>0&&v.strokeColor!=="";let r,k;for(l.save(),l.font=_.string,kk(l,v),r=0;r<M.length;++r)k=M[r],v.backdrop&&zk(l,v.backdrop),A&&(v.strokeColor&&(l.strokeStyle=v.strokeColor),An(v.strokeWidth)||(l.lineWidth=v.strokeWidth),l.strokeText(k,u,m,v.maxWidth)),l.fillText(k,u,m,v.maxWidth),Rk(l,u,m,k,v),m+=Number(_.lineHeight);l.restore()}function Bf(l,o){const{x:u,y:m,w:_,h:v,radius:M}=o;l.arc(u+M.topLeft,m+M.topLeft,M.topLeft,1.5*er,er,!0),l.lineTo(u,m+v-M.bottomLeft),l.arc(u+M.bottomLeft,m+v-M.bottomLeft,M.bottomLeft,er,wr,!0),l.lineTo(u+_-M.bottomRight,m+v),l.arc(u+_-M.bottomRight,m+v-M.bottomRight,M.bottomRight,wr,0,!0),l.lineTo(u+_,m+M.topRight),l.arc(u+_-M.topRight,m+M.topRight,M.topRight,0,-wr,!0),l.lineTo(u+M.topLeft,m)}const Ok=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,Fk=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function Bk(l,o){const u=(""+l).match(Ok);if(!u||u[1]==="normal")return o*1.2;switch(l=+u[2],u[3]){case"px":return l;case"%":l/=100;break}return o*l}const Nk=l=>+l||0;function ax(l,o){const u={},m=yn(o),_=m?Object.keys(o):o,v=yn(l)?m?M=>sn(l[M],l[o[M]]):M=>l[M]:()=>l;for(const M of _)u[M]=Nk(v(M));return u}function $S(l){return ax(l,{top:"y",right:"x",bottom:"y",left:"x"})}function Oc(l){return ax(l,["topLeft","topRight","bottomLeft","bottomRight"])}function es(l){const o=$S(l);return o.width=o.left+o.right,o.height=o.top+o.bottom,o}function Pr(l,o){l=l||{},o=o||mr.font;let u=sn(l.size,o.size);typeof u=="string"&&(u=parseInt(u,10));let m=sn(l.style,o.style);m&&!(""+m).match(Fk)&&(console.warn('Invalid font style specified: "'+m+'"'),m=void 0);const _={family:sn(l.family,o.family),lineHeight:Bk(sn(l.lineHeight,o.lineHeight),u),size:u,style:m,weight:sn(l.weight,o.weight),string:""};return _.string=Ck(_),_}function mf(l,o,u,m){let _,v,M;for(_=0,v=l.length;_<v;++_)if(M=l[_],M!==void 0&&M!==void 0)return M}function Vk(l,o,u){const{min:m,max:_}=l,v=LS(o,(_-m)/2),M=(A,r)=>u&&A===0?0:A+r;return{min:M(m,-Math.abs(v)),max:M(_,v)}}function Al(l,o){return Object.assign(Object.create(l),o)}function lx(l,o=[""],u,m,_=()=>l[0]){const v=u||l;typeof m>"u"&&(m=ZS("_fallback",l));const M={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:l,_rootScopes:v,_fallback:m,_getTarget:_,override:A=>lx([A,...l],o,v,m)};return new Proxy(M,{deleteProperty(A,r){return delete A[r],delete A._keys,delete l[0][r],!0},get(A,r){return HS(A,r,()=>Zk(r,o,l,A))},getOwnPropertyDescriptor(A,r){return Reflect.getOwnPropertyDescriptor(A._scopes[0],r)},getPrototypeOf(){return Reflect.getPrototypeOf(l[0])},has(A,r){return gT(A).includes(r)},ownKeys(A){return gT(A)},set(A,r,k){const N=A._storage||(A._storage=_());return A[r]=N[r]=k,delete A._keys,!0}})}function eh(l,o,u,m){const _={_cacheable:!1,_proxy:l,_context:o,_subProxy:u,_stack:new Set,_descriptors:WS(l,m),setContext:v=>eh(l,v,u,m),override:v=>eh(l.override(v),o,u,m)};return new Proxy(_,{deleteProperty(v,M){return delete v[M],delete l[M],!0},get(v,M,A){return HS(v,M,()=>jk(v,M,A))},getOwnPropertyDescriptor(v,M){return v._descriptors.allKeys?Reflect.has(l,M)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(l,M)},getPrototypeOf(){return Reflect.getPrototypeOf(l)},has(v,M){return Reflect.has(l,M)},ownKeys(){return Reflect.ownKeys(l)},set(v,M,A){return l[M]=A,delete v[M],!0}})}function WS(l,o={scriptable:!0,indexable:!0}){const{_scriptable:u=o.scriptable,_indexable:m=o.indexable,_allKeys:_=o.allKeys}=l;return{allKeys:_,scriptable:u,indexable:m,isScriptable:Ml(u)?u:()=>u,isIndexable:Ml(m)?m:()=>m}}const Uk=(l,o)=>l?l+ix(o):o,cx=(l,o)=>yn(o)&&l!=="adapters"&&(Object.getPrototypeOf(o)===null||o.constructor===Object);function HS(l,o,u){if(Object.prototype.hasOwnProperty.call(l,o)||o==="constructor")return l[o];const m=u();return l[o]=m,m}function jk(l,o,u){const{_proxy:m,_context:_,_subProxy:v,_descriptors:M}=l;let A=m[o];return Ml(A)&&M.isScriptable(o)&&(A=Gk(o,A,l,u)),ar(A)&&A.length&&(A=$k(o,A,l,M.isIndexable)),cx(o,A)&&(A=eh(A,_,v&&v[o],M)),A}function Gk(l,o,u,m){const{_proxy:_,_context:v,_subProxy:M,_stack:A}=u;if(A.has(l))throw new Error("Recursion detected: "+Array.from(A).join("->")+"->"+l);A.add(l);let r=o(v,M||m);return A.delete(l),cx(l,r)&&(r=ux(_._scopes,_,l,r)),r}function $k(l,o,u,m){const{_proxy:_,_context:v,_subProxy:M,_descriptors:A}=u;if(typeof v.index<"u"&&m(l))return o[v.index%o.length];if(yn(o[0])){const r=o,k=_._scopes.filter(N=>N!==r);o=[];for(const N of r){const G=ux(k,_,l,N);o.push(eh(G,v,M&&M[l],A))}}return o}function qS(l,o,u){return Ml(l)?l(o,u):l}const Wk=(l,o)=>l===!0?o:typeof l=="string"?Tl(o,l):void 0;function Hk(l,o,u,m,_){for(const v of o){const M=Wk(u,v);if(M){l.add(M);const A=qS(M._fallback,u,_);if(typeof A<"u"&&A!==u&&A!==m)return A}else if(M===!1&&typeof m<"u"&&u!==m)return null}return!1}function ux(l,o,u,m){const _=o._rootScopes,v=qS(o._fallback,u,m),M=[...l,..._],A=new Set;A.add(m);let r=_T(A,M,u,v||u,m);return r===null||typeof v<"u"&&v!==u&&(r=_T(A,M,v,r,m),r===null)?!1:lx(Array.from(A),[""],_,v,()=>qk(o,u,m))}function _T(l,o,u,m,_){for(;u;)u=Hk(l,o,u,m,_);return u}function qk(l,o,u){const m=l._getTarget();o in m||(m[o]={});const _=m[o];return ar(_)&&yn(u)?u:_||{}}function Zk(l,o,u,m){let _;for(const v of o)if(_=ZS(Uk(v,l),u),typeof _<"u")return cx(l,_)?ux(u,m,l,_):_}function ZS(l,o){for(const u of o){if(!u)continue;const m=u[l];if(typeof m<"u")return m}}function gT(l){let o=l._keys;return o||(o=l._keys=Xk(l._scopes)),o}function Xk(l){const o=new Set;for(const u of l)for(const m of Object.keys(u).filter(_=>!_.startsWith("_")))o.add(m);return Array.from(o)}function XS(l,o,u,m){const{iScale:_}=l,{key:v="r"}=this._parsing,M=new Array(m);let A,r,k,N;for(A=0,r=m;A<r;++A)k=A+u,N=o[k],M[A]={r:_.parse(Tl(N,v),k)};return M}const Yk=Number.EPSILON||1e-14,th=(l,o)=>o<l.length&&!l[o].skip&&l[o],YS=l=>l==="x"?"y":"x";function Kk(l,o,u,m){const _=l.skip?o:l,v=o,M=u.skip?o:u,A=g0(v,_),r=g0(M,v);let k=A/(A+r),N=r/(A+r);k=isNaN(k)?0:k,N=isNaN(N)?0:N;const G=m*k,K=m*N;return{previous:{x:v.x-G*(M.x-_.x),y:v.y-G*(M.y-_.y)},next:{x:v.x+K*(M.x-_.x),y:v.y+K*(M.y-_.y)}}}function Jk(l,o,u){const m=l.length;let _,v,M,A,r,k=th(l,0);for(let N=0;N<m-1;++N)if(r=k,k=th(l,N+1),!(!r||!k)){if(Ef(o[N],0,Yk)){u[N]=u[N+1]=0;continue}_=u[N]/o[N],v=u[N+1]/o[N],A=Math.pow(_,2)+Math.pow(v,2),!(A<=9)&&(M=3/Math.sqrt(A),u[N]=_*M*o[N],u[N+1]=v*M*o[N])}}function Qk(l,o,u="x"){const m=YS(u),_=l.length;let v,M,A,r=th(l,0);for(let k=0;k<_;++k){if(M=A,A=r,r=th(l,k+1),!A)continue;const N=A[u],G=A[m];M&&(v=(N-M[u])/3,A[`cp1${u}`]=N-v,A[`cp1${m}`]=G-v*o[k]),r&&(v=(r[u]-N)/3,A[`cp2${u}`]=N+v,A[`cp2${m}`]=G+v*o[k])}}function eR(l,o="x"){const u=YS(o),m=l.length,_=Array(m).fill(0),v=Array(m);let M,A,r,k=th(l,0);for(M=0;M<m;++M)if(A=r,r=k,k=th(l,M+1),!!r){if(k){const N=k[o]-r[o];_[M]=N!==0?(k[u]-r[u])/N:0}v[M]=A?k?jo(_[M-1])!==jo(_[M])?0:(_[M-1]+_[M])/2:_[M-1]:_[M]}Jk(l,_,v),Qk(l,v,o)}function Zm(l,o,u){return Math.max(Math.min(l,u),o)}function tR(l,o){let u,m,_,v,M,A=wa(l[0],o);for(u=0,m=l.length;u<m;++u)M=v,v=A,A=u<m-1&&wa(l[u+1],o),v&&(_=l[u],M&&(_.cp1x=Zm(_.cp1x,o.left,o.right),_.cp1y=Zm(_.cp1y,o.top,o.bottom)),A&&(_.cp2x=Zm(_.cp2x,o.left,o.right),_.cp2y=Zm(_.cp2y,o.top,o.bottom)))}function iR(l,o,u,m,_){let v,M,A,r;if(o.spanGaps&&(l=l.filter(k=>!k.skip)),o.cubicInterpolationMode==="monotone")eR(l,_);else{let k=m?l[l.length-1]:l[0];for(v=0,M=l.length;v<M;++v)A=l[v],r=Kk(k,A,l[Math.min(v+1,M-(m?0:1))%M],o.tension),A.cp1x=r.previous.x,A.cp1y=r.previous.y,A.cp2x=r.next.x,A.cp2y=r.next.y,k=A}o.capBezierPoints&&tR(l,u)}function hx(){return typeof window<"u"&&typeof document<"u"}function dx(l){let o=l.parentNode;return o&&o.toString()==="[object ShadowRoot]"&&(o=o.host),o}function E_(l,o,u){let m;return typeof l=="string"?(m=parseInt(l,10),l.indexOf("%")!==-1&&(m=m/100*o.parentNode[u])):m=l,m}const G_=l=>l.ownerDocument.defaultView.getComputedStyle(l,null);function nR(l,o){return G_(l).getPropertyValue(o)}const rR=["top","right","bottom","left"];function Fc(l,o,u){const m={};u=u?"-"+u:"";for(let _=0;_<4;_++){const v=rR[_];m[v]=parseFloat(l[o+"-"+v+u])||0}return m.width=m.left+m.right,m.height=m.top+m.bottom,m}const sR=(l,o,u)=>(l>0||o>0)&&(!u||!u.shadowRoot);function oR(l,o){const u=l.touches,m=u&&u.length?u[0]:l,{offsetX:_,offsetY:v}=m;let M=!1,A,r;if(sR(_,v,l.target))A=_,r=v;else{const k=o.getBoundingClientRect();A=m.clientX-k.left,r=m.clientY-k.top,M=!0}return{x:A,y:r,box:M}}function Pc(l,o){if("native"in l)return l;const{canvas:u,currentDevicePixelRatio:m}=o,_=G_(u),v=_.boxSizing==="border-box",M=Fc(_,"padding"),A=Fc(_,"border","width"),{x:r,y:k,box:N}=oR(l,u),G=M.left+(N&&A.left),K=M.top+(N&&A.top);let{width:ie,height:pe}=o;return v&&(ie-=M.width+A.width,pe-=M.height+A.height),{x:Math.round((r-G)/ie*u.width/m),y:Math.round((k-K)/pe*u.height/m)}}function aR(l,o,u){let m,_;if(o===void 0||u===void 0){const v=l&&dx(l);if(!v)o=l.clientWidth,u=l.clientHeight;else{const M=v.getBoundingClientRect(),A=G_(v),r=Fc(A,"border","width"),k=Fc(A,"padding");o=M.width-k.width-r.width,u=M.height-k.height-r.height,m=E_(A.maxWidth,v,"clientWidth"),_=E_(A.maxHeight,v,"clientHeight")}}return{width:o,height:u,maxWidth:m||M_,maxHeight:_||M_}}const Xm=l=>Math.round(l*10)/10;function lR(l,o,u,m){const _=G_(l),v=Fc(_,"margin"),M=E_(_.maxWidth,l,"clientWidth")||M_,A=E_(_.maxHeight,l,"clientHeight")||M_,r=aR(l,o,u);let{width:k,height:N}=r;if(_.boxSizing==="content-box"){const K=Fc(_,"border","width"),ie=Fc(_,"padding");k-=ie.width+K.width,N-=ie.height+K.height}return k=Math.max(0,k-v.width),N=Math.max(0,m?k/m:N-v.height),k=Xm(Math.min(k,M,r.maxWidth)),N=Xm(Math.min(N,A,r.maxHeight)),k&&!N&&(N=Xm(k/2)),(o!==void 0||u!==void 0)&&m&&r.height&&N>r.height&&(N=r.height,k=Xm(Math.floor(N*m))),{width:k,height:N}}function yT(l,o,u){const m=o||1,_=Math.floor(l.height*m),v=Math.floor(l.width*m);l.height=Math.floor(l.height),l.width=Math.floor(l.width);const M=l.canvas;return M.style&&(u||!M.style.height&&!M.style.width)&&(M.style.height=`${l.height}px`,M.style.width=`${l.width}px`),l.currentDevicePixelRatio!==m||M.height!==_||M.width!==v?(l.currentDevicePixelRatio=m,M.height=_,M.width=v,l.ctx.setTransform(m,0,0,m,0,0),!0):!1}const cR=function(){let l=!1;try{const o={get passive(){return l=!0,!1}};hx()&&(window.addEventListener("test",null,o),window.removeEventListener("test",null,o))}catch{}return l}();function xT(l,o){const u=nR(l,o),m=u&&u.match(/^(\d+)(\.\d+)?px$/);return m?+m[1]:void 0}function Dc(l,o,u,m){return{x:l.x+u*(o.x-l.x),y:l.y+u*(o.y-l.y)}}function uR(l,o,u,m){return{x:l.x+u*(o.x-l.x),y:m==="middle"?u<.5?l.y:o.y:m==="after"?u<1?l.y:o.y:u>0?o.y:l.y}}function hR(l,o,u,m){const _={x:l.cp2x,y:l.cp2y},v={x:o.cp1x,y:o.cp1y},M=Dc(l,_,u),A=Dc(_,v,u),r=Dc(v,o,u),k=Dc(M,A,u),N=Dc(A,r,u);return Dc(k,N,u)}const dR=function(l,o){return{x(u){return l+l+o-u},setWidth(u){o=u},textAlign(u){return u==="center"?u:u==="right"?"left":"right"},xPlus(u,m){return u-m},leftForLtr(u,m){return u-m}}},fR=function(){return{x(l){return l},setWidth(l){},textAlign(l){return l},xPlus(l,o){return l+o},leftForLtr(l,o){return l}}};function Ku(l,o,u){return l?dR(o,u):fR()}function KS(l,o){let u,m;(o==="ltr"||o==="rtl")&&(u=l.canvas.style,m=[u.getPropertyValue("direction"),u.getPropertyPriority("direction")],u.setProperty("direction",o,"important"),l.prevTextDirection=m)}function JS(l,o){o!==void 0&&(delete l.prevTextDirection,l.canvas.style.setProperty("direction",o[0],o[1]))}function QS(l){return l==="angle"?{between:Ff,compare:pk,normalize:Rs}:{between:va,compare:(o,u)=>o-u,normalize:o=>o}}function vT({start:l,end:o,count:u,loop:m,style:_}){return{start:l%u,end:o%u,loop:m&&(o-l+1)%u===0,style:_}}function pR(l,o,u){const{property:m,start:_,end:v}=u,{between:M,normalize:A}=QS(m),r=o.length;let{start:k,end:N,loop:G}=l,K,ie;if(G){for(k+=r,N+=r,K=0,ie=r;K<ie&&M(A(o[k%r][m]),_,v);++K)k--,N--;k%=r,N%=r}return N<k&&(N+=r),{start:k,end:N,loop:G,style:l.style}}function eE(l,o,u){if(!u)return[l];const{property:m,start:_,end:v}=u,M=o.length,{compare:A,between:r,normalize:k}=QS(m),{start:N,end:G,loop:K,style:ie}=pR(l,o,u),pe=[];let ge=!1,Te=null,Re,$e,tt;const ut=()=>r(_,tt,Re)&&A(_,tt)!==0,ot=()=>A(v,Re)===0||r(v,tt,Re),at=()=>ge||ut(),dt=()=>!ge||ot();for(let xe=N,le=N;xe<=G;++xe)$e=o[xe%M],!$e.skip&&(Re=k($e[m]),Re!==tt&&(ge=r(Re,_,v),Te===null&&at()&&(Te=A(Re,_)===0?xe:le),Te!==null&&dt()&&(pe.push(vT({start:Te,end:xe,loop:K,count:M,style:ie})),Te=null),le=xe,tt=Re));return Te!==null&&pe.push(vT({start:Te,end:G,loop:K,count:M,style:ie})),pe}function tE(l,o){const u=[],m=l.segments;for(let _=0;_<m.length;_++){const v=eE(m[_],l.points,o);v.length&&u.push(...v)}return u}function mR(l,o,u,m){let _=0,v=o-1;if(u&&!m)for(;_<o&&!l[_].skip;)_++;for(;_<o&&l[_].skip;)_++;for(_%=o,u&&(v+=_);v>_&&l[v%o].skip;)v--;return v%=o,{start:_,end:v}}function _R(l,o,u,m){const _=l.length,v=[];let M=o,A=l[o],r;for(r=o+1;r<=u;++r){const k=l[r%_];k.skip||k.stop?A.skip||(m=!1,v.push({start:o%_,end:(r-1)%_,loop:m}),o=M=k.stop?r:null):(M=r,A.skip&&(o=r)),A=k}return M!==null&&v.push({start:o%_,end:M%_,loop:m}),v}function gR(l,o){const u=l.points,m=l.options.spanGaps,_=u.length;if(!_)return[];const v=!!l._loop,{start:M,end:A}=mR(u,_,v,m);if(m===!0)return bT(l,[{start:M,end:A,loop:v}],u,o);const r=A<M?A+_:A,k=!!l._fullLoop&&M===0&&A===_-1;return bT(l,_R(u,M,r,k),u,o)}function bT(l,o,u,m){return!m||!m.setContext||!u?o:yR(l,o,u,m)}function yR(l,o,u,m){const _=l._chart.getContext(),v=wT(l.options),{_datasetIndex:M,options:{spanGaps:A}}=l,r=u.length,k=[];let N=v,G=o[0].start,K=G;function ie(pe,ge,Te,Re){const $e=A?-1:1;if(pe!==ge){for(pe+=r;u[pe%r].skip;)pe-=$e;for(;u[ge%r].skip;)ge+=$e;pe%r!==ge%r&&(k.push({start:pe%r,end:ge%r,loop:Te,style:Re}),N=Re,G=ge%r)}}for(const pe of o){G=A?G:pe.start;let ge=u[G%r],Te;for(K=G+1;K<=pe.end;K++){const Re=u[K%r];Te=wT(m.setContext(Al(_,{type:"segment",p0:ge,p1:Re,p0DataIndex:(K-1)%r,p1DataIndex:K%r,datasetIndex:M}))),xR(Te,N)&&ie(G,K-1,pe.loop,N),ge=Re,N=Te}G<K-1&&ie(G,K-1,pe.loop,N)}return k}function wT(l){return{backgroundColor:l.backgroundColor,borderCapStyle:l.borderCapStyle,borderDash:l.borderDash,borderDashOffset:l.borderDashOffset,borderJoinStyle:l.borderJoinStyle,borderWidth:l.borderWidth,borderColor:l.borderColor}}function xR(l,o){if(!o)return!1;const u=[],m=function(_,v){return ox(v)?(u.includes(v)||u.push(v),u.indexOf(v)):v};return JSON.stringify(l,m)!==JSON.stringify(o,m)}/*!
 * Chart.js v4.4.3
 * https://www.chartjs.org
 * (c) 2024 Chart.js Contributors
 * Released under the MIT License
 */class vR{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(o,u,m,_){const v=u.listeners[_],M=u.duration;v.forEach(A=>A({chart:o,initial:u.initial,numSteps:M,currentStep:Math.min(m-u.start,M)}))}_refresh(){this._request||(this._running=!0,this._request=BS.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(o=Date.now()){let u=0;this._charts.forEach((m,_)=>{if(!m.running||!m.items.length)return;const v=m.items;let M=v.length-1,A=!1,r;for(;M>=0;--M)r=v[M],r._active?(r._total>m.duration&&(m.duration=r._total),r.tick(o),A=!0):(v[M]=v[v.length-1],v.pop());A&&(_.draw(),this._notify(_,m,o,"progress")),v.length||(m.running=!1,this._notify(_,m,o,"complete"),m.initial=!1),u+=v.length}),this._lastDate=o,u===0&&(this._running=!1)}_getAnims(o){const u=this._charts;let m=u.get(o);return m||(m={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},u.set(o,m)),m}listen(o,u,m){this._getAnims(o).listeners[u].push(m)}add(o,u){!u||!u.length||this._getAnims(o).items.push(...u)}has(o){return this._getAnims(o).items.length>0}start(o){const u=this._charts.get(o);u&&(u.running=!0,u.start=Date.now(),u.duration=u.items.reduce((m,_)=>Math.max(m,_._duration),0),this._refresh())}running(o){if(!this._running)return!1;const u=this._charts.get(o);return!(!u||!u.running||!u.items.length)}stop(o){const u=this._charts.get(o);if(!u||!u.items.length)return;const m=u.items;let _=m.length-1;for(;_>=0;--_)m[_].cancel();u.items=[],this._notify(o,u,Date.now(),"complete")}remove(o){return this._charts.delete(o)}}var pa=new vR;const TT="transparent",bR={boolean(l,o,u){return u>.5?o:l},color(l,o,u){const m=fT(l||TT),_=m.valid&&fT(o||TT);return _&&_.valid?_.mix(m,u).hexString():o},number(l,o,u){return l+(o-l)*u}};class wR{constructor(o,u,m,_){const v=u[m];_=mf([o.to,_,v,o.from]);const M=mf([o.from,v,_]);this._active=!0,this._fn=o.fn||bR[o.type||typeof M],this._easing=Af[o.easing]||Af.linear,this._start=Math.floor(Date.now()+(o.delay||0)),this._duration=this._total=Math.floor(o.duration),this._loop=!!o.loop,this._target=u,this._prop=m,this._from=M,this._to=_,this._promises=void 0}active(){return this._active}update(o,u,m){if(this._active){this._notify(!1);const _=this._target[this._prop],v=m-this._start,M=this._duration-v;this._start=m,this._duration=Math.floor(Math.max(M,o.duration)),this._total+=v,this._loop=!!o.loop,this._to=mf([o.to,u,_,o.from]),this._from=mf([o.from,_,u])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(o){const u=o-this._start,m=this._duration,_=this._prop,v=this._from,M=this._loop,A=this._to;let r;if(this._active=v!==A&&(M||u<m),!this._active){this._target[_]=A,this._notify(!0);return}if(u<0){this._target[_]=v;return}r=u/m%2,r=M&&r>1?2-r:r,r=this._easing(Math.min(1,Math.max(0,r))),this._target[_]=this._fn(v,A,r)}wait(){const o=this._promises||(this._promises=[]);return new Promise((u,m)=>{o.push({res:u,rej:m})})}_notify(o){const u=o?"res":"rej",m=this._promises||[];for(let _=0;_<m.length;_++)m[_][u]()}}class iE{constructor(o,u){this._chart=o,this._properties=new Map,this.configure(u)}configure(o){if(!yn(o))return;const u=Object.keys(mr.animation),m=this._properties;Object.getOwnPropertyNames(o).forEach(_=>{const v=o[_];if(!yn(v))return;const M={};for(const A of u)M[A]=v[A];(ar(v.properties)&&v.properties||[_]).forEach(A=>{(A===_||!m.has(A))&&m.set(A,M)})})}_animateOptions(o,u){const m=u.options,_=MR(o,m);if(!_)return[];const v=this._createAnimations(_,m);return m.$shared&&TR(o.options.$animations,m).then(()=>{o.options=m},()=>{}),v}_createAnimations(o,u){const m=this._properties,_=[],v=o.$animations||(o.$animations={}),M=Object.keys(u),A=Date.now();let r;for(r=M.length-1;r>=0;--r){const k=M[r];if(k.charAt(0)==="$")continue;if(k==="options"){_.push(...this._animateOptions(o,u));continue}const N=u[k];let G=v[k];const K=m.get(k);if(G)if(K&&G.active()){G.update(K,N,A);continue}else G.cancel();if(!K||!K.duration){o[k]=N;continue}v[k]=G=new wR(K,o,k,N),_.push(G)}return _}update(o,u){if(this._properties.size===0){Object.assign(o,u);return}const m=this._createAnimations(o,u);if(m.length)return pa.add(this._chart,m),!0}}function TR(l,o){const u=[],m=Object.keys(o);for(let _=0;_<m.length;_++){const v=l[m[_]];v&&v.active()&&u.push(v.wait())}return Promise.all(u)}function MR(l,o){if(!o)return;let u=l.options;if(!u){l.options=o;return}return u.$shared&&(l.options=u=Object.assign({},u,{$shared:!1,$animations:{}})),u}function MT(l,o){const u=l&&l.options||{},m=u.reverse,_=u.min===void 0?o:0,v=u.max===void 0?o:0;return{start:m?v:_,end:m?_:v}}function SR(l,o,u){if(u===!1)return!1;const m=MT(l,u),_=MT(o,u);return{top:_.end,right:m.end,bottom:_.start,left:m.start}}function ER(l){let o,u,m,_;return yn(l)?(o=l.top,u=l.right,m=l.bottom,_=l.left):o=u=m=_=l,{top:o,right:u,bottom:m,left:_,disabled:l===!1}}function nE(l,o){const u=[],m=l._getSortedDatasetMetas(o);let _,v;for(_=0,v=m.length;_<v;++_)u.push(m[_].index);return u}function ST(l,o,u,m={}){const _=l.keys,v=m.mode==="single";let M,A,r,k;if(o!==null){for(M=0,A=_.length;M<A;++M){if(r=+_[M],r===u){if(m.all)continue;break}k=l.values[r],pr(k)&&(v||o===0||jo(o)===jo(k))&&(o+=k)}return o}}function AR(l,o){const{iScale:u,vScale:m}=o,_=u.axis==="x"?"x":"y",v=m.axis==="x"?"x":"y",M=Object.keys(l),A=new Array(M.length);let r,k,N;for(r=0,k=M.length;r<k;++r)N=M[r],A[r]={[_]:N,[v]:l[N]};return A}function ET(l,o){const u=l&&l.options.stacked;return u||u===void 0&&o.stack!==void 0}function IR(l,o,u){return`${l.id}.${o.id}.${u.stack||u.type}`}function CR(l){const{min:o,max:u,minDefined:m,maxDefined:_}=l.getUserBounds();return{min:m?o:Number.NEGATIVE_INFINITY,max:_?u:Number.POSITIVE_INFINITY}}function PR(l,o,u){const m=l[o]||(l[o]={});return m[u]||(m[u]={})}function AT(l,o,u,m){for(const _ of o.getMatchingVisibleMetas(m).reverse()){const v=l[_.index];if(u&&v>0||!u&&v<0)return _.index}return null}function IT(l,o){const{chart:u,_cachedMeta:m}=l,_=u._stacks||(u._stacks={}),{iScale:v,vScale:M,index:A}=m,r=v.axis,k=M.axis,N=IR(v,M,m),G=o.length;let K;for(let ie=0;ie<G;++ie){const pe=o[ie],{[r]:ge,[k]:Te}=pe,Re=pe._stacks||(pe._stacks={});K=Re[k]=PR(_,N,ge),K[A]=Te,K._top=AT(K,M,!0,m.type),K._bottom=AT(K,M,!1,m.type);const $e=K._visualValues||(K._visualValues={});$e[A]=Te}}function Xy(l,o){const u=l.scales;return Object.keys(u).filter(m=>u[m].axis===o).shift()}function DR(l,o){return Al(l,{active:!1,dataset:void 0,datasetIndex:o,index:o,mode:"default",type:"dataset"})}function LR(l,o,u){return Al(l,{active:!1,dataIndex:o,parsed:void 0,raw:void 0,element:u,index:o,mode:"default",type:"data"})}function lf(l,o){const u=l.controller.index,m=l.vScale&&l.vScale.axis;if(m){o=o||l._parsed;for(const _ of o){const v=_._stacks;if(!v||v[m]===void 0||v[m][u]===void 0)return;delete v[m][u],v[m]._visualValues!==void 0&&v[m]._visualValues[u]!==void 0&&delete v[m]._visualValues[u]}}}const Yy=l=>l==="reset"||l==="none",CT=(l,o)=>o?l:Object.assign({},l),kR=(l,o,u)=>l&&!o.hidden&&o._stacked&&{keys:nE(u,!0),values:null};class ho{constructor(o,u){this.chart=o,this._ctx=o.ctx,this.index=u,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const o=this._cachedMeta;this.configure(),this.linkScales(),o._stacked=ET(o.vScale,o),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(o){this.index!==o&&lf(this._cachedMeta),this.index=o}linkScales(){const o=this.chart,u=this._cachedMeta,m=this.getDataset(),_=(G,K,ie,pe)=>G==="x"?K:G==="r"?pe:ie,v=u.xAxisID=sn(m.xAxisID,Xy(o,"x")),M=u.yAxisID=sn(m.yAxisID,Xy(o,"y")),A=u.rAxisID=sn(m.rAxisID,Xy(o,"r")),r=u.indexAxis,k=u.iAxisID=_(r,v,M,A),N=u.vAxisID=_(r,M,v,A);u.xScale=this.getScaleForId(v),u.yScale=this.getScaleForId(M),u.rScale=this.getScaleForId(A),u.iScale=this.getScaleForId(k),u.vScale=this.getScaleForId(N)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(o){return this.chart.scales[o]}_getOtherScale(o){const u=this._cachedMeta;return o===u.iScale?u.vScale:u.iScale}reset(){this._update("reset")}_destroy(){const o=this._cachedMeta;this._data&&uT(this._data,this),o._stacked&&lf(o)}_dataCheck(){const o=this.getDataset(),u=o.data||(o.data=[]),m=this._data;if(yn(u)){const _=this._cachedMeta;this._data=AR(u,_)}else if(m!==u){if(m){uT(m,this);const _=this._cachedMeta;lf(_),_._parsed=[]}u&&Object.isExtensible(u)&&yk(u,this),this._syncList=[],this._data=u}}addElements(){const o=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(o.dataset=new this.datasetElementType)}buildOrUpdateElements(o){const u=this._cachedMeta,m=this.getDataset();let _=!1;this._dataCheck();const v=u._stacked;u._stacked=ET(u.vScale,u),u.stack!==m.stack&&(_=!0,lf(u),u.stack=m.stack),this._resyncElements(o),(_||v!==u._stacked)&&IT(this,u._parsed)}configure(){const o=this.chart.config,u=o.datasetScopeKeys(this._type),m=o.getOptionScopes(this.getDataset(),u,!0);this.options=o.createResolver(m,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(o,u){const{_cachedMeta:m,_data:_}=this,{iScale:v,_stacked:M}=m,A=v.axis;let r=o===0&&u===_.length?!0:m._sorted,k=o>0&&m._parsed[o-1],N,G,K;if(this._parsing===!1)m._parsed=_,m._sorted=!0,K=_;else{ar(_[o])?K=this.parseArrayData(m,_,o,u):yn(_[o])?K=this.parseObjectData(m,_,o,u):K=this.parsePrimitiveData(m,_,o,u);const ie=()=>G[A]===null||k&&G[A]<k[A];for(N=0;N<u;++N)m._parsed[N+o]=G=K[N],r&&(ie()&&(r=!1),k=G);m._sorted=r}M&&IT(this,K)}parsePrimitiveData(o,u,m,_){const{iScale:v,vScale:M}=o,A=v.axis,r=M.axis,k=v.getLabels(),N=v===M,G=new Array(_);let K,ie,pe;for(K=0,ie=_;K<ie;++K)pe=K+m,G[K]={[A]:N||v.parse(k[pe],pe),[r]:M.parse(u[pe],pe)};return G}parseArrayData(o,u,m,_){const{xScale:v,yScale:M}=o,A=new Array(_);let r,k,N,G;for(r=0,k=_;r<k;++r)N=r+m,G=u[N],A[r]={x:v.parse(G[0],N),y:M.parse(G[1],N)};return A}parseObjectData(o,u,m,_){const{xScale:v,yScale:M}=o,{xAxisKey:A="x",yAxisKey:r="y"}=this._parsing,k=new Array(_);let N,G,K,ie;for(N=0,G=_;N<G;++N)K=N+m,ie=u[K],k[N]={x:v.parse(Tl(ie,A),K),y:M.parse(Tl(ie,r),K)};return k}getParsed(o){return this._cachedMeta._parsed[o]}getDataElement(o){return this._cachedMeta.data[o]}applyStack(o,u,m){const _=this.chart,v=this._cachedMeta,M=u[o.axis],A={keys:nE(_,!0),values:u._stacks[o.axis]._visualValues};return ST(A,M,v.index,{mode:m})}updateRangeFromParsed(o,u,m,_){const v=m[u.axis];let M=v===null?NaN:v;const A=_&&m._stacks[u.axis];_&&A&&(_.values=A,M=ST(_,v,this._cachedMeta.index)),o.min=Math.min(o.min,M),o.max=Math.max(o.max,M)}getMinMax(o,u){const m=this._cachedMeta,_=m._parsed,v=m._sorted&&o===m.iScale,M=_.length,A=this._getOtherScale(o),r=kR(u,m,this.chart),k={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:N,max:G}=CR(A);let K,ie;function pe(){ie=_[K];const ge=ie[A.axis];return!pr(ie[o.axis])||N>ge||G<ge}for(K=0;K<M&&!(!pe()&&(this.updateRangeFromParsed(k,o,ie,r),v));++K);if(v){for(K=M-1;K>=0;--K)if(!pe()){this.updateRangeFromParsed(k,o,ie,r);break}}return k}getAllParsedValues(o){const u=this._cachedMeta._parsed,m=[];let _,v,M;for(_=0,v=u.length;_<v;++_)M=u[_][o.axis],pr(M)&&m.push(M);return m}getMaxOverflow(){return!1}getLabelAndValue(o){const u=this._cachedMeta,m=u.iScale,_=u.vScale,v=this.getParsed(o);return{label:m?""+m.getLabelForValue(v[m.axis]):"",value:_?""+_.getLabelForValue(v[_.axis]):""}}_update(o){const u=this._cachedMeta;this.update(o||"default"),u._clip=ER(sn(this.options.clip,SR(u.xScale,u.yScale,this.getMaxOverflow())))}update(o){}draw(){const o=this._ctx,u=this.chart,m=this._cachedMeta,_=m.data||[],v=u.chartArea,M=[],A=this._drawStart||0,r=this._drawCount||_.length-A,k=this.options.drawActiveElementsOnTop;let N;for(m.dataset&&m.dataset.draw(o,v,A,r),N=A;N<A+r;++N){const G=_[N];G.hidden||(G.active&&k?M.push(G):G.draw(o,v))}for(N=0;N<M.length;++N)M[N].draw(o,v)}getStyle(o,u){const m=u?"active":"default";return o===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(m):this.resolveDataElementOptions(o||0,m)}getContext(o,u,m){const _=this.getDataset();let v;if(o>=0&&o<this._cachedMeta.data.length){const M=this._cachedMeta.data[o];v=M.$context||(M.$context=LR(this.getContext(),o,M)),v.parsed=this.getParsed(o),v.raw=_.data[o],v.index=v.dataIndex=o}else v=this.$context||(this.$context=DR(this.chart.getContext(),this.index)),v.dataset=_,v.index=v.datasetIndex=this.index;return v.active=!!u,v.mode=m,v}resolveDatasetElementOptions(o){return this._resolveElementOptions(this.datasetElementType.id,o)}resolveDataElementOptions(o,u){return this._resolveElementOptions(this.dataElementType.id,u,o)}_resolveElementOptions(o,u="default",m){const _=u==="active",v=this._cachedDataOpts,M=o+"-"+u,A=v[M],r=this.enableOptionSharing&&Of(m);if(A)return CT(A,r);const k=this.chart.config,N=k.datasetElementScopeKeys(this._type,o),G=_?[`${o}Hover`,"hover",o,""]:[o,""],K=k.getOptionScopes(this.getDataset(),N),ie=Object.keys(mr.elements[o]),pe=()=>this.getContext(m,_,u),ge=k.resolveNamedOptions(K,ie,pe,G);return ge.$shared&&(ge.$shared=r,v[M]=Object.freeze(CT(ge,r))),ge}_resolveAnimations(o,u,m){const _=this.chart,v=this._cachedDataOpts,M=`animation-${u}`,A=v[M];if(A)return A;let r;if(_.options.animation!==!1){const N=this.chart.config,G=N.datasetAnimationScopeKeys(this._type,u),K=N.getOptionScopes(this.getDataset(),G);r=N.createResolver(K,this.getContext(o,m,u))}const k=new iE(_,r&&r.animations);return r&&r._cacheable&&(v[M]=Object.freeze(k)),k}getSharedOptions(o){if(o.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},o))}includeOptions(o,u){return!u||Yy(o)||this.chart._animationsDisabled}_getSharedOptions(o,u){const m=this.resolveDataElementOptions(o,u),_=this._sharedOptions,v=this.getSharedOptions(m),M=this.includeOptions(u,v)||v!==_;return this.updateSharedOptions(v,u,m),{sharedOptions:v,includeOptions:M}}updateElement(o,u,m,_){Yy(_)?Object.assign(o,m):this._resolveAnimations(u,_).update(o,m)}updateSharedOptions(o,u,m){o&&!Yy(u)&&this._resolveAnimations(void 0,u).update(o,m)}_setStyle(o,u,m,_){o.active=_;const v=this.getStyle(u,_);this._resolveAnimations(u,m,_).update(o,{options:!_&&this.getSharedOptions(v)||v})}removeHoverStyle(o,u,m){this._setStyle(o,m,"active",!1)}setHoverStyle(o,u,m){this._setStyle(o,m,"active",!0)}_removeDatasetHoverStyle(){const o=this._cachedMeta.dataset;o&&this._setStyle(o,void 0,"active",!1)}_setDatasetHoverStyle(){const o=this._cachedMeta.dataset;o&&this._setStyle(o,void 0,"active",!0)}_resyncElements(o){const u=this._data,m=this._cachedMeta.data;for(const[A,r,k]of this._syncList)this[A](r,k);this._syncList=[];const _=m.length,v=u.length,M=Math.min(v,_);M&&this.parse(0,M),v>_?this._insertElements(_,v-_,o):v<_&&this._removeElements(v,_-v)}_insertElements(o,u,m=!0){const _=this._cachedMeta,v=_.data,M=o+u;let A;const r=k=>{for(k.length+=u,A=k.length-1;A>=M;A--)k[A]=k[A-u]};for(r(v),A=o;A<M;++A)v[A]=new this.dataElementType;this._parsing&&r(_._parsed),this.parse(o,u),m&&this.updateElements(v,o,u,"reset")}updateElements(o,u,m,_){}_removeElements(o,u){const m=this._cachedMeta;if(this._parsing){const _=m._parsed.splice(o,u);m._stacked&&lf(m,_)}m.data.splice(o,u)}_sync(o){if(this._parsing)this._syncList.push(o);else{const[u,m,_]=o;this[u](m,_)}this.chart._dataChanges.push([this.index,...o])}_onDataPush(){const o=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-o,o])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(o,u){u&&this._sync(["_removeElements",o,u]);const m=arguments.length-2;m&&this._sync(["_insertElements",o,m])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}ei(ho,"defaults",{}),ei(ho,"datasetElementType",null),ei(ho,"dataElementType",null);function RR(l,o){if(!l._cache.$bar){const u=l.getMatchingVisibleMetas(o);let m=[];for(let _=0,v=u.length;_<v;_++)m=m.concat(u[_].controller.getAllParsedValues(l));l._cache.$bar=FS(m.sort((_,v)=>_-v))}return l._cache.$bar}function zR(l){const o=l.iScale,u=RR(o,l.type);let m=o._length,_,v,M,A;const r=()=>{M===32767||M===-32768||(Of(A)&&(m=Math.min(m,Math.abs(M-A)||m)),A=M)};for(_=0,v=u.length;_<v;++_)M=o.getPixelForValue(u[_]),r();for(A=void 0,_=0,v=o.ticks.length;_<v;++_)M=o.getPixelForTick(_),r();return m}function OR(l,o,u,m){const _=u.barThickness;let v,M;return An(_)?(v=o.min*u.categoryPercentage,M=u.barPercentage):(v=_*m,M=1),{chunk:v/m,ratio:M,start:o.pixels[l]-v/2}}function FR(l,o,u,m){const _=o.pixels,v=_[l];let M=l>0?_[l-1]:null,A=l<_.length-1?_[l+1]:null;const r=u.categoryPercentage;M===null&&(M=v-(A===null?o.end-o.start:A-v)),A===null&&(A=v+v-M);const k=v-(v-Math.min(M,A))/2*r;return{chunk:Math.abs(A-M)/2*r/m,ratio:u.barPercentage,start:k}}function BR(l,o,u,m){const _=u.parse(l[0],m),v=u.parse(l[1],m),M=Math.min(_,v),A=Math.max(_,v);let r=M,k=A;Math.abs(M)>Math.abs(A)&&(r=A,k=M),o[u.axis]=k,o._custom={barStart:r,barEnd:k,start:_,end:v,min:M,max:A}}function rE(l,o,u,m){return ar(l)?BR(l,o,u,m):o[u.axis]=u.parse(l,m),o}function PT(l,o,u,m){const _=l.iScale,v=l.vScale,M=_.getLabels(),A=_===v,r=[];let k,N,G,K;for(k=u,N=u+m;k<N;++k)K=o[k],G={},G[_.axis]=A||_.parse(M[k],k),r.push(rE(K,G,v,k));return r}function Ky(l){return l&&l.barStart!==void 0&&l.barEnd!==void 0}function NR(l,o,u){return l!==0?jo(l):(o.isHorizontal()?1:-1)*(o.min>=u?1:-1)}function VR(l){let o,u,m,_,v;return l.horizontal?(o=l.base>l.x,u="left",m="right"):(o=l.base<l.y,u="bottom",m="top"),o?(_="end",v="start"):(_="start",v="end"),{start:u,end:m,reverse:o,top:_,bottom:v}}function UR(l,o,u,m){let _=o.borderSkipped;const v={};if(!_){l.borderSkipped=v;return}if(_===!0){l.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:M,end:A,reverse:r,top:k,bottom:N}=VR(l);_==="middle"&&u&&(l.enableBorderRadius=!0,(u._top||0)===m?_=k:(u._bottom||0)===m?_=N:(v[DT(N,M,A,r)]=!0,_=k)),v[DT(_,M,A,r)]=!0,l.borderSkipped=v}function DT(l,o,u,m){return m?(l=jR(l,o,u),l=LT(l,u,o)):l=LT(l,o,u),l}function jR(l,o,u){return l===o?u:l===u?o:l}function LT(l,o,u){return l==="start"?o:l==="end"?u:l}function GR(l,{inflateAmount:o},u){l.inflateAmount=o==="auto"?u===1?.33:0:o}class c_ extends ho{parsePrimitiveData(o,u,m,_){return PT(o,u,m,_)}parseArrayData(o,u,m,_){return PT(o,u,m,_)}parseObjectData(o,u,m,_){const{iScale:v,vScale:M}=o,{xAxisKey:A="x",yAxisKey:r="y"}=this._parsing,k=v.axis==="x"?A:r,N=M.axis==="x"?A:r,G=[];let K,ie,pe,ge;for(K=m,ie=m+_;K<ie;++K)ge=u[K],pe={},pe[v.axis]=v.parse(Tl(ge,k),K),G.push(rE(Tl(ge,N),pe,M,K));return G}updateRangeFromParsed(o,u,m,_){super.updateRangeFromParsed(o,u,m,_);const v=m._custom;v&&u===this._cachedMeta.vScale&&(o.min=Math.min(o.min,v.min),o.max=Math.max(o.max,v.max))}getMaxOverflow(){return 0}getLabelAndValue(o){const u=this._cachedMeta,{iScale:m,vScale:_}=u,v=this.getParsed(o),M=v._custom,A=Ky(M)?"["+M.start+", "+M.end+"]":""+_.getLabelForValue(v[_.axis]);return{label:""+m.getLabelForValue(v[m.axis]),value:A}}initialize(){this.enableOptionSharing=!0,super.initialize();const o=this._cachedMeta;o.stack=this.getDataset().stack}update(o){const u=this._cachedMeta;this.updateElements(u.data,0,u.data.length,o)}updateElements(o,u,m,_){const v=_==="reset",{index:M,_cachedMeta:{vScale:A}}=this,r=A.getBasePixel(),k=A.isHorizontal(),N=this._getRuler(),{sharedOptions:G,includeOptions:K}=this._getSharedOptions(u,_);for(let ie=u;ie<u+m;ie++){const pe=this.getParsed(ie),ge=v||An(pe[A.axis])?{base:r,head:r}:this._calculateBarValuePixels(ie),Te=this._calculateBarIndexPixels(ie,N),Re=(pe._stacks||{})[A.axis],$e={horizontal:k,base:ge.base,enableBorderRadius:!Re||Ky(pe._custom)||M===Re._top||M===Re._bottom,x:k?ge.head:Te.center,y:k?Te.center:ge.head,height:k?Te.size:Math.abs(ge.size),width:k?Math.abs(ge.size):Te.size};K&&($e.options=G||this.resolveDataElementOptions(ie,o[ie].active?"active":_));const tt=$e.options||o[ie].options;UR($e,tt,Re,M),GR($e,tt,N.ratio),this.updateElement(o[ie],ie,$e,_)}}_getStacks(o,u){const{iScale:m}=this._cachedMeta,_=m.getMatchingVisibleMetas(this._type).filter(r=>r.controller.options.grouped),v=m.options.stacked,M=[],A=r=>{const k=r.controller.getParsed(u),N=k&&k[r.vScale.axis];if(An(N)||isNaN(N))return!0};for(const r of _)if(!(u!==void 0&&A(r))&&((v===!1||M.indexOf(r.stack)===-1||v===void 0&&r.stack===void 0)&&M.push(r.stack),r.index===o))break;return M.length||M.push(void 0),M}_getStackCount(o){return this._getStacks(void 0,o).length}_getStackIndex(o,u,m){const _=this._getStacks(o,m),v=u!==void 0?_.indexOf(u):-1;return v===-1?_.length-1:v}_getRuler(){const o=this.options,u=this._cachedMeta,m=u.iScale,_=[];let v,M;for(v=0,M=u.data.length;v<M;++v)_.push(m.getPixelForValue(this.getParsed(v)[m.axis],v));const A=o.barThickness;return{min:A||zR(u),pixels:_,start:m._startPixel,end:m._endPixel,stackCount:this._getStackCount(),scale:m,grouped:o.grouped,ratio:A?1:o.categoryPercentage*o.barPercentage}}_calculateBarValuePixels(o){const{_cachedMeta:{vScale:u,_stacked:m,index:_},options:{base:v,minBarLength:M}}=this,A=v||0,r=this.getParsed(o),k=r._custom,N=Ky(k);let G=r[u.axis],K=0,ie=m?this.applyStack(u,r,m):G,pe,ge;ie!==G&&(K=ie-G,ie=G),N&&(G=k.barStart,ie=k.barEnd-k.barStart,G!==0&&jo(G)!==jo(k.barEnd)&&(K=0),K+=G);const Te=!An(v)&&!N?v:K;let Re=u.getPixelForValue(Te);if(this.chart.getDataVisibility(o)?pe=u.getPixelForValue(K+ie):pe=Re,ge=pe-Re,Math.abs(ge)<M){ge=NR(ge,u,A)*M,G===A&&(Re-=ge/2);const $e=u.getPixelForDecimal(0),tt=u.getPixelForDecimal(1),ut=Math.min($e,tt),ot=Math.max($e,tt);Re=Math.max(Math.min(Re,ot),ut),pe=Re+ge,m&&!N&&(r._stacks[u.axis]._visualValues[_]=u.getValueForPixel(pe)-u.getValueForPixel(Re))}if(Re===u.getPixelForValue(A)){const $e=jo(ge)*u.getLineWidthForValue(A)/2;Re+=$e,ge-=$e}return{size:ge,base:Re,head:pe,center:pe+ge/2}}_calculateBarIndexPixels(o,u){const m=u.scale,_=this.options,v=_.skipNull,M=sn(_.maxBarThickness,1/0);let A,r;if(u.grouped){const k=v?this._getStackCount(o):u.stackCount,N=_.barThickness==="flex"?FR(o,u,_,k):OR(o,u,_,k),G=this._getStackIndex(this.index,this._cachedMeta.stack,v?o:void 0);A=N.start+N.chunk*G+N.chunk/2,r=Math.min(M,N.chunk*N.ratio)}else A=m.getPixelForValue(this.getParsed(o)[m.axis],o),r=Math.min(M,u.min*u.ratio);return{base:A-r/2,head:A+r/2,center:A,size:r}}draw(){const o=this._cachedMeta,u=o.vScale,m=o.data,_=m.length;let v=0;for(;v<_;++v)this.getParsed(v)[u.axis]!==null&&!m[v].hidden&&m[v].draw(this._ctx)}}ei(c_,"id","bar"),ei(c_,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),ei(c_,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class u_ extends ho{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(o,u,m,_){const v=super.parsePrimitiveData(o,u,m,_);for(let M=0;M<v.length;M++)v[M]._custom=this.resolveDataElementOptions(M+m).radius;return v}parseArrayData(o,u,m,_){const v=super.parseArrayData(o,u,m,_);for(let M=0;M<v.length;M++){const A=u[m+M];v[M]._custom=sn(A[2],this.resolveDataElementOptions(M+m).radius)}return v}parseObjectData(o,u,m,_){const v=super.parseObjectData(o,u,m,_);for(let M=0;M<v.length;M++){const A=u[m+M];v[M]._custom=sn(A&&A.r&&+A.r,this.resolveDataElementOptions(M+m).radius)}return v}getMaxOverflow(){const o=this._cachedMeta.data;let u=0;for(let m=o.length-1;m>=0;--m)u=Math.max(u,o[m].size(this.resolveDataElementOptions(m))/2);return u>0&&u}getLabelAndValue(o){const u=this._cachedMeta,m=this.chart.data.labels||[],{xScale:_,yScale:v}=u,M=this.getParsed(o),A=_.getLabelForValue(M.x),r=v.getLabelForValue(M.y),k=M._custom;return{label:m[o]||"",value:"("+A+", "+r+(k?", "+k:"")+")"}}update(o){const u=this._cachedMeta.data;this.updateElements(u,0,u.length,o)}updateElements(o,u,m,_){const v=_==="reset",{iScale:M,vScale:A}=this._cachedMeta,{sharedOptions:r,includeOptions:k}=this._getSharedOptions(u,_),N=M.axis,G=A.axis;for(let K=u;K<u+m;K++){const ie=o[K],pe=!v&&this.getParsed(K),ge={},Te=ge[N]=v?M.getPixelForDecimal(.5):M.getPixelForValue(pe[N]),Re=ge[G]=v?A.getBasePixel():A.getPixelForValue(pe[G]);ge.skip=isNaN(Te)||isNaN(Re),k&&(ge.options=r||this.resolveDataElementOptions(K,ie.active?"active":_),v&&(ge.options.radius=0)),this.updateElement(ie,K,ge,_)}}resolveDataElementOptions(o,u){const m=this.getParsed(o);let _=super.resolveDataElementOptions(o,u);_.$shared&&(_=Object.assign({},_,{$shared:!1}));const v=_.radius;return u!=="active"&&(_.radius=0),_.radius+=sn(m&&m._custom,v),_}}ei(u_,"id","bubble"),ei(u_,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),ei(u_,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function $R(l,o,u){let m=1,_=1,v=0,M=0;if(o<Qn){const A=l,r=A+o,k=Math.cos(A),N=Math.sin(A),G=Math.cos(r),K=Math.sin(r),ie=(tt,ut,ot)=>Ff(tt,A,r,!0)?1:Math.max(ut,ut*u,ot,ot*u),pe=(tt,ut,ot)=>Ff(tt,A,r,!0)?-1:Math.min(ut,ut*u,ot,ot*u),ge=ie(0,k,G),Te=ie(wr,N,K),Re=pe(er,k,G),$e=pe(er+wr,N,K);m=(ge-Re)/2,_=(Te-$e)/2,v=-(ge+Re)/2,M=-(Te+$e)/2}return{ratioX:m,ratioY:_,offsetX:v,offsetY:M}}class kc extends ho{constructor(o,u){super(o,u),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(o,u){const m=this.getDataset().data,_=this._cachedMeta;if(this._parsing===!1)_._parsed=m;else{let v=r=>+m[r];if(yn(m[o])){const{key:r="value"}=this._parsing;v=k=>+Tl(m[k],r)}let M,A;for(M=o,A=o+u;M<A;++M)_._parsed[M]=v(M)}}_getRotation(){return co(this.options.rotation-90)}_getCircumference(){return co(this.options.circumference)}_getRotationExtents(){let o=Qn,u=-Qn;for(let m=0;m<this.chart.data.datasets.length;++m)if(this.chart.isDatasetVisible(m)&&this.chart.getDatasetMeta(m).type===this._type){const _=this.chart.getDatasetMeta(m).controller,v=_._getRotation(),M=_._getCircumference();o=Math.min(o,v),u=Math.max(u,v+M)}return{rotation:o,circumference:u-o}}update(o){const u=this.chart,{chartArea:m}=u,_=this._cachedMeta,v=_.data,M=this.getMaxBorderWidth()+this.getMaxOffset(v)+this.options.spacing,A=Math.max((Math.min(m.width,m.height)-M)/2,0),r=Math.min(rk(this.options.cutout,A),1),k=this._getRingWeight(this.index),{circumference:N,rotation:G}=this._getRotationExtents(),{ratioX:K,ratioY:ie,offsetX:pe,offsetY:ge}=$R(G,N,r),Te=(m.width-M)/K,Re=(m.height-M)/ie,$e=Math.max(Math.min(Te,Re)/2,0),tt=LS(this.options.radius,$e),ut=Math.max(tt*r,0),ot=(tt-ut)/this._getVisibleDatasetWeightTotal();this.offsetX=pe*tt,this.offsetY=ge*tt,_.total=this.calculateTotal(),this.outerRadius=tt-ot*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-ot*k,0),this.updateElements(v,0,v.length,o)}_circumference(o,u){const m=this.options,_=this._cachedMeta,v=this._getCircumference();return u&&m.animation.animateRotate||!this.chart.getDataVisibility(o)||_._parsed[o]===null||_.data[o].hidden?0:this.calculateCircumference(_._parsed[o]*v/Qn)}updateElements(o,u,m,_){const v=_==="reset",M=this.chart,A=M.chartArea,k=M.options.animation,N=(A.left+A.right)/2,G=(A.top+A.bottom)/2,K=v&&k.animateScale,ie=K?0:this.innerRadius,pe=K?0:this.outerRadius,{sharedOptions:ge,includeOptions:Te}=this._getSharedOptions(u,_);let Re=this._getRotation(),$e;for($e=0;$e<u;++$e)Re+=this._circumference($e,v);for($e=u;$e<u+m;++$e){const tt=this._circumference($e,v),ut=o[$e],ot={x:N+this.offsetX,y:G+this.offsetY,startAngle:Re,endAngle:Re+tt,circumference:tt,outerRadius:pe,innerRadius:ie};Te&&(ot.options=ge||this.resolveDataElementOptions($e,ut.active?"active":_)),Re+=tt,this.updateElement(ut,$e,ot,_)}}calculateTotal(){const o=this._cachedMeta,u=o.data;let m=0,_;for(_=0;_<u.length;_++){const v=o._parsed[_];v!==null&&!isNaN(v)&&this.chart.getDataVisibility(_)&&!u[_].hidden&&(m+=Math.abs(v))}return m}calculateCircumference(o){const u=this._cachedMeta.total;return u>0&&!isNaN(o)?Qn*(Math.abs(o)/u):0}getLabelAndValue(o){const u=this._cachedMeta,m=this.chart,_=m.data.labels||[],v=$f(u._parsed[o],m.options.locale);return{label:_[o]||"",value:v}}getMaxBorderWidth(o){let u=0;const m=this.chart;let _,v,M,A,r;if(!o){for(_=0,v=m.data.datasets.length;_<v;++_)if(m.isDatasetVisible(_)){M=m.getDatasetMeta(_),o=M.data,A=M.controller;break}}if(!o)return 0;for(_=0,v=o.length;_<v;++_)r=A.resolveDataElementOptions(_),r.borderAlign!=="inner"&&(u=Math.max(u,r.borderWidth||0,r.hoverBorderWidth||0));return u}getMaxOffset(o){let u=0;for(let m=0,_=o.length;m<_;++m){const v=this.resolveDataElementOptions(m);u=Math.max(u,v.offset||0,v.hoverOffset||0)}return u}_getRingWeightOffset(o){let u=0;for(let m=0;m<o;++m)this.chart.isDatasetVisible(m)&&(u+=this._getRingWeight(m));return u}_getRingWeight(o){return Math.max(sn(this.chart.data.datasets[o].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}ei(kc,"id","doughnut"),ei(kc,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),ei(kc,"descriptors",{_scriptable:o=>o!=="spacing",_indexable:o=>o!=="spacing"&&!o.startsWith("borderDash")&&!o.startsWith("hoverBorderDash")}),ei(kc,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(o){const u=o.data;if(u.labels.length&&u.datasets.length){const{labels:{pointStyle:m,color:_}}=o.legend.options;return u.labels.map((v,M)=>{const r=o.getDatasetMeta(0).controller.getStyle(M);return{text:v,fillStyle:r.backgroundColor,strokeStyle:r.borderColor,fontColor:_,lineWidth:r.borderWidth,pointStyle:m,hidden:!o.getDataVisibility(M),index:M}})}return[]}},onClick(o,u,m){m.chart.toggleDataVisibility(u.index),m.chart.update()}}}});class h_ extends ho{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(o){const u=this._cachedMeta,{dataset:m,data:_=[],_dataset:v}=u,M=this.chart._animationsDisabled;let{start:A,count:r}=VS(u,_,M);this._drawStart=A,this._drawCount=r,US(u)&&(A=0,r=_.length),m._chart=this.chart,m._datasetIndex=this.index,m._decimated=!!v._decimated,m.points=_;const k=this.resolveDatasetElementOptions(o);this.options.showLine||(k.borderWidth=0),k.segment=this.options.segment,this.updateElement(m,void 0,{animated:!M,options:k},o),this.updateElements(_,A,r,o)}updateElements(o,u,m,_){const v=_==="reset",{iScale:M,vScale:A,_stacked:r,_dataset:k}=this._cachedMeta,{sharedOptions:N,includeOptions:G}=this._getSharedOptions(u,_),K=M.axis,ie=A.axis,{spanGaps:pe,segment:ge}=this.options,Te=Qu(pe)?pe:Number.POSITIVE_INFINITY,Re=this.chart._animationsDisabled||v||_==="none",$e=u+m,tt=o.length;let ut=u>0&&this.getParsed(u-1);for(let ot=0;ot<tt;++ot){const at=o[ot],dt=Re?at:{};if(ot<u||ot>=$e){dt.skip=!0;continue}const xe=this.getParsed(ot),le=An(xe[ie]),Je=dt[K]=M.getPixelForValue(xe[K],ot),Mt=dt[ie]=v||le?A.getBasePixel():A.getPixelForValue(r?this.applyStack(A,xe,r):xe[ie],ot);dt.skip=isNaN(Je)||isNaN(Mt)||le,dt.stop=ot>0&&Math.abs(xe[K]-ut[K])>Te,ge&&(dt.parsed=xe,dt.raw=k.data[ot]),G&&(dt.options=N||this.resolveDataElementOptions(ot,at.active?"active":_)),Re||this.updateElement(at,ot,dt,_),ut=xe}}getMaxOverflow(){const o=this._cachedMeta,u=o.dataset,m=u.options&&u.options.borderWidth||0,_=o.data||[];if(!_.length)return m;const v=_[0].size(this.resolveDataElementOptions(0)),M=_[_.length-1].size(this.resolveDataElementOptions(_.length-1));return Math.max(m,v,M)/2}draw(){const o=this._cachedMeta;o.dataset.updateControlPoints(this.chart.chartArea,o.iScale.axis),super.draw()}}ei(h_,"id","line"),ei(h_,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),ei(h_,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class Cf extends ho{constructor(o,u){super(o,u),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(o){const u=this._cachedMeta,m=this.chart,_=m.data.labels||[],v=$f(u._parsed[o].r,m.options.locale);return{label:_[o]||"",value:v}}parseObjectData(o,u,m,_){return XS.bind(this)(o,u,m,_)}update(o){const u=this._cachedMeta.data;this._updateRadius(),this.updateElements(u,0,u.length,o)}getMinMax(){const o=this._cachedMeta,u={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return o.data.forEach((m,_)=>{const v=this.getParsed(_).r;!isNaN(v)&&this.chart.getDataVisibility(_)&&(v<u.min&&(u.min=v),v>u.max&&(u.max=v))}),u}_updateRadius(){const o=this.chart,u=o.chartArea,m=o.options,_=Math.min(u.right-u.left,u.bottom-u.top),v=Math.max(_/2,0),M=Math.max(m.cutoutPercentage?v/100*m.cutoutPercentage:1,0),A=(v-M)/o.getVisibleDatasetCount();this.outerRadius=v-A*this.index,this.innerRadius=this.outerRadius-A}updateElements(o,u,m,_){const v=_==="reset",M=this.chart,r=M.options.animation,k=this._cachedMeta.rScale,N=k.xCenter,G=k.yCenter,K=k.getIndexAngle(0)-.5*er;let ie=K,pe;const ge=360/this.countVisibleElements();for(pe=0;pe<u;++pe)ie+=this._computeAngle(pe,_,ge);for(pe=u;pe<u+m;pe++){const Te=o[pe];let Re=ie,$e=ie+this._computeAngle(pe,_,ge),tt=M.getDataVisibility(pe)?k.getDistanceFromCenterForValue(this.getParsed(pe).r):0;ie=$e,v&&(r.animateScale&&(tt=0),r.animateRotate&&(Re=$e=K));const ut={x:N,y:G,innerRadius:0,outerRadius:tt,startAngle:Re,endAngle:$e,options:this.resolveDataElementOptions(pe,Te.active?"active":_)};this.updateElement(Te,pe,ut,_)}}countVisibleElements(){const o=this._cachedMeta;let u=0;return o.data.forEach((m,_)=>{!isNaN(this.getParsed(_).r)&&this.chart.getDataVisibility(_)&&u++}),u}_computeAngle(o,u,m){return this.chart.getDataVisibility(o)?co(this.resolveDataElementOptions(o,u).angle||m):0}}ei(Cf,"id","polarArea"),ei(Cf,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),ei(Cf,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(o){const u=o.data;if(u.labels.length&&u.datasets.length){const{labels:{pointStyle:m,color:_}}=o.legend.options;return u.labels.map((v,M)=>{const r=o.getDatasetMeta(0).controller.getStyle(M);return{text:v,fillStyle:r.backgroundColor,strokeStyle:r.borderColor,fontColor:_,lineWidth:r.borderWidth,pointStyle:m,hidden:!o.getDataVisibility(M),index:M}})}return[]}},onClick(o,u,m){m.chart.toggleDataVisibility(u.index),m.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class v0 extends kc{}ei(v0,"id","pie"),ei(v0,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class d_ extends ho{getLabelAndValue(o){const u=this._cachedMeta.vScale,m=this.getParsed(o);return{label:u.getLabels()[o],value:""+u.getLabelForValue(m[u.axis])}}parseObjectData(o,u,m,_){return XS.bind(this)(o,u,m,_)}update(o){const u=this._cachedMeta,m=u.dataset,_=u.data||[],v=u.iScale.getLabels();if(m.points=_,o!=="resize"){const M=this.resolveDatasetElementOptions(o);this.options.showLine||(M.borderWidth=0);const A={_loop:!0,_fullLoop:v.length===_.length,options:M};this.updateElement(m,void 0,A,o)}this.updateElements(_,0,_.length,o)}updateElements(o,u,m,_){const v=this._cachedMeta.rScale,M=_==="reset";for(let A=u;A<u+m;A++){const r=o[A],k=this.resolveDataElementOptions(A,r.active?"active":_),N=v.getPointPositionForValue(A,this.getParsed(A).r),G=M?v.xCenter:N.x,K=M?v.yCenter:N.y,ie={x:G,y:K,angle:N.angle,skip:isNaN(G)||isNaN(K),options:k};this.updateElement(r,A,ie,_)}}}ei(d_,"id","radar"),ei(d_,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),ei(d_,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class f_ extends ho{getLabelAndValue(o){const u=this._cachedMeta,m=this.chart.data.labels||[],{xScale:_,yScale:v}=u,M=this.getParsed(o),A=_.getLabelForValue(M.x),r=v.getLabelForValue(M.y);return{label:m[o]||"",value:"("+A+", "+r+")"}}update(o){const u=this._cachedMeta,{data:m=[]}=u,_=this.chart._animationsDisabled;let{start:v,count:M}=VS(u,m,_);if(this._drawStart=v,this._drawCount=M,US(u)&&(v=0,M=m.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:A,_dataset:r}=u;A._chart=this.chart,A._datasetIndex=this.index,A._decimated=!!r._decimated,A.points=m;const k=this.resolveDatasetElementOptions(o);k.segment=this.options.segment,this.updateElement(A,void 0,{animated:!_,options:k},o)}else this.datasetElementType&&(delete u.dataset,this.datasetElementType=!1);this.updateElements(m,v,M,o)}addElements(){const{showLine:o}=this.options;!this.datasetElementType&&o&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(o,u,m,_){const v=_==="reset",{iScale:M,vScale:A,_stacked:r,_dataset:k}=this._cachedMeta,N=this.resolveDataElementOptions(u,_),G=this.getSharedOptions(N),K=this.includeOptions(_,G),ie=M.axis,pe=A.axis,{spanGaps:ge,segment:Te}=this.options,Re=Qu(ge)?ge:Number.POSITIVE_INFINITY,$e=this.chart._animationsDisabled||v||_==="none";let tt=u>0&&this.getParsed(u-1);for(let ut=u;ut<u+m;++ut){const ot=o[ut],at=this.getParsed(ut),dt=$e?ot:{},xe=An(at[pe]),le=dt[ie]=M.getPixelForValue(at[ie],ut),Je=dt[pe]=v||xe?A.getBasePixel():A.getPixelForValue(r?this.applyStack(A,at,r):at[pe],ut);dt.skip=isNaN(le)||isNaN(Je)||xe,dt.stop=ut>0&&Math.abs(at[ie]-tt[ie])>Re,Te&&(dt.parsed=at,dt.raw=k.data[ut]),K&&(dt.options=G||this.resolveDataElementOptions(ut,ot.active?"active":_)),$e||this.updateElement(ot,ut,dt,_),tt=at}this.updateSharedOptions(G,_,N)}getMaxOverflow(){const o=this._cachedMeta,u=o.data||[];if(!this.options.showLine){let A=0;for(let r=u.length-1;r>=0;--r)A=Math.max(A,u[r].size(this.resolveDataElementOptions(r))/2);return A>0&&A}const m=o.dataset,_=m.options&&m.options.borderWidth||0;if(!u.length)return _;const v=u[0].size(this.resolveDataElementOptions(0)),M=u[u.length-1].size(this.resolveDataElementOptions(u.length-1));return Math.max(_,v,M)/2}}ei(f_,"id","scatter"),ei(f_,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),ei(f_,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var WR=Object.freeze({__proto__:null,BarController:c_,BubbleController:u_,DoughnutController:kc,LineController:h_,PieController:v0,PolarAreaController:Cf,RadarController:d_,ScatterController:f_});function Ic(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class fx{constructor(o){ei(this,"options");this.options=o||{}}static override(o){Object.assign(fx.prototype,o)}init(){}formats(){return Ic()}parse(){return Ic()}format(){return Ic()}add(){return Ic()}diff(){return Ic()}startOf(){return Ic()}endOf(){return Ic()}}var HR={_date:fx};function qR(l,o,u,m){const{controller:_,data:v,_sorted:M}=l,A=_._cachedMeta.iScale;if(A&&o===A.axis&&o!=="r"&&M&&v.length){const r=A._reversePixels?_k:ba;if(m){if(_._sharedOptions){const k=v[0],N=typeof k.getRange=="function"&&k.getRange(o);if(N){const G=r(v,o,u-N),K=r(v,o,u+N);return{lo:G.lo,hi:K.hi}}}}else return r(v,o,u)}return{lo:0,hi:v.length-1}}function Wf(l,o,u,m,_){const v=l.getSortedVisibleDatasetMetas(),M=u[o];for(let A=0,r=v.length;A<r;++A){const{index:k,data:N}=v[A],{lo:G,hi:K}=qR(v[A],o,M,_);for(let ie=G;ie<=K;++ie){const pe=N[ie];pe.skip||m(pe,k,ie)}}}function ZR(l){const o=l.indexOf("x")!==-1,u=l.indexOf("y")!==-1;return function(m,_){const v=o?Math.abs(m.x-_.x):0,M=u?Math.abs(m.y-_.y):0;return Math.sqrt(Math.pow(v,2)+Math.pow(M,2))}}function Jy(l,o,u,m,_){const v=[];return!_&&!l.isPointInArea(o)||Wf(l,u,o,function(A,r,k){!_&&!wa(A,l.chartArea,0)||A.inRange(o.x,o.y,m)&&v.push({element:A,datasetIndex:r,index:k})},!0),v}function XR(l,o,u,m){let _=[];function v(M,A,r){const{startAngle:k,endAngle:N}=M.getProps(["startAngle","endAngle"],m),{angle:G}=zS(M,{x:o.x,y:o.y});Ff(G,k,N)&&_.push({element:M,datasetIndex:A,index:r})}return Wf(l,u,o,v),_}function YR(l,o,u,m,_,v){let M=[];const A=ZR(u);let r=Number.POSITIVE_INFINITY;function k(N,G,K){const ie=N.inRange(o.x,o.y,_);if(m&&!ie)return;const pe=N.getCenterPoint(_);if(!(!!v||l.isPointInArea(pe))&&!ie)return;const Te=A(o,pe);Te<r?(M=[{element:N,datasetIndex:G,index:K}],r=Te):Te===r&&M.push({element:N,datasetIndex:G,index:K})}return Wf(l,u,o,k),M}function Qy(l,o,u,m,_,v){return!v&&!l.isPointInArea(o)?[]:u==="r"&&!m?XR(l,o,u,_):YR(l,o,u,m,_,v)}function kT(l,o,u,m,_){const v=[],M=u==="x"?"inXRange":"inYRange";let A=!1;return Wf(l,u,o,(r,k,N)=>{r[M](o[u],_)&&(v.push({element:r,datasetIndex:k,index:N}),A=A||r.inRange(o.x,o.y,_))}),m&&!A?[]:v}var KR={evaluateInteractionItems:Wf,modes:{index(l,o,u,m){const _=Pc(o,l),v=u.axis||"x",M=u.includeInvisible||!1,A=u.intersect?Jy(l,_,v,m,M):Qy(l,_,v,!1,m,M),r=[];return A.length?(l.getSortedVisibleDatasetMetas().forEach(k=>{const N=A[0].index,G=k.data[N];G&&!G.skip&&r.push({element:G,datasetIndex:k.index,index:N})}),r):[]},dataset(l,o,u,m){const _=Pc(o,l),v=u.axis||"xy",M=u.includeInvisible||!1;let A=u.intersect?Jy(l,_,v,m,M):Qy(l,_,v,!1,m,M);if(A.length>0){const r=A[0].datasetIndex,k=l.getDatasetMeta(r).data;A=[];for(let N=0;N<k.length;++N)A.push({element:k[N],datasetIndex:r,index:N})}return A},point(l,o,u,m){const _=Pc(o,l),v=u.axis||"xy",M=u.includeInvisible||!1;return Jy(l,_,v,m,M)},nearest(l,o,u,m){const _=Pc(o,l),v=u.axis||"xy",M=u.includeInvisible||!1;return Qy(l,_,v,u.intersect,m,M)},x(l,o,u,m){const _=Pc(o,l);return kT(l,_,"x",u.intersect,m)},y(l,o,u,m){const _=Pc(o,l);return kT(l,_,"y",u.intersect,m)}}};const sE=["left","top","right","bottom"];function cf(l,o){return l.filter(u=>u.pos===o)}function RT(l,o){return l.filter(u=>sE.indexOf(u.pos)===-1&&u.box.axis===o)}function uf(l,o){return l.sort((u,m)=>{const _=o?m:u,v=o?u:m;return _.weight===v.weight?_.index-v.index:_.weight-v.weight})}function JR(l){const o=[];let u,m,_,v,M,A;for(u=0,m=(l||[]).length;u<m;++u)_=l[u],{position:v,options:{stack:M,stackWeight:A=1}}=_,o.push({index:u,box:_,pos:v,horizontal:_.isHorizontal(),weight:_.weight,stack:M&&v+M,stackWeight:A});return o}function QR(l){const o={};for(const u of l){const{stack:m,pos:_,stackWeight:v}=u;if(!m||!sE.includes(_))continue;const M=o[m]||(o[m]={count:0,placed:0,weight:0,size:0});M.count++,M.weight+=v}return o}function ez(l,o){const u=QR(l),{vBoxMaxWidth:m,hBoxMaxHeight:_}=o;let v,M,A;for(v=0,M=l.length;v<M;++v){A=l[v];const{fullSize:r}=A.box,k=u[A.stack],N=k&&A.stackWeight/k.weight;A.horizontal?(A.width=N?N*m:r&&o.availableWidth,A.height=_):(A.width=m,A.height=N?N*_:r&&o.availableHeight)}return u}function tz(l){const o=JR(l),u=uf(o.filter(k=>k.box.fullSize),!0),m=uf(cf(o,"left"),!0),_=uf(cf(o,"right")),v=uf(cf(o,"top"),!0),M=uf(cf(o,"bottom")),A=RT(o,"x"),r=RT(o,"y");return{fullSize:u,leftAndTop:m.concat(v),rightAndBottom:_.concat(r).concat(M).concat(A),chartArea:cf(o,"chartArea"),vertical:m.concat(_).concat(r),horizontal:v.concat(M).concat(A)}}function zT(l,o,u,m){return Math.max(l[u],o[u])+Math.max(l[m],o[m])}function oE(l,o){l.top=Math.max(l.top,o.top),l.left=Math.max(l.left,o.left),l.bottom=Math.max(l.bottom,o.bottom),l.right=Math.max(l.right,o.right)}function iz(l,o,u,m){const{pos:_,box:v}=u,M=l.maxPadding;if(!yn(_)){u.size&&(l[_]-=u.size);const G=m[u.stack]||{size:0,count:1};G.size=Math.max(G.size,u.horizontal?v.height:v.width),u.size=G.size/G.count,l[_]+=u.size}v.getPadding&&oE(M,v.getPadding());const A=Math.max(0,o.outerWidth-zT(M,l,"left","right")),r=Math.max(0,o.outerHeight-zT(M,l,"top","bottom")),k=A!==l.w,N=r!==l.h;return l.w=A,l.h=r,u.horizontal?{same:k,other:N}:{same:N,other:k}}function nz(l){const o=l.maxPadding;function u(m){const _=Math.max(o[m]-l[m],0);return l[m]+=_,_}l.y+=u("top"),l.x+=u("left"),u("right"),u("bottom")}function rz(l,o){const u=o.maxPadding;function m(_){const v={left:0,top:0,right:0,bottom:0};return _.forEach(M=>{v[M]=Math.max(o[M],u[M])}),v}return m(l?["left","right"]:["top","bottom"])}function _f(l,o,u,m){const _=[];let v,M,A,r,k,N;for(v=0,M=l.length,k=0;v<M;++v){A=l[v],r=A.box,r.update(A.width||o.w,A.height||o.h,rz(A.horizontal,o));const{same:G,other:K}=iz(o,u,A,m);k|=G&&_.length,N=N||K,r.fullSize||_.push(A)}return k&&_f(_,o,u,m)||N}function Ym(l,o,u,m,_){l.top=u,l.left=o,l.right=o+m,l.bottom=u+_,l.width=m,l.height=_}function OT(l,o,u,m){const _=u.padding;let{x:v,y:M}=o;for(const A of l){const r=A.box,k=m[A.stack]||{count:1,placed:0,weight:1},N=A.stackWeight/k.weight||1;if(A.horizontal){const G=o.w*N,K=k.size||r.height;Of(k.start)&&(M=k.start),r.fullSize?Ym(r,_.left,M,u.outerWidth-_.right-_.left,K):Ym(r,o.left+k.placed,M,G,K),k.start=M,k.placed+=G,M=r.bottom}else{const G=o.h*N,K=k.size||r.width;Of(k.start)&&(v=k.start),r.fullSize?Ym(r,v,_.top,K,u.outerHeight-_.bottom-_.top):Ym(r,v,o.top+k.placed,K,G),k.start=v,k.placed+=G,v=r.right}}o.x=v,o.y=M}var Qr={addBox(l,o){l.boxes||(l.boxes=[]),o.fullSize=o.fullSize||!1,o.position=o.position||"top",o.weight=o.weight||0,o._layers=o._layers||function(){return[{z:0,draw(u){o.draw(u)}}]},l.boxes.push(o)},removeBox(l,o){const u=l.boxes?l.boxes.indexOf(o):-1;u!==-1&&l.boxes.splice(u,1)},configure(l,o,u){o.fullSize=u.fullSize,o.position=u.position,o.weight=u.weight},update(l,o,u,m){if(!l)return;const _=es(l.options.layout.padding),v=Math.max(o-_.width,0),M=Math.max(u-_.height,0),A=tz(l.boxes),r=A.vertical,k=A.horizontal;Gn(l.boxes,ge=>{typeof ge.beforeLayout=="function"&&ge.beforeLayout()});const N=r.reduce((ge,Te)=>Te.box.options&&Te.box.options.display===!1?ge:ge+1,0)||1,G=Object.freeze({outerWidth:o,outerHeight:u,padding:_,availableWidth:v,availableHeight:M,vBoxMaxWidth:v/2/N,hBoxMaxHeight:M/2}),K=Object.assign({},_);oE(K,es(m));const ie=Object.assign({maxPadding:K,w:v,h:M,x:_.left,y:_.top},_),pe=ez(r.concat(k),G);_f(A.fullSize,ie,G,pe),_f(r,ie,G,pe),_f(k,ie,G,pe)&&_f(r,ie,G,pe),nz(ie),OT(A.leftAndTop,ie,G,pe),ie.x+=ie.w,ie.y+=ie.h,OT(A.rightAndBottom,ie,G,pe),l.chartArea={left:ie.left,top:ie.top,right:ie.left+ie.w,bottom:ie.top+ie.h,height:ie.h,width:ie.w},Gn(A.chartArea,ge=>{const Te=ge.box;Object.assign(Te,l.chartArea),Te.update(ie.w,ie.h,{left:0,top:0,right:0,bottom:0})})}};class aE{acquireContext(o,u){}releaseContext(o){return!1}addEventListener(o,u,m){}removeEventListener(o,u,m){}getDevicePixelRatio(){return 1}getMaximumSize(o,u,m,_){return u=Math.max(0,u||o.width),m=m||o.height,{width:u,height:Math.max(0,_?Math.floor(u/_):m)}}isAttached(o){return!0}updateConfig(o){}}class sz extends aE{acquireContext(o){return o&&o.getContext&&o.getContext("2d")||null}updateConfig(o){o.options.animation=!1}}const p_="$chartjs",oz={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},FT=l=>l===null||l==="";function az(l,o){const u=l.style,m=l.getAttribute("height"),_=l.getAttribute("width");if(l[p_]={initial:{height:m,width:_,style:{display:u.display,height:u.height,width:u.width}}},u.display=u.display||"block",u.boxSizing=u.boxSizing||"border-box",FT(_)){const v=xT(l,"width");v!==void 0&&(l.width=v)}if(FT(m))if(l.style.height==="")l.height=l.width/(o||2);else{const v=xT(l,"height");v!==void 0&&(l.height=v)}return l}const lE=cR?{passive:!0}:!1;function lz(l,o,u){l&&l.addEventListener(o,u,lE)}function cz(l,o,u){l&&l.canvas&&l.canvas.removeEventListener(o,u,lE)}function uz(l,o){const u=oz[l.type]||l.type,{x:m,y:_}=Pc(l,o);return{type:u,chart:o,native:l,x:m!==void 0?m:null,y:_!==void 0?_:null}}function A_(l,o){for(const u of l)if(u===o||u.contains(o))return!0}function hz(l,o,u){const m=l.canvas,_=new MutationObserver(v=>{let M=!1;for(const A of v)M=M||A_(A.addedNodes,m),M=M&&!A_(A.removedNodes,m);M&&u()});return _.observe(document,{childList:!0,subtree:!0}),_}function dz(l,o,u){const m=l.canvas,_=new MutationObserver(v=>{let M=!1;for(const A of v)M=M||A_(A.removedNodes,m),M=M&&!A_(A.addedNodes,m);M&&u()});return _.observe(document,{childList:!0,subtree:!0}),_}const Nf=new Map;let BT=0;function cE(){const l=window.devicePixelRatio;l!==BT&&(BT=l,Nf.forEach((o,u)=>{u.currentDevicePixelRatio!==l&&o()}))}function fz(l,o){Nf.size||window.addEventListener("resize",cE),Nf.set(l,o)}function pz(l){Nf.delete(l),Nf.size||window.removeEventListener("resize",cE)}function mz(l,o,u){const m=l.canvas,_=m&&dx(m);if(!_)return;const v=NS((A,r)=>{const k=_.clientWidth;u(A,r),k<_.clientWidth&&u()},window),M=new ResizeObserver(A=>{const r=A[0],k=r.contentRect.width,N=r.contentRect.height;k===0&&N===0||v(k,N)});return M.observe(_),fz(l,v),M}function e0(l,o,u){u&&u.disconnect(),o==="resize"&&pz(l)}function _z(l,o,u){const m=l.canvas,_=NS(v=>{l.ctx!==null&&u(uz(v,l))},l);return lz(m,o,_),_}class gz extends aE{acquireContext(o,u){const m=o&&o.getContext&&o.getContext("2d");return m&&m.canvas===o?(az(o,u),m):null}releaseContext(o){const u=o.canvas;if(!u[p_])return!1;const m=u[p_].initial;["height","width"].forEach(v=>{const M=m[v];An(M)?u.removeAttribute(v):u.setAttribute(v,M)});const _=m.style||{};return Object.keys(_).forEach(v=>{u.style[v]=_[v]}),u.width=u.width,delete u[p_],!0}addEventListener(o,u,m){this.removeEventListener(o,u);const _=o.$proxies||(o.$proxies={}),M={attach:hz,detach:dz,resize:mz}[u]||_z;_[u]=M(o,u,m)}removeEventListener(o,u){const m=o.$proxies||(o.$proxies={}),_=m[u];if(!_)return;({attach:e0,detach:e0,resize:e0}[u]||cz)(o,u,_),m[u]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(o,u,m,_){return lR(o,u,m,_)}isAttached(o){const u=o&&dx(o);return!!(u&&u.isConnected)}}function yz(l){return!hx()||typeof OffscreenCanvas<"u"&&l instanceof OffscreenCanvas?sz:gz}var r_;let Sa=(r_=class{constructor(){ei(this,"x");ei(this,"y");ei(this,"active",!1);ei(this,"options");ei(this,"$animations")}tooltipPosition(o){const{x:u,y:m}=this.getProps(["x","y"],o);return{x:u,y:m}}hasValue(){return Qu(this.x)&&Qu(this.y)}getProps(o,u){const m=this.$animations;if(!u||!m)return this;const _={};return o.forEach(v=>{_[v]=m[v]&&m[v].active()?m[v]._to:this[v]}),_}},ei(r_,"defaults",{}),ei(r_,"defaultRoutes"),r_);function xz(l,o){const u=l.options.ticks,m=vz(l),_=Math.min(u.maxTicksLimit||m,m),v=u.major.enabled?wz(o):[],M=v.length,A=v[0],r=v[M-1],k=[];if(M>_)return Tz(o,k,v,M/_),k;const N=bz(v,o,_);if(M>0){let G,K;const ie=M>1?Math.round((r-A)/(M-1)):null;for(Km(o,k,N,An(ie)?0:A-ie,A),G=0,K=M-1;G<K;G++)Km(o,k,N,v[G],v[G+1]);return Km(o,k,N,r,An(ie)?o.length:r+ie),k}return Km(o,k,N),k}function vz(l){const o=l.options.offset,u=l._tickSize(),m=l._length/u+(o?0:1),_=l._maxLength/u;return Math.floor(Math.min(m,_))}function bz(l,o,u){const m=Mz(l),_=o.length/u;if(!m)return Math.max(_,1);const v=dk(m);for(let M=0,A=v.length-1;M<A;M++){const r=v[M];if(r>_)return r}return Math.max(_,1)}function wz(l){const o=[];let u,m;for(u=0,m=l.length;u<m;u++)l[u].major&&o.push(u);return o}function Tz(l,o,u,m){let _=0,v=u[0],M;for(m=Math.ceil(m),M=0;M<l.length;M++)M===v&&(o.push(l[M]),_++,v=u[_*m])}function Km(l,o,u,m,_){const v=sn(m,0),M=Math.min(sn(_,l.length),l.length);let A=0,r,k,N;for(u=Math.ceil(u),_&&(r=_-m,u=r/Math.floor(r/u)),N=v;N<0;)A++,N=Math.round(v+A*u);for(k=Math.max(v,0);k<M;k++)k===N&&(o.push(l[k]),A++,N=Math.round(v+A*u))}function Mz(l){const o=l.length;let u,m;if(o<2)return!1;for(m=l[0],u=1;u<o;++u)if(l[u]-l[u-1]!==m)return!1;return m}const Sz=l=>l==="left"?"right":l==="right"?"left":l,NT=(l,o,u)=>o==="top"||o==="left"?l[o]+u:l[o]-u,VT=(l,o)=>Math.min(o||l,l);function UT(l,o){const u=[],m=l.length/o,_=l.length;let v=0;for(;v<_;v+=m)u.push(l[Math.floor(v)]);return u}function Ez(l,o,u){const m=l.ticks.length,_=Math.min(o,m-1),v=l._startPixel,M=l._endPixel,A=1e-6;let r=l.getPixelForTick(_),k;if(!(u&&(m===1?k=Math.max(r-v,M-r):o===0?k=(l.getPixelForTick(1)-r)/2:k=(r-l.getPixelForTick(_-1))/2,r+=_<o?k:-k,r<v-A||r>M+A)))return r}function Az(l,o){Gn(l,u=>{const m=u.gc,_=m.length/2;let v;if(_>o){for(v=0;v<_;++v)delete u.data[m[v]];m.splice(0,_)}})}function hf(l){return l.drawTicks?l.tickLength:0}function jT(l,o){if(!l.display)return 0;const u=Pr(l.font,o),m=es(l.padding);return(ar(l.text)?l.text.length:1)*u.lineHeight+m.height}function Iz(l,o){return Al(l,{scale:o,type:"scale"})}function Cz(l,o,u){return Al(l,{tick:u,index:o,type:"tick"})}function Pz(l,o,u){let m=sx(l);return(u&&o!=="right"||!u&&o==="right")&&(m=Sz(m)),m}function Dz(l,o,u,m){const{top:_,left:v,bottom:M,right:A,chart:r}=l,{chartArea:k,scales:N}=r;let G=0,K,ie,pe;const ge=M-_,Te=A-v;if(l.isHorizontal()){if(ie=Yr(m,v,A),yn(u)){const Re=Object.keys(u)[0],$e=u[Re];pe=N[Re].getPixelForValue($e)+ge-o}else u==="center"?pe=(k.bottom+k.top)/2+ge-o:pe=NT(l,u,o);K=A-v}else{if(yn(u)){const Re=Object.keys(u)[0],$e=u[Re];ie=N[Re].getPixelForValue($e)-Te+o}else u==="center"?ie=(k.left+k.right)/2-Te+o:ie=NT(l,u,o);pe=Yr(m,M,_),G=u==="left"?-wr:wr}return{titleX:ie,titleY:pe,maxWidth:K,rotation:G}}class jc extends Sa{constructor(o){super(),this.id=o.id,this.type=o.type,this.options=void 0,this.ctx=o.ctx,this.chart=o.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(o){this.options=o.setContext(this.getContext()),this.axis=o.axis,this._userMin=this.parse(o.min),this._userMax=this.parse(o.max),this._suggestedMin=this.parse(o.suggestedMin),this._suggestedMax=this.parse(o.suggestedMax)}parse(o,u){return o}getUserBounds(){let{_userMin:o,_userMax:u,_suggestedMin:m,_suggestedMax:_}=this;return o=ks(o,Number.POSITIVE_INFINITY),u=ks(u,Number.NEGATIVE_INFINITY),m=ks(m,Number.POSITIVE_INFINITY),_=ks(_,Number.NEGATIVE_INFINITY),{min:ks(o,m),max:ks(u,_),minDefined:pr(o),maxDefined:pr(u)}}getMinMax(o){let{min:u,max:m,minDefined:_,maxDefined:v}=this.getUserBounds(),M;if(_&&v)return{min:u,max:m};const A=this.getMatchingVisibleMetas();for(let r=0,k=A.length;r<k;++r)M=A[r].controller.getMinMax(this,o),_||(u=Math.min(u,M.min)),v||(m=Math.max(m,M.max));return u=v&&u>m?m:u,m=_&&u>m?u:m,{min:ks(u,ks(m,u)),max:ks(m,ks(u,m))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const o=this.chart.data;return this.options.labels||(this.isHorizontal()?o.xLabels:o.yLabels)||o.labels||[]}getLabelItems(o=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(o))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Xn(this.options.beforeUpdate,[this])}update(o,u,m){const{beginAtZero:_,grace:v,ticks:M}=this.options,A=M.sampleSize;this.beforeUpdate(),this.maxWidth=o,this.maxHeight=u,this._margins=m=Object.assign({left:0,right:0,top:0,bottom:0},m),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+m.left+m.right:this.height+m.top+m.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=Vk(this,v,_),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const r=A<this.ticks.length;this._convertTicksToLabels(r?UT(this.ticks,A):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),M.display&&(M.autoSkip||M.source==="auto")&&(this.ticks=xz(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),r&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let o=this.options.reverse,u,m;this.isHorizontal()?(u=this.left,m=this.right):(u=this.top,m=this.bottom,o=!o),this._startPixel=u,this._endPixel=m,this._reversePixels=o,this._length=m-u,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Xn(this.options.afterUpdate,[this])}beforeSetDimensions(){Xn(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Xn(this.options.afterSetDimensions,[this])}_callHooks(o){this.chart.notifyPlugins(o,this.getContext()),Xn(this.options[o],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Xn(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(o){const u=this.options.ticks;let m,_,v;for(m=0,_=o.length;m<_;m++)v=o[m],v.label=Xn(u.callback,[v.value,m,o],this)}afterTickToLabelConversion(){Xn(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Xn(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const o=this.options,u=o.ticks,m=VT(this.ticks.length,o.ticks.maxTicksLimit),_=u.minRotation||0,v=u.maxRotation;let M=_,A,r,k;if(!this._isVisible()||!u.display||_>=v||m<=1||!this.isHorizontal()){this.labelRotation=_;return}const N=this._getLabelSizes(),G=N.widest.width,K=N.highest.height,ie=Rr(this.chart.width-G,0,this.maxWidth);A=o.offset?this.maxWidth/m:ie/(m-1),G+6>A&&(A=ie/(m-(o.offset?.5:1)),r=this.maxHeight-hf(o.grid)-u.padding-jT(o.title,this.chart.options.font),k=Math.sqrt(G*G+K*K),M=nx(Math.min(Math.asin(Rr((N.highest.height+6)/A,-1,1)),Math.asin(Rr(r/k,-1,1))-Math.asin(Rr(K/k,-1,1)))),M=Math.max(_,Math.min(v,M))),this.labelRotation=M}afterCalculateLabelRotation(){Xn(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Xn(this.options.beforeFit,[this])}fit(){const o={width:0,height:0},{chart:u,options:{ticks:m,title:_,grid:v}}=this,M=this._isVisible(),A=this.isHorizontal();if(M){const r=jT(_,u.options.font);if(A?(o.width=this.maxWidth,o.height=hf(v)+r):(o.height=this.maxHeight,o.width=hf(v)+r),m.display&&this.ticks.length){const{first:k,last:N,widest:G,highest:K}=this._getLabelSizes(),ie=m.padding*2,pe=co(this.labelRotation),ge=Math.cos(pe),Te=Math.sin(pe);if(A){const Re=m.mirror?0:Te*G.width+ge*K.height;o.height=Math.min(this.maxHeight,o.height+Re+ie)}else{const Re=m.mirror?0:ge*G.width+Te*K.height;o.width=Math.min(this.maxWidth,o.width+Re+ie)}this._calculatePadding(k,N,Te,ge)}}this._handleMargins(),A?(this.width=this._length=u.width-this._margins.left-this._margins.right,this.height=o.height):(this.width=o.width,this.height=this._length=u.height-this._margins.top-this._margins.bottom)}_calculatePadding(o,u,m,_){const{ticks:{align:v,padding:M},position:A}=this.options,r=this.labelRotation!==0,k=A!=="top"&&this.axis==="x";if(this.isHorizontal()){const N=this.getPixelForTick(0)-this.left,G=this.right-this.getPixelForTick(this.ticks.length-1);let K=0,ie=0;r?k?(K=_*o.width,ie=m*u.height):(K=m*o.height,ie=_*u.width):v==="start"?ie=u.width:v==="end"?K=o.width:v!=="inner"&&(K=o.width/2,ie=u.width/2),this.paddingLeft=Math.max((K-N+M)*this.width/(this.width-N),0),this.paddingRight=Math.max((ie-G+M)*this.width/(this.width-G),0)}else{let N=u.height/2,G=o.height/2;v==="start"?(N=0,G=o.height):v==="end"&&(N=u.height,G=0),this.paddingTop=N+M,this.paddingBottom=G+M}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Xn(this.options.afterFit,[this])}isHorizontal(){const{axis:o,position:u}=this.options;return u==="top"||u==="bottom"||o==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(o){this.beforeTickToLabelConversion(),this.generateTickLabels(o);let u,m;for(u=0,m=o.length;u<m;u++)An(o[u].label)&&(o.splice(u,1),m--,u--);this.afterTickToLabelConversion()}_getLabelSizes(){let o=this._labelSizes;if(!o){const u=this.options.ticks.sampleSize;let m=this.ticks;u<m.length&&(m=UT(m,u)),this._labelSizes=o=this._computeLabelSizes(m,m.length,this.options.ticks.maxTicksLimit)}return o}_computeLabelSizes(o,u,m){const{ctx:_,_longestTextCache:v}=this,M=[],A=[],r=Math.floor(u/VT(u,m));let k=0,N=0,G,K,ie,pe,ge,Te,Re,$e,tt,ut,ot;for(G=0;G<u;G+=r){if(pe=o[G].label,ge=this._resolveTickFontOptions(G),_.font=Te=ge.string,Re=v[Te]=v[Te]||{data:{},gc:[]},$e=ge.lineHeight,tt=ut=0,!An(pe)&&!ar(pe))tt=S_(_,Re.data,Re.gc,tt,pe),ut=$e;else if(ar(pe))for(K=0,ie=pe.length;K<ie;++K)ot=pe[K],!An(ot)&&!ar(ot)&&(tt=S_(_,Re.data,Re.gc,tt,ot),ut+=$e);M.push(tt),A.push(ut),k=Math.max(tt,k),N=Math.max(ut,N)}Az(v,u);const at=M.indexOf(k),dt=A.indexOf(N),xe=le=>({width:M[le]||0,height:A[le]||0});return{first:xe(0),last:xe(u-1),widest:xe(at),highest:xe(dt),widths:M,heights:A}}getLabelForValue(o){return o}getPixelForValue(o,u){return NaN}getValueForPixel(o){}getPixelForTick(o){const u=this.ticks;return o<0||o>u.length-1?null:this.getPixelForValue(u[o].value)}getPixelForDecimal(o){this._reversePixels&&(o=1-o);const u=this._startPixel+o*this._length;return mk(this._alignToPixels?Ac(this.chart,u,0):u)}getDecimalForPixel(o){const u=(o-this._startPixel)/this._length;return this._reversePixels?1-u:u}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:o,max:u}=this;return o<0&&u<0?u:o>0&&u>0?o:0}getContext(o){const u=this.ticks||[];if(o>=0&&o<u.length){const m=u[o];return m.$context||(m.$context=Cz(this.getContext(),o,m))}return this.$context||(this.$context=Iz(this.chart.getContext(),this))}_tickSize(){const o=this.options.ticks,u=co(this.labelRotation),m=Math.abs(Math.cos(u)),_=Math.abs(Math.sin(u)),v=this._getLabelSizes(),M=o.autoSkipPadding||0,A=v?v.widest.width+M:0,r=v?v.highest.height+M:0;return this.isHorizontal()?r*m>A*_?A/m:r/_:r*_<A*m?r/m:A/_}_isVisible(){const o=this.options.display;return o!=="auto"?!!o:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(o){const u=this.axis,m=this.chart,_=this.options,{grid:v,position:M,border:A}=_,r=v.offset,k=this.isHorizontal(),G=this.ticks.length+(r?1:0),K=hf(v),ie=[],pe=A.setContext(this.getContext()),ge=pe.display?pe.width:0,Te=ge/2,Re=function(si){return Ac(m,si,ge)};let $e,tt,ut,ot,at,dt,xe,le,Je,Mt,Qe,Zt;if(M==="top")$e=Re(this.bottom),dt=this.bottom-K,le=$e-Te,Mt=Re(o.top)+Te,Zt=o.bottom;else if(M==="bottom")$e=Re(this.top),Mt=o.top,Zt=Re(o.bottom)-Te,dt=$e+Te,le=this.top+K;else if(M==="left")$e=Re(this.right),at=this.right-K,xe=$e-Te,Je=Re(o.left)+Te,Qe=o.right;else if(M==="right")$e=Re(this.left),Je=o.left,Qe=Re(o.right)-Te,at=$e+Te,xe=this.left+K;else if(u==="x"){if(M==="center")$e=Re((o.top+o.bottom)/2+.5);else if(yn(M)){const si=Object.keys(M)[0],yt=M[si];$e=Re(this.chart.scales[si].getPixelForValue(yt))}Mt=o.top,Zt=o.bottom,dt=$e+Te,le=dt+K}else if(u==="y"){if(M==="center")$e=Re((o.left+o.right)/2);else if(yn(M)){const si=Object.keys(M)[0],yt=M[si];$e=Re(this.chart.scales[si].getPixelForValue(yt))}at=$e-Te,xe=at-K,Je=o.left,Qe=o.right}const xi=sn(_.ticks.maxTicksLimit,G),qe=Math.max(1,Math.ceil(G/xi));for(tt=0;tt<G;tt+=qe){const si=this.getContext(tt),yt=v.setContext(si),wt=A.setContext(si),Qt=yt.lineWidth,bn=yt.color,Ji=wt.dash||[],Nt=wt.dashOffset,Qi=yt.tickWidth,xn=yt.tickColor,un=yt.tickBorderDash||[],en=yt.tickBorderDashOffset;ut=Ez(this,tt,r),ut!==void 0&&(ot=Ac(m,ut,Qt),k?at=xe=Je=Qe=ot:dt=le=Mt=Zt=ot,ie.push({tx1:at,ty1:dt,tx2:xe,ty2:le,x1:Je,y1:Mt,x2:Qe,y2:Zt,width:Qt,color:bn,borderDash:Ji,borderDashOffset:Nt,tickWidth:Qi,tickColor:xn,tickBorderDash:un,tickBorderDashOffset:en}))}return this._ticksLength=G,this._borderValue=$e,ie}_computeLabelItems(o){const u=this.axis,m=this.options,{position:_,ticks:v}=m,M=this.isHorizontal(),A=this.ticks,{align:r,crossAlign:k,padding:N,mirror:G}=v,K=hf(m.grid),ie=K+N,pe=G?-N:ie,ge=-co(this.labelRotation),Te=[];let Re,$e,tt,ut,ot,at,dt,xe,le,Je,Mt,Qe,Zt="middle";if(_==="top")at=this.bottom-pe,dt=this._getXAxisLabelAlignment();else if(_==="bottom")at=this.top+pe,dt=this._getXAxisLabelAlignment();else if(_==="left"){const qe=this._getYAxisLabelAlignment(K);dt=qe.textAlign,ot=qe.x}else if(_==="right"){const qe=this._getYAxisLabelAlignment(K);dt=qe.textAlign,ot=qe.x}else if(u==="x"){if(_==="center")at=(o.top+o.bottom)/2+ie;else if(yn(_)){const qe=Object.keys(_)[0],si=_[qe];at=this.chart.scales[qe].getPixelForValue(si)+ie}dt=this._getXAxisLabelAlignment()}else if(u==="y"){if(_==="center")ot=(o.left+o.right)/2-ie;else if(yn(_)){const qe=Object.keys(_)[0],si=_[qe];ot=this.chart.scales[qe].getPixelForValue(si)}dt=this._getYAxisLabelAlignment(K).textAlign}u==="y"&&(r==="start"?Zt="top":r==="end"&&(Zt="bottom"));const xi=this._getLabelSizes();for(Re=0,$e=A.length;Re<$e;++Re){tt=A[Re],ut=tt.label;const qe=v.setContext(this.getContext(Re));xe=this.getPixelForTick(Re)+v.labelOffset,le=this._resolveTickFontOptions(Re),Je=le.lineHeight,Mt=ar(ut)?ut.length:1;const si=Mt/2,yt=qe.color,wt=qe.textStrokeColor,Qt=qe.textStrokeWidth;let bn=dt;M?(ot=xe,dt==="inner"&&(Re===$e-1?bn=this.options.reverse?"left":"right":Re===0?bn=this.options.reverse?"right":"left":bn="center"),_==="top"?k==="near"||ge!==0?Qe=-Mt*Je+Je/2:k==="center"?Qe=-xi.highest.height/2-si*Je+Je:Qe=-xi.highest.height+Je/2:k==="near"||ge!==0?Qe=Je/2:k==="center"?Qe=xi.highest.height/2-si*Je:Qe=xi.highest.height-Mt*Je,G&&(Qe*=-1),ge!==0&&!qe.showLabelBackdrop&&(ot+=Je/2*Math.sin(ge))):(at=xe,Qe=(1-Mt)*Je/2);let Ji;if(qe.showLabelBackdrop){const Nt=es(qe.backdropPadding),Qi=xi.heights[Re],xn=xi.widths[Re];let un=Qe-Nt.top,en=0-Nt.left;switch(Zt){case"middle":un-=Qi/2;break;case"bottom":un-=Qi;break}switch(dt){case"center":en-=xn/2;break;case"right":en-=xn;break;case"inner":Re===$e-1?en-=xn:Re>0&&(en-=xn/2);break}Ji={left:en,top:un,width:xn+Nt.width,height:Qi+Nt.height,color:qe.backdropColor}}Te.push({label:ut,font:le,textOffset:Qe,options:{rotation:ge,color:yt,strokeColor:wt,strokeWidth:Qt,textAlign:bn,textBaseline:Zt,translation:[ot,at],backdrop:Ji}})}return Te}_getXAxisLabelAlignment(){const{position:o,ticks:u}=this.options;if(-co(this.labelRotation))return o==="top"?"left":"right";let _="center";return u.align==="start"?_="left":u.align==="end"?_="right":u.align==="inner"&&(_="inner"),_}_getYAxisLabelAlignment(o){const{position:u,ticks:{crossAlign:m,mirror:_,padding:v}}=this.options,M=this._getLabelSizes(),A=o+v,r=M.widest.width;let k,N;return u==="left"?_?(N=this.right+v,m==="near"?k="left":m==="center"?(k="center",N+=r/2):(k="right",N+=r)):(N=this.right-A,m==="near"?k="right":m==="center"?(k="center",N-=r/2):(k="left",N=this.left)):u==="right"?_?(N=this.left+v,m==="near"?k="right":m==="center"?(k="center",N-=r/2):(k="left",N-=r)):(N=this.left+A,m==="near"?k="left":m==="center"?(k="center",N+=r/2):(k="right",N=this.right)):k="right",{textAlign:k,x:N}}_computeLabelArea(){if(this.options.ticks.mirror)return;const o=this.chart,u=this.options.position;if(u==="left"||u==="right")return{top:0,left:this.left,bottom:o.height,right:this.right};if(u==="top"||u==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:o.width}}drawBackground(){const{ctx:o,options:{backgroundColor:u},left:m,top:_,width:v,height:M}=this;u&&(o.save(),o.fillStyle=u,o.fillRect(m,_,v,M),o.restore())}getLineWidthForValue(o){const u=this.options.grid;if(!this._isVisible()||!u.display)return 0;const _=this.ticks.findIndex(v=>v.value===o);return _>=0?u.setContext(this.getContext(_)).lineWidth:0}drawGrid(o){const u=this.options.grid,m=this.ctx,_=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(o));let v,M;const A=(r,k,N)=>{!N.width||!N.color||(m.save(),m.lineWidth=N.width,m.strokeStyle=N.color,m.setLineDash(N.borderDash||[]),m.lineDashOffset=N.borderDashOffset,m.beginPath(),m.moveTo(r.x,r.y),m.lineTo(k.x,k.y),m.stroke(),m.restore())};if(u.display)for(v=0,M=_.length;v<M;++v){const r=_[v];u.drawOnChartArea&&A({x:r.x1,y:r.y1},{x:r.x2,y:r.y2},r),u.drawTicks&&A({x:r.tx1,y:r.ty1},{x:r.tx2,y:r.ty2},{color:r.tickColor,width:r.tickWidth,borderDash:r.tickBorderDash,borderDashOffset:r.tickBorderDashOffset})}}drawBorder(){const{chart:o,ctx:u,options:{border:m,grid:_}}=this,v=m.setContext(this.getContext()),M=m.display?v.width:0;if(!M)return;const A=_.setContext(this.getContext(0)).lineWidth,r=this._borderValue;let k,N,G,K;this.isHorizontal()?(k=Ac(o,this.left,M)-M/2,N=Ac(o,this.right,A)+A/2,G=K=r):(G=Ac(o,this.top,M)-M/2,K=Ac(o,this.bottom,A)+A/2,k=N=r),u.save(),u.lineWidth=v.width,u.strokeStyle=v.color,u.beginPath(),u.moveTo(k,G),u.lineTo(N,K),u.stroke(),u.restore()}drawLabels(o){if(!this.options.ticks.display)return;const m=this.ctx,_=this._computeLabelArea();_&&U_(m,_);const v=this.getLabelItems(o);for(const M of v){const A=M.options,r=M.font,k=M.label,N=M.textOffset;Vc(m,k,0,N,r,A)}_&&j_(m)}drawTitle(){const{ctx:o,options:{position:u,title:m,reverse:_}}=this;if(!m.display)return;const v=Pr(m.font),M=es(m.padding),A=m.align;let r=v.lineHeight/2;u==="bottom"||u==="center"||yn(u)?(r+=M.bottom,ar(m.text)&&(r+=v.lineHeight*(m.text.length-1))):r+=M.top;const{titleX:k,titleY:N,maxWidth:G,rotation:K}=Dz(this,r,u,A);Vc(o,m.text,0,0,v,{color:m.color,maxWidth:G,rotation:K,textAlign:Pz(A,u,_),textBaseline:"middle",translation:[k,N]})}draw(o){this._isVisible()&&(this.drawBackground(),this.drawGrid(o),this.drawBorder(),this.drawTitle(),this.drawLabels(o))}_layers(){const o=this.options,u=o.ticks&&o.ticks.z||0,m=sn(o.grid&&o.grid.z,-1),_=sn(o.border&&o.border.z,0);return!this._isVisible()||this.draw!==jc.prototype.draw?[{z:u,draw:v=>{this.draw(v)}}]:[{z:m,draw:v=>{this.drawBackground(),this.drawGrid(v),this.drawTitle()}},{z:_,draw:()=>{this.drawBorder()}},{z:u,draw:v=>{this.drawLabels(v)}}]}getMatchingVisibleMetas(o){const u=this.chart.getSortedVisibleDatasetMetas(),m=this.axis+"AxisID",_=[];let v,M;for(v=0,M=u.length;v<M;++v){const A=u[v];A[m]===this.id&&(!o||A.type===o)&&_.push(A)}return _}_resolveTickFontOptions(o){const u=this.options.ticks.setContext(this.getContext(o));return Pr(u.font)}_maxDigits(){const o=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/o}}class Jm{constructor(o,u,m){this.type=o,this.scope=u,this.override=m,this.items=Object.create(null)}isForType(o){return Object.prototype.isPrototypeOf.call(this.type.prototype,o.prototype)}register(o){const u=Object.getPrototypeOf(o);let m;Rz(u)&&(m=this.register(u));const _=this.items,v=o.id,M=this.scope+"."+v;if(!v)throw new Error("class does not have id: "+o);return v in _||(_[v]=o,Lz(o,M,m),this.override&&mr.override(o.id,o.overrides)),M}get(o){return this.items[o]}unregister(o){const u=this.items,m=o.id,_=this.scope;m in u&&delete u[m],_&&m in mr[_]&&(delete mr[_][m],this.override&&delete Nc[m])}}function Lz(l,o,u){const m=zf(Object.create(null),[u?mr.get(u):{},mr.get(o),l.defaults]);mr.set(o,m),l.defaultRoutes&&kz(o,l.defaultRoutes),l.descriptors&&mr.describe(o,l.descriptors)}function kz(l,o){Object.keys(o).forEach(u=>{const m=u.split("."),_=m.pop(),v=[l].concat(m).join("."),M=o[u].split("."),A=M.pop(),r=M.join(".");mr.route(v,_,r,A)})}function Rz(l){return"id"in l&&"defaults"in l}class zz{constructor(){this.controllers=new Jm(ho,"datasets",!0),this.elements=new Jm(Sa,"elements"),this.plugins=new Jm(Object,"plugins"),this.scales=new Jm(jc,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...o){this._each("register",o)}remove(...o){this._each("unregister",o)}addControllers(...o){this._each("register",o,this.controllers)}addElements(...o){this._each("register",o,this.elements)}addPlugins(...o){this._each("register",o,this.plugins)}addScales(...o){this._each("register",o,this.scales)}getController(o){return this._get(o,this.controllers,"controller")}getElement(o){return this._get(o,this.elements,"element")}getPlugin(o){return this._get(o,this.plugins,"plugin")}getScale(o){return this._get(o,this.scales,"scale")}removeControllers(...o){this._each("unregister",o,this.controllers)}removeElements(...o){this._each("unregister",o,this.elements)}removePlugins(...o){this._each("unregister",o,this.plugins)}removeScales(...o){this._each("unregister",o,this.scales)}_each(o,u,m){[...u].forEach(_=>{const v=m||this._getRegistryForType(_);m||v.isForType(_)||v===this.plugins&&_.id?this._exec(o,v,_):Gn(_,M=>{const A=m||this._getRegistryForType(M);this._exec(o,A,M)})})}_exec(o,u,m){const _=ix(o);Xn(m["before"+_],[],m),u[o](m),Xn(m["after"+_],[],m)}_getRegistryForType(o){for(let u=0;u<this._typedRegistries.length;u++){const m=this._typedRegistries[u];if(m.isForType(o))return m}return this.plugins}_get(o,u,m){const _=u.get(o);if(_===void 0)throw new Error('"'+o+'" is not a registered '+m+".");return _}}var No=new zz;class Oz{constructor(){this._init=[]}notify(o,u,m,_){u==="beforeInit"&&(this._init=this._createDescriptors(o,!0),this._notify(this._init,o,"install"));const v=_?this._descriptors(o).filter(_):this._descriptors(o),M=this._notify(v,o,u,m);return u==="afterDestroy"&&(this._notify(v,o,"stop"),this._notify(this._init,o,"uninstall")),M}_notify(o,u,m,_){_=_||{};for(const v of o){const M=v.plugin,A=M[m],r=[u,_,v.options];if(Xn(A,r,M)===!1&&_.cancelable)return!1}return!0}invalidate(){An(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(o){if(this._cache)return this._cache;const u=this._cache=this._createDescriptors(o);return this._notifyStateChanges(o),u}_createDescriptors(o,u){const m=o&&o.config,_=sn(m.options&&m.options.plugins,{}),v=Fz(m);return _===!1&&!u?[]:Nz(o,v,_,u)}_notifyStateChanges(o){const u=this._oldCache||[],m=this._cache,_=(v,M)=>v.filter(A=>!M.some(r=>A.plugin.id===r.plugin.id));this._notify(_(u,m),o,"stop"),this._notify(_(m,u),o,"start")}}function Fz(l){const o={},u=[],m=Object.keys(No.plugins.items);for(let v=0;v<m.length;v++)u.push(No.getPlugin(m[v]));const _=l.plugins||[];for(let v=0;v<_.length;v++){const M=_[v];u.indexOf(M)===-1&&(u.push(M),o[M.id]=!0)}return{plugins:u,localIds:o}}function Bz(l,o){return!o&&l===!1?null:l===!0?{}:l}function Nz(l,{plugins:o,localIds:u},m,_){const v=[],M=l.getContext();for(const A of o){const r=A.id,k=Bz(m[r],_);k!==null&&v.push({plugin:A,options:Vz(l.config,{plugin:A,local:u[r]},k,M)})}return v}function Vz(l,{plugin:o,local:u},m,_){const v=l.pluginScopeKeys(o),M=l.getOptionScopes(m,v);return u&&o.defaults&&M.push(o.defaults),l.createResolver(M,_,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function b0(l,o){const u=mr.datasets[l]||{};return((o.datasets||{})[l]||{}).indexAxis||o.indexAxis||u.indexAxis||"x"}function Uz(l,o){let u=l;return l==="_index_"?u=o:l==="_value_"&&(u=o==="x"?"y":"x"),u}function jz(l,o){return l===o?"_index_":"_value_"}function GT(l){if(l==="x"||l==="y"||l==="r")return l}function Gz(l){if(l==="top"||l==="bottom")return"x";if(l==="left"||l==="right")return"y"}function w0(l,...o){if(GT(l))return l;for(const u of o){const m=u.axis||Gz(u.position)||l.length>1&&GT(l[0].toLowerCase());if(m)return m}throw new Error(`Cannot determine type of '${l}' axis. Please provide 'axis' or 'position' option.`)}function $T(l,o,u){if(u[o+"AxisID"]===l)return{axis:o}}function $z(l,o){if(o.data&&o.data.datasets){const u=o.data.datasets.filter(m=>m.xAxisID===l||m.yAxisID===l);if(u.length)return $T(l,"x",u[0])||$T(l,"y",u[0])}return{}}function Wz(l,o){const u=Nc[l.type]||{scales:{}},m=o.scales||{},_=b0(l.type,o),v=Object.create(null);return Object.keys(m).forEach(M=>{const A=m[M];if(!yn(A))return console.error(`Invalid scale configuration for scale: ${M}`);if(A._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${M}`);const r=w0(M,A,$z(M,l),mr.scales[A.type]),k=jz(r,_),N=u.scales||{};v[M]=Sf(Object.create(null),[{axis:r},A,N[r],N[k]])}),l.data.datasets.forEach(M=>{const A=M.type||l.type,r=M.indexAxis||b0(A,o),N=(Nc[A]||{}).scales||{};Object.keys(N).forEach(G=>{const K=Uz(G,r),ie=M[K+"AxisID"]||K;v[ie]=v[ie]||Object.create(null),Sf(v[ie],[{axis:K},m[ie],N[G]])})}),Object.keys(v).forEach(M=>{const A=v[M];Sf(A,[mr.scales[A.type],mr.scale])}),v}function uE(l){const o=l.options||(l.options={});o.plugins=sn(o.plugins,{}),o.scales=Wz(l,o)}function hE(l){return l=l||{},l.datasets=l.datasets||[],l.labels=l.labels||[],l}function Hz(l){return l=l||{},l.data=hE(l.data),uE(l),l}const WT=new Map,dE=new Set;function Qm(l,o){let u=WT.get(l);return u||(u=o(),WT.set(l,u),dE.add(u)),u}const df=(l,o,u)=>{const m=Tl(o,u);m!==void 0&&l.add(m)};class qz{constructor(o){this._config=Hz(o),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(o){this._config.type=o}get data(){return this._config.data}set data(o){this._config.data=hE(o)}get options(){return this._config.options}set options(o){this._config.options=o}get plugins(){return this._config.plugins}update(){const o=this._config;this.clearCache(),uE(o)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(o){return Qm(o,()=>[[`datasets.${o}`,""]])}datasetAnimationScopeKeys(o,u){return Qm(`${o}.transition.${u}`,()=>[[`datasets.${o}.transitions.${u}`,`transitions.${u}`],[`datasets.${o}`,""]])}datasetElementScopeKeys(o,u){return Qm(`${o}-${u}`,()=>[[`datasets.${o}.elements.${u}`,`datasets.${o}`,`elements.${u}`,""]])}pluginScopeKeys(o){const u=o.id,m=this.type;return Qm(`${m}-plugin-${u}`,()=>[[`plugins.${u}`,...o.additionalOptionScopes||[]]])}_cachedScopes(o,u){const m=this._scopeCache;let _=m.get(o);return(!_||u)&&(_=new Map,m.set(o,_)),_}getOptionScopes(o,u,m){const{options:_,type:v}=this,M=this._cachedScopes(o,m),A=M.get(u);if(A)return A;const r=new Set;u.forEach(N=>{o&&(r.add(o),N.forEach(G=>df(r,o,G))),N.forEach(G=>df(r,_,G)),N.forEach(G=>df(r,Nc[v]||{},G)),N.forEach(G=>df(r,mr,G)),N.forEach(G=>df(r,y0,G))});const k=Array.from(r);return k.length===0&&k.push(Object.create(null)),dE.has(u)&&M.set(u,k),k}chartOptionScopes(){const{options:o,type:u}=this;return[o,Nc[u]||{},mr.datasets[u]||{},{type:u},mr,y0]}resolveNamedOptions(o,u,m,_=[""]){const v={$shared:!0},{resolver:M,subPrefixes:A}=HT(this._resolverCache,o,_);let r=M;if(Xz(M,u)){v.$shared=!1,m=Ml(m)?m():m;const k=this.createResolver(o,m,A);r=eh(M,m,k)}for(const k of u)v[k]=r[k];return v}createResolver(o,u,m=[""],_){const{resolver:v}=HT(this._resolverCache,o,m);return yn(u)?eh(v,u,void 0,_):v}}function HT(l,o,u){let m=l.get(o);m||(m=new Map,l.set(o,m));const _=u.join();let v=m.get(_);return v||(v={resolver:lx(o,u),subPrefixes:u.filter(A=>!A.toLowerCase().includes("hover"))},m.set(_,v)),v}const Zz=l=>yn(l)&&Object.getOwnPropertyNames(l).some(o=>Ml(l[o]));function Xz(l,o){const{isScriptable:u,isIndexable:m}=WS(l);for(const _ of o){const v=u(_),M=m(_),A=(M||v)&&l[_];if(v&&(Ml(A)||Zz(A))||M&&ar(A))return!0}return!1}var Yz="4.4.3";const Kz=["top","bottom","left","right","chartArea"];function qT(l,o){return l==="top"||l==="bottom"||Kz.indexOf(l)===-1&&o==="x"}function ZT(l,o){return function(u,m){return u[l]===m[l]?u[o]-m[o]:u[l]-m[l]}}function XT(l){const o=l.chart,u=o.options.animation;o.notifyPlugins("afterRender"),Xn(u&&u.onComplete,[l],o)}function Jz(l){const o=l.chart,u=o.options.animation;Xn(u&&u.onProgress,[l],o)}function fE(l){return hx()&&typeof l=="string"?l=document.getElementById(l):l&&l.length&&(l=l[0]),l&&l.canvas&&(l=l.canvas),l}const m_={},YT=l=>{const o=fE(l);return Object.values(m_).filter(u=>u.canvas===o).pop()};function Qz(l,o,u){const m=Object.keys(l);for(const _ of m){const v=+_;if(v>=o){const M=l[_];delete l[_],(u>0||v>o)&&(l[v+u]=M)}}}function eO(l,o,u,m){return!u||l.type==="mouseout"?null:m?o:l}function e_(l,o,u){return l.options.clip?l[u]:o[u]}function tO(l,o){const{xScale:u,yScale:m}=l;return u&&m?{left:e_(u,o,"left"),right:e_(u,o,"right"),top:e_(m,o,"top"),bottom:e_(m,o,"bottom")}:o}class ya{static register(...o){No.add(...o),KT()}static unregister(...o){No.remove(...o),KT()}constructor(o,u){const m=this.config=new qz(u),_=fE(o),v=YT(_);if(v)throw new Error("Canvas is already in use. Chart with ID '"+v.id+"' must be destroyed before the canvas with ID '"+v.canvas.id+"' can be reused.");const M=m.createResolver(m.chartOptionScopes(),this.getContext());this.platform=new(m.platform||yz(_)),this.platform.updateConfig(m);const A=this.platform.acquireContext(_,M.aspectRatio),r=A&&A.canvas,k=r&&r.height,N=r&&r.width;if(this.id=nk(),this.ctx=A,this.canvas=r,this.width=N,this.height=k,this._options=M,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new Oz,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=xk(G=>this.update(G),M.resizeDelay||0),this._dataChanges=[],m_[this.id]=this,!A||!r){console.error("Failed to create chart: can't acquire context from the given item");return}pa.listen(this,"complete",XT),pa.listen(this,"progress",Jz),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:o,maintainAspectRatio:u},width:m,height:_,_aspectRatio:v}=this;return An(o)?u&&v?v:_?m/_:null:o}get data(){return this.config.data}set data(o){this.config.data=o}get options(){return this._options}set options(o){this.config.options=o}get registry(){return No}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():yT(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return mT(this.canvas,this.ctx),this}stop(){return pa.stop(this),this}resize(o,u){pa.running(this)?this._resizeBeforeDraw={width:o,height:u}:this._resize(o,u)}_resize(o,u){const m=this.options,_=this.canvas,v=m.maintainAspectRatio&&this.aspectRatio,M=this.platform.getMaximumSize(_,o,u,v),A=m.devicePixelRatio||this.platform.getDevicePixelRatio(),r=this.width?"resize":"attach";this.width=M.width,this.height=M.height,this._aspectRatio=this.aspectRatio,yT(this,A,!0)&&(this.notifyPlugins("resize",{size:M}),Xn(m.onResize,[this,M],this),this.attached&&this._doResize(r)&&this.render())}ensureScalesHaveIDs(){const u=this.options.scales||{};Gn(u,(m,_)=>{m.id=_})}buildOrUpdateScales(){const o=this.options,u=o.scales,m=this.scales,_=Object.keys(m).reduce((M,A)=>(M[A]=!1,M),{});let v=[];u&&(v=v.concat(Object.keys(u).map(M=>{const A=u[M],r=w0(M,A),k=r==="r",N=r==="x";return{options:A,dposition:k?"chartArea":N?"bottom":"left",dtype:k?"radialLinear":N?"category":"linear"}}))),Gn(v,M=>{const A=M.options,r=A.id,k=w0(r,A),N=sn(A.type,M.dtype);(A.position===void 0||qT(A.position,k)!==qT(M.dposition))&&(A.position=M.dposition),_[r]=!0;let G=null;if(r in m&&m[r].type===N)G=m[r];else{const K=No.getScale(N);G=new K({id:r,type:N,ctx:this.ctx,chart:this}),m[G.id]=G}G.init(A,o)}),Gn(_,(M,A)=>{M||delete m[A]}),Gn(m,M=>{Qr.configure(this,M,M.options),Qr.addBox(this,M)})}_updateMetasets(){const o=this._metasets,u=this.data.datasets.length,m=o.length;if(o.sort((_,v)=>_.index-v.index),m>u){for(let _=u;_<m;++_)this._destroyDatasetMeta(_);o.splice(u,m-u)}this._sortedMetasets=o.slice(0).sort(ZT("order","index"))}_removeUnreferencedMetasets(){const{_metasets:o,data:{datasets:u}}=this;o.length>u.length&&delete this._stacks,o.forEach((m,_)=>{u.filter(v=>v===m._dataset).length===0&&this._destroyDatasetMeta(_)})}buildOrUpdateControllers(){const o=[],u=this.data.datasets;let m,_;for(this._removeUnreferencedMetasets(),m=0,_=u.length;m<_;m++){const v=u[m];let M=this.getDatasetMeta(m);const A=v.type||this.config.type;if(M.type&&M.type!==A&&(this._destroyDatasetMeta(m),M=this.getDatasetMeta(m)),M.type=A,M.indexAxis=v.indexAxis||b0(A,this.options),M.order=v.order||0,M.index=m,M.label=""+v.label,M.visible=this.isDatasetVisible(m),M.controller)M.controller.updateIndex(m),M.controller.linkScales();else{const r=No.getController(A),{datasetElementType:k,dataElementType:N}=mr.datasets[A];Object.assign(r,{dataElementType:No.getElement(N),datasetElementType:k&&No.getElement(k)}),M.controller=new r(this,m),o.push(M.controller)}}return this._updateMetasets(),o}_resetElements(){Gn(this.data.datasets,(o,u)=>{this.getDatasetMeta(u).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(o){const u=this.config;u.update();const m=this._options=u.createResolver(u.chartOptionScopes(),this.getContext()),_=this._animationsDisabled=!m.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:o,cancelable:!0})===!1)return;const v=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let M=0;for(let k=0,N=this.data.datasets.length;k<N;k++){const{controller:G}=this.getDatasetMeta(k),K=!_&&v.indexOf(G)===-1;G.buildOrUpdateElements(K),M=Math.max(+G.getMaxOverflow(),M)}M=this._minPadding=m.layout.autoPadding?M:0,this._updateLayout(M),_||Gn(v,k=>{k.reset()}),this._updateDatasets(o),this.notifyPlugins("afterUpdate",{mode:o}),this._layers.sort(ZT("z","_idx"));const{_active:A,_lastEvent:r}=this;r?this._eventHandler(r,!0):A.length&&this._updateHoverStyles(A,A,!0),this.render()}_updateScales(){Gn(this.scales,o=>{Qr.removeBox(this,o)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const o=this.options,u=new Set(Object.keys(this._listeners)),m=new Set(o.events);(!oT(u,m)||!!this._responsiveListeners!==o.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:o}=this,u=this._getUniformDataChanges()||[];for(const{method:m,start:_,count:v}of u){const M=m==="_removeElements"?-v:v;Qz(o,_,M)}}_getUniformDataChanges(){const o=this._dataChanges;if(!o||!o.length)return;this._dataChanges=[];const u=this.data.datasets.length,m=v=>new Set(o.filter(M=>M[0]===v).map((M,A)=>A+","+M.splice(1).join(","))),_=m(0);for(let v=1;v<u;v++)if(!oT(_,m(v)))return;return Array.from(_).map(v=>v.split(",")).map(v=>({method:v[1],start:+v[2],count:+v[3]}))}_updateLayout(o){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Qr.update(this,this.width,this.height,o);const u=this.chartArea,m=u.width<=0||u.height<=0;this._layers=[],Gn(this.boxes,_=>{m&&_.position==="chartArea"||(_.configure&&_.configure(),this._layers.push(..._._layers()))},this),this._layers.forEach((_,v)=>{_._idx=v}),this.notifyPlugins("afterLayout")}_updateDatasets(o){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:o,cancelable:!0})!==!1){for(let u=0,m=this.data.datasets.length;u<m;++u)this.getDatasetMeta(u).controller.configure();for(let u=0,m=this.data.datasets.length;u<m;++u)this._updateDataset(u,Ml(o)?o({datasetIndex:u}):o);this.notifyPlugins("afterDatasetsUpdate",{mode:o})}}_updateDataset(o,u){const m=this.getDatasetMeta(o),_={meta:m,index:o,mode:u,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",_)!==!1&&(m.controller._update(u),_.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",_))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(pa.has(this)?this.attached&&!pa.running(this)&&pa.start(this):(this.draw(),XT({chart:this})))}draw(){let o;if(this._resizeBeforeDraw){const{width:m,height:_}=this._resizeBeforeDraw;this._resize(m,_),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const u=this._layers;for(o=0;o<u.length&&u[o].z<=0;++o)u[o].draw(this.chartArea);for(this._drawDatasets();o<u.length;++o)u[o].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(o){const u=this._sortedMetasets,m=[];let _,v;for(_=0,v=u.length;_<v;++_){const M=u[_];(!o||M.visible)&&m.push(M)}return m}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const o=this.getSortedVisibleDatasetMetas();for(let u=o.length-1;u>=0;--u)this._drawDataset(o[u]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(o){const u=this.ctx,m=o._clip,_=!m.disabled,v=tO(o,this.chartArea),M={meta:o,index:o.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",M)!==!1&&(_&&U_(u,{left:m.left===!1?0:v.left-m.left,right:m.right===!1?this.width:v.right+m.right,top:m.top===!1?0:v.top-m.top,bottom:m.bottom===!1?this.height:v.bottom+m.bottom}),o.controller.draw(),_&&j_(u),M.cancelable=!1,this.notifyPlugins("afterDatasetDraw",M))}isPointInArea(o){return wa(o,this.chartArea,this._minPadding)}getElementsAtEventForMode(o,u,m,_){const v=KR.modes[u];return typeof v=="function"?v(this,o,m,_):[]}getDatasetMeta(o){const u=this.data.datasets[o],m=this._metasets;let _=m.filter(v=>v&&v._dataset===u).pop();return _||(_={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:u&&u.order||0,index:o,_dataset:u,_parsed:[],_sorted:!1},m.push(_)),_}getContext(){return this.$context||(this.$context=Al(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(o){const u=this.data.datasets[o];if(!u)return!1;const m=this.getDatasetMeta(o);return typeof m.hidden=="boolean"?!m.hidden:!u.hidden}setDatasetVisibility(o,u){const m=this.getDatasetMeta(o);m.hidden=!u}toggleDataVisibility(o){this._hiddenIndices[o]=!this._hiddenIndices[o]}getDataVisibility(o){return!this._hiddenIndices[o]}_updateVisibility(o,u,m){const _=m?"show":"hide",v=this.getDatasetMeta(o),M=v.controller._resolveAnimations(void 0,_);Of(u)?(v.data[u].hidden=!m,this.update()):(this.setDatasetVisibility(o,m),M.update(v,{visible:m}),this.update(A=>A.datasetIndex===o?_:void 0))}hide(o,u){this._updateVisibility(o,u,!1)}show(o,u){this._updateVisibility(o,u,!0)}_destroyDatasetMeta(o){const u=this._metasets[o];u&&u.controller&&u.controller._destroy(),delete this._metasets[o]}_stop(){let o,u;for(this.stop(),pa.remove(this),o=0,u=this.data.datasets.length;o<u;++o)this._destroyDatasetMeta(o)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:o,ctx:u}=this;this._stop(),this.config.clearCache(),o&&(this.unbindEvents(),mT(o,u),this.platform.releaseContext(u),this.canvas=null,this.ctx=null),delete m_[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...o){return this.canvas.toDataURL(...o)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const o=this._listeners,u=this.platform,m=(v,M)=>{u.addEventListener(this,v,M),o[v]=M},_=(v,M,A)=>{v.offsetX=M,v.offsetY=A,this._eventHandler(v)};Gn(this.options.events,v=>m(v,_))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const o=this._responsiveListeners,u=this.platform,m=(r,k)=>{u.addEventListener(this,r,k),o[r]=k},_=(r,k)=>{o[r]&&(u.removeEventListener(this,r,k),delete o[r])},v=(r,k)=>{this.canvas&&this.resize(r,k)};let M;const A=()=>{_("attach",A),this.attached=!0,this.resize(),m("resize",v),m("detach",M)};M=()=>{this.attached=!1,_("resize",v),this._stop(),this._resize(0,0),m("attach",A)},u.isAttached(this.canvas)?A():M()}unbindEvents(){Gn(this._listeners,(o,u)=>{this.platform.removeEventListener(this,u,o)}),this._listeners={},Gn(this._responsiveListeners,(o,u)=>{this.platform.removeEventListener(this,u,o)}),this._responsiveListeners=void 0}updateHoverStyle(o,u,m){const _=m?"set":"remove";let v,M,A,r;for(u==="dataset"&&(v=this.getDatasetMeta(o[0].datasetIndex),v.controller["_"+_+"DatasetHoverStyle"]()),A=0,r=o.length;A<r;++A){M=o[A];const k=M&&this.getDatasetMeta(M.datasetIndex).controller;k&&k[_+"HoverStyle"](M.element,M.datasetIndex,M.index)}}getActiveElements(){return this._active||[]}setActiveElements(o){const u=this._active||[],m=o.map(({datasetIndex:v,index:M})=>{const A=this.getDatasetMeta(v);if(!A)throw new Error("No dataset found at index "+v);return{datasetIndex:v,element:A.data[M],index:M}});!w_(m,u)&&(this._active=m,this._lastEvent=null,this._updateHoverStyles(m,u))}notifyPlugins(o,u,m){return this._plugins.notify(this,o,u,m)}isPluginEnabled(o){return this._plugins._cache.filter(u=>u.plugin.id===o).length===1}_updateHoverStyles(o,u,m){const _=this.options.hover,v=(r,k)=>r.filter(N=>!k.some(G=>N.datasetIndex===G.datasetIndex&&N.index===G.index)),M=v(u,o),A=m?o:v(o,u);M.length&&this.updateHoverStyle(M,_.mode,!1),A.length&&_.mode&&this.updateHoverStyle(A,_.mode,!0)}_eventHandler(o,u){const m={event:o,replay:u,cancelable:!0,inChartArea:this.isPointInArea(o)},_=M=>(M.options.events||this.options.events).includes(o.native.type);if(this.notifyPlugins("beforeEvent",m,_)===!1)return;const v=this._handleEvent(o,u,m.inChartArea);return m.cancelable=!1,this.notifyPlugins("afterEvent",m,_),(v||m.changed)&&this.render(),this}_handleEvent(o,u,m){const{_active:_=[],options:v}=this,M=u,A=this._getActiveElements(o,_,m,M),r=ck(o),k=eO(o,this._lastEvent,m,r);m&&(this._lastEvent=null,Xn(v.onHover,[o,A,this],this),r&&Xn(v.onClick,[o,A,this],this));const N=!w_(A,_);return(N||u)&&(this._active=A,this._updateHoverStyles(A,_,u)),this._lastEvent=k,N}_getActiveElements(o,u,m,_){if(o.type==="mouseout")return[];if(!m)return u;const v=this.options.hover;return this.getElementsAtEventForMode(o,v.mode,v,_)}}ei(ya,"defaults",mr),ei(ya,"instances",m_),ei(ya,"overrides",Nc),ei(ya,"registry",No),ei(ya,"version",Yz),ei(ya,"getChart",YT);function KT(){return Gn(ya.instances,l=>l._plugins.invalidate())}function iO(l,o,u){const{startAngle:m,pixelMargin:_,x:v,y:M,outerRadius:A,innerRadius:r}=o;let k=_/A;l.beginPath(),l.arc(v,M,A,m-k,u+k),r>_?(k=_/r,l.arc(v,M,r,u+k,m-k,!0)):l.arc(v,M,_,u+wr,m-wr),l.closePath(),l.clip()}function nO(l){return ax(l,["outerStart","outerEnd","innerStart","innerEnd"])}function rO(l,o,u,m){const _=nO(l.options.borderRadius),v=(u-o)/2,M=Math.min(v,m*o/2),A=r=>{const k=(u-Math.min(v,r))*m/2;return Rr(r,0,Math.min(v,k))};return{outerStart:A(_.outerStart),outerEnd:A(_.outerEnd),innerStart:Rr(_.innerStart,0,M),innerEnd:Rr(_.innerEnd,0,M)}}function Hu(l,o,u,m){return{x:u+l*Math.cos(o),y:m+l*Math.sin(o)}}function I_(l,o,u,m,_,v){const{x:M,y:A,startAngle:r,pixelMargin:k,innerRadius:N}=o,G=Math.max(o.outerRadius+m+u-k,0),K=N>0?N+m+u+k:0;let ie=0;const pe=_-r;if(m){const qe=N>0?N-m:0,si=G>0?G-m:0,yt=(qe+si)/2,wt=yt!==0?pe*yt/(yt+m):pe;ie=(pe-wt)/2}const ge=Math.max(.001,pe*G-u/er)/G,Te=(pe-ge)/2,Re=r+Te+ie,$e=_-Te-ie,{outerStart:tt,outerEnd:ut,innerStart:ot,innerEnd:at}=rO(o,K,G,$e-Re),dt=G-tt,xe=G-ut,le=Re+tt/dt,Je=$e-ut/xe,Mt=K+ot,Qe=K+at,Zt=Re+ot/Mt,xi=$e-at/Qe;if(l.beginPath(),v){const qe=(le+Je)/2;if(l.arc(M,A,G,le,qe),l.arc(M,A,G,qe,Je),ut>0){const Qt=Hu(xe,Je,M,A);l.arc(Qt.x,Qt.y,ut,Je,$e+wr)}const si=Hu(Qe,$e,M,A);if(l.lineTo(si.x,si.y),at>0){const Qt=Hu(Qe,xi,M,A);l.arc(Qt.x,Qt.y,at,$e+wr,xi+Math.PI)}const yt=($e-at/K+(Re+ot/K))/2;if(l.arc(M,A,K,$e-at/K,yt,!0),l.arc(M,A,K,yt,Re+ot/K,!0),ot>0){const Qt=Hu(Mt,Zt,M,A);l.arc(Qt.x,Qt.y,ot,Zt+Math.PI,Re-wr)}const wt=Hu(dt,Re,M,A);if(l.lineTo(wt.x,wt.y),tt>0){const Qt=Hu(dt,le,M,A);l.arc(Qt.x,Qt.y,tt,Re-wr,le)}}else{l.moveTo(M,A);const qe=Math.cos(le)*G+M,si=Math.sin(le)*G+A;l.lineTo(qe,si);const yt=Math.cos(Je)*G+M,wt=Math.sin(Je)*G+A;l.lineTo(yt,wt)}l.closePath()}function sO(l,o,u,m,_){const{fullCircles:v,startAngle:M,circumference:A}=o;let r=o.endAngle;if(v){I_(l,o,u,m,r,_);for(let k=0;k<v;++k)l.fill();isNaN(A)||(r=M+(A%Qn||Qn))}return I_(l,o,u,m,r,_),l.fill(),r}function oO(l,o,u,m,_){const{fullCircles:v,startAngle:M,circumference:A,options:r}=o,{borderWidth:k,borderJoinStyle:N,borderDash:G,borderDashOffset:K}=r,ie=r.borderAlign==="inner";if(!k)return;l.setLineDash(G||[]),l.lineDashOffset=K,ie?(l.lineWidth=k*2,l.lineJoin=N||"round"):(l.lineWidth=k,l.lineJoin=N||"bevel");let pe=o.endAngle;if(v){I_(l,o,u,m,pe,_);for(let ge=0;ge<v;++ge)l.stroke();isNaN(A)||(pe=M+(A%Qn||Qn))}ie&&iO(l,o,pe),v||(I_(l,o,u,m,pe,_),l.stroke())}class gf extends Sa{constructor(u){super();ei(this,"circumference");ei(this,"endAngle");ei(this,"fullCircles");ei(this,"innerRadius");ei(this,"outerRadius");ei(this,"pixelMargin");ei(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,u&&Object.assign(this,u)}inRange(u,m,_){const v=this.getProps(["x","y"],_),{angle:M,distance:A}=zS(v,{x:u,y:m}),{startAngle:r,endAngle:k,innerRadius:N,outerRadius:G,circumference:K}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],_),ie=(this.options.spacing+this.options.borderWidth)/2,ge=sn(K,k-r)>=Qn||Ff(M,r,k),Te=va(A,N+ie,G+ie);return ge&&Te}getCenterPoint(u){const{x:m,y:_,startAngle:v,endAngle:M,innerRadius:A,outerRadius:r}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],u),{offset:k,spacing:N}=this.options,G=(v+M)/2,K=(A+r+N+k)/2;return{x:m+Math.cos(G)*K,y:_+Math.sin(G)*K}}tooltipPosition(u){return this.getCenterPoint(u)}draw(u){const{options:m,circumference:_}=this,v=(m.offset||0)/4,M=(m.spacing||0)/2,A=m.circular;if(this.pixelMargin=m.borderAlign==="inner"?.33:0,this.fullCircles=_>Qn?Math.floor(_/Qn):0,_===0||this.innerRadius<0||this.outerRadius<0)return;u.save();const r=(this.startAngle+this.endAngle)/2;u.translate(Math.cos(r)*v,Math.sin(r)*v);const k=1-Math.sin(Math.min(er,_||0)),N=v*k;u.fillStyle=m.backgroundColor,u.strokeStyle=m.borderColor,sO(u,this,N,M,A),oO(u,this,N,M,A),u.restore()}}ei(gf,"id","arc"),ei(gf,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0}),ei(gf,"defaultRoutes",{backgroundColor:"backgroundColor"}),ei(gf,"descriptors",{_scriptable:!0,_indexable:u=>u!=="borderDash"});function pE(l,o,u=o){l.lineCap=sn(u.borderCapStyle,o.borderCapStyle),l.setLineDash(sn(u.borderDash,o.borderDash)),l.lineDashOffset=sn(u.borderDashOffset,o.borderDashOffset),l.lineJoin=sn(u.borderJoinStyle,o.borderJoinStyle),l.lineWidth=sn(u.borderWidth,o.borderWidth),l.strokeStyle=sn(u.borderColor,o.borderColor)}function aO(l,o,u){l.lineTo(u.x,u.y)}function lO(l){return l.stepped?Dk:l.tension||l.cubicInterpolationMode==="monotone"?Lk:aO}function mE(l,o,u={}){const m=l.length,{start:_=0,end:v=m-1}=u,{start:M,end:A}=o,r=Math.max(_,M),k=Math.min(v,A),N=_<M&&v<M||_>A&&v>A;return{count:m,start:r,loop:o.loop,ilen:k<r&&!N?m+k-r:k-r}}function cO(l,o,u,m){const{points:_,options:v}=o,{count:M,start:A,loop:r,ilen:k}=mE(_,u,m),N=lO(v);let{move:G=!0,reverse:K}=m||{},ie,pe,ge;for(ie=0;ie<=k;++ie)pe=_[(A+(K?k-ie:ie))%M],!pe.skip&&(G?(l.moveTo(pe.x,pe.y),G=!1):N(l,ge,pe,K,v.stepped),ge=pe);return r&&(pe=_[(A+(K?k:0))%M],N(l,ge,pe,K,v.stepped)),!!r}function uO(l,o,u,m){const _=o.points,{count:v,start:M,ilen:A}=mE(_,u,m),{move:r=!0,reverse:k}=m||{};let N=0,G=0,K,ie,pe,ge,Te,Re;const $e=ut=>(M+(k?A-ut:ut))%v,tt=()=>{ge!==Te&&(l.lineTo(N,Te),l.lineTo(N,ge),l.lineTo(N,Re))};for(r&&(ie=_[$e(0)],l.moveTo(ie.x,ie.y)),K=0;K<=A;++K){if(ie=_[$e(K)],ie.skip)continue;const ut=ie.x,ot=ie.y,at=ut|0;at===pe?(ot<ge?ge=ot:ot>Te&&(Te=ot),N=(G*N+ut)/++G):(tt(),l.lineTo(ut,ot),pe=at,G=0,ge=Te=ot),Re=ot}tt()}function T0(l){const o=l.options,u=o.borderDash&&o.borderDash.length;return!l._decimated&&!l._loop&&!o.tension&&o.cubicInterpolationMode!=="monotone"&&!o.stepped&&!u?uO:cO}function hO(l){return l.stepped?uR:l.tension||l.cubicInterpolationMode==="monotone"?hR:Dc}function dO(l,o,u,m){let _=o._path;_||(_=o._path=new Path2D,o.path(_,u,m)&&_.closePath()),pE(l,o.options),l.stroke(_)}function fO(l,o,u,m){const{segments:_,options:v}=o,M=T0(o);for(const A of _)pE(l,v,A.style),l.beginPath(),M(l,o,A,{start:u,end:u+m-1})&&l.closePath(),l.stroke()}const pO=typeof Path2D=="function";function mO(l,o,u,m){pO&&!o.options.segment?dO(l,o,u,m):fO(l,o,u,m)}class gl extends Sa{constructor(o){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,o&&Object.assign(this,o)}updateControlPoints(o,u){const m=this.options;if((m.tension||m.cubicInterpolationMode==="monotone")&&!m.stepped&&!this._pointsUpdated){const _=m.spanGaps?this._loop:this._fullLoop;iR(this._points,m,o,_,u),this._pointsUpdated=!0}}set points(o){this._points=o,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=gR(this,this.options.segment))}first(){const o=this.segments,u=this.points;return o.length&&u[o[0].start]}last(){const o=this.segments,u=this.points,m=o.length;return m&&u[o[m-1].end]}interpolate(o,u){const m=this.options,_=o[u],v=this.points,M=tE(this,{property:u,start:_,end:_});if(!M.length)return;const A=[],r=hO(m);let k,N;for(k=0,N=M.length;k<N;++k){const{start:G,end:K}=M[k],ie=v[G],pe=v[K];if(ie===pe){A.push(ie);continue}const ge=Math.abs((_-ie[u])/(pe[u]-ie[u])),Te=r(ie,pe,ge,m.stepped);Te[u]=o[u],A.push(Te)}return A.length===1?A[0]:A}pathSegment(o,u,m){return T0(this)(o,this,u,m)}path(o,u,m){const _=this.segments,v=T0(this);let M=this._loop;u=u||0,m=m||this.points.length-u;for(const A of _)M&=v(o,this,A,{start:u,end:u+m-1});return!!M}draw(o,u,m,_){const v=this.options||{};(this.points||[]).length&&v.borderWidth&&(o.save(),mO(o,this,m,_),o.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}ei(gl,"id","line"),ei(gl,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),ei(gl,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),ei(gl,"descriptors",{_scriptable:!0,_indexable:o=>o!=="borderDash"&&o!=="fill"});function JT(l,o,u,m){const _=l.options,{[u]:v}=l.getProps([u],m);return Math.abs(o-v)<_.radius+_.hitRadius}class __ extends Sa{constructor(u){super();ei(this,"parsed");ei(this,"skip");ei(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,u&&Object.assign(this,u)}inRange(u,m,_){const v=this.options,{x:M,y:A}=this.getProps(["x","y"],_);return Math.pow(u-M,2)+Math.pow(m-A,2)<Math.pow(v.hitRadius+v.radius,2)}inXRange(u,m){return JT(this,u,"x",m)}inYRange(u,m){return JT(this,u,"y",m)}getCenterPoint(u){const{x:m,y:_}=this.getProps(["x","y"],u);return{x:m,y:_}}size(u){u=u||this.options||{};let m=u.radius||0;m=Math.max(m,m&&u.hoverRadius||0);const _=m&&u.borderWidth||0;return(m+_)*2}draw(u,m){const _=this.options;this.skip||_.radius<.1||!wa(this,m,this.size(_)/2)||(u.strokeStyle=_.borderColor,u.lineWidth=_.borderWidth,u.fillStyle=_.backgroundColor,x0(u,_,this.x,this.y))}getRange(){const u=this.options||{};return u.radius+u.hitRadius}}ei(__,"id","point"),ei(__,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),ei(__,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function _E(l,o){const{x:u,y:m,base:_,width:v,height:M}=l.getProps(["x","y","base","width","height"],o);let A,r,k,N,G;return l.horizontal?(G=M/2,A=Math.min(u,_),r=Math.max(u,_),k=m-G,N=m+G):(G=v/2,A=u-G,r=u+G,k=Math.min(m,_),N=Math.max(m,_)),{left:A,top:k,right:r,bottom:N}}function yl(l,o,u,m){return l?0:Rr(o,u,m)}function _O(l,o,u){const m=l.options.borderWidth,_=l.borderSkipped,v=$S(m);return{t:yl(_.top,v.top,0,u),r:yl(_.right,v.right,0,o),b:yl(_.bottom,v.bottom,0,u),l:yl(_.left,v.left,0,o)}}function gO(l,o,u){const{enableBorderRadius:m}=l.getProps(["enableBorderRadius"]),_=l.options.borderRadius,v=Oc(_),M=Math.min(o,u),A=l.borderSkipped,r=m||yn(_);return{topLeft:yl(!r||A.top||A.left,v.topLeft,0,M),topRight:yl(!r||A.top||A.right,v.topRight,0,M),bottomLeft:yl(!r||A.bottom||A.left,v.bottomLeft,0,M),bottomRight:yl(!r||A.bottom||A.right,v.bottomRight,0,M)}}function yO(l){const o=_E(l),u=o.right-o.left,m=o.bottom-o.top,_=_O(l,u/2,m/2),v=gO(l,u/2,m/2);return{outer:{x:o.left,y:o.top,w:u,h:m,radius:v},inner:{x:o.left+_.l,y:o.top+_.t,w:u-_.l-_.r,h:m-_.t-_.b,radius:{topLeft:Math.max(0,v.topLeft-Math.max(_.t,_.l)),topRight:Math.max(0,v.topRight-Math.max(_.t,_.r)),bottomLeft:Math.max(0,v.bottomLeft-Math.max(_.b,_.l)),bottomRight:Math.max(0,v.bottomRight-Math.max(_.b,_.r))}}}}function t0(l,o,u,m){const _=o===null,v=u===null,A=l&&!(_&&v)&&_E(l,m);return A&&(_||va(o,A.left,A.right))&&(v||va(u,A.top,A.bottom))}function xO(l){return l.topLeft||l.topRight||l.bottomLeft||l.bottomRight}function vO(l,o){l.rect(o.x,o.y,o.w,o.h)}function i0(l,o,u={}){const m=l.x!==u.x?-o:0,_=l.y!==u.y?-o:0,v=(l.x+l.w!==u.x+u.w?o:0)-m,M=(l.y+l.h!==u.y+u.h?o:0)-_;return{x:l.x+m,y:l.y+_,w:l.w+v,h:l.h+M,radius:l.radius}}class g_ extends Sa{constructor(o){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,o&&Object.assign(this,o)}draw(o){const{inflateAmount:u,options:{borderColor:m,backgroundColor:_}}=this,{inner:v,outer:M}=yO(this),A=xO(M.radius)?Bf:vO;o.save(),(M.w!==v.w||M.h!==v.h)&&(o.beginPath(),A(o,i0(M,u,v)),o.clip(),A(o,i0(v,-u,M)),o.fillStyle=m,o.fill("evenodd")),o.beginPath(),A(o,i0(v,u)),o.fillStyle=_,o.fill(),o.restore()}inRange(o,u,m){return t0(this,o,u,m)}inXRange(o,u){return t0(this,o,null,u)}inYRange(o,u){return t0(this,null,o,u)}getCenterPoint(o){const{x:u,y:m,base:_,horizontal:v}=this.getProps(["x","y","base","horizontal"],o);return{x:v?(u+_)/2:u,y:v?m:(m+_)/2}}getRange(o){return o==="x"?this.width/2:this.height/2}}ei(g_,"id","bar"),ei(g_,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),ei(g_,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var bO=Object.freeze({__proto__:null,ArcElement:gf,BarElement:g_,LineElement:gl,PointElement:__});const M0=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],QT=M0.map(l=>l.replace("rgb(","rgba(").replace(")",", 0.5)"));function gE(l){return M0[l%M0.length]}function yE(l){return QT[l%QT.length]}function wO(l,o){return l.borderColor=gE(o),l.backgroundColor=yE(o),++o}function TO(l,o){return l.backgroundColor=l.data.map(()=>gE(o++)),o}function MO(l,o){return l.backgroundColor=l.data.map(()=>yE(o++)),o}function SO(l){let o=0;return(u,m)=>{const _=l.getDatasetMeta(m).controller;_ instanceof kc?o=TO(u,o):_ instanceof Cf?o=MO(u,o):_&&(o=wO(u,o))}}function eM(l){let o;for(o in l)if(l[o].borderColor||l[o].backgroundColor)return!0;return!1}function EO(l){return l&&(l.borderColor||l.backgroundColor)}var AO={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(l,o,u){if(!u.enabled)return;const{data:{datasets:m},options:_}=l.config,{elements:v}=_;if(!u.forceOverride&&(eM(m)||EO(_)||v&&eM(v)))return;const M=SO(l);m.forEach(M)}};function IO(l,o,u,m,_){const v=_.samples||m;if(v>=u)return l.slice(o,o+u);const M=[],A=(u-2)/(v-2);let r=0;const k=o+u-1;let N=o,G,K,ie,pe,ge;for(M[r++]=l[N],G=0;G<v-2;G++){let Te=0,Re=0,$e;const tt=Math.floor((G+1)*A)+1+o,ut=Math.min(Math.floor((G+2)*A)+1,u)+o,ot=ut-tt;for($e=tt;$e<ut;$e++)Te+=l[$e].x,Re+=l[$e].y;Te/=ot,Re/=ot;const at=Math.floor(G*A)+1+o,dt=Math.min(Math.floor((G+1)*A)+1,u)+o,{x:xe,y:le}=l[N];for(ie=pe=-1,$e=at;$e<dt;$e++)pe=.5*Math.abs((xe-Te)*(l[$e].y-le)-(xe-l[$e].x)*(Re-le)),pe>ie&&(ie=pe,K=l[$e],ge=$e);M[r++]=K,N=ge}return M[r++]=l[k],M}function CO(l,o,u,m){let _=0,v=0,M,A,r,k,N,G,K,ie,pe,ge;const Te=[],Re=o+u-1,$e=l[o].x,ut=l[Re].x-$e;for(M=o;M<o+u;++M){A=l[M],r=(A.x-$e)/ut*m,k=A.y;const ot=r|0;if(ot===N)k<pe?(pe=k,G=M):k>ge&&(ge=k,K=M),_=(v*_+A.x)/++v;else{const at=M-1;if(!An(G)&&!An(K)){const dt=Math.min(G,K),xe=Math.max(G,K);dt!==ie&&dt!==at&&Te.push({...l[dt],x:_}),xe!==ie&&xe!==at&&Te.push({...l[xe],x:_})}M>0&&at!==ie&&Te.push(l[at]),Te.push(A),N=ot,v=0,pe=ge=k,G=K=ie=M}}return Te}function xE(l){if(l._decimated){const o=l._data;delete l._decimated,delete l._data,Object.defineProperty(l,"data",{configurable:!0,enumerable:!0,writable:!0,value:o})}}function tM(l){l.data.datasets.forEach(o=>{xE(o)})}function PO(l,o){const u=o.length;let m=0,_;const{iScale:v}=l,{min:M,max:A,minDefined:r,maxDefined:k}=v.getUserBounds();return r&&(m=Rr(ba(o,v.axis,M).lo,0,u-1)),k?_=Rr(ba(o,v.axis,A).hi+1,m,u)-m:_=u-m,{start:m,count:_}}var DO={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(l,o,u)=>{if(!u.enabled){tM(l);return}const m=l.width;l.data.datasets.forEach((_,v)=>{const{_data:M,indexAxis:A}=_,r=l.getDatasetMeta(v),k=M||_.data;if(mf([A,l.options.indexAxis])==="y"||!r.controller.supportsDecimation)return;const N=l.scales[r.xAxisID];if(N.type!=="linear"&&N.type!=="time"||l.options.parsing)return;let{start:G,count:K}=PO(r,k);const ie=u.threshold||4*m;if(K<=ie){xE(_);return}An(M)&&(_._data=k,delete _.data,Object.defineProperty(_,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(ge){this._data=ge}}));let pe;switch(u.algorithm){case"lttb":pe=IO(k,G,K,m,u);break;case"min-max":pe=CO(k,G,K,m);break;default:throw new Error(`Unsupported decimation algorithm '${u.algorithm}'`)}_._decimated=pe})},destroy(l){tM(l)}};function LO(l,o,u){const m=l.segments,_=l.points,v=o.points,M=[];for(const A of m){let{start:r,end:k}=A;k=px(r,k,_);const N=S0(u,_[r],_[k],A.loop);if(!o.segments){M.push({source:A,target:N,start:_[r],end:_[k]});continue}const G=tE(o,N);for(const K of G){const ie=S0(u,v[K.start],v[K.end],K.loop),pe=eE(A,_,ie);for(const ge of pe)M.push({source:ge,target:K,start:{[u]:iM(N,ie,"start",Math.max)},end:{[u]:iM(N,ie,"end",Math.min)}})}}return M}function S0(l,o,u,m){if(m)return;let _=o[l],v=u[l];return l==="angle"&&(_=Rs(_),v=Rs(v)),{property:l,start:_,end:v}}function kO(l,o){const{x:u=null,y:m=null}=l||{},_=o.points,v=[];return o.segments.forEach(({start:M,end:A})=>{A=px(M,A,_);const r=_[M],k=_[A];m!==null?(v.push({x:r.x,y:m}),v.push({x:k.x,y:m})):u!==null&&(v.push({x:u,y:r.y}),v.push({x:u,y:k.y}))}),v}function px(l,o,u){for(;o>l;o--){const m=u[o];if(!isNaN(m.x)&&!isNaN(m.y))break}return o}function iM(l,o,u,m){return l&&o?m(l[u],o[u]):l?l[u]:o?o[u]:0}function vE(l,o){let u=[],m=!1;return ar(l)?(m=!0,u=l):u=kO(l,o),u.length?new gl({points:u,options:{tension:0},_loop:m,_fullLoop:m}):null}function nM(l){return l&&l.fill!==!1}function RO(l,o,u){let _=l[o].fill;const v=[o];let M;if(!u)return _;for(;_!==!1&&v.indexOf(_)===-1;){if(!pr(_))return _;if(M=l[_],!M)return!1;if(M.visible)return _;v.push(_),_=M.fill}return!1}function zO(l,o,u){const m=NO(l);if(yn(m))return isNaN(m.value)?!1:m;let _=parseFloat(m);return pr(_)&&Math.floor(_)===_?OO(m[0],o,_,u):["origin","start","end","stack","shape"].indexOf(m)>=0&&m}function OO(l,o,u,m){return(l==="-"||l==="+")&&(u=o+u),u===o||u<0||u>=m?!1:u}function FO(l,o){let u=null;return l==="start"?u=o.bottom:l==="end"?u=o.top:yn(l)?u=o.getPixelForValue(l.value):o.getBasePixel&&(u=o.getBasePixel()),u}function BO(l,o,u){let m;return l==="start"?m=u:l==="end"?m=o.options.reverse?o.min:o.max:yn(l)?m=l.value:m=o.getBaseValue(),m}function NO(l){const o=l.options,u=o.fill;let m=sn(u&&u.target,u);return m===void 0&&(m=!!o.backgroundColor),m===!1||m===null?!1:m===!0?"origin":m}function VO(l){const{scale:o,index:u,line:m}=l,_=[],v=m.segments,M=m.points,A=UO(o,u);A.push(vE({x:null,y:o.bottom},m));for(let r=0;r<v.length;r++){const k=v[r];for(let N=k.start;N<=k.end;N++)jO(_,M[N],A)}return new gl({points:_,options:{}})}function UO(l,o){const u=[],m=l.getMatchingVisibleMetas("line");for(let _=0;_<m.length;_++){const v=m[_];if(v.index===o)break;v.hidden||u.unshift(v.dataset)}return u}function jO(l,o,u){const m=[];for(let _=0;_<u.length;_++){const v=u[_],{first:M,last:A,point:r}=GO(v,o,"x");if(!(!r||M&&A)){if(M)m.unshift(r);else if(l.push(r),!A)break}}l.push(...m)}function GO(l,o,u){const m=l.interpolate(o,u);if(!m)return{};const _=m[u],v=l.segments,M=l.points;let A=!1,r=!1;for(let k=0;k<v.length;k++){const N=v[k],G=M[N.start][u],K=M[N.end][u];if(va(_,G,K)){A=_===G,r=_===K;break}}return{first:A,last:r,point:m}}class bE{constructor(o){this.x=o.x,this.y=o.y,this.radius=o.radius}pathSegment(o,u,m){const{x:_,y:v,radius:M}=this;return u=u||{start:0,end:Qn},o.arc(_,v,M,u.end,u.start,!0),!m.bounds}interpolate(o){const{x:u,y:m,radius:_}=this,v=o.angle;return{x:u+Math.cos(v)*_,y:m+Math.sin(v)*_,angle:v}}}function $O(l){const{chart:o,fill:u,line:m}=l;if(pr(u))return WO(o,u);if(u==="stack")return VO(l);if(u==="shape")return!0;const _=HO(l);return _ instanceof bE?_:vE(_,m)}function WO(l,o){const u=l.getDatasetMeta(o);return u&&l.isDatasetVisible(o)?u.dataset:null}function HO(l){return(l.scale||{}).getPointPositionForValue?ZO(l):qO(l)}function qO(l){const{scale:o={},fill:u}=l,m=FO(u,o);if(pr(m)){const _=o.isHorizontal();return{x:_?m:null,y:_?null:m}}return null}function ZO(l){const{scale:o,fill:u}=l,m=o.options,_=o.getLabels().length,v=m.reverse?o.max:o.min,M=BO(u,o,v),A=[];if(m.grid.circular){const r=o.getPointPositionForValue(0,v);return new bE({x:r.x,y:r.y,radius:o.getDistanceFromCenterForValue(M)})}for(let r=0;r<_;++r)A.push(o.getPointPositionForValue(r,M));return A}function n0(l,o,u){const m=$O(o),{line:_,scale:v,axis:M}=o,A=_.options,r=A.fill,k=A.backgroundColor,{above:N=k,below:G=k}=r||{};m&&_.points.length&&(U_(l,u),XO(l,{line:_,target:m,above:N,below:G,area:u,scale:v,axis:M}),j_(l))}function XO(l,o){const{line:u,target:m,above:_,below:v,area:M,scale:A}=o,r=u._loop?"angle":o.axis;l.save(),r==="x"&&v!==_&&(rM(l,m,M.top),sM(l,{line:u,target:m,color:_,scale:A,property:r}),l.restore(),l.save(),rM(l,m,M.bottom)),sM(l,{line:u,target:m,color:v,scale:A,property:r}),l.restore()}function rM(l,o,u){const{segments:m,points:_}=o;let v=!0,M=!1;l.beginPath();for(const A of m){const{start:r,end:k}=A,N=_[r],G=_[px(r,k,_)];v?(l.moveTo(N.x,N.y),v=!1):(l.lineTo(N.x,u),l.lineTo(N.x,N.y)),M=!!o.pathSegment(l,A,{move:M}),M?l.closePath():l.lineTo(G.x,u)}l.lineTo(o.first().x,u),l.closePath(),l.clip()}function sM(l,o){const{line:u,target:m,property:_,color:v,scale:M}=o,A=LO(u,m,_);for(const{source:r,target:k,start:N,end:G}of A){const{style:{backgroundColor:K=v}={}}=r,ie=m!==!0;l.save(),l.fillStyle=K,YO(l,M,ie&&S0(_,N,G)),l.beginPath();const pe=!!u.pathSegment(l,r);let ge;if(ie){pe?l.closePath():oM(l,m,G,_);const Te=!!m.pathSegment(l,k,{move:pe,reverse:!0});ge=pe&&Te,ge||oM(l,m,N,_)}l.closePath(),l.fill(ge?"evenodd":"nonzero"),l.restore()}}function YO(l,o,u){const{top:m,bottom:_}=o.chart.chartArea,{property:v,start:M,end:A}=u||{};v==="x"&&(l.beginPath(),l.rect(M,m,A-M,_-m),l.clip())}function oM(l,o,u,m){const _=o.interpolate(u,m);_&&l.lineTo(_.x,_.y)}var KO={id:"filler",afterDatasetsUpdate(l,o,u){const m=(l.data.datasets||[]).length,_=[];let v,M,A,r;for(M=0;M<m;++M)v=l.getDatasetMeta(M),A=v.dataset,r=null,A&&A.options&&A instanceof gl&&(r={visible:l.isDatasetVisible(M),index:M,fill:zO(A,M,m),chart:l,axis:v.controller.options.indexAxis,scale:v.vScale,line:A}),v.$filler=r,_.push(r);for(M=0;M<m;++M)r=_[M],!(!r||r.fill===!1)&&(r.fill=RO(_,M,u.propagate))},beforeDraw(l,o,u){const m=u.drawTime==="beforeDraw",_=l.getSortedVisibleDatasetMetas(),v=l.chartArea;for(let M=_.length-1;M>=0;--M){const A=_[M].$filler;A&&(A.line.updateControlPoints(v,A.axis),m&&A.fill&&n0(l.ctx,A,v))}},beforeDatasetsDraw(l,o,u){if(u.drawTime!=="beforeDatasetsDraw")return;const m=l.getSortedVisibleDatasetMetas();for(let _=m.length-1;_>=0;--_){const v=m[_].$filler;nM(v)&&n0(l.ctx,v,l.chartArea)}},beforeDatasetDraw(l,o,u){const m=o.meta.$filler;!nM(m)||u.drawTime!=="beforeDatasetDraw"||n0(l.ctx,m,l.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const aM=(l,o)=>{let{boxHeight:u=o,boxWidth:m=o}=l;return l.usePointStyle&&(u=Math.min(u,o),m=l.pointStyleWidth||Math.min(m,o)),{boxWidth:m,boxHeight:u,itemHeight:Math.max(o,u)}},JO=(l,o)=>l!==null&&o!==null&&l.datasetIndex===o.datasetIndex&&l.index===o.index;class lM extends Sa{constructor(o){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=o.chart,this.options=o.options,this.ctx=o.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(o,u,m){this.maxWidth=o,this.maxHeight=u,this._margins=m,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const o=this.options.labels||{};let u=Xn(o.generateLabels,[this.chart],this)||[];o.filter&&(u=u.filter(m=>o.filter(m,this.chart.data))),o.sort&&(u=u.sort((m,_)=>o.sort(m,_,this.chart.data))),this.options.reverse&&u.reverse(),this.legendItems=u}fit(){const{options:o,ctx:u}=this;if(!o.display){this.width=this.height=0;return}const m=o.labels,_=Pr(m.font),v=_.size,M=this._computeTitleHeight(),{boxWidth:A,itemHeight:r}=aM(m,v);let k,N;u.font=_.string,this.isHorizontal()?(k=this.maxWidth,N=this._fitRows(M,v,A,r)+10):(N=this.maxHeight,k=this._fitCols(M,_,A,r)+10),this.width=Math.min(k,o.maxWidth||this.maxWidth),this.height=Math.min(N,o.maxHeight||this.maxHeight)}_fitRows(o,u,m,_){const{ctx:v,maxWidth:M,options:{labels:{padding:A}}}=this,r=this.legendHitBoxes=[],k=this.lineWidths=[0],N=_+A;let G=o;v.textAlign="left",v.textBaseline="middle";let K=-1,ie=-N;return this.legendItems.forEach((pe,ge)=>{const Te=m+u/2+v.measureText(pe.text).width;(ge===0||k[k.length-1]+Te+2*A>M)&&(G+=N,k[k.length-(ge>0?0:1)]=0,ie+=N,K++),r[ge]={left:0,top:ie,row:K,width:Te,height:_},k[k.length-1]+=Te+A}),G}_fitCols(o,u,m,_){const{ctx:v,maxHeight:M,options:{labels:{padding:A}}}=this,r=this.legendHitBoxes=[],k=this.columnSizes=[],N=M-o;let G=A,K=0,ie=0,pe=0,ge=0;return this.legendItems.forEach((Te,Re)=>{const{itemWidth:$e,itemHeight:tt}=QO(m,u,v,Te,_);Re>0&&ie+tt+2*A>N&&(G+=K+A,k.push({width:K,height:ie}),pe+=K+A,ge++,K=ie=0),r[Re]={left:pe,top:ie,col:ge,width:$e,height:tt},K=Math.max(K,$e),ie+=tt+A}),G+=K,k.push({width:K,height:ie}),G}adjustHitBoxes(){if(!this.options.display)return;const o=this._computeTitleHeight(),{legendHitBoxes:u,options:{align:m,labels:{padding:_},rtl:v}}=this,M=Ku(v,this.left,this.width);if(this.isHorizontal()){let A=0,r=Yr(m,this.left+_,this.right-this.lineWidths[A]);for(const k of u)A!==k.row&&(A=k.row,r=Yr(m,this.left+_,this.right-this.lineWidths[A])),k.top+=this.top+o+_,k.left=M.leftForLtr(M.x(r),k.width),r+=k.width+_}else{let A=0,r=Yr(m,this.top+o+_,this.bottom-this.columnSizes[A].height);for(const k of u)k.col!==A&&(A=k.col,r=Yr(m,this.top+o+_,this.bottom-this.columnSizes[A].height)),k.top=r,k.left+=this.left+_,k.left=M.leftForLtr(M.x(k.left),k.width),r+=k.height+_}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const o=this.ctx;U_(o,this),this._draw(),j_(o)}}_draw(){const{options:o,columnSizes:u,lineWidths:m,ctx:_}=this,{align:v,labels:M}=o,A=mr.color,r=Ku(o.rtl,this.left,this.width),k=Pr(M.font),{padding:N}=M,G=k.size,K=G/2;let ie;this.drawTitle(),_.textAlign=r.textAlign("left"),_.textBaseline="middle",_.lineWidth=.5,_.font=k.string;const{boxWidth:pe,boxHeight:ge,itemHeight:Te}=aM(M,G),Re=function(at,dt,xe){if(isNaN(pe)||pe<=0||isNaN(ge)||ge<0)return;_.save();const le=sn(xe.lineWidth,1);if(_.fillStyle=sn(xe.fillStyle,A),_.lineCap=sn(xe.lineCap,"butt"),_.lineDashOffset=sn(xe.lineDashOffset,0),_.lineJoin=sn(xe.lineJoin,"miter"),_.lineWidth=le,_.strokeStyle=sn(xe.strokeStyle,A),_.setLineDash(sn(xe.lineDash,[])),M.usePointStyle){const Je={radius:ge*Math.SQRT2/2,pointStyle:xe.pointStyle,rotation:xe.rotation,borderWidth:le},Mt=r.xPlus(at,pe/2),Qe=dt+K;GS(_,Je,Mt,Qe,M.pointStyleWidth&&pe)}else{const Je=dt+Math.max((G-ge)/2,0),Mt=r.leftForLtr(at,pe),Qe=Oc(xe.borderRadius);_.beginPath(),Object.values(Qe).some(Zt=>Zt!==0)?Bf(_,{x:Mt,y:Je,w:pe,h:ge,radius:Qe}):_.rect(Mt,Je,pe,ge),_.fill(),le!==0&&_.stroke()}_.restore()},$e=function(at,dt,xe){Vc(_,xe.text,at,dt+Te/2,k,{strikethrough:xe.hidden,textAlign:r.textAlign(xe.textAlign)})},tt=this.isHorizontal(),ut=this._computeTitleHeight();tt?ie={x:Yr(v,this.left+N,this.right-m[0]),y:this.top+N+ut,line:0}:ie={x:this.left+N,y:Yr(v,this.top+ut+N,this.bottom-u[0].height),line:0},KS(this.ctx,o.textDirection);const ot=Te+N;this.legendItems.forEach((at,dt)=>{_.strokeStyle=at.fontColor,_.fillStyle=at.fontColor;const xe=_.measureText(at.text).width,le=r.textAlign(at.textAlign||(at.textAlign=M.textAlign)),Je=pe+K+xe;let Mt=ie.x,Qe=ie.y;r.setWidth(this.width),tt?dt>0&&Mt+Je+N>this.right&&(Qe=ie.y+=ot,ie.line++,Mt=ie.x=Yr(v,this.left+N,this.right-m[ie.line])):dt>0&&Qe+ot>this.bottom&&(Mt=ie.x=Mt+u[ie.line].width+N,ie.line++,Qe=ie.y=Yr(v,this.top+ut+N,this.bottom-u[ie.line].height));const Zt=r.x(Mt);if(Re(Zt,Qe,at),Mt=vk(le,Mt+pe+K,tt?Mt+Je:this.right,o.rtl),$e(r.x(Mt),Qe,at),tt)ie.x+=Je+N;else if(typeof at.text!="string"){const xi=k.lineHeight;ie.y+=wE(at,xi)+N}else ie.y+=ot}),JS(this.ctx,o.textDirection)}drawTitle(){const o=this.options,u=o.title,m=Pr(u.font),_=es(u.padding);if(!u.display)return;const v=Ku(o.rtl,this.left,this.width),M=this.ctx,A=u.position,r=m.size/2,k=_.top+r;let N,G=this.left,K=this.width;if(this.isHorizontal())K=Math.max(...this.lineWidths),N=this.top+k,G=Yr(o.align,G,this.right-K);else{const pe=this.columnSizes.reduce((ge,Te)=>Math.max(ge,Te.height),0);N=k+Yr(o.align,this.top,this.bottom-pe-o.labels.padding-this._computeTitleHeight())}const ie=Yr(A,G,G+K);M.textAlign=v.textAlign(sx(A)),M.textBaseline="middle",M.strokeStyle=u.color,M.fillStyle=u.color,M.font=m.string,Vc(M,u.text,ie,N,m)}_computeTitleHeight(){const o=this.options.title,u=Pr(o.font),m=es(o.padding);return o.display?u.lineHeight+m.height:0}_getLegendItemAt(o,u){let m,_,v;if(va(o,this.left,this.right)&&va(u,this.top,this.bottom)){for(v=this.legendHitBoxes,m=0;m<v.length;++m)if(_=v[m],va(o,_.left,_.left+_.width)&&va(u,_.top,_.top+_.height))return this.legendItems[m]}return null}handleEvent(o){const u=this.options;if(!i3(o.type,u))return;const m=this._getLegendItemAt(o.x,o.y);if(o.type==="mousemove"||o.type==="mouseout"){const _=this._hoveredItem,v=JO(_,m);_&&!v&&Xn(u.onLeave,[o,_,this],this),this._hoveredItem=m,m&&!v&&Xn(u.onHover,[o,m,this],this)}else m&&Xn(u.onClick,[o,m,this],this)}}function QO(l,o,u,m,_){const v=e3(m,l,o,u),M=t3(_,m,o.lineHeight);return{itemWidth:v,itemHeight:M}}function e3(l,o,u,m){let _=l.text;return _&&typeof _!="string"&&(_=_.reduce((v,M)=>v.length>M.length?v:M)),o+u.size/2+m.measureText(_).width}function t3(l,o,u){let m=l;return typeof o.text!="string"&&(m=wE(o,u)),m}function wE(l,o){const u=l.text?l.text.length:0;return o*u}function i3(l,o){return!!((l==="mousemove"||l==="mouseout")&&(o.onHover||o.onLeave)||o.onClick&&(l==="click"||l==="mouseup"))}var n3={id:"legend",_element:lM,start(l,o,u){const m=l.legend=new lM({ctx:l.ctx,options:u,chart:l});Qr.configure(l,m,u),Qr.addBox(l,m)},stop(l){Qr.removeBox(l,l.legend),delete l.legend},beforeUpdate(l,o,u){const m=l.legend;Qr.configure(l,m,u),m.options=u},afterUpdate(l){const o=l.legend;o.buildLabels(),o.adjustHitBoxes()},afterEvent(l,o){o.replay||l.legend.handleEvent(o.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(l,o,u){const m=o.datasetIndex,_=u.chart;_.isDatasetVisible(m)?(_.hide(m),o.hidden=!0):(_.show(m),o.hidden=!1)},onHover:null,onLeave:null,labels:{color:l=>l.chart.options.color,boxWidth:40,padding:10,generateLabels(l){const o=l.data.datasets,{labels:{usePointStyle:u,pointStyle:m,textAlign:_,color:v,useBorderRadius:M,borderRadius:A}}=l.legend.options;return l._getSortedDatasetMetas().map(r=>{const k=r.controller.getStyle(u?0:void 0),N=es(k.borderWidth);return{text:o[r.index].label,fillStyle:k.backgroundColor,fontColor:v,hidden:!r.visible,lineCap:k.borderCapStyle,lineDash:k.borderDash,lineDashOffset:k.borderDashOffset,lineJoin:k.borderJoinStyle,lineWidth:(N.width+N.height)/4,strokeStyle:k.borderColor,pointStyle:m||k.pointStyle,rotation:k.rotation,textAlign:_||k.textAlign,borderRadius:M&&(A||k.borderRadius),datasetIndex:r.index}},this)}},title:{color:l=>l.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:l=>!l.startsWith("on"),labels:{_scriptable:l=>!["generateLabels","filter","sort"].includes(l)}}};class mx extends Sa{constructor(o){super(),this.chart=o.chart,this.options=o.options,this.ctx=o.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(o,u){const m=this.options;if(this.left=0,this.top=0,!m.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=o,this.height=this.bottom=u;const _=ar(m.text)?m.text.length:1;this._padding=es(m.padding);const v=_*Pr(m.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=v:this.width=v}isHorizontal(){const o=this.options.position;return o==="top"||o==="bottom"}_drawArgs(o){const{top:u,left:m,bottom:_,right:v,options:M}=this,A=M.align;let r=0,k,N,G;return this.isHorizontal()?(N=Yr(A,m,v),G=u+o,k=v-m):(M.position==="left"?(N=m+o,G=Yr(A,_,u),r=er*-.5):(N=v-o,G=Yr(A,u,_),r=er*.5),k=_-u),{titleX:N,titleY:G,maxWidth:k,rotation:r}}draw(){const o=this.ctx,u=this.options;if(!u.display)return;const m=Pr(u.font),v=m.lineHeight/2+this._padding.top,{titleX:M,titleY:A,maxWidth:r,rotation:k}=this._drawArgs(v);Vc(o,u.text,0,0,m,{color:u.color,maxWidth:r,rotation:k,textAlign:sx(u.align),textBaseline:"middle",translation:[M,A]})}}function r3(l,o){const u=new mx({ctx:l.ctx,options:o,chart:l});Qr.configure(l,u,o),Qr.addBox(l,u),l.titleBlock=u}var s3={id:"title",_element:mx,start(l,o,u){r3(l,u)},stop(l){const o=l.titleBlock;Qr.removeBox(l,o),delete l.titleBlock},beforeUpdate(l,o,u){const m=l.titleBlock;Qr.configure(l,m,u),m.options=u},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const t_=new WeakMap;var o3={id:"subtitle",start(l,o,u){const m=new mx({ctx:l.ctx,options:u,chart:l});Qr.configure(l,m,u),Qr.addBox(l,m),t_.set(l,m)},stop(l){Qr.removeBox(l,t_.get(l)),t_.delete(l)},beforeUpdate(l,o,u){const m=t_.get(l);Qr.configure(l,m,u),m.options=u},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const yf={average(l){if(!l.length)return!1;let o,u,m=new Set,_=0,v=0;for(o=0,u=l.length;o<u;++o){const A=l[o].element;if(A&&A.hasValue()){const r=A.tooltipPosition();m.add(r.x),_+=r.y,++v}}return{x:[...m].reduce((A,r)=>A+r)/m.size,y:_/v}},nearest(l,o){if(!l.length)return!1;let u=o.x,m=o.y,_=Number.POSITIVE_INFINITY,v,M,A;for(v=0,M=l.length;v<M;++v){const r=l[v].element;if(r&&r.hasValue()){const k=r.getCenterPoint(),N=g0(o,k);N<_&&(_=N,A=r)}}if(A){const r=A.tooltipPosition();u=r.x,m=r.y}return{x:u,y:m}}};function Bo(l,o){return o&&(ar(o)?Array.prototype.push.apply(l,o):l.push(o)),l}function ma(l){return(typeof l=="string"||l instanceof String)&&l.indexOf(`
`)>-1?l.split(`
`):l}function a3(l,o){const{element:u,datasetIndex:m,index:_}=o,v=l.getDatasetMeta(m).controller,{label:M,value:A}=v.getLabelAndValue(_);return{chart:l,label:M,parsed:v.getParsed(_),raw:l.data.datasets[m].data[_],formattedValue:A,dataset:v.getDataset(),dataIndex:_,datasetIndex:m,element:u}}function cM(l,o){const u=l.chart.ctx,{body:m,footer:_,title:v}=l,{boxWidth:M,boxHeight:A}=o,r=Pr(o.bodyFont),k=Pr(o.titleFont),N=Pr(o.footerFont),G=v.length,K=_.length,ie=m.length,pe=es(o.padding);let ge=pe.height,Te=0,Re=m.reduce((ut,ot)=>ut+ot.before.length+ot.lines.length+ot.after.length,0);if(Re+=l.beforeBody.length+l.afterBody.length,G&&(ge+=G*k.lineHeight+(G-1)*o.titleSpacing+o.titleMarginBottom),Re){const ut=o.displayColors?Math.max(A,r.lineHeight):r.lineHeight;ge+=ie*ut+(Re-ie)*r.lineHeight+(Re-1)*o.bodySpacing}K&&(ge+=o.footerMarginTop+K*N.lineHeight+(K-1)*o.footerSpacing);let $e=0;const tt=function(ut){Te=Math.max(Te,u.measureText(ut).width+$e)};return u.save(),u.font=k.string,Gn(l.title,tt),u.font=r.string,Gn(l.beforeBody.concat(l.afterBody),tt),$e=o.displayColors?M+2+o.boxPadding:0,Gn(m,ut=>{Gn(ut.before,tt),Gn(ut.lines,tt),Gn(ut.after,tt)}),$e=0,u.font=N.string,Gn(l.footer,tt),u.restore(),Te+=pe.width,{width:Te,height:ge}}function l3(l,o){const{y:u,height:m}=o;return u<m/2?"top":u>l.height-m/2?"bottom":"center"}function c3(l,o,u,m){const{x:_,width:v}=m,M=u.caretSize+u.caretPadding;if(l==="left"&&_+v+M>o.width||l==="right"&&_-v-M<0)return!0}function u3(l,o,u,m){const{x:_,width:v}=u,{width:M,chartArea:{left:A,right:r}}=l;let k="center";return m==="center"?k=_<=(A+r)/2?"left":"right":_<=v/2?k="left":_>=M-v/2&&(k="right"),c3(k,l,o,u)&&(k="center"),k}function uM(l,o,u){const m=u.yAlign||o.yAlign||l3(l,u);return{xAlign:u.xAlign||o.xAlign||u3(l,o,u,m),yAlign:m}}function h3(l,o){let{x:u,width:m}=l;return o==="right"?u-=m:o==="center"&&(u-=m/2),u}function d3(l,o,u){let{y:m,height:_}=l;return o==="top"?m+=u:o==="bottom"?m-=_+u:m-=_/2,m}function hM(l,o,u,m){const{caretSize:_,caretPadding:v,cornerRadius:M}=l,{xAlign:A,yAlign:r}=u,k=_+v,{topLeft:N,topRight:G,bottomLeft:K,bottomRight:ie}=Oc(M);let pe=h3(o,A);const ge=d3(o,r,k);return r==="center"?A==="left"?pe+=k:A==="right"&&(pe-=k):A==="left"?pe-=Math.max(N,K)+_:A==="right"&&(pe+=Math.max(G,ie)+_),{x:Rr(pe,0,m.width-o.width),y:Rr(ge,0,m.height-o.height)}}function i_(l,o,u){const m=es(u.padding);return o==="center"?l.x+l.width/2:o==="right"?l.x+l.width-m.right:l.x+m.left}function dM(l){return Bo([],ma(l))}function f3(l,o,u){return Al(l,{tooltip:o,tooltipItems:u,type:"tooltip"})}function fM(l,o){const u=o&&o.dataset&&o.dataset.tooltip&&o.dataset.tooltip.callbacks;return u?l.override(u):l}const TE={beforeTitle:fa,title(l){if(l.length>0){const o=l[0],u=o.chart.data.labels,m=u?u.length:0;if(this&&this.options&&this.options.mode==="dataset")return o.dataset.label||"";if(o.label)return o.label;if(m>0&&o.dataIndex<m)return u[o.dataIndex]}return""},afterTitle:fa,beforeBody:fa,beforeLabel:fa,label(l){if(this&&this.options&&this.options.mode==="dataset")return l.label+": "+l.formattedValue||l.formattedValue;let o=l.dataset.label||"";o&&(o+=": ");const u=l.formattedValue;return An(u)||(o+=u),o},labelColor(l){const u=l.chart.getDatasetMeta(l.datasetIndex).controller.getStyle(l.dataIndex);return{borderColor:u.borderColor,backgroundColor:u.backgroundColor,borderWidth:u.borderWidth,borderDash:u.borderDash,borderDashOffset:u.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(l){const u=l.chart.getDatasetMeta(l.datasetIndex).controller.getStyle(l.dataIndex);return{pointStyle:u.pointStyle,rotation:u.rotation}},afterLabel:fa,afterBody:fa,beforeFooter:fa,footer:fa,afterFooter:fa};function _s(l,o,u,m){const _=l[o].call(u,m);return typeof _>"u"?TE[o].call(u,m):_}class E0 extends Sa{constructor(o){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=o.chart,this.options=o.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(o){this.options=o,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const o=this._cachedAnimations;if(o)return o;const u=this.chart,m=this.options.setContext(this.getContext()),_=m.enabled&&u.options.animation&&m.animations,v=new iE(this.chart,_);return _._cacheable&&(this._cachedAnimations=Object.freeze(v)),v}getContext(){return this.$context||(this.$context=f3(this.chart.getContext(),this,this._tooltipItems))}getTitle(o,u){const{callbacks:m}=u,_=_s(m,"beforeTitle",this,o),v=_s(m,"title",this,o),M=_s(m,"afterTitle",this,o);let A=[];return A=Bo(A,ma(_)),A=Bo(A,ma(v)),A=Bo(A,ma(M)),A}getBeforeBody(o,u){return dM(_s(u.callbacks,"beforeBody",this,o))}getBody(o,u){const{callbacks:m}=u,_=[];return Gn(o,v=>{const M={before:[],lines:[],after:[]},A=fM(m,v);Bo(M.before,ma(_s(A,"beforeLabel",this,v))),Bo(M.lines,_s(A,"label",this,v)),Bo(M.after,ma(_s(A,"afterLabel",this,v))),_.push(M)}),_}getAfterBody(o,u){return dM(_s(u.callbacks,"afterBody",this,o))}getFooter(o,u){const{callbacks:m}=u,_=_s(m,"beforeFooter",this,o),v=_s(m,"footer",this,o),M=_s(m,"afterFooter",this,o);let A=[];return A=Bo(A,ma(_)),A=Bo(A,ma(v)),A=Bo(A,ma(M)),A}_createItems(o){const u=this._active,m=this.chart.data,_=[],v=[],M=[];let A=[],r,k;for(r=0,k=u.length;r<k;++r)A.push(a3(this.chart,u[r]));return o.filter&&(A=A.filter((N,G,K)=>o.filter(N,G,K,m))),o.itemSort&&(A=A.sort((N,G)=>o.itemSort(N,G,m))),Gn(A,N=>{const G=fM(o.callbacks,N);_.push(_s(G,"labelColor",this,N)),v.push(_s(G,"labelPointStyle",this,N)),M.push(_s(G,"labelTextColor",this,N))}),this.labelColors=_,this.labelPointStyles=v,this.labelTextColors=M,this.dataPoints=A,A}update(o,u){const m=this.options.setContext(this.getContext()),_=this._active;let v,M=[];if(!_.length)this.opacity!==0&&(v={opacity:0});else{const A=yf[m.position].call(this,_,this._eventPosition);M=this._createItems(m),this.title=this.getTitle(M,m),this.beforeBody=this.getBeforeBody(M,m),this.body=this.getBody(M,m),this.afterBody=this.getAfterBody(M,m),this.footer=this.getFooter(M,m);const r=this._size=cM(this,m),k=Object.assign({},A,r),N=uM(this.chart,m,k),G=hM(m,k,N,this.chart);this.xAlign=N.xAlign,this.yAlign=N.yAlign,v={opacity:1,x:G.x,y:G.y,width:r.width,height:r.height,caretX:A.x,caretY:A.y}}this._tooltipItems=M,this.$context=void 0,v&&this._resolveAnimations().update(this,v),o&&m.external&&m.external.call(this,{chart:this.chart,tooltip:this,replay:u})}drawCaret(o,u,m,_){const v=this.getCaretPosition(o,m,_);u.lineTo(v.x1,v.y1),u.lineTo(v.x2,v.y2),u.lineTo(v.x3,v.y3)}getCaretPosition(o,u,m){const{xAlign:_,yAlign:v}=this,{caretSize:M,cornerRadius:A}=m,{topLeft:r,topRight:k,bottomLeft:N,bottomRight:G}=Oc(A),{x:K,y:ie}=o,{width:pe,height:ge}=u;let Te,Re,$e,tt,ut,ot;return v==="center"?(ut=ie+ge/2,_==="left"?(Te=K,Re=Te-M,tt=ut+M,ot=ut-M):(Te=K+pe,Re=Te+M,tt=ut-M,ot=ut+M),$e=Te):(_==="left"?Re=K+Math.max(r,N)+M:_==="right"?Re=K+pe-Math.max(k,G)-M:Re=this.caretX,v==="top"?(tt=ie,ut=tt-M,Te=Re-M,$e=Re+M):(tt=ie+ge,ut=tt+M,Te=Re+M,$e=Re-M),ot=tt),{x1:Te,x2:Re,x3:$e,y1:tt,y2:ut,y3:ot}}drawTitle(o,u,m){const _=this.title,v=_.length;let M,A,r;if(v){const k=Ku(m.rtl,this.x,this.width);for(o.x=i_(this,m.titleAlign,m),u.textAlign=k.textAlign(m.titleAlign),u.textBaseline="middle",M=Pr(m.titleFont),A=m.titleSpacing,u.fillStyle=m.titleColor,u.font=M.string,r=0;r<v;++r)u.fillText(_[r],k.x(o.x),o.y+M.lineHeight/2),o.y+=M.lineHeight+A,r+1===v&&(o.y+=m.titleMarginBottom-A)}}_drawColorBox(o,u,m,_,v){const M=this.labelColors[m],A=this.labelPointStyles[m],{boxHeight:r,boxWidth:k}=v,N=Pr(v.bodyFont),G=i_(this,"left",v),K=_.x(G),ie=r<N.lineHeight?(N.lineHeight-r)/2:0,pe=u.y+ie;if(v.usePointStyle){const ge={radius:Math.min(k,r)/2,pointStyle:A.pointStyle,rotation:A.rotation,borderWidth:1},Te=_.leftForLtr(K,k)+k/2,Re=pe+r/2;o.strokeStyle=v.multiKeyBackground,o.fillStyle=v.multiKeyBackground,x0(o,ge,Te,Re),o.strokeStyle=M.borderColor,o.fillStyle=M.backgroundColor,x0(o,ge,Te,Re)}else{o.lineWidth=yn(M.borderWidth)?Math.max(...Object.values(M.borderWidth)):M.borderWidth||1,o.strokeStyle=M.borderColor,o.setLineDash(M.borderDash||[]),o.lineDashOffset=M.borderDashOffset||0;const ge=_.leftForLtr(K,k),Te=_.leftForLtr(_.xPlus(K,1),k-2),Re=Oc(M.borderRadius);Object.values(Re).some($e=>$e!==0)?(o.beginPath(),o.fillStyle=v.multiKeyBackground,Bf(o,{x:ge,y:pe,w:k,h:r,radius:Re}),o.fill(),o.stroke(),o.fillStyle=M.backgroundColor,o.beginPath(),Bf(o,{x:Te,y:pe+1,w:k-2,h:r-2,radius:Re}),o.fill()):(o.fillStyle=v.multiKeyBackground,o.fillRect(ge,pe,k,r),o.strokeRect(ge,pe,k,r),o.fillStyle=M.backgroundColor,o.fillRect(Te,pe+1,k-2,r-2))}o.fillStyle=this.labelTextColors[m]}drawBody(o,u,m){const{body:_}=this,{bodySpacing:v,bodyAlign:M,displayColors:A,boxHeight:r,boxWidth:k,boxPadding:N}=m,G=Pr(m.bodyFont);let K=G.lineHeight,ie=0;const pe=Ku(m.rtl,this.x,this.width),ge=function(xe){u.fillText(xe,pe.x(o.x+ie),o.y+K/2),o.y+=K+v},Te=pe.textAlign(M);let Re,$e,tt,ut,ot,at,dt;for(u.textAlign=M,u.textBaseline="middle",u.font=G.string,o.x=i_(this,Te,m),u.fillStyle=m.bodyColor,Gn(this.beforeBody,ge),ie=A&&Te!=="right"?M==="center"?k/2+N:k+2+N:0,ut=0,at=_.length;ut<at;++ut){for(Re=_[ut],$e=this.labelTextColors[ut],u.fillStyle=$e,Gn(Re.before,ge),tt=Re.lines,A&&tt.length&&(this._drawColorBox(u,o,ut,pe,m),K=Math.max(G.lineHeight,r)),ot=0,dt=tt.length;ot<dt;++ot)ge(tt[ot]),K=G.lineHeight;Gn(Re.after,ge)}ie=0,K=G.lineHeight,Gn(this.afterBody,ge),o.y-=v}drawFooter(o,u,m){const _=this.footer,v=_.length;let M,A;if(v){const r=Ku(m.rtl,this.x,this.width);for(o.x=i_(this,m.footerAlign,m),o.y+=m.footerMarginTop,u.textAlign=r.textAlign(m.footerAlign),u.textBaseline="middle",M=Pr(m.footerFont),u.fillStyle=m.footerColor,u.font=M.string,A=0;A<v;++A)u.fillText(_[A],r.x(o.x),o.y+M.lineHeight/2),o.y+=M.lineHeight+m.footerSpacing}}drawBackground(o,u,m,_){const{xAlign:v,yAlign:M}=this,{x:A,y:r}=o,{width:k,height:N}=m,{topLeft:G,topRight:K,bottomLeft:ie,bottomRight:pe}=Oc(_.cornerRadius);u.fillStyle=_.backgroundColor,u.strokeStyle=_.borderColor,u.lineWidth=_.borderWidth,u.beginPath(),u.moveTo(A+G,r),M==="top"&&this.drawCaret(o,u,m,_),u.lineTo(A+k-K,r),u.quadraticCurveTo(A+k,r,A+k,r+K),M==="center"&&v==="right"&&this.drawCaret(o,u,m,_),u.lineTo(A+k,r+N-pe),u.quadraticCurveTo(A+k,r+N,A+k-pe,r+N),M==="bottom"&&this.drawCaret(o,u,m,_),u.lineTo(A+ie,r+N),u.quadraticCurveTo(A,r+N,A,r+N-ie),M==="center"&&v==="left"&&this.drawCaret(o,u,m,_),u.lineTo(A,r+G),u.quadraticCurveTo(A,r,A+G,r),u.closePath(),u.fill(),_.borderWidth>0&&u.stroke()}_updateAnimationTarget(o){const u=this.chart,m=this.$animations,_=m&&m.x,v=m&&m.y;if(_||v){const M=yf[o.position].call(this,this._active,this._eventPosition);if(!M)return;const A=this._size=cM(this,o),r=Object.assign({},M,this._size),k=uM(u,o,r),N=hM(o,r,k,u);(_._to!==N.x||v._to!==N.y)&&(this.xAlign=k.xAlign,this.yAlign=k.yAlign,this.width=A.width,this.height=A.height,this.caretX=M.x,this.caretY=M.y,this._resolveAnimations().update(this,N))}}_willRender(){return!!this.opacity}draw(o){const u=this.options.setContext(this.getContext());let m=this.opacity;if(!m)return;this._updateAnimationTarget(u);const _={width:this.width,height:this.height},v={x:this.x,y:this.y};m=Math.abs(m)<.001?0:m;const M=es(u.padding),A=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;u.enabled&&A&&(o.save(),o.globalAlpha=m,this.drawBackground(v,o,_,u),KS(o,u.textDirection),v.y+=M.top,this.drawTitle(v,o,u),this.drawBody(v,o,u),this.drawFooter(v,o,u),JS(o,u.textDirection),o.restore())}getActiveElements(){return this._active||[]}setActiveElements(o,u){const m=this._active,_=o.map(({datasetIndex:A,index:r})=>{const k=this.chart.getDatasetMeta(A);if(!k)throw new Error("Cannot find a dataset at index "+A);return{datasetIndex:A,element:k.data[r],index:r}}),v=!w_(m,_),M=this._positionChanged(_,u);(v||M)&&(this._active=_,this._eventPosition=u,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(o,u,m=!0){if(u&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const _=this.options,v=this._active||[],M=this._getActiveElements(o,v,u,m),A=this._positionChanged(M,o),r=u||!w_(M,v)||A;return r&&(this._active=M,(_.enabled||_.external)&&(this._eventPosition={x:o.x,y:o.y},this.update(!0,u))),r}_getActiveElements(o,u,m,_){const v=this.options;if(o.type==="mouseout")return[];if(!_)return u.filter(A=>this.chart.data.datasets[A.datasetIndex]&&this.chart.getDatasetMeta(A.datasetIndex).controller.getParsed(A.index)!==void 0);const M=this.chart.getElementsAtEventForMode(o,v.mode,v,m);return v.reverse&&M.reverse(),M}_positionChanged(o,u){const{caretX:m,caretY:_,options:v}=this,M=yf[v.position].call(this,o,u);return M!==!1&&(m!==M.x||_!==M.y)}}ei(E0,"positioners",yf);var p3={id:"tooltip",_element:E0,positioners:yf,afterInit(l,o,u){u&&(l.tooltip=new E0({chart:l,options:u}))},beforeUpdate(l,o,u){l.tooltip&&l.tooltip.initialize(u)},reset(l,o,u){l.tooltip&&l.tooltip.initialize(u)},afterDraw(l){const o=l.tooltip;if(o&&o._willRender()){const u={tooltip:o};if(l.notifyPlugins("beforeTooltipDraw",{...u,cancelable:!0})===!1)return;o.draw(l.ctx),l.notifyPlugins("afterTooltipDraw",u)}},afterEvent(l,o){if(l.tooltip){const u=o.replay;l.tooltip.handleEvent(o.event,u,o.inChartArea)&&(o.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(l,o)=>o.bodyFont.size,boxWidth:(l,o)=>o.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:TE},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:l=>l!=="filter"&&l!=="itemSort"&&l!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},m3=Object.freeze({__proto__:null,Colors:AO,Decimation:DO,Filler:KO,Legend:n3,SubTitle:o3,Title:s3,Tooltip:p3});const _3=(l,o,u,m)=>(typeof o=="string"?(u=l.push(o)-1,m.unshift({index:u,label:o})):isNaN(o)&&(u=null),u);function g3(l,o,u,m){const _=l.indexOf(o);if(_===-1)return _3(l,o,u,m);const v=l.lastIndexOf(o);return _!==v?u:_}const y3=(l,o)=>l===null?null:Rr(Math.round(l),0,o);function pM(l){const o=this.getLabels();return l>=0&&l<o.length?o[l]:l}class A0 extends jc{constructor(o){super(o),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(o){const u=this._addedLabels;if(u.length){const m=this.getLabels();for(const{index:_,label:v}of u)m[_]===v&&m.splice(_,1);this._addedLabels=[]}super.init(o)}parse(o,u){if(An(o))return null;const m=this.getLabels();return u=isFinite(u)&&m[u]===o?u:g3(m,o,sn(u,o),this._addedLabels),y3(u,m.length-1)}determineDataLimits(){const{minDefined:o,maxDefined:u}=this.getUserBounds();let{min:m,max:_}=this.getMinMax(!0);this.options.bounds==="ticks"&&(o||(m=0),u||(_=this.getLabels().length-1)),this.min=m,this.max=_}buildTicks(){const o=this.min,u=this.max,m=this.options.offset,_=[];let v=this.getLabels();v=o===0&&u===v.length-1?v:v.slice(o,u+1),this._valueRange=Math.max(v.length-(m?0:1),1),this._startValue=this.min-(m?.5:0);for(let M=o;M<=u;M++)_.push({value:M});return _}getLabelForValue(o){return pM.call(this,o)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(o){return typeof o!="number"&&(o=this.parse(o)),o===null?NaN:this.getPixelForDecimal((o-this._startValue)/this._valueRange)}getPixelForTick(o){const u=this.ticks;return o<0||o>u.length-1?null:this.getPixelForValue(u[o].value)}getValueForPixel(o){return Math.round(this._startValue+this.getDecimalForPixel(o)*this._valueRange)}getBasePixel(){return this.bottom}}ei(A0,"id","category"),ei(A0,"defaults",{ticks:{callback:pM}});function x3(l,o){const u=[],{bounds:_,step:v,min:M,max:A,precision:r,count:k,maxTicks:N,maxDigits:G,includeBounds:K}=l,ie=v||1,pe=N-1,{min:ge,max:Te}=o,Re=!An(M),$e=!An(A),tt=!An(k),ut=(Te-ge)/(G+1);let ot=lT((Te-ge)/pe/ie)*ie,at,dt,xe,le;if(ot<1e-14&&!Re&&!$e)return[{value:ge},{value:Te}];le=Math.ceil(Te/ot)-Math.floor(ge/ot),le>pe&&(ot=lT(le*ot/pe/ie)*ie),An(r)||(at=Math.pow(10,r),ot=Math.ceil(ot*at)/at),_==="ticks"?(dt=Math.floor(ge/ot)*ot,xe=Math.ceil(Te/ot)*ot):(dt=ge,xe=Te),Re&&$e&&v&&fk((A-M)/v,ot/1e3)?(le=Math.round(Math.min((A-M)/ot,N)),ot=(A-M)/le,dt=M,xe=A):tt?(dt=Re?M:dt,xe=$e?A:xe,le=k-1,ot=(xe-dt)/le):(le=(xe-dt)/ot,Ef(le,Math.round(le),ot/1e3)?le=Math.round(le):le=Math.ceil(le));const Je=Math.max(cT(ot),cT(dt));at=Math.pow(10,An(r)?Je:r),dt=Math.round(dt*at)/at,xe=Math.round(xe*at)/at;let Mt=0;for(Re&&(K&&dt!==M?(u.push({value:M}),dt<M&&Mt++,Ef(Math.round((dt+Mt*ot)*at)/at,M,mM(M,ut,l))&&Mt++):dt<M&&Mt++);Mt<le;++Mt){const Qe=Math.round((dt+Mt*ot)*at)/at;if($e&&Qe>A)break;u.push({value:Qe})}return $e&&K&&xe!==A?u.length&&Ef(u[u.length-1].value,A,mM(A,ut,l))?u[u.length-1].value=A:u.push({value:A}):(!$e||xe===A)&&u.push({value:xe}),u}function mM(l,o,{horizontal:u,minRotation:m}){const _=co(m),v=(u?Math.sin(_):Math.cos(_))||.001,M=.75*o*(""+l).length;return Math.min(o/v,M)}class C_ extends jc{constructor(o){super(o),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(o,u){return An(o)||(typeof o=="number"||o instanceof Number)&&!isFinite(+o)?null:+o}handleTickRangeOptions(){const{beginAtZero:o}=this.options,{minDefined:u,maxDefined:m}=this.getUserBounds();let{min:_,max:v}=this;const M=r=>_=u?_:r,A=r=>v=m?v:r;if(o){const r=jo(_),k=jo(v);r<0&&k<0?A(0):r>0&&k>0&&M(0)}if(_===v){let r=v===0?1:Math.abs(v*.05);A(v+r),o||M(_-r)}this.min=_,this.max=v}getTickLimit(){const o=this.options.ticks;let{maxTicksLimit:u,stepSize:m}=o,_;return m?(_=Math.ceil(this.max/m)-Math.floor(this.min/m)+1,_>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${m} would result generating up to ${_} ticks. Limiting to 1000.`),_=1e3)):(_=this.computeTickLimit(),u=u||11),u&&(_=Math.min(u,_)),_}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const o=this.options,u=o.ticks;let m=this.getTickLimit();m=Math.max(2,m);const _={maxTicks:m,bounds:o.bounds,min:o.min,max:o.max,precision:u.precision,step:u.stepSize,count:u.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:u.minRotation||0,includeBounds:u.includeBounds!==!1},v=this._range||this,M=x3(_,v);return o.bounds==="ticks"&&RS(M,this,"value"),o.reverse?(M.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),M}configure(){const o=this.ticks;let u=this.min,m=this.max;if(super.configure(),this.options.offset&&o.length){const _=(m-u)/Math.max(o.length-1,1)/2;u-=_,m+=_}this._startValue=u,this._endValue=m,this._valueRange=m-u}getLabelForValue(o){return $f(o,this.chart.options.locale,this.options.ticks.format)}}class I0 extends C_{determineDataLimits(){const{min:o,max:u}=this.getMinMax(!0);this.min=pr(o)?o:0,this.max=pr(u)?u:1,this.handleTickRangeOptions()}computeTickLimit(){const o=this.isHorizontal(),u=o?this.width:this.height,m=co(this.options.ticks.minRotation),_=(o?Math.sin(m):Math.cos(m))||.001,v=this._resolveTickFontOptions(0);return Math.ceil(u/Math.min(40,v.lineHeight/_))}getPixelForValue(o){return o===null?NaN:this.getPixelForDecimal((o-this._startValue)/this._valueRange)}getValueForPixel(o){return this._startValue+this.getDecimalForPixel(o)*this._valueRange}}ei(I0,"id","linear"),ei(I0,"defaults",{ticks:{callback:V_.formatters.numeric}});const Vf=l=>Math.floor(_l(l)),Cc=(l,o)=>Math.pow(10,Vf(l)+o);function _M(l){return l/Math.pow(10,Vf(l))===1}function gM(l,o,u){const m=Math.pow(10,u),_=Math.floor(l/m);return Math.ceil(o/m)-_}function v3(l,o){const u=o-l;let m=Vf(u);for(;gM(l,o,m)>10;)m++;for(;gM(l,o,m)<10;)m--;return Math.min(m,Vf(l))}function b3(l,{min:o,max:u}){o=ks(l.min,o);const m=[],_=Vf(o);let v=v3(o,u),M=v<0?Math.pow(10,Math.abs(v)):1;const A=Math.pow(10,v),r=_>v?Math.pow(10,_):0,k=Math.round((o-r)*M)/M,N=Math.floor((o-r)/A/10)*A*10;let G=Math.floor((k-N)/Math.pow(10,v)),K=ks(l.min,Math.round((r+N+G*Math.pow(10,v))*M)/M);for(;K<u;)m.push({value:K,major:_M(K),significand:G}),G>=10?G=G<15?15:20:G++,G>=20&&(v++,G=2,M=v>=0?1:M),K=Math.round((r+N+G*Math.pow(10,v))*M)/M;const ie=ks(l.max,K);return m.push({value:ie,major:_M(ie),significand:G}),m}class C0 extends jc{constructor(o){super(o),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(o,u){const m=C_.prototype.parse.apply(this,[o,u]);if(m===0){this._zero=!0;return}return pr(m)&&m>0?m:null}determineDataLimits(){const{min:o,max:u}=this.getMinMax(!0);this.min=pr(o)?Math.max(0,o):null,this.max=pr(u)?Math.max(0,u):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!pr(this._userMin)&&(this.min=o===Cc(this.min,0)?Cc(this.min,-1):Cc(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:o,maxDefined:u}=this.getUserBounds();let m=this.min,_=this.max;const v=A=>m=o?m:A,M=A=>_=u?_:A;m===_&&(m<=0?(v(1),M(10)):(v(Cc(m,-1)),M(Cc(_,1)))),m<=0&&v(Cc(_,-1)),_<=0&&M(Cc(m,1)),this.min=m,this.max=_}buildTicks(){const o=this.options,u={min:this._userMin,max:this._userMax},m=b3(u,this);return o.bounds==="ticks"&&RS(m,this,"value"),o.reverse?(m.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),m}getLabelForValue(o){return o===void 0?"0":$f(o,this.chart.options.locale,this.options.ticks.format)}configure(){const o=this.min;super.configure(),this._startValue=_l(o),this._valueRange=_l(this.max)-_l(o)}getPixelForValue(o){return(o===void 0||o===0)&&(o=this.min),o===null||isNaN(o)?NaN:this.getPixelForDecimal(o===this.min?0:(_l(o)-this._startValue)/this._valueRange)}getValueForPixel(o){const u=this.getDecimalForPixel(o);return Math.pow(10,this._startValue+u*this._valueRange)}}ei(C0,"id","logarithmic"),ei(C0,"defaults",{ticks:{callback:V_.formatters.logarithmic,major:{enabled:!0}}});function P0(l){const o=l.ticks;if(o.display&&l.display){const u=es(o.backdropPadding);return sn(o.font&&o.font.size,mr.font.size)+u.height}return 0}function w3(l,o,u){return u=ar(u)?u:[u],{w:Pk(l,o.string,u),h:u.length*o.lineHeight}}function yM(l,o,u,m,_){return l===m||l===_?{start:o-u/2,end:o+u/2}:l<m||l>_?{start:o-u,end:o}:{start:o,end:o+u}}function T3(l){const o={l:l.left+l._padding.left,r:l.right-l._padding.right,t:l.top+l._padding.top,b:l.bottom-l._padding.bottom},u=Object.assign({},o),m=[],_=[],v=l._pointLabels.length,M=l.options.pointLabels,A=M.centerPointLabels?er/v:0;for(let r=0;r<v;r++){const k=M.setContext(l.getPointLabelContext(r));_[r]=k.padding;const N=l.getPointPosition(r,l.drawingArea+_[r],A),G=Pr(k.font),K=w3(l.ctx,G,l._pointLabels[r]);m[r]=K;const ie=Rs(l.getIndexAngle(r)+A),pe=Math.round(nx(ie)),ge=yM(pe,N.x,K.w,0,180),Te=yM(pe,N.y,K.h,90,270);M3(u,o,ie,ge,Te)}l.setCenterPoint(o.l-u.l,u.r-o.r,o.t-u.t,u.b-o.b),l._pointLabelItems=A3(l,m,_)}function M3(l,o,u,m,_){const v=Math.abs(Math.sin(u)),M=Math.abs(Math.cos(u));let A=0,r=0;m.start<o.l?(A=(o.l-m.start)/v,l.l=Math.min(l.l,o.l-A)):m.end>o.r&&(A=(m.end-o.r)/v,l.r=Math.max(l.r,o.r+A)),_.start<o.t?(r=(o.t-_.start)/M,l.t=Math.min(l.t,o.t-r)):_.end>o.b&&(r=(_.end-o.b)/M,l.b=Math.max(l.b,o.b+r))}function S3(l,o,u){const m=l.drawingArea,{extra:_,additionalAngle:v,padding:M,size:A}=u,r=l.getPointPosition(o,m+_+M,v),k=Math.round(nx(Rs(r.angle+wr))),N=P3(r.y,A.h,k),G=I3(k),K=C3(r.x,A.w,G);return{visible:!0,x:r.x,y:N,textAlign:G,left:K,top:N,right:K+A.w,bottom:N+A.h}}function E3(l,o){if(!o)return!0;const{left:u,top:m,right:_,bottom:v}=l;return!(wa({x:u,y:m},o)||wa({x:u,y:v},o)||wa({x:_,y:m},o)||wa({x:_,y:v},o))}function A3(l,o,u){const m=[],_=l._pointLabels.length,v=l.options,{centerPointLabels:M,display:A}=v.pointLabels,r={extra:P0(v)/2,additionalAngle:M?er/_:0};let k;for(let N=0;N<_;N++){r.padding=u[N],r.size=o[N];const G=S3(l,N,r);m.push(G),A==="auto"&&(G.visible=E3(G,k),G.visible&&(k=G))}return m}function I3(l){return l===0||l===180?"center":l<180?"left":"right"}function C3(l,o,u){return u==="right"?l-=o:u==="center"&&(l-=o/2),l}function P3(l,o,u){return u===90||u===270?l-=o/2:(u>270||u<90)&&(l-=o),l}function D3(l,o,u){const{left:m,top:_,right:v,bottom:M}=u,{backdropColor:A}=o;if(!An(A)){const r=Oc(o.borderRadius),k=es(o.backdropPadding);l.fillStyle=A;const N=m-k.left,G=_-k.top,K=v-m+k.width,ie=M-_+k.height;Object.values(r).some(pe=>pe!==0)?(l.beginPath(),Bf(l,{x:N,y:G,w:K,h:ie,radius:r}),l.fill()):l.fillRect(N,G,K,ie)}}function L3(l,o){const{ctx:u,options:{pointLabels:m}}=l;for(let _=o-1;_>=0;_--){const v=l._pointLabelItems[_];if(!v.visible)continue;const M=m.setContext(l.getPointLabelContext(_));D3(u,M,v);const A=Pr(M.font),{x:r,y:k,textAlign:N}=v;Vc(u,l._pointLabels[_],r,k+A.lineHeight/2,A,{color:M.color,textAlign:N,textBaseline:"middle"})}}function ME(l,o,u,m){const{ctx:_}=l;if(u)_.arc(l.xCenter,l.yCenter,o,0,Qn);else{let v=l.getPointPosition(0,o);_.moveTo(v.x,v.y);for(let M=1;M<m;M++)v=l.getPointPosition(M,o),_.lineTo(v.x,v.y)}}function k3(l,o,u,m,_){const v=l.ctx,M=o.circular,{color:A,lineWidth:r}=o;!M&&!m||!A||!r||u<0||(v.save(),v.strokeStyle=A,v.lineWidth=r,v.setLineDash(_.dash),v.lineDashOffset=_.dashOffset,v.beginPath(),ME(l,u,M,m),v.closePath(),v.stroke(),v.restore())}function R3(l,o,u){return Al(l,{label:u,index:o,type:"pointLabel"})}class xf extends C_{constructor(o){super(o),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const o=this._padding=es(P0(this.options)/2),u=this.width=this.maxWidth-o.width,m=this.height=this.maxHeight-o.height;this.xCenter=Math.floor(this.left+u/2+o.left),this.yCenter=Math.floor(this.top+m/2+o.top),this.drawingArea=Math.floor(Math.min(u,m)/2)}determineDataLimits(){const{min:o,max:u}=this.getMinMax(!1);this.min=pr(o)&&!isNaN(o)?o:0,this.max=pr(u)&&!isNaN(u)?u:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/P0(this.options))}generateTickLabels(o){C_.prototype.generateTickLabels.call(this,o),this._pointLabels=this.getLabels().map((u,m)=>{const _=Xn(this.options.pointLabels.callback,[u,m],this);return _||_===0?_:""}).filter((u,m)=>this.chart.getDataVisibility(m))}fit(){const o=this.options;o.display&&o.pointLabels.display?T3(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(o,u,m,_){this.xCenter+=Math.floor((o-u)/2),this.yCenter+=Math.floor((m-_)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(o,u,m,_))}getIndexAngle(o){const u=Qn/(this._pointLabels.length||1),m=this.options.startAngle||0;return Rs(o*u+co(m))}getDistanceFromCenterForValue(o){if(An(o))return NaN;const u=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-o)*u:(o-this.min)*u}getValueForDistanceFromCenter(o){if(An(o))return NaN;const u=o/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-u:this.min+u}getPointLabelContext(o){const u=this._pointLabels||[];if(o>=0&&o<u.length){const m=u[o];return R3(this.getContext(),o,m)}}getPointPosition(o,u,m=0){const _=this.getIndexAngle(o)-wr+m;return{x:Math.cos(_)*u+this.xCenter,y:Math.sin(_)*u+this.yCenter,angle:_}}getPointPositionForValue(o,u){return this.getPointPosition(o,this.getDistanceFromCenterForValue(u))}getBasePosition(o){return this.getPointPositionForValue(o||0,this.getBaseValue())}getPointLabelPosition(o){const{left:u,top:m,right:_,bottom:v}=this._pointLabelItems[o];return{left:u,top:m,right:_,bottom:v}}drawBackground(){const{backgroundColor:o,grid:{circular:u}}=this.options;if(o){const m=this.ctx;m.save(),m.beginPath(),ME(this,this.getDistanceFromCenterForValue(this._endValue),u,this._pointLabels.length),m.closePath(),m.fillStyle=o,m.fill(),m.restore()}}drawGrid(){const o=this.ctx,u=this.options,{angleLines:m,grid:_,border:v}=u,M=this._pointLabels.length;let A,r,k;if(u.pointLabels.display&&L3(this,M),_.display&&this.ticks.forEach((N,G)=>{if(G!==0||G===0&&this.min<0){r=this.getDistanceFromCenterForValue(N.value);const K=this.getContext(G),ie=_.setContext(K),pe=v.setContext(K);k3(this,ie,r,M,pe)}}),m.display){for(o.save(),A=M-1;A>=0;A--){const N=m.setContext(this.getPointLabelContext(A)),{color:G,lineWidth:K}=N;!K||!G||(o.lineWidth=K,o.strokeStyle=G,o.setLineDash(N.borderDash),o.lineDashOffset=N.borderDashOffset,r=this.getDistanceFromCenterForValue(u.ticks.reverse?this.min:this.max),k=this.getPointPosition(A,r),o.beginPath(),o.moveTo(this.xCenter,this.yCenter),o.lineTo(k.x,k.y),o.stroke())}o.restore()}}drawBorder(){}drawLabels(){const o=this.ctx,u=this.options,m=u.ticks;if(!m.display)return;const _=this.getIndexAngle(0);let v,M;o.save(),o.translate(this.xCenter,this.yCenter),o.rotate(_),o.textAlign="center",o.textBaseline="middle",this.ticks.forEach((A,r)=>{if(r===0&&this.min>=0&&!u.reverse)return;const k=m.setContext(this.getContext(r)),N=Pr(k.font);if(v=this.getDistanceFromCenterForValue(this.ticks[r].value),k.showLabelBackdrop){o.font=N.string,M=o.measureText(A.label).width,o.fillStyle=k.backdropColor;const G=es(k.backdropPadding);o.fillRect(-M/2-G.left,-v-N.size/2-G.top,M+G.width,N.size+G.height)}Vc(o,A.label,0,-v,N,{color:k.color,strokeColor:k.textStrokeColor,strokeWidth:k.textStrokeWidth})}),o.restore()}drawTitle(){}}ei(xf,"id","radialLinear"),ei(xf,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:V_.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(o){return o},padding:5,centerPointLabels:!1}}),ei(xf,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),ei(xf,"descriptors",{angleLines:{_fallback:"grid"}});const $_={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},ys=Object.keys($_);function xM(l,o){return l-o}function vM(l,o){if(An(o))return null;const u=l._adapter,{parser:m,round:_,isoWeekday:v}=l._parseOpts;let M=o;return typeof m=="function"&&(M=m(M)),pr(M)||(M=typeof m=="string"?u.parse(M,m):u.parse(M)),M===null?null:(_&&(M=_==="week"&&(Qu(v)||v===!0)?u.startOf(M,"isoWeek",v):u.startOf(M,_)),+M)}function bM(l,o,u,m){const _=ys.length;for(let v=ys.indexOf(l);v<_-1;++v){const M=$_[ys[v]],A=M.steps?M.steps:Number.MAX_SAFE_INTEGER;if(M.common&&Math.ceil((u-o)/(A*M.size))<=m)return ys[v]}return ys[_-1]}function z3(l,o,u,m,_){for(let v=ys.length-1;v>=ys.indexOf(u);v--){const M=ys[v];if($_[M].common&&l._adapter.diff(_,m,M)>=o-1)return M}return ys[u?ys.indexOf(u):0]}function O3(l){for(let o=ys.indexOf(l)+1,u=ys.length;o<u;++o)if($_[ys[o]].common)return ys[o]}function wM(l,o,u){if(!u)l[o]=!0;else if(u.length){const{lo:m,hi:_}=rx(u,o),v=u[m]>=o?u[m]:u[_];l[v]=!0}}function F3(l,o,u,m){const _=l._adapter,v=+_.startOf(o[0].value,m),M=o[o.length-1].value;let A,r;for(A=v;A<=M;A=+_.add(A,1,m))r=u[A],r>=0&&(o[r].major=!0);return o}function TM(l,o,u){const m=[],_={},v=o.length;let M,A;for(M=0;M<v;++M)A=o[M],_[A]=M,m.push({value:A,major:!1});return v===0||!u?m:F3(l,m,_,u)}class Uf extends jc{constructor(o){super(o),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(o,u={}){const m=o.time||(o.time={}),_=this._adapter=new HR._date(o.adapters.date);_.init(u),Sf(m.displayFormats,_.formats()),this._parseOpts={parser:m.parser,round:m.round,isoWeekday:m.isoWeekday},super.init(o),this._normalized=u.normalized}parse(o,u){return o===void 0?null:vM(this,o)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const o=this.options,u=this._adapter,m=o.time.unit||"day";let{min:_,max:v,minDefined:M,maxDefined:A}=this.getUserBounds();function r(k){!M&&!isNaN(k.min)&&(_=Math.min(_,k.min)),!A&&!isNaN(k.max)&&(v=Math.max(v,k.max))}(!M||!A)&&(r(this._getLabelBounds()),(o.bounds!=="ticks"||o.ticks.source!=="labels")&&r(this.getMinMax(!1))),_=pr(_)&&!isNaN(_)?_:+u.startOf(Date.now(),m),v=pr(v)&&!isNaN(v)?v:+u.endOf(Date.now(),m)+1,this.min=Math.min(_,v-1),this.max=Math.max(_+1,v)}_getLabelBounds(){const o=this.getLabelTimestamps();let u=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY;return o.length&&(u=o[0],m=o[o.length-1]),{min:u,max:m}}buildTicks(){const o=this.options,u=o.time,m=o.ticks,_=m.source==="labels"?this.getLabelTimestamps():this._generate();o.bounds==="ticks"&&_.length&&(this.min=this._userMin||_[0],this.max=this._userMax||_[_.length-1]);const v=this.min,M=this.max,A=gk(_,v,M);return this._unit=u.unit||(m.autoSkip?bM(u.minUnit,this.min,this.max,this._getLabelCapacity(v)):z3(this,A.length,u.minUnit,this.min,this.max)),this._majorUnit=!m.major.enabled||this._unit==="year"?void 0:O3(this._unit),this.initOffsets(_),o.reverse&&A.reverse(),TM(this,A,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(o=>+o.value))}initOffsets(o=[]){let u=0,m=0,_,v;this.options.offset&&o.length&&(_=this.getDecimalForValue(o[0]),o.length===1?u=1-_:u=(this.getDecimalForValue(o[1])-_)/2,v=this.getDecimalForValue(o[o.length-1]),o.length===1?m=v:m=(v-this.getDecimalForValue(o[o.length-2]))/2);const M=o.length<3?.5:.25;u=Rr(u,0,M),m=Rr(m,0,M),this._offsets={start:u,end:m,factor:1/(u+1+m)}}_generate(){const o=this._adapter,u=this.min,m=this.max,_=this.options,v=_.time,M=v.unit||bM(v.minUnit,u,m,this._getLabelCapacity(u)),A=sn(_.ticks.stepSize,1),r=M==="week"?v.isoWeekday:!1,k=Qu(r)||r===!0,N={};let G=u,K,ie;if(k&&(G=+o.startOf(G,"isoWeek",r)),G=+o.startOf(G,k?"day":M),o.diff(m,u,M)>1e5*A)throw new Error(u+" and "+m+" are too far apart with stepSize of "+A+" "+M);const pe=_.ticks.source==="data"&&this.getDataTimestamps();for(K=G,ie=0;K<m;K=+o.add(K,A,M),ie++)wM(N,K,pe);return(K===m||_.bounds==="ticks"||ie===1)&&wM(N,K,pe),Object.keys(N).sort(xM).map(ge=>+ge)}getLabelForValue(o){const u=this._adapter,m=this.options.time;return m.tooltipFormat?u.format(o,m.tooltipFormat):u.format(o,m.displayFormats.datetime)}format(o,u){const _=this.options.time.displayFormats,v=this._unit,M=u||_[v];return this._adapter.format(o,M)}_tickFormatFunction(o,u,m,_){const v=this.options,M=v.ticks.callback;if(M)return Xn(M,[o,u,m],this);const A=v.time.displayFormats,r=this._unit,k=this._majorUnit,N=r&&A[r],G=k&&A[k],K=m[u],ie=k&&G&&K&&K.major;return this._adapter.format(o,_||(ie?G:N))}generateTickLabels(o){let u,m,_;for(u=0,m=o.length;u<m;++u)_=o[u],_.label=this._tickFormatFunction(_.value,u,o)}getDecimalForValue(o){return o===null?NaN:(o-this.min)/(this.max-this.min)}getPixelForValue(o){const u=this._offsets,m=this.getDecimalForValue(o);return this.getPixelForDecimal((u.start+m)*u.factor)}getValueForPixel(o){const u=this._offsets,m=this.getDecimalForPixel(o)/u.factor-u.end;return this.min+m*(this.max-this.min)}_getLabelSize(o){const u=this.options.ticks,m=this.ctx.measureText(o).width,_=co(this.isHorizontal()?u.maxRotation:u.minRotation),v=Math.cos(_),M=Math.sin(_),A=this._resolveTickFontOptions(0).size;return{w:m*v+A*M,h:m*M+A*v}}_getLabelCapacity(o){const u=this.options.time,m=u.displayFormats,_=m[u.unit]||m.millisecond,v=this._tickFormatFunction(o,0,TM(this,[o],this._majorUnit),_),M=this._getLabelSize(v),A=Math.floor(this.isHorizontal()?this.width/M.w:this.height/M.h)-1;return A>0?A:1}getDataTimestamps(){let o=this._cache.data||[],u,m;if(o.length)return o;const _=this.getMatchingVisibleMetas();if(this._normalized&&_.length)return this._cache.data=_[0].controller.getAllParsedValues(this);for(u=0,m=_.length;u<m;++u)o=o.concat(_[u].controller.getAllParsedValues(this));return this._cache.data=this.normalize(o)}getLabelTimestamps(){const o=this._cache.labels||[];let u,m;if(o.length)return o;const _=this.getLabels();for(u=0,m=_.length;u<m;++u)o.push(vM(this,_[u]));return this._cache.labels=this._normalized?o:this.normalize(o)}normalize(o){return FS(o.sort(xM))}}ei(Uf,"id","time"),ei(Uf,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function n_(l,o,u){let m=0,_=l.length-1,v,M,A,r;u?(o>=l[m].pos&&o<=l[_].pos&&({lo:m,hi:_}=ba(l,"pos",o)),{pos:v,time:A}=l[m],{pos:M,time:r}=l[_]):(o>=l[m].time&&o<=l[_].time&&({lo:m,hi:_}=ba(l,"time",o)),{time:v,pos:A}=l[m],{time:M,pos:r}=l[_]);const k=M-v;return k?A+(r-A)*(o-v)/k:A}class D0 extends Uf{constructor(o){super(o),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const o=this._getTimestampsForTable(),u=this._table=this.buildLookupTable(o);this._minPos=n_(u,this.min),this._tableRange=n_(u,this.max)-this._minPos,super.initOffsets(o)}buildLookupTable(o){const{min:u,max:m}=this,_=[],v=[];let M,A,r,k,N;for(M=0,A=o.length;M<A;++M)k=o[M],k>=u&&k<=m&&_.push(k);if(_.length<2)return[{time:u,pos:0},{time:m,pos:1}];for(M=0,A=_.length;M<A;++M)N=_[M+1],r=_[M-1],k=_[M],Math.round((N+r)/2)!==k&&v.push({time:k,pos:M/(A-1)});return v}_generate(){const o=this.min,u=this.max;let m=super.getDataTimestamps();return(!m.includes(o)||!m.length)&&m.splice(0,0,o),(!m.includes(u)||m.length===1)&&m.push(u),m.sort((_,v)=>_-v)}_getTimestampsForTable(){let o=this._cache.all||[];if(o.length)return o;const u=this.getDataTimestamps(),m=this.getLabelTimestamps();return u.length&&m.length?o=this.normalize(u.concat(m)):o=u.length?u:m,o=this._cache.all=o,o}getDecimalForValue(o){return(n_(this._table,o)-this._minPos)/this._tableRange}getValueForPixel(o){const u=this._offsets,m=this.getDecimalForPixel(o)/u.factor-u.end;return n_(this._table,m*this._tableRange+this._minPos,!0)}}ei(D0,"id","timeseries"),ei(D0,"defaults",Uf.defaults);var B3=Object.freeze({__proto__:null,CategoryScale:A0,LinearScale:I0,LogarithmicScale:C0,RadialLinearScale:xf,TimeScale:Uf,TimeSeriesScale:D0});const N3=[WR,bO,m3,B3];ya.register(...N3);const V3="/OECD-Vue/assets/AFRICAPOLIS2020-C8Pz-0MU.geojson",U3="/OECD-Vue/assets/UrbAglo_AQdata-DnSSbyQ0.csv",SE=(l,o)=>{const u=l.__vccOpts||l;for(const[m,_]of o)u[m]=_;return u};AS.accessToken="pk.eyJ1IjoiY2FzdHJvcGhvbnkiLCJhIjoiY2x3OTgzdzNtMDB1NDJrbzNpMW16aXRzdyJ9.tU-frPFkcVXo96DfhGf8Pg";const j3={name:"Map",data(){return{map:null,chart:null,chartData:[],cityName:"All Cities"}},mounted(){this.initMap(),this.loadCSVData()},methods:{initMap(){this.map=new AS.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[0,0],zoom:2}),this.map.on("load",()=>{this.loadGeoJSONData()})},loadGeoJSONData(){this.map.addSource("urban-areas",{type:"geojson",data:V3}),this.map.addLayer({id:"urban-areas-fill",type:"fill",source:"urban-areas",paint:{"fill-color":"#888888","fill-opacity":.4},minzoom:8}),this.map.addLayer({id:"urban-areas-outline",type:"line",source:"urban-areas",paint:{"line-color":"#000000","line-width":2},minzoom:8}),this.map.addLayer({id:"urban-areas-centroids",type:"circle",source:"urban-areas",paint:{"circle-radius":6,"circle-color":"#B42222"},maxzoom:10}),this.map.on("click","urban-areas-fill",l=>{const o=l.features[0].properties.agglosName;this.updateChartData(o)})},loadCSVData(){fetch(U3).then(l=>l.text()).then(l=>{RL.parse(l,{header:!0,complete:o=>{this.chartData=o.data,this.updateChartData()}})})},updateChartData(l=null){const o=Array.from({length:23},(_,v)=>1998+v),u=o.map(_=>{const v=`X${_}`;if(l){const M=this.chartData.find(A=>A.Agglomeration_Name===l);return M?parseFloat(M[v]):0}else return this.chartData.reduce((A,r)=>A+parseFloat(r[v]),0)/this.chartData.length});this.cityName=l||"All Cities",this.chart&&this.chart.destroy();const m=this.$refs.chart.getContext("2d");this.chart=new ya(m,{type:"line",data:{labels:o,datasets:[{label:"PM 2.5 Levels",data:u,borderColor:"#42A5F5",fill:!1}]},options:{responsive:!0,maintainAspectRatio:!0,scales:{y:{beginAtZero:!0}}}})},resetChart(){this.map.flyTo({center:[0,0],zoom:2});const l={};this.chartData.forEach(o=>{for(let u=1998;u<=2020;u++)l[u]||(l[u]=[]),l[u].push(parseFloat(o[`X${u}`])||0)});for(let o in l){const u=l[o].reduce((m,_)=>m+_,0);l[o]=u/l[o].length}this.updateChartData(null)}}},G3=xa("div",{id:"map",style:{height:"100vh"}},null,-1),$3={class:"chart-container"},W3=xa("p",null,"Insights from the table",-1),H3={ref:"chart",id:"chart",width:"400",height:"200"};function q3(l,o,u,m,_,v){return gS(),yS("div",null,[G3,xa("div",$3,[xa("h2",null,[vS("PM 2.5 for "),xa("span",null,_P(_.cityName),1)]),xa("button",{id:"reset-btn",onClick:o[0]||(o[0]=(...M)=>v.resetChart&&v.resetChart(...M))},"Reset"),W3,xa("canvas",H3,null,512)])])}const Z3=SE(j3,[["render",q3]]),X3={name:"App",components:{MapComponent:Z3}},Y3={id:"app"};function K3(l,o,u,m,_,v){const M=nD("MapComponent");return gS(),yS("div",Y3,[bl(M)])}const J3=SE(X3,[["render",K3]]);CL(J3).mount("#app");
